# BVT Test Report - FULL Mode

**Generated:** 2025-09-24T23:59:13.182Z

## Summary

- **Total Tests:** 13
- **Passed:** 1
- **Failed:** 12
- **Critical Failures:** 7
- **Success Rate:** 7.7%
- **Total Duration:** 1152.03s
- **Overall Result:** ❌ FAIL

## Test Results

| Category | Name | Status | Duration | Critical | Error |
|----------|------|--------|----------|----------|-------|
| unit | Unit Tests | ✅ PASS | 15.56s | 🔴 Yes | - |
| integration | Integration Tests | ❌ FAIL | 180.17s | 🔴 Yes | Command failed: npm run test:integration
FAIL src/... |
| e2e | End-to-End Tests | ❌ FAIL | 300.05s | 🔴 Yes | Command failed: npm run test:e2e
[1A[2K[chromium... |
| system | System Tests | ❌ FAIL | 2.60s | 🔴 Yes | Command failed: npm run test:comprehensive
... |
| regression | Regression Tests | ❌ FAIL | 3.82s | 🟡 No | Command failed: npm run test:regression:comprehens... |
| acceptance | Acceptance Tests | ❌ FAIL | 2.50s | 🔴 Yes | Command failed: npm run test:acceptance:comprehens... |
| performance | Performance Tests | ❌ FAIL | 314.84s | 🟡 No | Command failed: npm run test:performance
FAIL src/... |
| security | Security Tests | ❌ FAIL | 62.48s | 🔴 Yes | Command failed: npm run test:security
FAIL src/__t... |
| accessibility | Accessibility Tests | ❌ FAIL | 10.38s | 🟡 No | Command failed: npm run test:accessibility
... |
| compatibility | Compatibility Tests | ❌ FAIL | 2.94s | 🟡 No | Command failed: npm run test:compatibility:compreh... |
| exploratory | Exploratory Tests | ❌ FAIL | 16.58s | 🟡 No | Command failed: npm run test:exploratory:comprehen... |
| smoke | Smoke Tests | ❌ FAIL | 60.05s | 🔴 Yes | Command failed: npm run test:bvt
... |
| memory | Memory Stress Tests | ❌ FAIL | 180.06s | 🔴 Yes | Command failed: npm run test:memory
... |

## Failed Tests Details

### Integration Tests

**Error:** Command failed: npm run test:integration
FAIL src/__tests__/login-csrf-integration.test.tsx (7.555 s)
  Login Page CSRF Integration
    CSRF Token Loading States
      √ should show loading message only during initial load (99 ms)
      × should not show 401 errors to users (16 ms)
      × should show non-401 errors to users (19 ms)
      √ should not show loading and error simultaneously (11 ms)
    Successful CSRF Token Load
      × should enable form submission when token is loaded (76 ms)
      √ should disable form submission without valid token (31 ms)
    Form Submission with CSRF Protection
      × should submit form with CSRF token (1038 ms)
      × should handle form submission errors gracefully (1041 ms)
    Rate Limiting Handling
      × should show rate limit message and countdown (1043 ms)
    Authentication Check
      × should redirect if already authenticated (1016 ms)
      √ should stay on login page if not authenticated (10 ms)

  ● Login Page CSRF Integration › CSRF Token Loading States › should not show 401 errors to users

    expect(element).not.toBeInTheDocument()

    expected document not to contain element, found <div class="text-sm text-blue-700">Loading security token...</div> instead

    [0m [90m 87 |[39m
     [90m 88 |[39m       [90m// Should not show loading message when not loading[39m
    [31m[1m>[22m[39m[90m 89 |[39m       expect(screen[33m.[39mqueryByText([32m'Loading security token...'[39m))[33m.[39mnot[33m.[39mtoBeInTheDocument()
     [90m    |[39m                                                                   [31m[1m^[22m[39m
     [90m 90 |[39m     })
     [90m 91 |[39m
     [90m 92 |[39m     it([32m'should show non-401 errors to users'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBeInTheDocument (src/__tests__/login-csrf-integration.test.tsx:89:67)

  ● Login Page CSRF Integration › CSRF Token Loading States › should show non-401 errors to users

    TestingLibraryElementError: Unable to find an element with the text: Network error occurred. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
              [36m>[39m
                [36m<img[39m
                  [33malt[39m=[32m"Business Scraper Logo"[39m
                  [33mclass[39m=[32m"object-contain"[39m
                  [33mheight[39m=[32m"40"[39m
                  [33mquality[39m=[32m"90"[39m
                  [33msizes[39m=[32m"40px"[39m
                  [33msrc[39m=[32m"/favicon.ico"[39m
                  [33mwidth[39m=[32m"40"[39m
                [36m/>[39m
                [36m<h2[39m
                  [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                [36m>[39m
                  [0mBusiness Scraper[0m
                [36m</h2>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
              [36m>[39m
                [0mSign in to access the application[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
            [36m>[39m
              [36m<form[39m
                [33mclass[39m=[32m"space-y-6"[39m
              [36m>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"username"[39m
                  [36m>[39m
                    [0mUsername[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"username"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"username"[39m
                        [33mname[39m=[32m"username"[39m
                        [33mplaceholder[39m=[32m"Username"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"password"[39m
                  [36m>[39m
                    [0mPassword[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"current-password"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"password"[39m
                        [33mname[39m=[32m"password"[39m
                        [33mplaceholder[39m=[32m"Password"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"password"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"rounded-md bg-blue-50 p-4"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"text-sm text-blue-700"[39m
                  [36m>[39m
                    [0mLoading security token...[0m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mtype[39m=[32m"submit"[39m
                  [36m>[39m
                    [0mSign in[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</form>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"text-center"[39m
            [36m>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-xs text-gray-500"[39m
              [36m>[39m
                [0mThis is a single-user application. Contact your administrator for access.[0m
              [36m</p>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 104 |[39m
     [90m 105 |[39m       [90m// Should show non-401 errors[39m
    [31m[1m>[22m[39m[90m 106 |[39m       expect(screen[33m.[39mgetByText([32m'Network error occurred'[39m))[33m.[39mtoBeInTheDocument()
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 107 |[39m     })
     [90m 108 |[39m
     [90m 109 |[39m     it([32m'should not show loading and error simultaneously'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/login-csrf-integration.test.tsx:106:21)

  ● Login Page CSRF Integration › Successful CSRF Token Load › should enable form submission when token is loaded

    expect(element).not.toBeDisabled()

    Received element is disabled:
      <button class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center" disabled="" type="submit" />

    [0m [90m 156 |[39m       [90m// Submit button should be enabled[39m
     [90m 157 |[39m       [36mconst[39m submitButton [33m=[39m screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/sign in/i[39m })
    [31m[1m>[22m[39m[90m 158 |[39m       expect(submitButton)[33m.[39mnot[33m.[39mtoBeDisabled()
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 159 |[39m
     [90m 160 |[39m       [90m// Should not show any error or loading messages[39m
     [90m 161 |[39m       expect(screen[33m.[39mqueryByText([32m'Loading security token...'[39m))[33m.[39mnot[33m.[39mtoBeInTheDocument()[0m

      at Object.toBeDisabled (src/__tests__/login-csrf-integration.test.tsx:158:32)

  ● Login Page CSRF Integration › Form Submission with CSRF Protection › should submit form with CSRF token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/auth", {"password": "password", "username": "admin"}

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
            [36m>[39m
              [36m<div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
                [36m>[39m
                  [36m<img[39m
                    [33malt[39m=[32m"Business Scraper Logo"[39m
                    [33mclass[39m=[32m"object-contain"[39m
                    [33mheight[39m=[32m"40"[39m
                    [33mquality[39m=[32m"90"[39m
                    [33msizes[39m=[32m"40px"[39m
                    [33msrc[39m=[32m"/favicon.ico"[39m
                    [33mwidth[39m=[32m"40"[39m
                  [36m/>[39m
                  [36m<h2[39m
                    [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                  [36m>[39m
                    [0mBusiness Scraper[0m
                  [36m</h2>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
                [36m>[39m
                  [0mSign in to access the application[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
              [36m>[39m
                [36m<form[39m
                  [33mclass[39m=[32m"space-y-6"[39m
                [36m>[39m
                  [36m<div>[39m
                    [36m<label[39m
                      [33mclass[39m=[32m"sr-only"[39m
                      [33mfor[39m=[32m"username"[39m
                    [36m>[39m
                      [0mUsername[0m
                    [36m</label>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"space-y-2"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"relative"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33maria-invalid[39m=[32m"false"[39m
                          [33mautocomplete[39m=[32m"username"[39m
                          [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                          [33mid[39m=[32m"username"[39m
                          [33mname[39m=[32m"username"[39m
                          [33mplaceholder[39m=[32m"Username"[39m
                          [33mrequired[39m=[32m""[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m"admin"[39m
                        [36m/>[39m
                        [36m<div[39m
                          [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div>[39m
                    [36m<label[39m
                      [33mclass[39m=[32m"sr-only"[39m
                      [33mfor[39m=[32m"password"[39m
                    [36m>[39m
                      [0mPassword[0m
                    [36m</label>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"space-y-2"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"relative"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33maria-invalid[39m=[32m"false"[39m
                          [33mautocomplete[39m=[32m"current-password"[39m
                          [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                          [33mid[39m=[32m"password"[39m
                          [33mname[39m=[32m"password"[39m
                          [33mplaceholder[39m=[32m"Password"[39m
                          [33mrequired[39m=[32m""[39m
                          [33mtype[39m=[32m"password"[39m
                          [33mvalue[39m=[32m"password"[39m
                        [36m/>[39m
                        [36m<div[39m
                          [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div>[39m
                    [36m<button[39m
                      [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                      [33mdisabled[39m=[32m""[39m
                      [33mtype[39m=[32m"submit"[39m
                    [36m>[39m
                      [0mSign in[0m
                    [36m</button>[39m
                  [36m</div>[39m
                [36m</form>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-center"[39m
              [36m>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-xs text-gray-500"[39m
                [36m>[39m
                  [0mThis is a single-user application. Contact your administrator for access.[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 225 |[39m
     [90m 226 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 227 |[39m         expect(mockSubmitForm)[33m.[39mtoHaveBeenCalledWith([32m'/api/auth'[39m[33m,[39m {
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 228 |[39m           username[33m:[39m [32m'admin'[39m[33m,[39m
     [90m 229 |[39m           password[33m:[39m [32m'password'[39m[33m,[39m
     [90m 230 |[39m         })[0m

      at toHaveBeenCalledWith (src/__tests__/login-csrf-integration.test.tsx:227:32)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● Login Page CSRF Integration › Form Submission with CSRF Protection › should handle form submission errors gracefully

    Unable to find an element with the text: Invalid credentials. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
              [36m>[39m
                [36m<img[39m
                  [33malt[39m=[32m"Business Scraper Logo"[39m
                  [33mclass[39m=[32m"object-contain"[39m
                  [33mheight[39m=[32m"40"[39m
                  [33mquality[39m=[32m"90"[39m
                  [33msizes[39m=[32m"40px"[39m
                  [33msrc[39m=[32m"/favicon.ico"[39m
                  [33mwidth[39m=[32m"40"[39m
                [36m/>[39m
                [36m<h2[39m
                  [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                [36m>[39m
                  [0mBusiness Scraper[0m
                [36m</h2>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
              [36m>[39m
                [0mSign in to access the application[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
            [36m>[39m
              [36m<form[39m
                [33mclass[39m=[32m"space-y-6"[39m
              [36m>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"username"[39m
                  [36m>[39m
                    [0mUsername[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"username"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"username"[39m
                        [33mname[39m=[32m"username"[39m
                        [33mplaceholder[39m=[32m"Username"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m"admin"[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"password"[39m
                  [36m>[39m
                    [0mPassword[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"current-password"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"password"[39m
                        [33mname[39m=[32m"password"[39m
                        [33mplaceholder[39m=[32m"Password"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"password"[39m
                        [33mvalue[39m=[32m"wrong"[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mtype[39m=[32m"submit"[39m
                  [36m>[39m
                    [0mSign in[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</form>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"text-center"[39m
            [36m>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-xs text-gray-500"[39m
              [36m>[39m
                [0mThis is a single-user application. Contact your administrator for access.[0m
              [36m</p>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 266 |[39m       fireEvent[33m.[39mclick(screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/sign in/i[39m }))
     [90m 267 |[39m
    [31m[1m>[22m[39m[90m 268 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 269 |[39m         expect(screen[33m.[39mgetByText([32m'Invalid credentials'[39m))[33m.[39mtoBeInTheDocument()
     [90m 270 |[39m       })
     [90m 271 |[39m     })[0m

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/__tests__/login-csrf-integration.test.tsx:268:20)

  ● Login Page CSRF Integration › Rate Limiting Handling › should show rate limit message and countdown

    Unable to find an element with the text: /Too many failed attempts/. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
              [36m>[39m
                [36m<img[39m
                  [33malt[39m=[32m"Business Scraper Logo"[39m
                  [33mclass[39m=[32m"object-contain"[39m
                  [33mheight[39m=[32m"40"[39m
                  [33mquality[39m=[32m"90"[39m
                  [33msizes[39m=[32m"40px"[39m
                  [33msrc[39m=[32m"/favicon.ico"[39m
                  [33mwidth[39m=[32m"40"[39m
                [36m/>[39m
                [36m<h2[39m
                  [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                [36m>[39m
                  [0mBusiness Scraper[0m
                [36m</h2>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
              [36m>[39m
                [0mSign in to access the application[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
            [36m>[39m
              [36m<form[39m
                [33mclass[39m=[32m"space-y-6"[39m
              [36m>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"username"[39m
                  [36m>[39m
                    [0mUsername[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"username"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"username"[39m
                        [33mname[39m=[32m"username"[39m
                        [33mplaceholder[39m=[32m"Username"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m"admin"[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"password"[39m
                  [36m>[39m
                    [0mPassword[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"current-password"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"password"[39m
                        [33mname[39m=[32m"password"[39m
                        [33mplaceholder[39m=[32m"Password"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"password"[39m
                        [33mvalue[39m=[32m"wrong"[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mtype[39m=[32m"submit"[39m
                  [36m>[39m
                    [0mSign in[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</form>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"text-center"[39m
            [36m>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-xs text-gray-500"[39m
              [36m>[39m
                [0mThis is a single-user application. Contact your administrator for access.[0m
              [36m</p>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 310 |[39m       fireEvent[33m.[39mclick(screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/sign in/i[39m }))
     [90m 311 |[39m
    [31m[1m>[22m[39m[90m 312 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 313 |[39m         expect(screen[33m.[39mgetByText([35m/Too many failed attempts/[39m))[33m.[39mtoBeInTheDocument()
     [90m 314 |[39m         expect(screen[33m.[39mgetByText([35m/Retry in 60 seconds/[39m))[33m.[39mtoBeInTheDocument()
     [90m 315 |[39m       })[0m

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/__tests__/login-csrf-integration.test.tsx:312:20)

  ● Login Page CSRF Integration › Authentication Check › should redirect if already authenticated

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/"

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
            [36m>[39m
              [36m<div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
                [36m>[39m
                  [36m<img[39m
                    [33malt[39m=[32m"Business Scraper Logo"[39m
                    [33mclass[39m=[32m"object-contain"[39m
                    [33mheight[39m=[32m"40"[39m
                    [33mquality[39m=[32m"90"[39m
                    [33msizes[39m=[32m"40px"[39m
                    [33msrc[39m=[32m"/favicon.ico"[39m
                    [33mwidth[39m=[32m"40"[39m
                  [36m/>[39m
                  [36m<h2[39m
                    [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                  [36m>[39m
                    [0mBusiness Scraper[0m
                  [36m</h2>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
                [36m>[39m
                  [0mSign in to access the application[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
              [36m>[39m
                [36m<form[39m
                  [33mclass[39m=[32m"space-y-6"[39m
                [36m>[39m
                  [36m<div>[39m
                    [36m<label[39m
                      [33mclass[39m=[32m"sr-only"[39m
                      [33mfor[39m=[32m"username"[39m
                    [36m>[39m
                      [0mUsername[0m
                    [36m</label>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"space-y-2"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"relative"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33maria-invalid[39m=[32m"false"[39m
                          [33mautocomplete[39m=[32m"username"[39m
                          [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                          [33mid[39m=[32m"username"[39m
                          [33mname[39m=[32m"username"[39m
                          [33mplaceholder[39m=[32m"Username"[39m
                          [33mrequired[39m=[32m""[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                        [36m<div[39m
                          [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div>[39m
                    [36m<label[39m
                      [33mclass[39m=[32m"sr-only"[39m
                      [33mfor[39m=[32m"password"[39m
                    [36m>[39m
                      [0mPassword[0m
                    [36m</label>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"space-y-2"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"relative"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33maria-invalid[39m=[32m"false"[39m
                          [33mautocomplete[39m=[32m"current-password"[39m
                          [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                          [33mid[39m=[32m"password"[39m
                          [33mname[39m=[32m"password"[39m
                          [33mplaceholder[39m=[32m"Password"[39m
                          [33mrequired[39m=[32m""[39m
                          [33mtype[39m=[32m"password"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                        [36m<div[39m
                          [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div>[39m
                    [36m<button[39m
                      [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                      [33mdisabled[39m=[32m""[39m
                      [33mtype[39m=[32m"submit"[39m
                    [36m>[39m
                      [0mSign in[0m
                    [36m</button>[39m
                  [36m</div>[39m
                [36m</form>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-center"[39m
              [36m>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-xs text-gray-500"[39m
                [36m>[39m
                  [0mThis is a single-user application. Contact your administrator for access.[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 343 |[39m
     [90m 344 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 345 |[39m         expect(mockPush)[33m.[39mtoHaveBeenCalledWith([32m'/'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 346 |[39m       })
     [90m 347 |[39m     })
     [90m 348 |[39m[0m

      at toHaveBeenCalledWith (src/__tests__/login-csrf-integration.test.tsx:345:26)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

FAIL src/__tests__/debug-solution-integration.test.tsx
  Debug Solution Integration
    Complete Debug Mode Flow
      × should enable debug mode and prevent auto-reload during security token errors (46 ms)
      × should allow normal reload when debug mode is disabled (3 ms)
      × should provide debug utilities in console when debug mode is active (1024 ms)
      × should capture and persist security token loading errors (6 ms)
      × should show reload prevention notification when auto-reload is blocked (1011 ms)
    Error Recovery and Debugging
      × should provide comprehensive error data for debugging (4 ms)

  ● Debug Solution Integration › Complete Debug Mode Flow › should enable debug mode and prevent auto-reload during security token errors

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 47 |[39m       [90m// Enable debug mode[39m
     [90m 48 |[39m       enableDebugMode()
    [31m[1m>[22m[39m[90m 49 |[39m       expect(isDebugMode())[33m.[39mtoBe([36mtrue[39m)
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 50 |[39m       
     [90m 51 |[39m       [90m// Initialize debug system[39m
     [90m 52 |[39m       render([33m<[39m[33mDebugSystemInitializer[39m [33m/[39m[33m>[39m)[0m

      at Object.toBe (src/__tests__/debug-solution-integration.test.tsx:49:29)

  ● Debug Solution Integration › Complete Debug Mode Flow › should allow normal reload when debug mode is disabled

    TypeError: Cannot redefine property: reload
        at Function.defineProperty (<anonymous>)

    [0m [90m 104 |[39m       [36mconst[39m originalReload [33m=[39m window[33m.[39mlocation[33m.[39mreload
     [90m 105 |[39m       [36mconst[39m reloadSpy [33m=[39m jest[33m.[39mfn()
    [31m[1m>[22m[39m[90m 106 |[39m       [33mObject[39m[33m.[39mdefineProperty(window[33m.[39mlocation[33m,[39m [32m'reload'[39m[33m,[39m {
     [90m     |[39m              [31m[1m^[22m[39m
     [90m 107 |[39m         writable[33m:[39m [36mtrue[39m[33m,[39m
     [90m 108 |[39m         value[33m:[39m reloadSpy
     [90m 109 |[39m       })[0m

      at Object.defineProperty (src/__tests__/debug-solution-integration.test.tsx:106:14)

  ● Debug Solution Integration › Complete Debug Mode Flow › should provide debug utilities in console when debug mode is active

    expect(received).toBeDefined()

    Received: undefined

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 130 |[39m       [90m// Wait for debug utilities to be available[39m
     [90m 131 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 132 |[39m         expect((window [36mas[39m any)[33m.[39mdebugUtils)[33m.[39mtoBeDefined()
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 133 |[39m         expect([36mtypeof[39m (window [36mas[39m any)[33m.[39mdebugUtils[33m.[39menableDebugMode)[33m.[39mtoBe([32m'function'[39m)
     [90m 134 |[39m         expect([36mtypeof[39m (window [36mas[39m any)[33m.[39mdebugUtils[33m.[39mdisableDebugMode)[33m.[39mtoBe([32m'function'[39m)
     [90m 135 |[39m         expect([36mtypeof[39m (window [36mas[39m any)[33m.[39mdebugUtils[33m.[39mgetErrorAnalytics)[33m.[39mtoBe([32m'function'[39m)[0m

      at toBeDefined (src/__tests__/debug-solution-integration.test.tsx:132:44)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● Debug Solution Integration › Complete Debug Mode Flow › should capture and persist security token loading errors

    expect(received).toHaveLength(expected)

    Expected length: 4
    Received length: 0
    Received array:  []

    [0m [90m 167 |[39m       [90m// Verify all errors were persisted[39m
     [90m 168 |[39m       [36mconst[39m persistedErrors [33m=[39m errorPersistenceManager[33m.[39mgetCurrentSessionErrors()
    [31m[1m>[22m[39m[90m 169 |[39m       expect(persistedErrors)[33m.[39mtoHaveLength([35m4[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 170 |[39m       
     [90m 171 |[39m       [90m// Verify error analytics[39m
     [90m 172 |[39m       [36mconst[39m analytics [33m=[39m errorPersistenceManager[33m.[39mgetErrorAnalytics()[0m

      at Object.toHaveLength (src/__tests__/debug-solution-integration.test.tsx:169:31)

  ● Debug Solution Integration › Complete Debug Mode Flow › should show reload prevention notification when auto-reload is blocked

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: undefined

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 196 |[39m           el[33m.[39mtextContent[33m?[39m[33m.[39mincludes([32m'Auto-reload Prevented'[39m)
     [90m 197 |[39m         )
    [31m[1m>[22m[39m[90m 198 |[39m         expect(reloadNotification)[33m.[39mtoBeInTheDocument()
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 199 |[39m         expect(reloadNotification[33m?[39m[33m.[39mtextContent)[33m.[39mtoContain([32m'Security token error occurred'[39m)
     [90m 200 |[39m       })
     [90m 201 |[39m     })[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at toBeInTheDocument (src/__tests__/debug-solution-integration.test.tsx:198:36)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● Debug Solution Integration › Error Recovery and Debugging › should provide comprehensive error data for debugging

    TypeError: Cannot read properties of undefined (reading 'totalErrors')

    [0m [90m 233 |[39m       [36mconst[39m exportedData [33m=[39m errorPersistenceManager[33m.[39mexportErrorData()
     [90m 234 |[39m       
    [31m[1m>[22m[39m[90m 235 |[39m       expect(exportedData[33m.[39msummary[33m.[39mtotalErrors)[33m.[39mtoBe([35m3[39m)
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 236 |[39m       expect(exportedData[33m.[39msummary[33m.[39mtotalSessions)[33m.[39mtoBe([35m1[39m)
     [90m 237 |[39m       expect(exportedData[33m.[39merrors)[33m.[39mtoHaveLength([35m3[39m)
     [90m 238 |[39m       [0m

      at Object.totalErrors (src/__tests__/debug-solution-integration.test.tsx:235:35)

FAIL src/tests/integration/payment-api.test.ts
  Payment API Integration Tests
    Stripe Webhook Handler
      √ should process valid webhook with signature (4 ms)
      √ should reject webhook without signature (2 ms)
      √ should reject webhook with invalid signature (2 ms)
      √ should handle subscription update events (2 ms)
      √ should handle payment success events (4 ms)
      √ should handle unhandled event types gracefully (5 ms)
    Payment Intent Creation API
      × should create payment intent for authenticated user (4 ms)
      × should reject unauthenticated requests (6 ms)
      × should validate request body (5 ms)
      × should handle Stripe errors gracefully (2 ms)
    Payment Intent Retrieval API
      × should retrieve payment intent for authenticated user (5 ms)
      √ should reject request without payment intent ID (1 ms)
      × should reject unauthorized access to payment intent (2 ms)

  ● Payment API Integration Tests › Payment Intent Creation API › should create payment intent for authenticated user

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 217 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createPaymentIntentHandler(request)
     [90m 218 |[39m
    [31m[1m>[22m[39m[90m 219 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 220 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 221 |[39m       expect(responseData[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 222 |[39m       expect(responseData[33m.[39mclientSecret)[33m.[39mtoBe([32m'pi_123_secret'[39m)[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:219:31)

  ● Payment API Integration Tests › Payment Intent Creation API › should reject unauthenticated requests

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 400

    [0m [90m 236 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createPaymentIntentHandler(request)
     [90m 237 |[39m
    [31m[1m>[22m[39m[90m 238 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 239 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 240 |[39m       expect(responseData[33m.[39merror)[33m.[39mtoBe([32m'Authentication required'[39m)
     [90m 241 |[39m     })[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:238:31)

  ● Payment API Integration Tests › Payment Intent Creation API › should validate request body

    expect(received).toBe(expected) // Object.is equality

    Expected: "Validation failed"
    Received: "Invalid JSON in request body"

    [0m [90m 255 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m 256 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
    [31m[1m>[22m[39m[90m 257 |[39m       expect(responseData[33m.[39merror)[33m.[39mtoBe([32m'Validation failed'[39m)
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 258 |[39m     })
     [90m 259 |[39m
     [90m 260 |[39m     it([32m'should handle Stripe errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:257:34)

  ● Payment API Integration Tests › Payment Intent Creation API › should handle Stripe errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

    [0m [90m 272 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createPaymentIntentHandler(request)
     [90m 273 |[39m
    [31m[1m>[22m[39m[90m 274 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 275 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 276 |[39m       expect(responseData[33m.[39merror)[33m.[39mtoBe([32m'Failed to create payment intent'[39m)
     [90m 277 |[39m     })[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:274:31)

  ● Payment API Integration Tests › Payment Intent Retrieval API › should retrieve payment intent for authenticated user

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 326 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getPaymentIntentHandler(request)
     [90m 327 |[39m
    [31m[1m>[22m[39m[90m 328 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 329 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 330 |[39m       expect(responseData[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 331 |[39m       expect(responseData[33m.[39mpaymentIntent[33m.[39mid)[33m.[39mtoBe([32m'pi_123'[39m)[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:328:31)

  ● Payment API Integration Tests › Payment Intent Retrieval API › should reject unauthorized access to payment intent

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 500

    [0m [90m 370 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getPaymentIntentHandler(request)
     [90m 371 |[39m
    [31m[1m>[22m[39m[90m 372 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 373 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 374 |[39m       expect(responseData[33m.[39merror)[33m.[39mtoBe([32m'Payment intent not found'[39m)
     [90m 375 |[39m     })[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:372:31)

FAIL src/__tests__/integration/csrf-auth-fix.test.ts
  CSRF Authentication Fix Integration Test
    CSRF Token Fetching
      × should successfully fetch CSRF token from /api/csrf without 401 error (5 ms)
      × should set proper cookies for session and CSRF token (3 ms)
    Authentication Flow
      × should complete full authentication flow without CSRF errors (4 ms)
    Error Handling
      × should handle CSRF endpoint errors gracefully (4 ms)
    Security Compliance
      × should log security events for audit compliance (3 ms)
      × should include proper security headers (3 ms)

  ● CSRF Authentication Fix Integration Test › CSRF Token Fetching › should successfully fetch CSRF token from /api/csrf without 401 error

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 78 |[39m       })
     [90m 79 |[39m
    [31m[1m>[22m[39m[90m 80 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m csrfGet(request)
     [90m    |[39m                                     [31m[1m^[22m[39m
     [90m 81 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 82 |[39m
     [90m 83 |[39m       [90m// Verify successful response[39m[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:80:37)

  ● CSRF Authentication Fix Integration Test › CSRF Token Fetching › should set proper cookies for session and CSRF token

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 103 |[39m       })
     [90m 104 |[39m
    [31m[1m>[22m[39m[90m 105 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m csrfGet(request)
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 106 |[39m
     [90m 107 |[39m       [90m// Check that session cookie is set[39m
     [90m 108 |[39m       [36mconst[39m setCookieHeaders [33m=[39m response[33m.[39mheaders[33m.[39mgetSetCookie()[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:105:37)

  ● CSRF Authentication Fix Integration Test › Authentication Flow › should complete full authentication flow without CSRF errors

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 129 |[39m       })
     [90m 130 |[39m
    [31m[1m>[22m[39m[90m 131 |[39m       [36mconst[39m csrfResponse [33m=[39m [36mawait[39m csrfGet(csrfRequest)
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 132 |[39m       [36mconst[39m csrfData [33m=[39m [36mawait[39m csrfResponse[33m.[39mjson()
     [90m 133 |[39m
     [90m 134 |[39m       expect(csrfResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:131:41)

  ● CSRF Authentication Fix Integration Test › Error Handling › should handle CSRF endpoint errors gracefully

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 177 |[39m       })
     [90m 178 |[39m
    [31m[1m>[22m[39m[90m 179 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m csrfGet(request)
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 180 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 181 |[39m
     [90m 182 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:179:37)

  ● CSRF Authentication Fix Integration Test › Security Compliance › should log security events for audit compliance

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 197 |[39m       })
     [90m 198 |[39m
    [31m[1m>[22m[39m[90m 199 |[39m       [36mawait[39m csrfGet(request)
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 200 |[39m
     [90m 201 |[39m       [90m// Verify audit logging[39m
     [90m 202 |[39m       expect(auditService[33m.[39mlogAuditEvent)[33m.[39mtoHaveBeenCalledWith([0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:199:20)

  ● CSRF Authentication Fix Integration Test › Security Compliance › should include proper security headers

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 222 |[39m       })
     [90m 223 |[39m
    [31m[1m>[22m[39m[90m 224 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m csrfGet(request)
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 225 |[39m
     [90m 226 |[39m       [90m// Verify security headers[39m
     [90m 227 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-CSRF-Token'[39m))[33m.[39mtoBeDefined()[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:224:37)

FAIL src/__tests__/lib/integrations/api-framework.test.ts
  ApiFramework
    Handler Creation
      √ should create handler with default options (2 ms)
      √ should create handler with custom options (2 ms)
    Request Processing
      × should process successful request (7 ms)
      √ should handle rate limit exceeded (11 ms)
      √ should handle handler errors (9 ms)
    Authentication
      √ should handle missing authentication (4 ms)
      √ should handle API key authentication (4 ms)
    Authorization
      √ should enforce permission requirements (3 ms)
      √ should allow access with correct permissions (2 ms)
    CORS Handling
      √ should handle OPTIONS preflight request (3 ms)
      √ should add CORS headers to responses (3 ms)
    Response Headers
      √ should include standard headers (8 ms)
    Metrics Integration
      × should record request metrics (4 ms)
      √ should record rate limit hits (3 ms)
    Health and Metrics
      √ should provide health status (3 ms)
      √ should provide metrics (2 ms)

  ● ApiFramework › Request Processing › should process successful request

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_bodyUsed": false, "body": undefined, "cookies": {"delete": [Function mockConstructor], "get": [Function mockConstructor], "getAll": [Function mockConstructor], "has": [Function mockConstructor], "set": [Function mockConstructor]}, "headers": {}, "method": "GET", "nextUrl": "https://example.com/api/v1/test", "url": "https://example.com/api/v1/test", Symbol(internal request): {"cookies": {"_headers": {}, "_parsed": Map {}}, "geo": {}, "ip": undefined, "nextUrl": "https://example.com/api/v1/test", "url": "https://example.com/api/v1/test"}},
    - ObjectContaining {"metadata": ObjectContaining {"ip": "127.0.0.1", "method": "GET", "userAgent": "test-agent"}, "permissions": Any<Array>, "requestId": Any<String>},
    + {"clientId": "oauth-client", "metadata": {"ip": undefined, "method": "GET", "pathname": "/api/v1/test", "userAgent": "test-agent"}, "permissions": ["read:businesses", "write:businesses", "read:exports", "write:exports"], "rateLimit": {"remaining": 99, "resetTime": 60}, "requestId": "req_1758757230614_r2vym0ikp", "startTime": 1758757230614, "userId": "oauth-user"},

    Number of calls: 1

    [0m [90m 89 |[39m
     [90m 90 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 91 |[39m       expect(mockHandler)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 92 |[39m         mockRequest[33m,[39m
     [90m 93 |[39m         expect[33m.[39mobjectContaining({
     [90m 94 |[39m           requestId[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.toHaveBeenCalledWith (src/__tests__/lib/integrations/api-framework.test.ts:91:27)

  ● ApiFramework › Metrics Integration › should record request metrics

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<String>, Any<String>, "GET", 200, Any<Number>, Any<Number>, ObjectContaining {"ip": "127.0.0.1", "userAgent": "test-agent"}
    Received: "oauth-client", "/api/v1/test", "GET", 200, 1, 128, {"ip": undefined, "userAgent": "test-agent"}

    Number of calls: 1

    [0m [90m 346 |[39m       [36mawait[39m handler(mockRequest)
     [90m 347 |[39m
    [31m[1m>[22m[39m[90m 348 |[39m       expect(apiMetricsService[33m.[39mrecordRequest)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 349 |[39m         expect[33m.[39many([33mString[39m)[33m,[39m [90m// clientId[39m
     [90m 350 |[39m         expect[33m.[39many([33mString[39m)[33m,[39m [90m// endpoint[39m
     [90m 351 |[39m         [32m'GET'[39m[33m,[39m [90m// method[39m[0m

      at Object.toHaveBeenCalledWith (src/__tests__/lib/integrations/api-framework.test.ts:348:47)

FAIL src/tests/integration/api.test.ts
  API Integration Tests
    Enhanced Scraping API (/api/enhanced-scrape)
      POST requests
        × should initialize scraping engine (2 ms)
        × should add a scraping job (3 ms)
        × should validate URL parameter (1 ms)
        × should validate URL format (1 ms)
        × should add multiple jobs (1 ms)
        × should limit batch job size (1 ms)
        × should get job status (2 ms)
        × should cancel a job (2 ms)
        × should handle invalid actions (2 ms)
      GET requests
        × should get scraping statistics (2 ms)
    Data Management API (/api/data-management)
      POST requests
        × should validate business data (2 ms)
        × should validate batch of businesses (5 ms)
        × should limit batch validation size (2 ms)
        × should find duplicates (1 ms)
        × should compare two records (2 ms)
        × should get retention policies (2 ms)
        × should export data with enhanced options (3 ms)
      GET requests
        × should get overview statistics (2 ms)
        × should get validation statistics (8 ms)
        × should handle invalid stats type (2 ms)
    Error Handling
      × should handle malformed JSON (1 ms)
      × should handle missing request body (2 ms)
      × should handle database connection errors (2 ms)
    Security Tests
      × should sanitize input data (2 ms)
      × should validate content type (3 ms)
      × should handle large payloads (54 ms)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should initialize scraping engine

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 51 |[39m         })
     [90m 52 |[39m
    [31m[1m>[22m[39m[90m 53 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 54 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 55 |[39m
     [90m 56 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:53:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should add a scraping job

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 71 |[39m         })
     [90m 72 |[39m
    [31m[1m>[22m[39m[90m 73 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 74 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 75 |[39m
     [90m 76 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:73:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should validate URL parameter

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 92 |[39m         })
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 95 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 96 |[39m
     [90m 97 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:94:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should validate URL format

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 109 |[39m         })
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 112 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 113 |[39m
     [90m 114 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:111:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should add multiple jobs

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 128 |[39m         })
     [90m 129 |[39m
    [31m[1m>[22m[39m[90m 130 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 131 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 132 |[39m
     [90m 133 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:130:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should limit batch job size

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 148 |[39m         })
     [90m 149 |[39m
    [31m[1m>[22m[39m[90m 150 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 151 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 152 |[39m
     [90m 153 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:150:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should get job status

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 165 |[39m         })
     [90m 166 |[39m
    [31m[1m>[22m[39m[90m 167 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 168 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 169 |[39m
     [90m 170 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:167:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should cancel a job

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 183 |[39m         })
     [90m 184 |[39m
    [31m[1m>[22m[39m[90m 185 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 186 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 187 |[39m
     [90m 188 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:185:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should handle invalid actions

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 199 |[39m         })
     [90m 200 |[39m
    [31m[1m>[22m[39m[90m 201 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 202 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 203 |[39m
     [90m 204 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:201:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › GET requests › should get scraping statistics

    ReferenceError: enhancedScrapeGet is not defined

    [0m [90m 211 |[39m         [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/enhanced-scrape'[39m)
     [90m 212 |[39m
    [31m[1m>[22m[39m[90m 213 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapeGet(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 214 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 215 |[39m
     [90m 216 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:213:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should validate business data

    ReferenceError: dataManagementPost is not defined

    [0m [90m 251 |[39m         })
     [90m 252 |[39m
    [31m[1m>[22m[39m[90m 253 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 254 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 255 |[39m
     [90m 256 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:253:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should validate batch of businesses

    ReferenceError: dataManagementPost is not defined

    [0m [90m 288 |[39m         })
     [90m 289 |[39m
    [31m[1m>[22m[39m[90m 290 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 291 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 292 |[39m
     [90m 293 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:290:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should limit batch validation size

    ReferenceError: dataManagementPost is not defined

    [0m [90m 313 |[39m         })
     [90m 314 |[39m
    [31m[1m>[22m[39m[90m 315 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 316 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 317 |[39m
     [90m 318 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:315:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should find duplicates

    ReferenceError: dataManagementPost is not defined

    [0m [90m 347 |[39m         })
     [90m 348 |[39m
    [31m[1m>[22m[39m[90m 349 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 350 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 351 |[39m
     [90m 352 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:349:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should compare two records

    ReferenceError: dataManagementPost is not defined

    [0m [90m 379 |[39m         })
     [90m 380 |[39m
    [31m[1m>[22m[39m[90m 381 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 382 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 383 |[39m
     [90m 384 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:381:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should get retention policies

    ReferenceError: dataManagementPost is not defined

    [0m [90m 398 |[39m         })
     [90m 399 |[39m
    [31m[1m>[22m[39m[90m 400 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 401 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 402 |[39m
     [90m 403 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:400:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should export data with enhanced options

    ReferenceError: dataManagementPost is not defined

    [0m [90m 430 |[39m         })
     [90m 431 |[39m
    [31m[1m>[22m[39m[90m 432 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 433 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 434 |[39m
     [90m 435 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:432:26)

  ● API Integration Tests › Data Management API (/api/data-management) › GET requests › should get overview statistics

    ReferenceError: dataManagementGet is not defined

    [0m [90m 445 |[39m         [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/data-management?type=overview'[39m)
     [90m 446 |[39m
    [31m[1m>[22m[39m[90m 447 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementGet(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 448 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 449 |[39m
     [90m 450 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:447:26)

  ● API Integration Tests › Data Management API (/api/data-management) › GET requests › should get validation statistics

    ReferenceError: dataManagementGet is not defined

    [0m [90m 458 |[39m         )
     [90m 459 |[39m
    [31m[1m>[22m[39m[90m 460 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementGet(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 461 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 462 |[39m
     [90m 463 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:460:26)

  ● API Integration Tests › Data Management API (/api/data-management) › GET requests › should handle invalid stats type

    ReferenceError: dataManagementGet is not defined

    [0m [90m 469 |[39m         [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/data-management?type=invalid'[39m)
     [90m 470 |[39m
    [31m[1m>[22m[39m[90m 471 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementGet(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 472 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 473 |[39m
     [90m 474 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:471:26)

  ● API Integration Tests › Error Handling › should handle malformed JSON

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 486 |[39m       })
     [90m 487 |[39m
    [31m[1m>[22m[39m[90m 488 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 489 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 490 |[39m
     [90m 491 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:488:24)

  ● API Integration Tests › Error Handling › should handle missing request body

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 499 |[39m       })
     [90m 500 |[39m
    [31m[1m>[22m[39m[90m 501 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 502 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 503 |[39m
     [90m 504 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:501:24)

  ● API Integration Tests › Error Handling › should handle database connection errors

    ReferenceError: dataManagementPost is not defined

    [0m [90m 519 |[39m       })
     [90m 520 |[39m
    [31m[1m>[22m[39m[90m 521 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 522 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 523 |[39m
     [90m 524 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:521:24)

  ● API Integration Tests › Security Tests › should sanitize input data

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 542 |[39m       })
     [90m 543 |[39m
    [31m[1m>[22m[39m[90m 544 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 545 |[39m
     [90m 546 |[39m       [90m// Should either sanitize or reject the input[39m
     [90m 547 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:544:24)

  ● API Integration Tests › Security Tests › should validate content type

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 555 |[39m       })
     [90m 556 |[39m
    [31m[1m>[22m[39m[90m 557 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 558 |[39m
     [90m 559 |[39m       [90m// Should handle non-JSON content type appropriately[39m
     [90m 560 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:557:24)

  ● API Integration Tests › Security Tests › should handle large payloads

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 574 |[39m       })
     [90m 575 |[39m
    [31m[1m>[22m[39m[90m 576 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 577 |[39m
     [90m 578 |[39m       [90m// Should handle large payloads gracefully[39m
     [90m 579 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:576:24)

FAIL src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts
  Database Operations Comprehensive Integration Tests
    Business Records CRUD Operations
      × should create business record successfully (156 ms)
      × should handle duplicate business creation (5 ms)
      × should read business record by ID (2 ms)
      × should handle non-existent business ID (3 ms)
      × should update business record (3 ms)
      × should delete business record (4 ms)
      × should handle delete of non-existent business (4 ms)
    Search and Query Operations
      × should search businesses by industry (3 ms)
      × should search businesses by ZIP code (4 ms)
      × should handle complex search queries (2 ms)
      × should handle search with no results (10 ms)
      × should handle search with SQL injection attempts (3 ms)
    Batch Operations
      × should create multiple businesses in batch (2 ms)
      × should handle batch operation with partial failures (2 ms)
      × should handle empty batch operation (1 ms)
    Database Connection Management
      × should handle database connection errors (1 ms)
      × should handle database timeout errors (2 ms)
      × should handle transaction rollback (2 ms)
    Data Validation and Constraints
      × should handle invalid data types (2 ms)
      × should handle constraint violations (2 ms)
      × should handle foreign key violations (1 ms)
    Performance and Optimization
      × should handle large result sets efficiently (3 ms)
      × should handle concurrent database operations (2 ms)
      × should handle database connection pool exhaustion (1 ms)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should create business record successfully

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 69 |[39m
     [90m 70 |[39m       [90m// Import the database service[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(businessData)
     [90m 74 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:71:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:71:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should handle duplicate business creation

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 108 |[39m       })
     [90m 109 |[39m
    [31m[1m>[22m[39m[90m 110 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 111 |[39m
     [90m 112 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(businessData)
     [90m 113 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:110:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:110:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should read business record by ID

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 131 |[39m       })
     [90m 132 |[39m
    [31m[1m>[22m[39m[90m 133 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 134 |[39m
     [90m 135 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mgetBusinessById([32m'1'[39m)
     [90m 136 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:133:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:133:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should handle non-existent business ID

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 148 |[39m       })
     [90m 149 |[39m
    [31m[1m>[22m[39m[90m 150 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 151 |[39m
     [90m 152 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mgetBusinessById([32m'non-existent'[39m)
     [90m 153 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:150:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:150:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should update business record

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 167 |[39m       })
     [90m 168 |[39m
    [31m[1m>[22m[39m[90m 169 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 170 |[39m
     [90m 171 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mupdateBusiness([32m'1'[39m[33m,[39m updateData)
     [90m 172 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:169:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:169:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should delete business record

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 184 |[39m       })
     [90m 185 |[39m
    [31m[1m>[22m[39m[90m 186 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mdeleteBusiness([32m'1'[39m)
     [90m 189 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:186:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:186:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should handle delete of non-existent business

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 201 |[39m       })
     [90m 202 |[39m
    [31m[1m>[22m[39m[90m 203 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 204 |[39m
     [90m 205 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mdeleteBusiness([32m'non-existent'[39m)
     [90m 206 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:203:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:203:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should search businesses by industry

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 233 |[39m       })
     [90m 234 |[39m
    [31m[1m>[22m[39m[90m 235 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 236 |[39m
     [90m 237 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry(
     [90m 238 |[39m         [32m'restaurants'[39m[33m,[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:235:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:235:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should search businesses by ZIP code

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 262 |[39m       })
     [90m 263 |[39m
    [31m[1m>[22m[39m[90m 264 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 265 |[39m
     [90m 266 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByZipCode([32m'12345'[39m)
     [90m 267 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:264:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:264:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should handle complex search queries

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 286 |[39m       })
     [90m 287 |[39m
    [31m[1m>[22m[39m[90m 288 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 289 |[39m
     [90m 290 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinesses(searchParams)
     [90m 291 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:288:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:288:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should handle search with no results

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 309 |[39m       })
     [90m 310 |[39m
    [31m[1m>[22m[39m[90m 311 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 312 |[39m
     [90m 313 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry(
     [90m 314 |[39m         [32m'nonexistent'[39m[33m,[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:311:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:311:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should handle search with SQL injection attempts

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 328 |[39m       })
     [90m 329 |[39m
    [31m[1m>[22m[39m[90m 330 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 331 |[39m
     [90m 332 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry(maliciousInput[33m,[39m [32m'City'[39m[33m,[39m [32m'ST'[39m)
     [90m 333 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:330:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:330:36)

  ● Database Operations Comprehensive Integration Tests › Batch Operations › should create multiple businesses in batch

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 388 |[39m       })
     [90m 389 |[39m
    [31m[1m>[22m[39m[90m 390 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 391 |[39m
     [90m 392 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusinessesBatch(businessesData)
     [90m 393 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:390:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:390:36)

  ● Database Operations Comprehensive Integration Tests › Batch Operations › should handle batch operation with partial failures

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 440 |[39m       })
     [90m 441 |[39m
    [31m[1m>[22m[39m[90m 442 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 443 |[39m
     [90m 444 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusinessesBatch(businessesData)
     [90m 445 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:442:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:442:36)

  ● Database Operations Comprehensive Integration Tests › Batch Operations › should handle empty batch operation

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 448 |[39m
     [90m 449 |[39m     test([32m'should handle empty batch operation'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 450 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 451 |[39m
     [90m 452 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusinessesBatch([])
     [90m 453 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:450:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:450:36)

  ● Database Operations Comprehensive Integration Tests › Database Connection Management › should handle database connection errors

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 461 |[39m       mockQuery[33m.[39mmockRejectedValueOnce([36mnew[39m [33mError[39m([32m'Connection failed'[39m))
     [90m 462 |[39m
    [31m[1m>[22m[39m[90m 463 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 464 |[39m
     [90m 465 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mgetBusinessById([32m'1'[39m)
     [90m 466 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:463:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:463:36)

  ● Database Operations Comprehensive Integration Tests › Database Connection Management › should handle database timeout errors

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 471 |[39m       mockQuery[33m.[39mmockRejectedValueOnce([36mnew[39m [33mError[39m([32m'Query timeout'[39m))
     [90m 472 |[39m
    [31m[1m>[22m[39m[90m 473 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 474 |[39m
     [90m 475 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry([32m'restaurants'[39m[33m,[39m [32m'City'[39m[33m,[39m [32m'ST'[39m)
     [90m 476 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:473:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:473:36)

  ● Database Operations Comprehensive Integration Tests › Database Connection Management › should handle transaction rollback

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 499 |[39m       ]
     [90m 500 |[39m
    [31m[1m>[22m[39m[90m 501 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 502 |[39m
     [90m 503 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusinessesBatch(businessesData)
     [90m 504 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:501:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:501:36)

  ● Database Operations Comprehensive Integration Tests › Data Validation and Constraints › should handle invalid data types

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 518 |[39m       mockQuery[33m.[39mmockRejectedValueOnce([36mnew[39m [33mError[39m([32m'Invalid data type'[39m))
     [90m 519 |[39m
    [31m[1m>[22m[39m[90m 520 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 521 |[39m
     [90m 522 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(invalidData [36mas[39m any)
     [90m 523 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:520:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:520:36)

  ● Database Operations Comprehensive Integration Tests › Data Validation and Constraints › should handle constraint violations

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 547 |[39m       })
     [90m 548 |[39m
    [31m[1m>[22m[39m[90m 549 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 550 |[39m
     [90m 551 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(businessData)
     [90m 552 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:549:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:549:36)

  ● Database Operations Comprehensive Integration Tests › Data Validation and Constraints › should handle foreign key violations

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 577 |[39m       })
     [90m 578 |[39m
    [31m[1m>[22m[39m[90m 579 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 580 |[39m
     [90m 581 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(businessData)
     [90m 582 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:579:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:579:36)

  ● Database Operations Comprehensive Integration Tests › Performance and Optimization › should handle large result sets efficiently

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 598 |[39m       })
     [90m 599 |[39m
    [31m[1m>[22m[39m[90m 600 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 601 |[39m
     [90m 602 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry([32m'restaurants'[39m[33m,[39m [32m'City'[39m[33m,[39m [32m'ST'[39m)
     [90m 603 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:600:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:600:36)

  ● Database Operations Comprehensive Integration Tests › Performance and Optimization › should handle concurrent database operations

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 611 |[39m       })
     [90m 612 |[39m
    [31m[1m>[22m[39m[90m 613 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 614 |[39m
     [90m 615 |[39m       [90m// Simulate concurrent operations[39m
     [90m 616 |[39m       [36mconst[39m promises [33m=[39m [33mArray[39m[33m.[39m[36mfrom[39m({ length[33m:[39m [35m10[39m }[33m,[39m (_[33m,[39m i) [33m=>[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:613:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:613:36)

  ● Database Operations Comprehensive Integration Tests › Performance and Optimization › should handle database connection pool exhaustion

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 627 |[39m       mockQuery[33m.[39mmockRejectedValueOnce([36mnew[39m [33mError[39m([32m'Connection pool exhausted'[39m))
     [90m 628 |[39m
    [31m[1m>[22m[39m[90m 629 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 630 |[39m
     [90m 631 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mgetBusinessById([32m'1'[39m)
     [90m 632 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:629:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:629:36)

FAIL src/tests/integration/enhancedDataValidation.test.ts (112.387 s)
  Enhanced Data Validation Pipeline - Integration Tests
    Complete Business Record Validation and Enrichment
      × should validate and enrich a complete business record (11368 ms)
      √ should handle partial business records gracefully (10976 ms)
      √ should handle invalid data appropriately (10952 ms)
    Email Validation Integration
      √ should perform comprehensive email validation (11238 ms)
    Phone Validation Integration
      √ should perform comprehensive phone validation (11046 ms)
    Business Intelligence Integration
      × should perform comprehensive business intelligence enrichment (11213 ms)
    Data Quality Scoring
      × should calculate accurate data quality scores (11595 ms)
    Performance and Caching
      √ should cache validation results for performance (22560 ms)
    Error Recovery
      √ should continue enrichment even when some services fail (11195 ms)

  ● Enhanced Data Validation Pipeline - Integration Tests › Complete Business Record Validation and Enrichment › should validate and enrich a complete business record

    expect(received).toBeGreaterThan(expected)

    Matcher error: received value must be a number or bigint

    Received has value: undefined

    [0m [90m 121 |[39m       expect(
     [90m 122 |[39m         businessRecord[33m.[39mbusinessIntelligence[33m?[39m[33m.[39mtechnologyStack[33m?[39m[33m.[39mplatforms[33m?[39m[33m.[39mlength
    [31m[1m>[22m[39m[90m 123 |[39m       )[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 124 |[39m
     [90m 125 |[39m       [90m// Check geocoding[39m
     [90m 126 |[39m       expect(businessRecord[33m.[39mcoordinates)[33m.[39mtoBeDefined()[0m

      at Object.toBeGreaterThan (src/tests/integration/enhancedDataValidation.test.ts:123:9)

  ● Enhanced Data Validation Pipeline - Integration Tests › Business Intelligence Integration › should perform comprehensive business intelligence enrichment

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 361 |[39m       [90m// Technology[39m
     [90m 362 |[39m       [36mconst[39m techPlatforms [33m=[39m businessRecord[33m.[39mbusinessIntelligence[33m?[39m[33m.[39mtechnologyStack[33m?[39m[33m.[39mplatforms
    [31m[1m>[22m[39m[90m 363 |[39m       expect(techPlatforms[33m?[39m[33m.[39msome(p [33m=>[39m p[33m.[39mname [33m===[39m [32m'WordPress'[39m))[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                                                                [31m[1m^[22m[39m
     [90m 364 |[39m       expect(techPlatforms[33m?[39m[33m.[39msome(p [33m=>[39m p[33m.[39mname [33m===[39m [32m'Google Analytics'[39m))[33m.[39mtoBe([36mtrue[39m)
     [90m 365 |[39m
     [90m 366 |[39m       [90m// Social media[39m[0m

      at Object.toBe (src/tests/integration/enhancedDataValidation.test.ts:363:64)

  ● Enhanced Data Validation Pipeline - Integration Tests › Data Quality Scoring › should calculate accurate data quality scores

    expect(received).toBeGreaterThan(expected)

    Expected: > 70
    Received:   NaN

    [0m [90m 396 |[39m       highQualityRecord[33m.[39mdataQualityScore [33m=[39m qualityScore[33m.[39moverall [33m*[39m [35m100[39m
     [90m 397 |[39m
    [31m[1m>[22m[39m[90m 398 |[39m       expect(highQualityRecord[33m.[39mdataQualityScore)[33m.[39mtoBeGreaterThan([35m70[39m)
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 399 |[39m
     [90m 400 |[39m       [36mconst[39m lowQualityRecord[33m:[39m [33mBusinessRecord[39m [33m=[39m {
     [90m 401 |[39m         id[33m:[39m [32m'low-quality'[39m[33m,[39m[0m

      at Object.toBeGreaterThan (src/tests/integration/enhancedDataValidation.test.ts:398:50)

FAIL src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts
  API Endpoints Comprehensive Integration Tests
    /api/search endpoint
      × should handle valid search request (7 ms)
      √ should handle missing required fields (8 ms)
      √ should handle invalid JSON body (1 ms)
      √ should handle empty request body (1 ms)
      × should handle invalid ZIP code format (2 ms)
      √ should handle negative maxResults (3 ms)
      √ should handle extremely large maxResults (1 ms)
      √ should handle special characters in query (1 ms)
      √ should handle very long query strings (3 ms)
    /api/scrape endpoint
      × should handle valid scrape request (43 ms)
      × should handle invalid URL (26 ms)
      × should handle malicious URLs (12 ms)
      √ should handle cleanup action (5 ms)
      √ should handle unknown action (3 ms)
    /api/config endpoint
      × should return configuration (4 ms)
      √ should handle configuration errors (2 ms)
    /api/health endpoint
      × should return health status
      × should include service health checks (1 ms)
    Error Handling Across Endpoints
      √ should handle CORS preflight requests (8 ms)
      √ should handle unsupported HTTP methods (3 ms)
      √ should handle request timeout scenarios (12 ms)
      √ should handle memory pressure during large requests (5 ms)

  ● API Endpoints Comprehensive Integration Tests › /api/search endpoint › should handle valid search request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 50 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 53 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'results'[39m)
     [90m 54 |[39m       expect([33mArray[39m[33m.[39misArray(data[33m.[39mresults))[33m.[39mtoBe([36mtrue[39m)
     [90m 55 |[39m     })[0m

      at Object.toBe (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:52:31)

  ● API Endpoints Comprehensive Integration Tests › /api/search endpoint › should handle invalid ZIP code format

    expect(received).toContain(expected) // indexOf

    Expected substring: "ZIP code"
    Received string:    "Query and location are required"

    [0m [90m 128 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m 129 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'error'[39m)
    [31m[1m>[22m[39m[90m 130 |[39m       expect(data[33m.[39merror)[33m.[39mtoContain([32m'ZIP code'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 131 |[39m     })
     [90m 132 |[39m
     [90m 133 |[39m     test([32m'should handle negative maxResults'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:130:26)

  ● API Endpoints Comprehensive Integration Tests › /api/scrape endpoint › should handle valid scrape request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 243 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 244 |[39m
    [31m[1m>[22m[39m[90m 245 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 246 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'businesses'[39m)
     [90m 247 |[39m       expect([33mArray[39m[33m.[39misArray(data[33m.[39mbusinesses))[33m.[39mtoBe([36mtrue[39m)
     [90m 248 |[39m     })[0m

      at Object.toBe (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:245:31)

  ● API Endpoints Comprehensive Integration Tests › /api/scrape endpoint › should handle invalid URL

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 267 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 268 |[39m
    [31m[1m>[22m[39m[90m 269 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 270 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'error'[39m)
     [90m 271 |[39m     })
     [90m 272 |[39m[0m

      at Object.toBe (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:269:31)

  ● API Endpoints Comprehensive Integration Tests › /api/scrape endpoint › should handle malicious URLs

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 297 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m scrapeHandler(request)
     [90m 298 |[39m
    [31m[1m>[22m[39m[90m 299 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 300 |[39m       }
     [90m 301 |[39m     })
     [90m 302 |[39m[0m

      at Object.toBe (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:299:33)

  ● API Endpoints Comprehensive Integration Tests › /api/config endpoint › should return configuration

    expect(received).toHaveProperty(path)

    Expected path: "config"
    Received path: []

    Received value: {"app": {"debug": false, "environment": "test", "name": "Business Scraper App", "version": "1.3.0"}, "cache": {"type": "redis"}, "features": {"enableAuth": true, "enableCaching": true, "enableDebugMode": false, "enableExperimentalFeatures": false, "enableMetrics": true, "enableRateLimiting": true}, "logging": {"format": "json", "level": "info"}, "scraping": {"maxRetries": 3, "maxSearchResults": 50, "timeout": 30000}}

    [0m [90m 361 |[39m
     [90m 362 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 363 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'config'[39m)
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 364 |[39m     })
     [90m 365 |[39m
     [90m 366 |[39m     test([32m'should handle configuration errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toHaveProperty (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:363:20)

  ● API Endpoints Comprehensive Integration Tests › /api/health endpoint › should return health status

    Configuration error

    [0m [90m 367 |[39m       [90m// Mock configuration error[39m
     [90m 368 |[39m       jest[33m.[39mdoMock([32m'@/lib/config'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 369 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Configuration error'[39m)
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 370 |[39m       })
     [90m 371 |[39m
     [90m 372 |[39m       [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/config'[39m[33m,[39m {[0m

      at src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:369:15
      at Object.<anonymous> (src/lib/database.ts:38:17)
      at Object.<anonymous> (src/app/api/health/route.ts:14:19)
      at src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:386:34
      at Object.<anonymous> (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:386:28)

  ● API Endpoints Comprehensive Integration Tests › /api/health endpoint › should include service health checks

    Configuration error

    [0m [90m 367 |[39m       [90m// Mock configuration error[39m
     [90m 368 |[39m       jest[33m.[39mdoMock([32m'@/lib/config'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 369 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Configuration error'[39m)
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 370 |[39m       })
     [90m 371 |[39m
     [90m 372 |[39m       [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/config'[39m[33m,[39m {[0m

      at src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:369:15
      at Object.<anonymous> (src/lib/database.ts:38:17)
      at Object.<anonymous> (src/app/api/health/route.ts:14:19)
      at src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:386:34
      at Object.<anonymous> (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:386:28)

FAIL src/controller/__tests__/paymentIntegration.test.ts
  Payment System Integration
    User Subscription Workflow
      × should handle complete subscription creation workflow (4 ms)
      × should handle subscription cancellation workflow (3 ms)
    Feature Usage and Limits Integration
      × should track usage and enforce limits correctly (8 ms)
      × should handle enterprise unlimited access correctly (4 ms)
    Event-Driven Integration
      × should handle subscription events and cache invalidation (4 ms)
      × should handle cache invalidation on subscription changes (5 ms)
    Error Handling Integration
      × should handle payment controller errors gracefully in feature access (6 ms)
      × should handle feature access errors in payment workflows (2 ms)
    Usage Summary Integration
      × should provide comprehensive usage summary across all features (6 ms)
    Plan Upgrade/Downgrade Scenarios
      × should handle plan upgrade scenario correctly (6 ms)

  ● Payment System Integration › User Subscription Workflow › should handle complete subscription creation workflow

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 45 |[39m       [90m// Check initial free tier access[39m
     [90m 46 |[39m       [36mlet[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'scraping_request'[39m)
    [31m[1m>[22m[39m[90m 47 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mtrue[39m)
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 48 |[39m       expect(accessResult[33m.[39musageLimit)[33m.[39mtoBe([35m10[39m) [90m// free tier limit[39m
     [90m 49 |[39m
     [90m 50 |[39m       [90m// Advanced search should be denied on free tier[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:47:38)

  ● Payment System Integration › User Subscription Workflow › should handle subscription cancellation workflow

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 104 |[39m       [90m// Verify pro access[39m
     [90m 105 |[39m       [36mlet[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'api_access'[39m)
    [31m[1m>[22m[39m[90m 106 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 107 |[39m       expect(accessResult[33m.[39musageLimit)[33m.[39mtoBe([35m50[39m) [90m// pro tier API access[39m
     [90m 108 |[39m
     [90m 109 |[39m       [90m// Cancel subscription[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:106:38)

  ● Payment System Integration › Feature Usage and Limits Integration › should track usage and enforce limits correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "usage_limit_exceeded"
    Received: "subscription_required"

    [0m [90m 146 |[39m       [36mconst[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'scraping_request'[39m)
     [90m 147 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 148 |[39m       expect(accessResult[33m.[39mreason)[33m.[39mtoBe([32m'usage_limit_exceeded'[39m)
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 149 |[39m       expect(accessResult[33m.[39mcurrentUsage)[33m.[39mtoBe([35m100[39m)
     [90m 150 |[39m       expect(accessResult[33m.[39musageLimit)[33m.[39mtoBe([35m100[39m)
     [90m 151 |[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:148:35)

  ● Payment System Integration › Feature Usage and Limits Integration › should handle enterprise unlimited access correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 176 |[39m       [90m// Should still have access due to unlimited plan[39m
     [90m 177 |[39m       [36mconst[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'scraping_request'[39m)
    [31m[1m>[22m[39m[90m 178 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 179 |[39m       expect(accessResult[33m.[39mcurrentUsage)[33m.[39mtoBeUndefined()
     [90m 180 |[39m       expect(accessResult[33m.[39musageLimit)[33m.[39mtoBeUndefined()
     [90m 181 |[39m     })[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:178:38)

  ● Payment System Integration › Event-Driven Integration › should handle subscription events and cache invalidation

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"featureType": "api_access", "reason": "plan_restriction"}

    Number of calls: 0

    [0m [90m 208 |[39m       [90m// Try to access restricted feature (should trigger access:denied)[39m
     [90m 209 |[39m       [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'api_access'[39m) [90m// not available on free tier[39m
    [31m[1m>[22m[39m[90m 210 |[39m       expect(accessDeniedSpy)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 211 |[39m         featureType[33m:[39m [32m'api_access'[39m[33m,[39m
     [90m 212 |[39m         reason[33m:[39m [32m'plan_restriction'[39m[33m,[39m
     [90m 213 |[39m       })[0m

      at Object.toHaveBeenCalledWith (src/controller/__tests__/paymentIntegration.test.ts:210:31)

  ● Payment System Integration › Event-Driven Integration › should handle cache invalidation on subscription changes

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 223 |[39m       [90m// Verify cache is populated[39m
     [90m 224 |[39m       [36mconst[39m cacheSize [33m=[39m (featureAccessController [36mas[39m any)[33m.[39musageCache[33m.[39msize
    [31m[1m>[22m[39m[90m 225 |[39m       expect(cacheSize)[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 226 |[39m
     [90m 227 |[39m       [90m// Simulate subscription change[39m
     [90m 228 |[39m       [36mconst[39m newSubscription [33m=[39m {[0m

      at Object.toBeGreaterThan (src/controller/__tests__/paymentIntegration.test.ts:225:25)

  ● Payment System Integration › Error Handling Integration › should handle payment controller errors gracefully in feature access

    expect(received).toBe(expected) // Object.is equality

    Expected: "feature_disabled"
    Received: "subscription_required"

    [0m [90m 260 |[39m       [36mconst[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'scraping_request'[39m)
     [90m 261 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 262 |[39m       expect(accessResult[33m.[39mreason)[33m.[39mtoBe([32m'feature_disabled'[39m)
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 263 |[39m     })
     [90m 264 |[39m
     [90m 265 |[39m     it([32m'should handle feature access errors in payment workflows'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:262:35)

  ● Payment System Integration › Error Handling Integration › should handle feature access errors in payment workflows

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 273 |[39m       [90m// Payment controller should handle the error gracefully[39m
     [90m 274 |[39m       [36mconst[39m hasAccess [33m=[39m [36mawait[39m paymentController[33m.[39mcheckFeatureAccess([32m'scraping_request'[39m)
    [31m[1m>[22m[39m[90m 275 |[39m       expect(hasAccess)[33m.[39mtoBe([36mfalse[39m)
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 276 |[39m     })
     [90m 277 |[39m   })
     [90m 278 |[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:275:25)

  ● Payment System Integration › Usage Summary Integration › should provide comprehensive usage summary across all features

    expect(received).toEqual(expected) // deep equality

    - Expected  - 18
    + Received  +  1

    - Object {
    -   "advanced_search": Object {
    -     "limit": 10,
    -     "used": 8,
    -   },
    -   "api_access": Object {
    -     "limit": 0,
    -     "used": 0,
    -   },
    -   "export": Object {
    -     "limit": 50,
    -     "used": 30,
    -   },
    -   "scraping_request": Object {
    -     "limit": 100,
    -     "used": 75,
    -   },
    - }
    + Object {}

    [0m [90m 310 |[39m       [36mconst[39m summary [33m=[39m [36mawait[39m featureAccessController[33m.[39mgetUsageSummary()
     [90m 311 |[39m
    [31m[1m>[22m[39m[90m 312 |[39m       expect(summary)[33m.[39mtoEqual({
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 313 |[39m         scraping_request[33m:[39m { used[33m:[39m [35m75[39m[33m,[39m limit[33m:[39m [35m100[39m }[33m,[39m
     [90m 314 |[39m         [36mexport[39m[33m:[39m { used[33m:[39m [35m30[39m[33m,[39m limit[33m:[39m [35m50[39m }[33m,[39m
     [90m 315 |[39m         advanced_search[33m:[39m { used[33m:[39m [35m8[39m[33m,[39m limit[33m:[39m [35m10[39m }[33m,[39m[0m

      at Object.toEqual (src/controller/__tests__/paymentIntegration.test.ts:312:23)

  ● Payment System Integration › Plan Upgrade/Downgrade Scenarios › should handle plan upgrade scenario correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 50
    Received: 0

    [0m [90m 360 |[39m       [90m// Verify pro plan limits[39m
     [90m 361 |[39m       limits [33m=[39m [36mawait[39m featureAccessController[33m.[39mgetFeatureLimits()
    [31m[1m>[22m[39m[90m 362 |[39m       expect(limits[33m.[39mapi_access)[33m.[39mtoBe([35m50[39m) [90m// API access available in pro[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 363 |[39m       expect(limits[33m.[39mscraping_request)[33m.[39mtoBe([35m1000[39m) [90m// Higher scraping limit[39m
     [90m 364 |[39m
     [90m 365 |[39m       [90m// Verify API access is now available[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:362:33)

FAIL src/__tests__/integration/api-endpoints.test.ts
  API Endpoints Integration
    Templates API
      × GET /api/v1/templates should return template list (5 ms)
      × GET /api/v1/templates with platform filter (4 ms)
      × GET /api/v1/templates with details (8 ms)
    Exports API
      × POST /api/v1/exports should create export successfully (4 ms)
      × POST /api/v1/exports should validate required fields (2 ms)
      × POST /api/v1/exports should validate business data (8 ms)
    Analytics API
      × GET /api/v1/analytics?type=realtime should return real-time metrics (4 ms)
      × GET /api/v1/analytics?type=client should return client analytics (3 ms)
      × GET /api/v1/analytics?type=system should return system analytics (2 ms)
      × GET /api/v1/analytics with date range should filter data (9 ms)
    Error Handling
      × should handle invalid JSON in request body (3 ms)
      × should handle missing required parameters (3 ms)
    Response Format
      √ should include standard response metadata (2 ms)
      × should include rate limit headers (2 ms)
      √ should include CORS headers (2 ms)

  ● API Endpoints Integration › Templates API › GET /api/v1/templates should return template list

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 192 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getTemplatesList(request)
     [90m 193 |[39m
    [31m[1m>[22m[39m[90m 194 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 195 |[39m
     [90m 196 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 197 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:194:31)

  ● API Endpoints Integration › Templates API › GET /api/v1/templates with platform filter

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 205 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getTemplatesList(request)
     [90m 206 |[39m
    [31m[1m>[22m[39m[90m 207 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 208 |[39m
     [90m 209 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 210 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:207:31)

  ● API Endpoints Integration › Templates API › GET /api/v1/templates with details

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 216 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getTemplatesList(request)
     [90m 217 |[39m
    [31m[1m>[22m[39m[90m 218 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 219 |[39m
     [90m 220 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 221 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:218:31)

  ● API Endpoints Integration › Exports API › POST /api/v1/exports should create export successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 260 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createExport(request)
     [90m 261 |[39m
    [31m[1m>[22m[39m[90m 262 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 263 |[39m
     [90m 264 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 265 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:262:31)

  ● API Endpoints Integration › Exports API › POST /api/v1/exports should validate required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

    [0m [90m 285 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createExport(request)
     [90m 286 |[39m
    [31m[1m>[22m[39m[90m 287 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m) [90m// Should be handled by error handling[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 288 |[39m
     [90m 289 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 290 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:287:31)

  ● API Endpoints Integration › Exports API › POST /api/v1/exports should validate business data

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

    [0m [90m 306 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createExport(request)
     [90m 307 |[39m
    [31m[1m>[22m[39m[90m 308 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 309 |[39m
     [90m 310 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 311 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:308:31)

  ● API Endpoints Integration › Analytics API › GET /api/v1/analytics?type=realtime should return real-time metrics

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 319 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 320 |[39m
    [31m[1m>[22m[39m[90m 321 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 322 |[39m
     [90m 323 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 324 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:321:31)

  ● API Endpoints Integration › Analytics API › GET /api/v1/analytics?type=client should return client analytics

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 335 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 336 |[39m
    [31m[1m>[22m[39m[90m 337 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 338 |[39m
     [90m 339 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 340 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:337:31)

  ● API Endpoints Integration › Analytics API › GET /api/v1/analytics?type=system should return system analytics

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 349 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 350 |[39m
    [31m[1m>[22m[39m[90m 351 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 352 |[39m
     [90m 353 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 354 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:351:31)

  ● API Endpoints Integration › Analytics API › GET /api/v1/analytics with date range should filter data

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 369 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 370 |[39m
    [31m[1m>[22m[39m[90m 371 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 372 |[39m
     [90m 373 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 374 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:371:31)

  ● API Endpoints Integration › Error Handling › should handle invalid JSON in request body

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

    [0m [90m 388 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createExport(request)
     [90m 389 |[39m
    [31m[1m>[22m[39m[90m 390 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 391 |[39m
     [90m 392 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 393 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:390:31)

  ● API Endpoints Integration › Error Handling › should handle missing required parameters

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

    [0m [90m 401 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 402 |[39m
    [31m[1m>[22m[39m[90m 403 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 404 |[39m
     [90m 405 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 406 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:403:31)

  ● API Endpoints Integration › Response Format › should include rate limit headers

    expect(received).toBeTruthy()

    Received: undefined

    [0m [90m 427 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-Request-ID'[39m))[33m.[39mtoBeTruthy()
     [90m 428 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-API-Version'[39m))[33m.[39mtoBe([32m'v1'[39m)
    [31m[1m>[22m[39m[90m 429 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-RateLimit-Remaining'[39m))[33m.[39mtoBeTruthy()
     [90m     |[39m                                                             [31m[1m^[22m[39m
     [90m 430 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-RateLimit-Reset'[39m))[33m.[39mtoBeTruthy()
     [90m 431 |[39m     })
     [90m 432 |[39m[0m

      at Object.toBeTruthy (src/__tests__/integration/api-endpoints.test.ts:429:61)

FAIL src/__tests__/integration/crmSync.test.ts
  CRM Sync Integration Tests
    Business Record Sync
      × should sync single business record to CRM (13 ms)
      × should sync multiple business records in batch (2 ms)
      × should handle sync failures gracefully (3 ms)
      × should sync to multiple CRM providers (3 ms)
      × should filter by specific provider IDs (6 ms)
    Sync Status and History
      √ should retrieve sync status and history (9 ms)
      √ should filter sync history by provider (2 ms)
    Error Handling
      × should return error for invalid request body (2 ms)
      × should return error when no active CRM services found (2 ms)
      × should handle malformed JSON gracefully (2 ms)
    Performance Tests
      × should handle large batch sync efficiently (3 ms)
      × should handle concurrent sync requests (6 ms)

  ● CRM Sync Integration Tests › Business Record Sync › should sync single business record to CRM

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 63 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 64 |[39m
    [31m[1m>[22m[39m[90m 65 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 66 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 67 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalSynced)[33m.[39mtoBe([35m1[39m)
     [90m 68 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalFailed)[33m.[39mtoBe([35m0[39m)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:65:31)

  ● CRM Sync Integration Tests › Business Record Sync › should sync multiple business records in batch

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 119 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 120 |[39m
    [31m[1m>[22m[39m[90m 121 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 122 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 123 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalSynced)[33m.[39mtoBe(mockBusinessData[33m.[39mlength)
     [90m 124 |[39m       expect(mockService[33m.[39msyncBusinessRecords)[33m.[39mtoHaveBeenCalledWith(mockBusinessData)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:121:31)

  ● CRM Sync Integration Tests › Business Record Sync › should handle sync failures gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 151 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 152 |[39m
    [31m[1m>[22m[39m[90m 153 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 154 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 155 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults[[35m0[39m][33m.[39mtype)[33m.[39mtoBe([32m'error'[39m)
     [90m 156 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults[[35m0[39m][33m.[39merror)[33m.[39mtoBe([32m'Sync failed'[39m)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:153:31)

  ● CRM Sync Integration Tests › Business Record Sync › should sync to multiple CRM providers

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 201 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 202 |[39m
    [31m[1m>[22m[39m[90m 203 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 204 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 205 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalProviders)[33m.[39mtoBe([35m2[39m)
     [90m 206 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults)[33m.[39mtoHaveLength([35m2[39m)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:203:31)

  ● CRM Sync Integration Tests › Business Record Sync › should filter by specific provider IDs

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 251 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 252 |[39m
    [31m[1m>[22m[39m[90m 253 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 254 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 255 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults)[33m.[39mtoHaveLength([35m1[39m)
     [90m 256 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults[[35m0[39m][33m.[39mproviderId)[33m.[39mtoBe([32m'provider-1'[39m)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:253:31)

  ● CRM Sync Integration Tests › Error Handling › should return error for invalid request body

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

    [0m [90m 310 |[39m
     [90m 311 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
    [31m[1m>[22m[39m[90m 312 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 313 |[39m       expect(data[33m.[39merror)[33m.[39mtoContain([32m'Records array is required'[39m)
     [90m 314 |[39m     })
     [90m 315 |[39m[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:312:28)

  ● CRM Sync Integration Tests › Error Handling › should return error when no active CRM services found

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

    [0m [90m 332 |[39m
     [90m 333 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
    [31m[1m>[22m[39m[90m 334 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 335 |[39m       expect(data[33m.[39merror)[33m.[39mtoContain([32m'No active CRM services found'[39m)
     [90m 336 |[39m     })
     [90m 337 |[39m[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:334:28)

  ● CRM Sync Integration Tests › Error Handling › should handle malformed JSON gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

    [0m [90m 348 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 349 |[39m
    [31m[1m>[22m[39m[90m 350 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 351 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)
     [90m 352 |[39m     })
     [90m 353 |[39m   })[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:350:31)

  ● CRM Sync Integration Tests › Performance Tests › should handle large batch sync efficiently

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 401 |[39m       [36mconst[39m endTime [33m=[39m [33mDate[39m[33m.[39mnow()
     [90m 402 |[39m
    [31m[1m>[22m[39m[90m 403 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 404 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 405 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalSynced)[33m.[39mtoBe(largeBatch[33m.[39mlength)
     [90m 406 |[39m       expect(endTime [33m-[39m startTime)[33m.[39mtoBeLessThan([35m5000[39m) [90m// Should complete within 5 seconds[39m[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:403:31)

  ● CRM Sync Integration Tests › Performance Tests › should handle concurrent sync requests

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 440 |[39m       [90m// All requests should succeed[39m
     [90m 441 |[39m       [36mfor[39m ([36mconst[39m response [36mof[39m responses) {
    [31m[1m>[22m[39m[90m 442 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 443 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 444 |[39m         expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 445 |[39m       }[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:442:33)

FAIL src/__tests__/integration/payment-flow.test.tsx
  Payment Flow Integration
    successful payment flow
      √ should complete payment flow successfully (211 ms)
      √ should handle subscription creation flow (186 ms)
    payment error handling
      × should handle payment errors gracefully (2 ms)
      × should handle network errors (2 ms)
      √ should handle insufficient funds error (63 ms)
    payment form validation
      √ should validate required fields (47 ms)
      √ should handle invalid card number (65 ms)
    payment processing states
      √ should show loading state during payment processing (167 ms)
      √ should handle payment timeout (185 ms)
    subscription management integration
      √ should handle subscription upgrade flow (190 ms)
      √ should handle subscription cancellation (13 ms)

  ● Payment Flow Integration › payment error handling › should handle payment errors gracefully

    TypeError: jest.mocked(...).mockReturnValue is not a function

    [0m [90m 145 |[39m
     [90m 146 |[39m       [90m// Mock payment failure[39m
    [31m[1m>[22m[39m[90m 147 |[39m       jest[33m.[39mmocked(require([32m'@stripe/react-stripe-js'[39m)[33m.[39museStripe)[33m.[39mmockReturnValue({
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 148 |[39m         confirmPayment[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue({
     [90m 149 |[39m           error[33m:[39m { message[33m:[39m [32m'Your card was declined.'[39m }[33m,[39m
     [90m 150 |[39m         })[33m,[39m[0m

      at Object.mockReturnValue (src/__tests__/integration/payment-flow.test.tsx:147:65)

  ● Payment Flow Integration › payment error handling › should handle network errors

    TypeError: jest.mocked(...).mockReturnValue is not a function

    [0m [90m 187 |[39m
     [90m 188 |[39m       [90m// Mock network error[39m
    [31m[1m>[22m[39m[90m 189 |[39m       jest[33m.[39mmocked(require([32m'@stripe/react-stripe-js'[39m)[33m.[39museStripe)[33m.[39mmockReturnValue({
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 190 |[39m         confirmPayment[33m:[39m jest[33m.[39mfn()[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Network error'[39m))[33m,[39m
     [90m 191 |[39m       })
     [90m 192 |[39m[0m

      at Object.mockReturnValue (src/__tests__/integration/payment-flow.test.tsx:189:65)

FAIL src/__tests__/integration/ai-workflow.test.ts
  AI/ML Workflow Integration
    Complete AI Pipeline
      × should process businesses through the complete AI pipeline (17 ms)
      × should handle mixed quality data appropriately (2 ms)
      × should provide industry-specific scoring (2 ms)
      × should provide geographic scoring (3 ms)
    Batch Processing Performance
      × should handle large batches efficiently (2 ms)
      × should handle errors gracefully in batch processing (2 ms)
    Data Enhancement
      × should enhance business records with AI insights (4 ms)
      × should provide actionable recommendations (9 ms)
    Export Integration
      × should export enhanced data with AI insights (3 ms)
    Filtering and Sorting
      × should filter businesses by lead score (1 ms)
      × should sort businesses by lead score (1 ms)
      × should identify businesses needing attention (2 ms)

  ● AI/ML Workflow Integration › Complete AI Pipeline › should process businesses through the complete AI pipeline

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:120:48)

  ● AI/ML Workflow Integration › Complete AI Pipeline › should handle mixed quality data appropriately

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:164:48)

  ● AI/ML Workflow Integration › Complete AI Pipeline › should provide industry-specific scoring

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:177:48)

  ● AI/ML Workflow Integration › Complete AI Pipeline › should provide geographic scoring

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:193:48)

  ● AI/ML Workflow Integration › Batch Processing Performance › should handle large batches efficiently

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:220:48)

  ● AI/ML Workflow Integration › Batch Processing Performance › should handle errors gracefully in batch processing

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:238:48)

  ● AI/ML Workflow Integration › Data Enhancement › should enhance business records with AI insights

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:249:48)

  ● AI/ML Workflow Integration › Data Enhancement › should provide actionable recommendations

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:269:48)

  ● AI/ML Workflow Integration › Export Integration › should export enhanced data with AI insights

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:294:48)

  ● AI/ML Workflow Integration › Filtering and Sorting › should filter businesses by lead score

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:321:48)

  ● AI/ML Workflow Integration › Filtering and Sorting › should sort businesses by lead score

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:337:48)

  ● AI/ML Workflow Integration › Filtering and Sorting › should identify businesses needing attention

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:367:48)

FAIL src/tests/integration/crm/crmExportService.test.ts
  CRMExportService Integration
    exportWithCRMTemplate
      √ should export business records using Salesforce template (16 ms)
      √ should handle progress callbacks (8 ms)
      × should generate CSV export correctly (6 ms)
      × should handle HubSpot JSON export (17 ms)
      × should validate records and skip invalid ones (11 ms)
      × should handle empty record set (5 ms)
      √ should generate proper filename with timestamp (2 ms)
      √ should include export metadata (2 ms)
    getExportPreview
      √ should generate preview with limited records (5 ms)
      √ should show validation errors in preview (3 ms)
    validateRecords
      √ should validate all records against template (12 ms)
      × should identify invalid records (2 ms)
    platform and template management
      √ should get available platforms (2 ms)
      √ should get templates for specific platform (2 ms)
      √ should get template by ID (2 ms)
    error handling
      √ should handle invalid template platform (12 ms)
      √ should handle transformation errors gracefully (3 ms)
    performance
      √ should handle large datasets efficiently (10 ms)
      √ should provide accurate progress updates for large datasets (5 ms)

  ● CRMExportService Integration › exportWithCRMTemplate › should generate CSV export correctly

    TypeError: result.blob.text is not a function

    [0m [90m 111 |[39m       )
     [90m 112 |[39m
    [31m[1m>[22m[39m[90m 113 |[39m       [36mconst[39m csvText [33m=[39m [36mawait[39m result[33m.[39mblob[33m.[39mtext()
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 114 |[39m       [36mconst[39m lines [33m=[39m csvText[33m.[39msplit([32m'\n'[39m)[33m.[39mfilter(line [33m=>[39m line[33m.[39mtrim())
     [90m 115 |[39m
     [90m 116 |[39m       [90m// Should have header + 3 data rows[39m[0m

      at Object.text (src/tests/integration/crm/crmExportService.test.ts:113:41)

  ● CRMExportService Integration › exportWithCRMTemplate › should handle HubSpot JSON export

    TypeError: result.blob.text is not a function

    [0m [90m 142 |[39m         expect(result[33m.[39mblob[33m.[39mtype)[33m.[39mtoBe([32m'application/json'[39m)
     [90m 143 |[39m
    [31m[1m>[22m[39m[90m 144 |[39m         [36mconst[39m jsonText [33m=[39m [36mawait[39m result[33m.[39mblob[33m.[39mtext()
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 145 |[39m         [36mconst[39m jsonData [33m=[39m [33mJSON[39m[33m.[39mparse(jsonText)
     [90m 146 |[39m
     [90m 147 |[39m         expect(jsonData[33m.[39mmetadata)[33m.[39mtoBeDefined()[0m

      at Object.text (src/tests/integration/crm/crmExportService.test.ts:144:44)

  ● CRMExportService Integration › exportWithCRMTemplate › should validate records and skip invalid ones

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 4

    [0m [90m 177 |[39m
     [90m 178 |[39m       expect(result[33m.[39mstatistics[33m.[39mtotalRecords)[33m.[39mtoBe([35m4[39m)
    [31m[1m>[22m[39m[90m 179 |[39m       expect(result[33m.[39mstatistics[33m.[39mexportedRecords)[33m.[39mtoBe([35m3[39m) [90m// Only valid records[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 180 |[39m       expect(result[33m.[39mstatistics[33m.[39mskippedRecords)[33m.[39mtoBe([35m1[39m)
     [90m 181 |[39m       expect(result[33m.[39mstatistics[33m.[39merrors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m 182 |[39m     })[0m

      at Object.toBe (src/tests/integration/crm/crmExportService.test.ts:179:49)

  ● CRMExportService Integration › exportWithCRMTemplate › should handle empty record set

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 189 |[39m       expect(result[33m.[39mstatistics[33m.[39mtotalRecords)[33m.[39mtoBe([35m0[39m)
     [90m 190 |[39m       expect(result[33m.[39mstatistics[33m.[39mexportedRecords)[33m.[39mtoBe([35m0[39m)
    [31m[1m>[22m[39m[90m 191 |[39m       expect(result[33m.[39mblob[33m.[39msize)[33m.[39mtoBeGreaterThan([35m0[39m) [90m// Should still have headers[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 192 |[39m     })
     [90m 193 |[39m
     [90m 194 |[39m     it([32m'should generate proper filename with timestamp'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBeGreaterThan (src/tests/integration/crm/crmExportService.test.ts:191:32)

  ● CRMExportService Integration › validateRecords › should identify invalid records

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 4

    [0m [90m 273 |[39m       [36mconst[39m validation [33m=[39m [36mawait[39m exportService[33m.[39mvalidateRecords(invalidRecords[33m,[39m salesforceTemplate)
     [90m 274 |[39m
    [31m[1m>[22m[39m[90m 275 |[39m       expect(validation[33m.[39mvalidCount)[33m.[39mtoBe([35m3[39m)
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 276 |[39m       expect(validation[33m.[39minvalidCount)[33m.[39mtoBe([35m1[39m)
     [90m 277 |[39m       expect(validation[33m.[39merrors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m 278 |[39m     })[0m

      at Object.toBe (src/tests/integration/crm/crmExportService.test.ts:275:37)

FAIL src/tests/integration/virtualizedResultsTable.test.tsx (5.889 s)
  VirtualizedResultsTable Integration Tests
    Component Rendering
      √ should render virtual scrolling table (126 ms)
      √ should show loading state (29 ms)
      √ should display performance monitoring panel in development (20 ms)
    Performance Monitoring Integration
      √ should start frame rate monitoring on mount (46 ms)
      √ should stop frame rate monitoring on unmount (22 ms)
      √ should record performance metrics on scroll (69 ms)
      × should show performance metrics when panel is open (1039 ms)
    Search and Filtering
      √ should handle search input (396 ms)
      √ should record performance metrics on search (163 ms)
    Row Selection
      √ should handle row selection (141 ms)
      √ should handle select all (203 ms)
    Export Functionality
      × should handle export with performance tracking (1035 ms)
      √ should show export button with count (56 ms)
    Sorting
      √ should handle column sorting (50 ms)
    Error Handling
      √ should handle fetch errors gracefully (15 ms)
    Accessibility
      × should have proper ARIA labels (1033 ms)
      √ should support keyboard navigation (132 ms)
    Responsive Design
      √ should handle different screen sizes (8 ms)
    Memory Management
      √ should limit performance metrics to prevent memory leaks (889 ms)

  ● VirtualizedResultsTable Integration Tests › Performance Monitoring Integration › should show performance metrics when panel is open

    Unable to find an element with the text: Performance Metrics. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between"[39m
            [36m>[39m
              [36m<h3[39m
                [33mclass[39m=[32m"text-2xl font-semibold leading-none tracking-tight"[39m
              [36m>[39m
                [0mBusiness Results ([0m
                [0m1,000[0m
                [0m)[0m
              [36m</h3>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"24"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<rect[39m
                      [33mheight[39m=[32m"14"[39m
                      [33mrx[39m=[32m"2"[39m
                      [33mwidth[39m=[32m"20"[39m
                      [33mx[39m=[32m"2"[39m
                      [33my[39m=[32m"3"[39m
                    [36m/>[39m
                    [36m<line[39m
                      [33mx1[39m=[32m"8"[39m
                      [33mx2[39m=[32m"16"[39m
                      [33my1[39m=[32m"21"[39m
                      [33my2[39m=[32m"21"[39m
                    [36m/>[39m
                    [36m<line[39m
                      [33mx1[39m=[32m"12"[39m
                      [33mx2[39m=[32m"12"[39m
                      [33my1[39m=[32m"17"[39m
                      [33my2[39m=[32m"21"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mPerformance[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"24"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"[39m
                    [36m/>[39m
                    [36m<polyline[39m
                      [33mpoints[39m=[32m"7 10 12 15 17 10"[39m
                    [36m/>[39m
                    [36m<line[39m
                      [33mx1[39m=[32m"12"[39m
                      [33mx2[39m=[32m"12"[39m
                      [33my1[39m=[32m"15"[39m
                      [33my2[39m=[32m"3"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mExport ([0m
                  [0m10[0m
                  [0m)[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex-1"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"space-y-2"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33mclass[39m=[32m"h-4 w-4 text-muted-foreground"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"11"[39m
                          [33mcy[39m=[32m"11"[39m
                          [33mr[39m=[32m"8"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"m21 21-4.3-4.3"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</div>[39m
                    [36m<input[39m
                      [33maria-invalid[39m=[32m"false"[39m
                      [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 pl-10 pr-3 border-input focus-visible:ring-ring"[39m
                      [33mid[39m=[32m":r6:"[39m
                      [33mplaceholder[39m=[32m"Search businesses..."[39m
                      [33mtype[39m=[32m"text"[39m
                      [33mvalue[39m=[32m""[39m
                    [36m/>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"abs...

    [0m [90m 225 |[39m       fireEvent[33m.[39mclick(performanceButton)
     [90m 226 |[39m
    [31m[1m>[22m[39m[90m 227 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 228 |[39m         expect(screen[33m.[39mgetByText([32m'Performance Metrics'[39m))[33m.[39mtoBeInTheDocument()
     [90m 229 |[39m         expect(screen[33m.[39mgetByText([32m'8.50ms'[39m))[33m.[39mtoBeInTheDocument() [90m// avgRenderTime[39m
     [90m 230 |[39m         expect(screen[33m.[39mgetByText([32m'58 fps'[39m))[33m.[39mtoBeInTheDocument() [90m// avgFrameRate[39m[0m

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/tests/integration/virtualizedResultsTable.test.tsx:227:20)

  ● VirtualizedResultsTable Integration Tests › Export Functionality › should handle export with performance tracking

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"operation": "export"}
    Received: {"componentName": "VirtualizedResultsTable", "memoryUsage": 52428800, "operation": "loadInitialData", "renderTime": 0, "scrollPosition": 0, "scrollVelocity": 0, "timestamp": 1758757353262, "totalItemsCount": 0, "visibleItemsCount": 0}

    Number of calls: 1

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm w-full"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"text-2xl font-semibold leading-none tracking-tight"[39m
                [36m>[39m
                  [0mBusiness Results ([0m
                  [0m1,000[0m
                  [0m)[0m
                [36m</h3>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3 bg-blue-100"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"14"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"20"[39m
                        [33mx[39m=[32m"2"[39m
                        [33my[39m=[32m"3"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"8"[39m
                        [33mx2[39m=[32m"16"[39m
                        [33my1[39m=[32m"21"[39m
                        [33my2[39m=[32m"21"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"12"[39m
                        [33mx2[39m=[32m"12"[39m
                        [33my1[39m=[32m"17"[39m
                        [33my2[39m=[32m"21"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [0mPerformance[0m
                  [36m</button>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"[39m
                      [36m/>[39m
                      [36m<polyline[39m
                        [33mpoints[39m=[32m"7 10 12 15 17 10"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"12"[39m
                        [33mx2[39m=[32m"12"[39m
                        [33my1[39m=[32m"15"[39m
                        [33my2[39m=[32m"3"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [0mExport ([0m
                    [0m10[0m
                    [0m)[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-4"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"[39m
                      [36m>[39m
                        [36m<svg[39m
                          [33mclass[39m=[32m"h-4 w-4 text-muted-foreground"[39m
                          [33mfill[39m=[32m"none"[39m
                          [33mheight[39m=[32m"24"[39m
                          [33mstroke[39m=[32m"currentColor"[39m
                          [33mstroke-linecap[39m=[32m"round"[39m
                          [33mstroke-linejoin[39m=[32m"round"[39m
                          [33mstroke-width[39m=[32m"2"[39m
                          [33mviewBox[39m=[32m"0 0 24 24"[39m
                          [33mwidth[39m=[32m"24"[39m
                          [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                        [36m>[39m
                          [36m<circle[39m
                            [33mcx[39m=[32m"11"[39m
                            [33mcy[39m=[32m"11"[39m
                            [33mr[39m=[32m"8"[39m
                          [36m/>[39m
                          [36m<path[39m
                            [33md[39m=[32m"m21 21-4.3-4.3"[39m
                          [36m/>[39m
                        [36m</svg>[39m
                      [36m</div>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 pl-10 pr-3 border-input focus-visible:ring-ring"[39m
           ...

    [0m [90m 301 |[39m
     [90m 302 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 303 |[39m         expect(performanceMonitoringService[33m.[39mrecordMetric)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                           [31m[1m^[22m[39m
     [90m 304 |[39m           expect[33m.[39mobjectContaining({
     [90m 305 |[39m             operation[33m:[39m [32m'export'[39m[33m,[39m
     [90m 306 |[39m           })[0m

      at toHaveBeenCalledWith (src/tests/integration/virtualizedResultsTable.test.tsx:303:59)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● VirtualizedResultsTable Integration Tests › Accessibility › should have proper ARIA labels

    expect(element).toHaveAttribute("title", "Select all businesses") // element.getAttribute("title") === "Select all businesses"

    Expected the element to have attribute:
      title="Select all businesses"
    Received:
      null

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm w-full"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"text-2xl font-semibold leading-none tracking-tight"[39m
                [36m>[39m
                  [0mBusiness Results ([0m
                  [0m1,000[0m
                  [0m)[0m
                [36m</h3>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3 bg-blue-100"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"14"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"20"[39m
                        [33mx[39m=[32m"2"[39m
                        [33my[39m=[32m"3"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"8"[39m
                        [33mx2[39m=[32m"16"[39m
                        [33my1[39m=[32m"21"[39m
                        [33my2[39m=[32m"21"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"12"[39m
                        [33mx2[39m=[32m"12"[39m
                        [33my1[39m=[32m"17"[39m
                        [33my2[39m=[32m"21"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [0mPerformance[0m
                  [36m</button>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"[39m
                      [36m/>[39m
                      [36m<polyline[39m
                        [33mpoints[39m=[32m"7 10 12 15 17 10"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"12"[39m
                        [33mx2[39m=[32m"12"[39m
                        [33my1[39m=[32m"15"[39m
                        [33my2[39m=[32m"3"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [0mExport ([0m
                    [0m10[0m
                    [0m)[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-4"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"[39m
                      [36m>[39m
                        [36m<svg[39m
                          [33mclass[39m=[32m"h-4 w-4 text-muted-foreground"[39m
                          [33mfill[39m=[32m"none"[39m
                          [33mheight[39m=[32m"24"[39m
                          [33mstroke[39m=[32m"currentColor"[39m
                          [33mstroke-linecap[39m=[32m"round"[39m
                          [33mstroke-linejoin[39m=[32m"round"[39m
                          [33mstroke-width[39m=[32m"2"[39m
                          [33mviewBox[39m=[32m"0 0 24 24"[39m
                          [33mwidth[39m=[32m"24"[39m
                          [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                        [36m>[39m
                          [36m<circle[39m
                            [33mcx[39m=[32m"11"[39m
                            [33mcy[39m=[32m"11"[39m
                            [33mr[39m=[32m"8"[39m
                          [36m/>[39m
                          [36m<path[39m
                            [33md[39m=[32m"m21 21-4.3-4.3"[39m
                          [36m/>[39m
                        [36m</svg>[39m
                      [36m</div>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 pl-10 pr-3 border-input focus-visible:ring-ring"[39m
           ...

    [0m [90m 354 |[39m
     [90m 355 |[39m         [36mconst[39m checkboxes [33m=[39m screen[33m.[39mgetAllByRole([32m'checkbox'[39m)
    [31m[1m>[22m[39m[90m 356 |[39m         expect(checkboxes[[35m0[39m])[33m.[39mtoHaveAttribute([32m'title'[39m[33m,[39m [32m'Select all businesses'[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 357 |[39m       })
     [90m 358 |[39m     })
     [90m 359 |[39m[0m

      at toHaveAttribute (src/tests/integration/virtualizedResultsTable.test.tsx:356:31)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

FAIL src/__tests__/integration/healthCheck.integration.test.ts
  Health Check Integration Tests
    Basic Health Check Endpoint
      √ should return healthy status when all systems are operational (12 ms)
      √ should return unhealthy status when database is down (6 ms)
      × should return warning status when configuration has issues (3 ms)
      √ should handle memory usage monitoring (3 ms)
    Detailed Health Check Endpoint
      √ should return detailed health information with metrics (10 ms)
      √ should return detailed health information with alerts (6 ms)
      × should handle custom health check parameters via POST (6 ms)
    Metrics Endpoint Integration
      × should return Prometheus format by default (8 ms)
      × should return JSON format when requested (4 ms)
      √ should exclude monitoring data when requested (4 ms)
    Error Handling
      × should handle monitoring service failures gracefully (19 ms)
      √ should handle metrics service failures (3 ms)

  ● Health Check Integration Tests › Basic Health Check Endpoint › should return warning status when configuration has issues

    expect(received).toBe(expected) // Object.is equality

    Expected: "warning"
    Received: "degraded"

    [0m [90m 146 |[39m
     [90m 147 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 148 |[39m       expect(data[33m.[39mstatus)[33m.[39mtoBe([32m'warning'[39m)
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 149 |[39m       expect(data[33m.[39mchecks[33m.[39mconfiguration)[33m.[39mtoBe([32m'warning'[39m)
     [90m 150 |[39m     })
     [90m 151 |[39m[0m

      at Object.toBe (src/__tests__/integration/healthCheck.integration.test.ts:148:27)

  ● Health Check Integration Tests › Detailed Health Check Endpoint › should handle custom health check parameters via POST

    expect(received).toMatchObject(expected)

    Matcher error: received value must be a non-null object

    Received has value: undefined

    [0m [90m 319 |[39m
     [90m 320 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 321 |[39m       expect(data[33m.[39mrequestedParameters)[33m.[39mtoMatchObject(requestBody)
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 322 |[39m       expect(data[33m.[39mservices)[33m.[39mtoHaveLength([35m1[39m)
     [90m 323 |[39m       expect(data[33m.[39mservices[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'database'[39m)
     [90m 324 |[39m     })[0m

      at Object.toMatchObject (src/__tests__/integration/healthCheck.integration.test.ts:321:40)

  ● Health Check Integration Tests › Metrics Endpoint Integration › should return Prometheus format by default

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 332 |[39m       [36mconst[39m text [33m=[39m [36mawait[39m response[33m.[39mtext()
     [90m 333 |[39m
    [31m[1m>[22m[39m[90m 334 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 335 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'Content-Type'[39m))[33m.[39mtoContain([32m'text/plain'[39m)
     [90m 336 |[39m       expect(text)[33m.[39mtoContain([32m'# Prometheus metrics'[39m)
     [90m 337 |[39m     })[0m

      at Object.toBe (src/__tests__/integration/healthCheck.integration.test.ts:334:31)

  ● Health Check Integration Tests › Metrics Endpoint Integration › should return JSON format when requested

    expect(received).toMatchObject(expected)

    - Expected  - 1
    + Received  + 0

    @@ -1,7 +1,6 @@
      Object {
    -   "alerts": Any<Array>,
        "metrics": Any<Array>,
        "prometheus": Any<String>,
        "system": Object {
          "activeAlerts": Any<Number>,
          "services": Any<Array>,

    [0m [90m 354 |[39m
     [90m 355 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 356 |[39m       expect(data)[33m.[39mtoMatchObject({
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 357 |[39m         timestamp[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m
     [90m 358 |[39m         system[33m:[39m {
     [90m 359 |[39m           status[33m:[39m [32m'healthy'[39m[33m,[39m[0m

      at Object.toMatchObject (src/__tests__/integration/healthCheck.integration.test.ts:356:20)

  ● Health Check Integration Tests › Error Handling › should handle monitoring service failures gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 503
    Received: 500

    [0m [90m 388 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m healthCheckHandler(request)
     [90m 389 |[39m
    [31m[1m>[22m[39m[90m 390 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m503[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 391 |[39m     })
     [90m 392 |[39m
     [90m 393 |[39m     it([32m'should handle metrics service failures'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (src/__tests__/integration/healthCheck.integration.test.ts:390:31)

FAIL src/__tests__/integration/userManagement.integration.test.ts
  User Management Integration
    Complete User Onboarding Flow
      × should complete full onboarding flow with payment setup (7 ms)
      × should handle subscription upgrade flow (2 ms)
      × should handle multiple user registrations (2 ms)
    Usage Quota Management
      × should properly initialize and track usage quotas (4 ms)
      × should handle different plan quota limits (2 ms)
    Payment Integration
      × should handle payment profile creation and updates (1 ms)
      × should gracefully handle payment service failures (4 ms)
    Data Persistence and Retrieval
      × should persist user data correctly across service calls (8 ms)
      × should handle concurrent user operations (3 ms)
    Error Scenarios
      × should handle duplicate email registration attempts (2 ms)
      × should handle invalid verification tokens (1 ms)

  ● User Management Integration › Complete User Onboarding Flow › should complete full onboarding flow with payment setup

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:53:51)

  ● User Management Integration › Complete User Onboarding Flow › should handle subscription upgrade flow

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:93:64)

  ● User Management Integration › Complete User Onboarding Flow › should handle multiple user registrations

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:121:50)

  ● User Management Integration › Usage Quota Management › should properly initialize and track usage quotas

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:146:48)

  ● User Management Integration › Usage Quota Management › should handle different plan quota limits

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:172:50)

  ● User Management Integration › Payment Integration › should handle payment profile creation and updates

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:189:48)

  ● User Management Integration › Payment Integration › should gracefully handle payment service failures

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:214:48)

  ● User Management Integration › Data Persistence and Retrieval › should persist user data correctly across service calls

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:239:56)

  ● User Management Integration › Data Persistence and Retrieval › should handle concurrent user operations

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:262:75)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/integration/userManagement.integration.test.ts:262:42)

  ● User Management Integration › Error Scenarios › should handle duplicate email registration attempts

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:292:53)

  ● User Management Integration › Error Scenarios › should handle invalid verification tokens

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:310:48)

PASS src/tests/integration/simple-api.test.ts
  Simple Integration Tests
    API Client
      √ should make GET requests correctly (4 ms)
      √ should make POST requests correctly (2 ms)
    Business Data Validation
      √ should validate business data structure (3 ms)
      √ should have valid email format (2 ms)
      √ should have valid phone format (3 ms)
      √ should have valid website URL (2 ms)
      √ should have valid confidence score (2 ms)
    Data Processing Pipeline
      √ should process business data through validation pipeline (2 ms)
      √ should handle batch validation (1 ms)
    Error Handling
      √ should handle network errors (16 ms)
      √ should handle invalid JSON responses (2 ms)
      √ should validate required fields (1 ms)
    Data Transformation
      √ should transform business data for export (1 ms)
      √ should handle missing optional fields in transformation (3 ms)
    Search and Filtering
      √ should filter businesses by industry (4 ms)
      √ should search businesses by name (1 ms)
      √ should sort businesses by confidence (1 ms)
    Performance Tests
      √ should handle large datasets efficiently (2 ms)
      √ should handle concurrent API requests (1 ms)

FAIL src/__tests__/integration/mobile-responsiveness.test.tsx
  Mobile Responsiveness Integration
    Mobile Layout
      × should render mobile-optimized header (58 ms)
      × should open mobile navigation drawer (17 ms)
      × should have touch-friendly targets (16 ms)
      × should handle mobile navigation between tabs (8 ms)
    Tablet Layout
      × should render tablet-optimized layout (11 ms)
    Desktop Layout
      × should render desktop layout (10 ms)
    Responsive Breakpoint Changes
      × should adapt when switching from mobile to desktop (6 ms)
    Touch Interactions
      × should handle touch events properly (9 ms)
      × should prevent body scroll when modal is open (21 ms)
    Accessibility on Mobile
      × should have proper ARIA attributes for mobile navigation (6 ms)
      × should support keyboard navigation (9 ms)
      × should have minimum touch target sizes (14 ms)

  ● Mobile Responsiveness Integration › Mobile Layout › should render mobile-optimized header

    TestingLibraryElementError: Unable to find an element with the text: Scraper. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 79 |[39m
     [90m 80 |[39m       [90m// Should show mobile title[39m
    [31m[1m>[22m[39m[90m 81 |[39m       expect(screen[33m.[39mgetByText([32m'Scraper'[39m))[33m.[39mtoBeInTheDocument()
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 82 |[39m       expect(screen[33m.[39mqueryByText([32m'Business Scraper'[39m))[33m.[39mnot[33m.[39mtoBeInTheDocument()
     [90m 83 |[39m
     [90m 84 |[39m       [90m// Should show mobile menu button[39m[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/integration/mobile-responsiveness.test.tsx:81:21)

  ● Mobile Responsiveness Integration › Mobile Layout › should open mobile navigation drawer

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m  95 |[39m       )
     [90m  96 |[39m
    [31m[1m>[22m[39m[90m  97 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m  98 |[39m
     [90m  99 |[39m       expect(screen[33m.[39mgetByRole([32m'dialog'[39m))[33m.[39mtoBeInTheDocument()
     [90m 100 |[39m       expect(screen[33m.[39mgetByText([32m'Navigation'[39m))[33m.[39mtoBeInTheDocument()[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:97:31)

  ● Mobile Responsiveness Integration › Mobile Layout › should have touch-friendly targets

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 110 |[39m       )
     [90m 111 |[39m
    [31m[1m>[22m[39m[90m 112 |[39m       [36mconst[39m menuButton [33m=[39m screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 113 |[39m       expect(menuButton)[33m.[39mtoHaveClass([32m'min-h-touch'[39m[33m,[39m [32m'min-w-touch'[39m)
     [90m 114 |[39m
     [90m 115 |[39m       [36mawait[39m user[33m.[39mclick(menuButton)[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:112:33)

  ● Mobile Responsiveness Integration › Mobile Layout › should handle mobile navigation between tabs

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 129 |[39m
     [90m 130 |[39m       [90m// Open mobile menu[39m
    [31m[1m>[22m[39m[90m 131 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 132 |[39m
     [90m 133 |[39m       [90m// Navigate to scraping tab[39m
     [90m 134 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByText([32m'Scraping'[39m))[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:131:31)

  ● Mobile Responsiveness Integration › Tablet Layout › should render tablet-optimized layout

    TestingLibraryElementError: Unable to find an element with the text: Business Scraper. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 170 |[39m
     [90m 171 |[39m       [90m// Should show full title on tablet[39m
    [31m[1m>[22m[39m[90m 172 |[39m       expect(screen[33m.[39mgetByText([32m'Business Scraper'[39m))[33m.[39mtoBeInTheDocument()
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 173 |[39m
     [90m 174 |[39m       [90m// Should show desktop navigation on tablet[39m
     [90m 175 |[39m       expect(screen[33m.[39mgetByText([32m'Configuration'[39m))[33m.[39mtoBeInTheDocument()[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/integration/mobile-responsiveness.test.tsx:172:21)

  ● Mobile Responsiveness Integration › Desktop Layout › should render desktop layout

    TestingLibraryElementError: Unable to find an element with the text: Business Scraper. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 204 |[39m
     [90m 205 |[39m       [90m// Should show full title[39m
    [31m[1m>[22m[39m[90m 206 |[39m       expect(screen[33m.[39mgetByText([32m'Business Scraper'[39m))[33m.[39mtoBeInTheDocument()
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 207 |[39m
     [90m 208 |[39m       [90m// Should show desktop navigation[39m
     [90m 209 |[39m       expect(screen[33m.[39mgetByText([32m'Configuration'[39m))[33m.[39mtoBeInTheDocument()[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/integration/mobile-responsiveness.test.tsx:206:21)

  ● Mobile Responsiveness Integration › Responsive Breakpoint Changes › should adapt when switching from mobile to desktop

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 236 |[39m
     [90m 237 |[39m       [90m// Should be in mobile mode[39m
    [31m[1m>[22m[39m[90m 238 |[39m       expect(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))[33m.[39mtoBeInTheDocument()
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 239 |[39m
     [90m 240 |[39m       [90m// Open mobile drawer[39m
     [90m 241 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:238:21)

  ● Mobile Responsiveness Integration › Touch Interactions › should handle touch events properly

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 286 |[39m       )
     [90m 287 |[39m
    [31m[1m>[22m[39m[90m 288 |[39m       [36mconst[39m menuButton [33m=[39m screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 289 |[39m
     [90m 290 |[39m       [90m// Simulate touch events[39m
     [90m 291 |[39m       fireEvent[33m.[39mtouchStart(menuButton)[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:288:33)

  ● Mobile Responsiveness Integration › Touch Interactions › should prevent body scroll when modal is open

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 308 |[39m       expect(document[33m.[39mbody[33m.[39mstyle[33m.[39moverflow)[33m.[39mtoBe([32m''[39m)
     [90m 309 |[39m
    [31m[1m>[22m[39m[90m 310 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 311 |[39m
     [90m 312 |[39m       expect(document[33m.[39mbody[33m.[39mstyle[33m.[39moverflow)[33m.[39mtoBe([32m'hidden'[39m)
     [90m 313 |[39m[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:310:31)

  ● Mobile Responsiveness Integration › Accessibility on Mobile › should have proper ARIA attributes for mobile navigation

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 341 |[39m       )
     [90m 342 |[39m
    [31m[1m>[22m[39m[90m 343 |[39m       [36mconst[39m menuButton [33m=[39m screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 344 |[39m       expect(menuButton)[33m.[39mtoHaveAttribute([32m'aria-expanded'[39m[33m,[39m [32m'false'[39m)
     [90m 345 |[39m
     [90m 346 |[39m       [36mawait[39m user[33m.[39mclick(menuButton)[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:343:33)

  ● Mobile Responsiveness Integration › Accessibility on Mobile › should support keyboard navigation

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 362 |[39m       )
     [90m 363 |[39m
    [31m[1m>[22m[39m[90m 364 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 365 |[39m
     [90m 366 |[39m       [90m// Should be able to close with Escape[39m
     [90m 367 |[39m       fireEvent[33m.[39mkeyDown(document[33m,[39m { key[33m:[39m [32m'Escape'[39m[33m,[39m code[33m:[39m [32m'Escape'[39m })[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:364:31)

  ● Mobile Responsiveness Integration › Accessibility on Mobile › should have minimum touch target sizes

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 381 |[39m       )
     [90m 382 |[39m
    [31m[1m>[22m[39m[90m 383 |[39m       [36mconst[39m menuButton [33m=[39m screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 384 |[39m       expect(menuButton)[33m.[39mtoHaveClass([32m'min-h-touch'[39m[33m,[39m [32m'min-w-touch'[39m)
     [90m 385 |[39m
     [90m 386 |[39m       [36mawait[39m user[33m.[39mclick(menuButton)[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:383:33)



**stderr:**
```
FAIL src/__tests__/login-csrf-integration.test.tsx (7.555 s)
  Login Page CSRF Integration
    CSRF Token Loading States
      √ should show loading message only during initial load (99 ms)
      × should not show 401 errors to users (16 ms)
      × should show non-401 errors to users (19 ms)
      √ should not show loading and error simultaneously (11 ms)
    Successful CSRF Token Load
      × should enable form submission when token is loaded (76 ms)
      √ should disable form submission without valid token (31 ms)
    Form Submission with CSRF Protection
      × should submit form with CSRF token (1038 ms)
      × should handle form submission errors gracefully (1041 ms)
    Rate Limiting Handling
      × should show rate limit message and countdown (1043 ms)
    Authentication Check
      × should redirect if already authenticated (1016 ms)
      √ should stay on login page if not authenticated (10 ms)

  ● Login Page CSRF Integration › CSRF Token Loading States › should not show 401 errors to users

    expect(element).not.toBeInTheDocument()

    expected document not to contain element, found <div class="text-sm text-blue-700">Loading security token...</div> instead

    [0m [90m 87 |[39m
     [90m 88 |[39m       [90m// Should not show loading message when not loading[39m
    [31m[1m>[22m[39m[90m 89 |[39m       expect(screen[33m.[39mqueryByText([32m'Loading security token...'[39m))[33m.[39mnot[33m.[39mtoBeInTheDocument()
     [90m    |[39m                                                                   [31m[1m^[22m[39m
     [90m 90 |[39m     })
     [90m 91 |[39m
     [90m 92 |[39m     it([32m'should show non-401 errors to users'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBeInTheDocument (src/__tests__/login-csrf-integration.test.tsx:89:67)

  ● Login Page CSRF Integration › CSRF Token Loading States › should show non-401 errors to users

    TestingLibraryElementError: Unable to find an element with the text: Network error occurred. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
              [36m>[39m
                [36m<img[39m
                  [33malt[39m=[32m"Business Scraper Logo"[39m
                  [33mclass[39m=[32m"object-contain"[39m
                  [33mheight[39m=[32m"40"[39m
                  [33mquality[39m=[32m"90"[39m
                  [33msizes[39m=[32m"40px"[39m
                  [33msrc[39m=[32m"/favicon.ico"[39m
                  [33mwidth[39m=[32m"40"[39m
                [36m/>[39m
                [36m<h2[39m
                  [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                [36m>[39m
                  [0mBusiness Scraper[0m
                [36m</h2>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
              [36m>[39m
                [0mSign in to access the application[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
            [36m>[39m
              [36m<form[39m
                [33mclass[39m=[32m"space-y-6"[39m
              [36m>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"username"[39m
                  [36m>[39m
                    [0mUsername[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"username"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"username"[39m
                        [33mname[39m=[32m"username"[39m
                        [33mplaceholder[39m=[32m"Username"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"password"[39m
                  [36m>[39m
                    [0mPassword[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"current-password"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"password"[39m
                        [33mname[39m=[32m"password"[39m
                        [33mplaceholder[39m=[32m"Password"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"password"[39m
                        [33mvalue[39m=[32m""[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"rounded-md bg-blue-50 p-4"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"text-sm text-blue-700"[39m
                  [36m>[39m
                    [0mLoading security token...[0m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mtype[39m=[32m"submit"[39m
                  [36m>[39m
                    [0mSign in[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</form>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"text-center"[39m
            [36m>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-xs text-gray-500"[39m
              [36m>[39m
                [0mThis is a single-user application. Contact your administrator for access.[0m
              [36m</p>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 104 |[39m
     [90m 105 |[39m       [90m// Should show non-401 errors[39m
    [31m[1m>[22m[39m[90m 106 |[39m       expect(screen[33m.[39mgetByText([32m'Network error occurred'[39m))[33m.[39mtoBeInTheDocument()
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 107 |[39m     })
     [90m 108 |[39m
     [90m 109 |[39m     it([32m'should not show loading and error simultaneously'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/login-csrf-integration.test.tsx:106:21)

  ● Login Page CSRF Integration › Successful CSRF Token Load › should enable form submission when token is loaded

    expect(element).not.toBeDisabled()

    Received element is disabled:
      <button class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center" disabled="" type="submit" />

    [0m [90m 156 |[39m       [90m// Submit button should be enabled[39m
     [90m 157 |[39m       [36mconst[39m submitButton [33m=[39m screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/sign in/i[39m })
    [31m[1m>[22m[39m[90m 158 |[39m       expect(submitButton)[33m.[39mnot[33m.[39mtoBeDisabled()
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 159 |[39m
     [90m 160 |[39m       [90m// Should not show any error or loading messages[39m
     [90m 161 |[39m       expect(screen[33m.[39mqueryByText([32m'Loading security token...'[39m))[33m.[39mnot[33m.[39mtoBeInTheDocument()[0m

      at Object.toBeDisabled (src/__tests__/login-csrf-integration.test.tsx:158:32)

  ● Login Page CSRF Integration › Form Submission with CSRF Protection › should submit form with CSRF token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/auth", {"password": "password", "username": "admin"}

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
            [36m>[39m
              [36m<div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
                [36m>[39m
                  [36m<img[39m
                    [33malt[39m=[32m"Business Scraper Logo"[39m
                    [33mclass[39m=[32m"object-contain"[39m
                    [33mheight[39m=[32m"40"[39m
                    [33mquality[39m=[32m"90"[39m
                    [33msizes[39m=[32m"40px"[39m
                    [33msrc[39m=[32m"/favicon.ico"[39m
                    [33mwidth[39m=[32m"40"[39m
                  [36m/>[39m
                  [36m<h2[39m
                    [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                  [36m>[39m
                    [0mBusiness Scraper[0m
                  [36m</h2>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
                [36m>[39m
                  [0mSign in to access the application[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
              [36m>[39m
                [36m<form[39m
                  [33mclass[39m=[32m"space-y-6"[39m
                [36m>[39m
                  [36m<div>[39m
                    [36m<label[39m
                      [33mclass[39m=[32m"sr-only"[39m
                      [33mfor[39m=[32m"username"[39m
                    [36m>[39m
                      [0mUsername[0m
                    [36m</label>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"space-y-2"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"relative"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33maria-invalid[39m=[32m"false"[39m
                          [33mautocomplete[39m=[32m"username"[39m
                          [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                          [33mid[39m=[32m"username"[39m
                          [33mname[39m=[32m"username"[39m
                          [33mplaceholder[39m=[32m"Username"[39m
                          [33mrequired[39m=[32m""[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m"admin"[39m
                        [36m/>[39m
                        [36m<div[39m
                          [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div>[39m
                    [36m<label[39m
                      [33mclass[39m=[32m"sr-only"[39m
                      [33mfor[39m=[32m"password"[39m
                    [36m>[39m
                      [0mPassword[0m
                    [36m</label>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"space-y-2"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"relative"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33maria-invalid[39m=[32m"false"[39m
                          [33mautocomplete[39m=[32m"current-password"[39m
                          [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                          [33mid[39m=[32m"password"[39m
                          [33mname[39m=[32m"password"[39m
                          [33mplaceholder[39m=[32m"Password"[39m
                          [33mrequired[39m=[32m""[39m
                          [33mtype[39m=[32m"password"[39m
                          [33mvalue[39m=[32m"password"[39m
                        [36m/>[39m
                        [36m<div[39m
                          [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div>[39m
                    [36m<button[39m
                      [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                      [33mdisabled[39m=[32m""[39m
                      [33mtype[39m=[32m"submit"[39m
                    [36m>[39m
                      [0mSign in[0m
                    [36m</button>[39m
                  [36m</div>[39m
                [36m</form>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-center"[39m
              [36m>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-xs text-gray-500"[39m
                [36m>[39m
                  [0mThis is a single-user application. Contact your administrator for access.[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 225 |[39m
     [90m 226 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 227 |[39m         expect(mockSubmitForm)[33m.[39mtoHaveBeenCalledWith([32m'/api/auth'[39m[33m,[39m {
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 228 |[39m           username[33m:[39m [32m'admin'[39m[33m,[39m
     [90m 229 |[39m           password[33m:[39m [32m'password'[39m[33m,[39m
     [90m 230 |[39m         })[0m

      at toHaveBeenCalledWith (src/__tests__/login-csrf-integration.test.tsx:227:32)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● Login Page CSRF Integration › Form Submission with CSRF Protection › should handle form submission errors gracefully

    Unable to find an element with the text: Invalid credentials. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
              [36m>[39m
                [36m<img[39m
                  [33malt[39m=[32m"Business Scraper Logo"[39m
                  [33mclass[39m=[32m"object-contain"[39m
                  [33mheight[39m=[32m"40"[39m
                  [33mquality[39m=[32m"90"[39m
                  [33msizes[39m=[32m"40px"[39m
                  [33msrc[39m=[32m"/favicon.ico"[39m
                  [33mwidth[39m=[32m"40"[39m
                [36m/>[39m
                [36m<h2[39m
                  [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                [36m>[39m
                  [0mBusiness Scraper[0m
                [36m</h2>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
              [36m>[39m
                [0mSign in to access the application[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
            [36m>[39m
              [36m<form[39m
                [33mclass[39m=[32m"space-y-6"[39m
              [36m>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"username"[39m
                  [36m>[39m
                    [0mUsername[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"username"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"username"[39m
                        [33mname[39m=[32m"username"[39m
                        [33mplaceholder[39m=[32m"Username"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m"admin"[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"password"[39m
                  [36m>[39m
                    [0mPassword[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"current-password"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"password"[39m
                        [33mname[39m=[32m"password"[39m
                        [33mplaceholder[39m=[32m"Password"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"password"[39m
                        [33mvalue[39m=[32m"wrong"[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mtype[39m=[32m"submit"[39m
                  [36m>[39m
                    [0mSign in[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</form>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"text-center"[39m
            [36m>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-xs text-gray-500"[39m
              [36m>[39m
                [0mThis is a single-user application. Contact your administrator for access.[0m
              [36m</p>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 266 |[39m       fireEvent[33m.[39mclick(screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/sign in/i[39m }))
     [90m 267 |[39m
    [31m[1m>[22m[39m[90m 268 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 269 |[39m         expect(screen[33m.[39mgetByText([32m'Invalid credentials'[39m))[33m.[39mtoBeInTheDocument()
     [90m 270 |[39m       })
     [90m 271 |[39m     })[0m

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/__tests__/login-csrf-integration.test.tsx:268:20)

  ● Login Page CSRF Integration › Rate Limiting Handling › should show rate limit message and countdown

    Unable to find an element with the text: /Too many failed attempts/. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
              [36m>[39m
                [36m<img[39m
                  [33malt[39m=[32m"Business Scraper Logo"[39m
                  [33mclass[39m=[32m"object-contain"[39m
                  [33mheight[39m=[32m"40"[39m
                  [33mquality[39m=[32m"90"[39m
                  [33msizes[39m=[32m"40px"[39m
                  [33msrc[39m=[32m"/favicon.ico"[39m
                  [33mwidth[39m=[32m"40"[39m
                [36m/>[39m
                [36m<h2[39m
                  [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                [36m>[39m
                  [0mBusiness Scraper[0m
                [36m</h2>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
              [36m>[39m
                [0mSign in to access the application[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
            [36m>[39m
              [36m<form[39m
                [33mclass[39m=[32m"space-y-6"[39m
              [36m>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"username"[39m
                  [36m>[39m
                    [0mUsername[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"username"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"username"[39m
                        [33mname[39m=[32m"username"[39m
                        [33mplaceholder[39m=[32m"Username"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"text"[39m
                        [33mvalue[39m=[32m"admin"[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<label[39m
                    [33mclass[39m=[32m"sr-only"[39m
                    [33mfor[39m=[32m"password"[39m
                  [36m>[39m
                    [0mPassword[0m
                  [36m</label>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mautocomplete[39m=[32m"current-password"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                        [33mid[39m=[32m"password"[39m
                        [33mname[39m=[32m"password"[39m
                        [33mplaceholder[39m=[32m"Password"[39m
                        [33mrequired[39m=[32m""[39m
                        [33mtype[39m=[32m"password"[39m
                        [33mvalue[39m=[32m"wrong"[39m
                      [36m/>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                      [36m/>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                [36m</div>[39m
                [36m<div>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mtype[39m=[32m"submit"[39m
                  [36m>[39m
                    [0mSign in[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</form>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"text-center"[39m
            [36m>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-xs text-gray-500"[39m
              [36m>[39m
                [0mThis is a single-user application. Contact your administrator for access.[0m
              [36m</p>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 310 |[39m       fireEvent[33m.[39mclick(screen[33m.[39mgetByRole([32m'button'[39m[33m,[39m { name[33m:[39m [35m/sign in/i[39m }))
     [90m 311 |[39m
    [31m[1m>[22m[39m[90m 312 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 313 |[39m         expect(screen[33m.[39mgetByText([35m/Too many failed attempts/[39m))[33m.[39mtoBeInTheDocument()
     [90m 314 |[39m         expect(screen[33m.[39mgetByText([35m/Retry in 60 seconds/[39m))[33m.[39mtoBeInTheDocument()
     [90m 315 |[39m       })[0m

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/__tests__/login-csrf-integration.test.tsx:312:20)

  ● Login Page CSRF Integration › Authentication Check › should redirect if already authenticated

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/"

    Number of calls: 0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"max-w-md w-full space-y-8"[39m
            [36m>[39m
              [36m<div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center justify-center gap-3 mb-2"[39m
                [36m>[39m
                  [36m<img[39m
                    [33malt[39m=[32m"Business Scraper Logo"[39m
                    [33mclass[39m=[32m"object-contain"[39m
                    [33mheight[39m=[32m"40"[39m
                    [33mquality[39m=[32m"90"[39m
                    [33msizes[39m=[32m"40px"[39m
                    [33msrc[39m=[32m"/favicon.ico"[39m
                    [33mwidth[39m=[32m"40"[39m
                  [36m/>[39m
                  [36m<h2[39m
                    [33mclass[39m=[32m"text-3xl font-extrabold text-gray-900"[39m
                  [36m>[39m
                    [0mBusiness Scraper[0m
                  [36m</h2>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-2 text-center text-sm text-gray-600"[39m
                [36m>[39m
                  [0mSign in to access the application[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm p-8"[39m
              [36m>[39m
                [36m<form[39m
                  [33mclass[39m=[32m"space-y-6"[39m
                [36m>[39m
                  [36m<div>[39m
                    [36m<label[39m
                      [33mclass[39m=[32m"sr-only"[39m
                      [33mfor[39m=[32m"username"[39m
                    [36m>[39m
                      [0mUsername[0m
                    [36m</label>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"space-y-2"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"relative"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33maria-invalid[39m=[32m"false"[39m
                          [33mautocomplete[39m=[32m"username"[39m
                          [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                          [33mid[39m=[32m"username"[39m
                          [33mname[39m=[32m"username"[39m
                          [33mplaceholder[39m=[32m"Username"[39m
                          [33mrequired[39m=[32m""[39m
                          [33mtype[39m=[32m"text"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                        [36m<div[39m
                          [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div>[39m
                    [36m<label[39m
                      [33mclass[39m=[32m"sr-only"[39m
                      [33mfor[39m=[32m"password"[39m
                    [36m>[39m
                      [0mPassword[0m
                    [36m</label>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"space-y-2"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"relative"[39m
                      [36m>[39m
                        [36m<input[39m
                          [33maria-invalid[39m=[32m"false"[39m
                          [33mautocomplete[39m=[32m"current-password"[39m
                          [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 px-3 pr-3 border-input focus-visible:ring-ring relative block w-full"[39m
                          [33mid[39m=[32m"password"[39m
                          [33mname[39m=[32m"password"[39m
                          [33mplaceholder[39m=[32m"Password"[39m
                          [33mrequired[39m=[32m""[39m
                          [33mtype[39m=[32m"password"[39m
                          [33mvalue[39m=[32m""[39m
                        [36m/>[39m
                        [36m<div[39m
                          [33mclass[39m=[32m"absolute inset-y-0 right-0 flex items-center pr-3 space-x-1"[39m
                        [36m/>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                  [36m</div>[39m
                  [36m<div>[39m
                    [36m<button[39m
                      [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 group relative w-full flex justify-center"[39m
                      [33mdisabled[39m=[32m""[39m
                      [33mtype[39m=[32m"submit"[39m
                    [36m>[39m
                      [0mSign in[0m
                    [36m</button>[39m
                  [36m</div>[39m
                [36m</form>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-center"[39m
              [36m>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-xs text-gray-500"[39m
                [36m>[39m
                  [0mThis is a single-user application. Contact your administrator for access.[0m
                [36m</p>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 343 |[39m
     [90m 344 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 345 |[39m         expect(mockPush)[33m.[39mtoHaveBeenCalledWith([32m'/'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 346 |[39m       })
     [90m 347 |[39m     })
     [90m 348 |[39m[0m

      at toHaveBeenCalledWith (src/__tests__/login-csrf-integration.test.tsx:345:26)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

FAIL src/__tests__/debug-solution-integration.test.tsx
  Debug Solution Integration
    Complete Debug Mode Flow
      × should enable debug mode and prevent auto-reload during security token errors (46 ms)
      × should allow normal reload when debug mode is disabled (3 ms)
      × should provide debug utilities in console when debug mode is active (1024 ms)
      × should capture and persist security token loading errors (6 ms)
      × should show reload prevention notification when auto-reload is blocked (1011 ms)
    Error Recovery and Debugging
      × should provide comprehensive error data for debugging (4 ms)

  ● Debug Solution Integration › Complete Debug Mode Flow › should enable debug mode and prevent auto-reload during security token errors

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 47 |[39m       [90m// Enable debug mode[39m
     [90m 48 |[39m       enableDebugMode()
    [31m[1m>[22m[39m[90m 49 |[39m       expect(isDebugMode())[33m.[39mtoBe([36mtrue[39m)
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 50 |[39m       
     [90m 51 |[39m       [90m// Initialize debug system[39m
     [90m 52 |[39m       render([33m<[39m[33mDebugSystemInitializer[39m [33m/[39m[33m>[39m)[0m

      at Object.toBe (src/__tests__/debug-solution-integration.test.tsx:49:29)

  ● Debug Solution Integration › Complete Debug Mode Flow › should allow normal reload when debug mode is disabled

    TypeError: Cannot redefine property: reload
        at Function.defineProperty (<anonymous>)

    [0m [90m 104 |[39m       [36mconst[39m originalReload [33m=[39m window[33m.[39mlocation[33m.[39mreload
     [90m 105 |[39m       [36mconst[39m reloadSpy [33m=[39m jest[33m.[39mfn()
    [31m[1m>[22m[39m[90m 106 |[39m       [33mObject[39m[33m.[39mdefineProperty(window[33m.[39mlocation[33m,[39m [32m'reload'[39m[33m,[39m {
     [90m     |[39m              [31m[1m^[22m[39m
     [90m 107 |[39m         writable[33m:[39m [36mtrue[39m[33m,[39m
     [90m 108 |[39m         value[33m:[39m reloadSpy
     [90m 109 |[39m       })[0m

      at Object.defineProperty (src/__tests__/debug-solution-integration.test.tsx:106:14)

  ● Debug Solution Integration › Complete Debug Mode Flow › should provide debug utilities in console when debug mode is active

    expect(received).toBeDefined()

    Received: undefined

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 130 |[39m       [90m// Wait for debug utilities to be available[39m
     [90m 131 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 132 |[39m         expect((window [36mas[39m any)[33m.[39mdebugUtils)[33m.[39mtoBeDefined()
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 133 |[39m         expect([36mtypeof[39m (window [36mas[39m any)[33m.[39mdebugUtils[33m.[39menableDebugMode)[33m.[39mtoBe([32m'function'[39m)
     [90m 134 |[39m         expect([36mtypeof[39m (window [36mas[39m any)[33m.[39mdebugUtils[33m.[39mdisableDebugMode)[33m.[39mtoBe([32m'function'[39m)
     [90m 135 |[39m         expect([36mtypeof[39m (window [36mas[39m any)[33m.[39mdebugUtils[33m.[39mgetErrorAnalytics)[33m.[39mtoBe([32m'function'[39m)[0m

      at toBeDefined (src/__tests__/debug-solution-integration.test.tsx:132:44)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● Debug Solution Integration › Complete Debug Mode Flow › should capture and persist security token loading errors

    expect(received).toHaveLength(expected)

    Expected length: 4
    Received length: 0
    Received array:  []

    [0m [90m 167 |[39m       [90m// Verify all errors were persisted[39m
     [90m 168 |[39m       [36mconst[39m persistedErrors [33m=[39m errorPersistenceManager[33m.[39mgetCurrentSessionErrors()
    [31m[1m>[22m[39m[90m 169 |[39m       expect(persistedErrors)[33m.[39mtoHaveLength([35m4[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 170 |[39m       
     [90m 171 |[39m       [90m// Verify error analytics[39m
     [90m 172 |[39m       [36mconst[39m analytics [33m=[39m errorPersistenceManager[33m.[39mgetErrorAnalytics()[0m

      at Object.toHaveLength (src/__tests__/debug-solution-integration.test.tsx:169:31)

  ● Debug Solution Integration › Complete Debug Mode Flow › should show reload prevention notification when auto-reload is blocked

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: undefined

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div />[39m
      [36m</body>[39m
    [36m</html>[39m

    [0m [90m 196 |[39m           el[33m.[39mtextContent[33m?[39m[33m.[39mincludes([32m'Auto-reload Prevented'[39m)
     [90m 197 |[39m         )
    [31m[1m>[22m[39m[90m 198 |[39m         expect(reloadNotification)[33m.[39mtoBeInTheDocument()
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 199 |[39m         expect(reloadNotification[33m?[39m[33m.[39mtextContent)[33m.[39mtoContain([32m'Security token error occurred'[39m)
     [90m 200 |[39m       })
     [90m 201 |[39m     })[0m

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:325:30)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:326:15)
      at toBeInTheDocument (src/__tests__/debug-solution-integration.test.tsx:198:36)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● Debug Solution Integration › Error Recovery and Debugging › should provide comprehensive error data for debugging

    TypeError: Cannot read properties of undefined (reading 'totalErrors')

    [0m [90m 233 |[39m       [36mconst[39m exportedData [33m=[39m errorPersistenceManager[33m.[39mexportErrorData()
     [90m 234 |[39m       
    [31m[1m>[22m[39m[90m 235 |[39m       expect(exportedData[33m.[39msummary[33m.[39mtotalErrors)[33m.[39mtoBe([35m3[39m)
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 236 |[39m       expect(exportedData[33m.[39msummary[33m.[39mtotalSessions)[33m.[39mtoBe([35m1[39m)
     [90m 237 |[39m       expect(exportedData[33m.[39merrors)[33m.[39mtoHaveLength([35m3[39m)
     [90m 238 |[39m       [0m

      at Object.totalErrors (src/__tests__/debug-solution-integration.test.tsx:235:35)

FAIL src/tests/integration/payment-api.test.ts
  Payment API Integration Tests
    Stripe Webhook Handler
      √ should process valid webhook with signature (4 ms)
      √ should reject webhook without signature (2 ms)
      √ should reject webhook with invalid signature (2 ms)
      √ should handle subscription update events (2 ms)
      √ should handle payment success events (4 ms)
      √ should handle unhandled event types gracefully (5 ms)
    Payment Intent Creation API
      × should create payment intent for authenticated user (4 ms)
      × should reject unauthenticated requests (6 ms)
      × should validate request body (5 ms)
      × should handle Stripe errors gracefully (2 ms)
    Payment Intent Retrieval API
      × should retrieve payment intent for authenticated user (5 ms)
      √ should reject request without payment intent ID (1 ms)
      × should reject unauthorized access to payment intent (2 ms)

  ● Payment API Integration Tests › Payment Intent Creation API › should create payment intent for authenticated user

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 217 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createPaymentIntentHandler(request)
     [90m 218 |[39m
    [31m[1m>[22m[39m[90m 219 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 220 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 221 |[39m       expect(responseData[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 222 |[39m       expect(responseData[33m.[39mclientSecret)[33m.[39mtoBe([32m'pi_123_secret'[39m)[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:219:31)

  ● Payment API Integration Tests › Payment Intent Creation API › should reject unauthenticated requests

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 400

    [0m [90m 236 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createPaymentIntentHandler(request)
     [90m 237 |[39m
    [31m[1m>[22m[39m[90m 238 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 239 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 240 |[39m       expect(responseData[33m.[39merror)[33m.[39mtoBe([32m'Authentication required'[39m)
     [90m 241 |[39m     })[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:238:31)

  ● Payment API Integration Tests › Payment Intent Creation API › should validate request body

    expect(received).toBe(expected) // Object.is equality

    Expected: "Validation failed"
    Received: "Invalid JSON in request body"

    [0m [90m 255 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m 256 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
    [31m[1m>[22m[39m[90m 257 |[39m       expect(responseData[33m.[39merror)[33m.[39mtoBe([32m'Validation failed'[39m)
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 258 |[39m     })
     [90m 259 |[39m
     [90m 260 |[39m     it([32m'should handle Stripe errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:257:34)

  ● Payment API Integration Tests › Payment Intent Creation API › should handle Stripe errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

    [0m [90m 272 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createPaymentIntentHandler(request)
     [90m 273 |[39m
    [31m[1m>[22m[39m[90m 274 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 275 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 276 |[39m       expect(responseData[33m.[39merror)[33m.[39mtoBe([32m'Failed to create payment intent'[39m)
     [90m 277 |[39m     })[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:274:31)

  ● Payment API Integration Tests › Payment Intent Retrieval API › should retrieve payment intent for authenticated user

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 326 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getPaymentIntentHandler(request)
     [90m 327 |[39m
    [31m[1m>[22m[39m[90m 328 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 329 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 330 |[39m       expect(responseData[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 331 |[39m       expect(responseData[33m.[39mpaymentIntent[33m.[39mid)[33m.[39mtoBe([32m'pi_123'[39m)[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:328:31)

  ● Payment API Integration Tests › Payment Intent Retrieval API › should reject unauthorized access to payment intent

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 500

    [0m [90m 370 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getPaymentIntentHandler(request)
     [90m 371 |[39m
    [31m[1m>[22m[39m[90m 372 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 373 |[39m       [36mconst[39m responseData [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 374 |[39m       expect(responseData[33m.[39merror)[33m.[39mtoBe([32m'Payment intent not found'[39m)
     [90m 375 |[39m     })[0m

      at Object.toBe (src/tests/integration/payment-api.test.ts:372:31)

FAIL src/__tests__/integration/csrf-auth-fix.test.ts
  CSRF Authentication Fix Integration Test
    CSRF Token Fetching
      × should successfully fetch CSRF token from /api/csrf without 401 error (5 ms)
      × should set proper cookies for session and CSRF token (3 ms)
    Authentication Flow
      × should complete full authentication flow without CSRF errors (4 ms)
    Error Handling
      × should handle CSRF endpoint errors gracefully (4 ms)
    Security Compliance
      × should log security events for audit compliance (3 ms)
      × should include proper security headers (3 ms)

  ● CSRF Authentication Fix Integration Test › CSRF Token Fetching › should successfully fetch CSRF token from /api/csrf without 401 error

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 78 |[39m       })
     [90m 79 |[39m
    [31m[1m>[22m[39m[90m 80 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m csrfGet(request)
     [90m    |[39m                                     [31m[1m^[22m[39m
     [90m 81 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 82 |[39m
     [90m 83 |[39m       [90m// Verify successful response[39m[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:80:37)

  ● CSRF Authentication Fix Integration Test › CSRF Token Fetching › should set proper cookies for session and CSRF token

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 103 |[39m       })
     [90m 104 |[39m
    [31m[1m>[22m[39m[90m 105 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m csrfGet(request)
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 106 |[39m
     [90m 107 |[39m       [90m// Check that session cookie is set[39m
     [90m 108 |[39m       [36mconst[39m setCookieHeaders [33m=[39m response[33m.[39mheaders[33m.[39mgetSetCookie()[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:105:37)

  ● CSRF Authentication Fix Integration Test › Authentication Flow › should complete full authentication flow without CSRF errors

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 129 |[39m       })
     [90m 130 |[39m
    [31m[1m>[22m[39m[90m 131 |[39m       [36mconst[39m csrfResponse [33m=[39m [36mawait[39m csrfGet(csrfRequest)
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 132 |[39m       [36mconst[39m csrfData [33m=[39m [36mawait[39m csrfResponse[33m.[39mjson()
     [90m 133 |[39m
     [90m 134 |[39m       expect(csrfResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:131:41)

  ● CSRF Authentication Fix Integration Test › Error Handling › should handle CSRF endpoint errors gracefully

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 177 |[39m       })
     [90m 178 |[39m
    [31m[1m>[22m[39m[90m 179 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m csrfGet(request)
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 180 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 181 |[39m
     [90m 182 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:179:37)

  ● CSRF Authentication Fix Integration Test › Security Compliance › should log security events for audit compliance

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 197 |[39m       })
     [90m 198 |[39m
    [31m[1m>[22m[39m[90m 199 |[39m       [36mawait[39m csrfGet(request)
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 200 |[39m
     [90m 201 |[39m       [90m// Verify audit logging[39m
     [90m 202 |[39m       expect(auditService[33m.[39mlogAuditEvent)[33m.[39mtoHaveBeenCalledWith([0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:199:20)

  ● CSRF Authentication Fix Integration Test › Security Compliance › should include proper security headers

    TypeError: (0 , _route.GET) is not a function

    [0m [90m 222 |[39m       })
     [90m 223 |[39m
    [31m[1m>[22m[39m[90m 224 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m csrfGet(request)
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 225 |[39m
     [90m 226 |[39m       [90m// Verify security headers[39m
     [90m 227 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-CSRF-Token'[39m))[33m.[39mtoBeDefined()[0m

      at Object.<anonymous> (src/__tests__/integration/csrf-auth-fix.test.ts:224:37)

FAIL src/__tests__/lib/integrations/api-framework.test.ts
  ApiFramework
    Handler Creation
      √ should create handler with default options (2 ms)
      √ should create handler with custom options (2 ms)
    Request Processing
      × should process successful request (7 ms)
      √ should handle rate limit exceeded (11 ms)
      √ should handle handler errors (9 ms)
    Authentication
      √ should handle missing authentication (4 ms)
      √ should handle API key authentication (4 ms)
    Authorization
      √ should enforce permission requirements (3 ms)
      √ should allow access with correct permissions (2 ms)
    CORS Handling
      √ should handle OPTIONS preflight request (3 ms)
      √ should add CORS headers to responses (3 ms)
    Response Headers
      √ should include standard headers (8 ms)
    Metrics Integration
      × should record request metrics (4 ms)
      √ should record rate limit hits (3 ms)
    Health and Metrics
      √ should provide health status (3 ms)
      √ should provide metrics (2 ms)

  ● ApiFramework › Request Processing › should process successful request

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_bodyUsed": false, "body": undefined, "cookies": {"delete": [Function mockConstructor], "get": [Function mockConstructor], "getAll": [Function mockConstructor], "has": [Function mockConstructor], "set": [Function mockConstructor]}, "headers": {}, "method": "GET", "nextUrl": "https://example.com/api/v1/test", "url": "https://example.com/api/v1/test", Symbol(internal request): {"cookies": {"_headers": {}, "_parsed": Map {}}, "geo": {}, "ip": undefined, "nextUrl": "https://example.com/api/v1/test", "url": "https://example.com/api/v1/test"}},
    - ObjectContaining {"metadata": ObjectContaining {"ip": "127.0.0.1", "method": "GET", "userAgent": "test-agent"}, "permissions": Any<Array>, "requestId": Any<String>},
    + {"clientId": "oauth-client", "metadata": {"ip": undefined, "method": "GET", "pathname": "/api/v1/test", "userAgent": "test-agent"}, "permissions": ["read:businesses", "write:businesses", "read:exports", "write:exports"], "rateLimit": {"remaining": 99, "resetTime": 60}, "requestId": "req_1758757230614_r2vym0ikp", "startTime": 1758757230614, "userId": "oauth-user"},

    Number of calls: 1

    [0m [90m 89 |[39m
     [90m 90 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 91 |[39m       expect(mockHandler)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 92 |[39m         mockRequest[33m,[39m
     [90m 93 |[39m         expect[33m.[39mobjectContaining({
     [90m 94 |[39m           requestId[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.toHaveBeenCalledWith (src/__tests__/lib/integrations/api-framework.test.ts:91:27)

  ● ApiFramework › Metrics Integration › should record request metrics

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Any<String>, Any<String>, "GET", 200, Any<Number>, Any<Number>, ObjectContaining {"ip": "127.0.0.1", "userAgent": "test-agent"}
    Received: "oauth-client", "/api/v1/test", "GET", 200, 1, 128, {"ip": undefined, "userAgent": "test-agent"}

    Number of calls: 1

    [0m [90m 346 |[39m       [36mawait[39m handler(mockRequest)
     [90m 347 |[39m
    [31m[1m>[22m[39m[90m 348 |[39m       expect(apiMetricsService[33m.[39mrecordRequest)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 349 |[39m         expect[33m.[39many([33mString[39m)[33m,[39m [90m// clientId[39m
     [90m 350 |[39m         expect[33m.[39many([33mString[39m)[33m,[39m [90m// endpoint[39m
     [90m 351 |[39m         [32m'GET'[39m[33m,[39m [90m// method[39m[0m

      at Object.toHaveBeenCalledWith (src/__tests__/lib/integrations/api-framework.test.ts:348:47)

FAIL src/tests/integration/api.test.ts
  API Integration Tests
    Enhanced Scraping API (/api/enhanced-scrape)
      POST requests
        × should initialize scraping engine (2 ms)
        × should add a scraping job (3 ms)
        × should validate URL parameter (1 ms)
        × should validate URL format (1 ms)
        × should add multiple jobs (1 ms)
        × should limit batch job size (1 ms)
        × should get job status (2 ms)
        × should cancel a job (2 ms)
        × should handle invalid actions (2 ms)
      GET requests
        × should get scraping statistics (2 ms)
    Data Management API (/api/data-management)
      POST requests
        × should validate business data (2 ms)
        × should validate batch of businesses (5 ms)
        × should limit batch validation size (2 ms)
        × should find duplicates (1 ms)
        × should compare two records (2 ms)
        × should get retention policies (2 ms)
        × should export data with enhanced options (3 ms)
      GET requests
        × should get overview statistics (2 ms)
        × should get validation statistics (8 ms)
        × should handle invalid stats type (2 ms)
    Error Handling
      × should handle malformed JSON (1 ms)
      × should handle missing request body (2 ms)
      × should handle database connection errors (2 ms)
    Security Tests
      × should sanitize input data (2 ms)
      × should validate content type (3 ms)
      × should handle large payloads (54 ms)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should initialize scraping engine

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 51 |[39m         })
     [90m 52 |[39m
    [31m[1m>[22m[39m[90m 53 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 54 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 55 |[39m
     [90m 56 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:53:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should add a scraping job

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 71 |[39m         })
     [90m 72 |[39m
    [31m[1m>[22m[39m[90m 73 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 74 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 75 |[39m
     [90m 76 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:73:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should validate URL parameter

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 92 |[39m         })
     [90m 93 |[39m
    [31m[1m>[22m[39m[90m 94 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 95 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 96 |[39m
     [90m 97 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:94:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should validate URL format

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 109 |[39m         })
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 112 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 113 |[39m
     [90m 114 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:111:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should add multiple jobs

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 128 |[39m         })
     [90m 129 |[39m
    [31m[1m>[22m[39m[90m 130 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 131 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 132 |[39m
     [90m 133 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:130:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should limit batch job size

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 148 |[39m         })
     [90m 149 |[39m
    [31m[1m>[22m[39m[90m 150 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 151 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 152 |[39m
     [90m 153 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:150:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should get job status

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 165 |[39m         })
     [90m 166 |[39m
    [31m[1m>[22m[39m[90m 167 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 168 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 169 |[39m
     [90m 170 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:167:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should cancel a job

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 183 |[39m         })
     [90m 184 |[39m
    [31m[1m>[22m[39m[90m 185 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 186 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 187 |[39m
     [90m 188 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:185:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › POST requests › should handle invalid actions

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 199 |[39m         })
     [90m 200 |[39m
    [31m[1m>[22m[39m[90m 201 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 202 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 203 |[39m
     [90m 204 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:201:26)

  ● API Integration Tests › Enhanced Scraping API (/api/enhanced-scrape) › GET requests › should get scraping statistics

    ReferenceError: enhancedScrapeGet is not defined

    [0m [90m 211 |[39m         [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/enhanced-scrape'[39m)
     [90m 212 |[39m
    [31m[1m>[22m[39m[90m 213 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapeGet(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 214 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 215 |[39m
     [90m 216 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:213:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should validate business data

    ReferenceError: dataManagementPost is not defined

    [0m [90m 251 |[39m         })
     [90m 252 |[39m
    [31m[1m>[22m[39m[90m 253 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 254 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 255 |[39m
     [90m 256 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:253:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should validate batch of businesses

    ReferenceError: dataManagementPost is not defined

    [0m [90m 288 |[39m         })
     [90m 289 |[39m
    [31m[1m>[22m[39m[90m 290 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 291 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 292 |[39m
     [90m 293 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:290:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should limit batch validation size

    ReferenceError: dataManagementPost is not defined

    [0m [90m 313 |[39m         })
     [90m 314 |[39m
    [31m[1m>[22m[39m[90m 315 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 316 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 317 |[39m
     [90m 318 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:315:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should find duplicates

    ReferenceError: dataManagementPost is not defined

    [0m [90m 347 |[39m         })
     [90m 348 |[39m
    [31m[1m>[22m[39m[90m 349 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 350 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 351 |[39m
     [90m 352 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:349:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should compare two records

    ReferenceError: dataManagementPost is not defined

    [0m [90m 379 |[39m         })
     [90m 380 |[39m
    [31m[1m>[22m[39m[90m 381 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 382 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 383 |[39m
     [90m 384 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:381:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should get retention policies

    ReferenceError: dataManagementPost is not defined

    [0m [90m 398 |[39m         })
     [90m 399 |[39m
    [31m[1m>[22m[39m[90m 400 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 401 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 402 |[39m
     [90m 403 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:400:26)

  ● API Integration Tests › Data Management API (/api/data-management) › POST requests › should export data with enhanced options

    ReferenceError: dataManagementPost is not defined

    [0m [90m 430 |[39m         })
     [90m 431 |[39m
    [31m[1m>[22m[39m[90m 432 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 433 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 434 |[39m
     [90m 435 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:432:26)

  ● API Integration Tests › Data Management API (/api/data-management) › GET requests › should get overview statistics

    ReferenceError: dataManagementGet is not defined

    [0m [90m 445 |[39m         [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/data-management?type=overview'[39m)
     [90m 446 |[39m
    [31m[1m>[22m[39m[90m 447 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementGet(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 448 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 449 |[39m
     [90m 450 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:447:26)

  ● API Integration Tests › Data Management API (/api/data-management) › GET requests › should get validation statistics

    ReferenceError: dataManagementGet is not defined

    [0m [90m 458 |[39m         )
     [90m 459 |[39m
    [31m[1m>[22m[39m[90m 460 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementGet(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 461 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 462 |[39m
     [90m 463 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:460:26)

  ● API Integration Tests › Data Management API (/api/data-management) › GET requests › should handle invalid stats type

    ReferenceError: dataManagementGet is not defined

    [0m [90m 469 |[39m         [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/data-management?type=invalid'[39m)
     [90m 470 |[39m
    [31m[1m>[22m[39m[90m 471 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m dataManagementGet(request)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 472 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 473 |[39m
     [90m 474 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:471:26)

  ● API Integration Tests › Error Handling › should handle malformed JSON

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 486 |[39m       })
     [90m 487 |[39m
    [31m[1m>[22m[39m[90m 488 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 489 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 490 |[39m
     [90m 491 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:488:24)

  ● API Integration Tests › Error Handling › should handle missing request body

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 499 |[39m       })
     [90m 500 |[39m
    [31m[1m>[22m[39m[90m 501 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 502 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 503 |[39m
     [90m 504 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:501:24)

  ● API Integration Tests › Error Handling › should handle database connection errors

    ReferenceError: dataManagementPost is not defined

    [0m [90m 519 |[39m       })
     [90m 520 |[39m
    [31m[1m>[22m[39m[90m 521 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m dataManagementPost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 522 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 523 |[39m
     [90m 524 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:521:24)

  ● API Integration Tests › Security Tests › should sanitize input data

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 542 |[39m       })
     [90m 543 |[39m
    [31m[1m>[22m[39m[90m 544 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 545 |[39m
     [90m 546 |[39m       [90m// Should either sanitize or reject the input[39m
     [90m 547 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:544:24)

  ● API Integration Tests › Security Tests › should validate content type

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 555 |[39m       })
     [90m 556 |[39m
    [31m[1m>[22m[39m[90m 557 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 558 |[39m
     [90m 559 |[39m       [90m// Should handle non-JSON content type appropriately[39m
     [90m 560 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:557:24)

  ● API Integration Tests › Security Tests › should handle large payloads

    ReferenceError: enhancedScrapePost is not defined

    [0m [90m 574 |[39m       })
     [90m 575 |[39m
    [31m[1m>[22m[39m[90m 576 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m enhancedScrapePost(request)
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 577 |[39m
     [90m 578 |[39m       [90m// Should handle large payloads gracefully[39m
     [90m 579 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m500[39m)[0m

      at Object.<anonymous> (src/tests/integration/api.test.ts:576:24)

FAIL src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts
  Database Operations Comprehensive Integration Tests
    Business Records CRUD Operations
      × should create business record successfully (156 ms)
      × should handle duplicate business creation (5 ms)
      × should read business record by ID (2 ms)
      × should handle non-existent business ID (3 ms)
      × should update business record (3 ms)
      × should delete business record (4 ms)
      × should handle delete of non-existent business (4 ms)
    Search and Query Operations
      × should search businesses by industry (3 ms)
      × should search businesses by ZIP code (4 ms)
      × should handle complex search queries (2 ms)
      × should handle search with no results (10 ms)
      × should handle search with SQL injection attempts (3 ms)
    Batch Operations
      × should create multiple businesses in batch (2 ms)
      × should handle batch operation with partial failures (2 ms)
      × should handle empty batch operation (1 ms)
    Database Connection Management
      × should handle database connection errors (1 ms)
      × should handle database timeout errors (2 ms)
      × should handle transaction rollback (2 ms)
    Data Validation and Constraints
      × should handle invalid data types (2 ms)
      × should handle constraint violations (2 ms)
      × should handle foreign key violations (1 ms)
    Performance and Optimization
      × should handle large result sets efficiently (3 ms)
      × should handle concurrent database operations (2 ms)
      × should handle database connection pool exhaustion (1 ms)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should create business record successfully

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 69 |[39m
     [90m 70 |[39m       [90m// Import the database service[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(businessData)
     [90m 74 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:71:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:71:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should handle duplicate business creation

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 108 |[39m       })
     [90m 109 |[39m
    [31m[1m>[22m[39m[90m 110 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 111 |[39m
     [90m 112 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(businessData)
     [90m 113 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:110:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:110:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should read business record by ID

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 131 |[39m       })
     [90m 132 |[39m
    [31m[1m>[22m[39m[90m 133 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 134 |[39m
     [90m 135 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mgetBusinessById([32m'1'[39m)
     [90m 136 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:133:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:133:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should handle non-existent business ID

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 148 |[39m       })
     [90m 149 |[39m
    [31m[1m>[22m[39m[90m 150 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 151 |[39m
     [90m 152 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mgetBusinessById([32m'non-existent'[39m)
     [90m 153 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:150:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:150:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should update business record

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 167 |[39m       })
     [90m 168 |[39m
    [31m[1m>[22m[39m[90m 169 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 170 |[39m
     [90m 171 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mupdateBusiness([32m'1'[39m[33m,[39m updateData)
     [90m 172 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:169:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:169:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should delete business record

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 184 |[39m       })
     [90m 185 |[39m
    [31m[1m>[22m[39m[90m 186 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mdeleteBusiness([32m'1'[39m)
     [90m 189 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:186:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:186:36)

  ● Database Operations Comprehensive Integration Tests › Business Records CRUD Operations › should handle delete of non-existent business

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 201 |[39m       })
     [90m 202 |[39m
    [31m[1m>[22m[39m[90m 203 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 204 |[39m
     [90m 205 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mdeleteBusiness([32m'non-existent'[39m)
     [90m 206 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:203:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:203:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should search businesses by industry

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 233 |[39m       })
     [90m 234 |[39m
    [31m[1m>[22m[39m[90m 235 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 236 |[39m
     [90m 237 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry(
     [90m 238 |[39m         [32m'restaurants'[39m[33m,[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:235:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:235:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should search businesses by ZIP code

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 262 |[39m       })
     [90m 263 |[39m
    [31m[1m>[22m[39m[90m 264 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 265 |[39m
     [90m 266 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByZipCode([32m'12345'[39m)
     [90m 267 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:264:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:264:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should handle complex search queries

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 286 |[39m       })
     [90m 287 |[39m
    [31m[1m>[22m[39m[90m 288 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 289 |[39m
     [90m 290 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinesses(searchParams)
     [90m 291 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:288:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:288:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should handle search with no results

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 309 |[39m       })
     [90m 310 |[39m
    [31m[1m>[22m[39m[90m 311 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 312 |[39m
     [90m 313 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry(
     [90m 314 |[39m         [32m'nonexistent'[39m[33m,[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:311:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:311:36)

  ● Database Operations Comprehensive Integration Tests › Search and Query Operations › should handle search with SQL injection attempts

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 328 |[39m       })
     [90m 329 |[39m
    [31m[1m>[22m[39m[90m 330 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 331 |[39m
     [90m 332 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry(maliciousInput[33m,[39m [32m'City'[39m[33m,[39m [32m'ST'[39m)
     [90m 333 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:330:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:330:36)

  ● Database Operations Comprehensive Integration Tests › Batch Operations › should create multiple businesses in batch

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 388 |[39m       })
     [90m 389 |[39m
    [31m[1m>[22m[39m[90m 390 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 391 |[39m
     [90m 392 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusinessesBatch(businessesData)
     [90m 393 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:390:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:390:36)

  ● Database Operations Comprehensive Integration Tests › Batch Operations › should handle batch operation with partial failures

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 440 |[39m       })
     [90m 441 |[39m
    [31m[1m>[22m[39m[90m 442 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 443 |[39m
     [90m 444 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusinessesBatch(businessesData)
     [90m 445 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:442:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:442:36)

  ● Database Operations Comprehensive Integration Tests › Batch Operations › should handle empty batch operation

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 448 |[39m
     [90m 449 |[39m     test([32m'should handle empty batch operation'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 450 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 451 |[39m
     [90m 452 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusinessesBatch([])
     [90m 453 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:450:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:450:36)

  ● Database Operations Comprehensive Integration Tests › Database Connection Management › should handle database connection errors

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 461 |[39m       mockQuery[33m.[39mmockRejectedValueOnce([36mnew[39m [33mError[39m([32m'Connection failed'[39m))
     [90m 462 |[39m
    [31m[1m>[22m[39m[90m 463 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 464 |[39m
     [90m 465 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mgetBusinessById([32m'1'[39m)
     [90m 466 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:463:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:463:36)

  ● Database Operations Comprehensive Integration Tests › Database Connection Management › should handle database timeout errors

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 471 |[39m       mockQuery[33m.[39mmockRejectedValueOnce([36mnew[39m [33mError[39m([32m'Query timeout'[39m))
     [90m 472 |[39m
    [31m[1m>[22m[39m[90m 473 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 474 |[39m
     [90m 475 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry([32m'restaurants'[39m[33m,[39m [32m'City'[39m[33m,[39m [32m'ST'[39m)
     [90m 476 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:473:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:473:36)

  ● Database Operations Comprehensive Integration Tests › Database Connection Management › should handle transaction rollback

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 499 |[39m       ]
     [90m 500 |[39m
    [31m[1m>[22m[39m[90m 501 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 502 |[39m
     [90m 503 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusinessesBatch(businessesData)
     [90m 504 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:501:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:501:36)

  ● Database Operations Comprehensive Integration Tests › Data Validation and Constraints › should handle invalid data types

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 518 |[39m       mockQuery[33m.[39mmockRejectedValueOnce([36mnew[39m [33mError[39m([32m'Invalid data type'[39m))
     [90m 519 |[39m
    [31m[1m>[22m[39m[90m 520 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 521 |[39m
     [90m 522 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(invalidData [36mas[39m any)
     [90m 523 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:520:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:520:36)

  ● Database Operations Comprehensive Integration Tests › Data Validation and Constraints › should handle constraint violations

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 547 |[39m       })
     [90m 548 |[39m
    [31m[1m>[22m[39m[90m 549 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 550 |[39m
     [90m 551 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(businessData)
     [90m 552 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:549:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:549:36)

  ● Database Operations Comprehensive Integration Tests › Data Validation and Constraints › should handle foreign key violations

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 577 |[39m       })
     [90m 578 |[39m
    [31m[1m>[22m[39m[90m 579 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 580 |[39m
     [90m 581 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mcreateBusiness(businessData)
     [90m 582 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:579:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:579:36)

  ● Database Operations Comprehensive Integration Tests › Performance and Optimization › should handle large result sets efficiently

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 598 |[39m       })
     [90m 599 |[39m
    [31m[1m>[22m[39m[90m 600 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 601 |[39m
     [90m 602 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39msearchBusinessesByIndustry([32m'restaurants'[39m[33m,[39m [32m'City'[39m[33m,[39m [32m'ST'[39m)
     [90m 603 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:600:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:600:36)

  ● Database Operations Comprehensive Integration Tests › Performance and Optimization › should handle concurrent database operations

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 611 |[39m       })
     [90m 612 |[39m
    [31m[1m>[22m[39m[90m 613 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 614 |[39m
     [90m 615 |[39m       [90m// Simulate concurrent operations[39m
     [90m 616 |[39m       [36mconst[39m promises [33m=[39m [33mArray[39m[33m.[39m[36mfrom[39m({ length[33m:[39m [35m10[39m }[33m,[39m (_[33m,[39m i) [33m=>[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:613:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:613:36)

  ● Database Operations Comprehensive Integration Tests › Performance and Optimization › should handle database connection pool exhaustion

    Cannot find module '../../../model/businessDatabase' from 'src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts'

    [0m [90m 627 |[39m       mockQuery[33m.[39mmockRejectedValueOnce([36mnew[39m [33mError[39m([32m'Connection pool exhausted'[39m))
     [90m 628 |[39m
    [31m[1m>[22m[39m[90m 629 |[39m       [36mconst[39m { businessDatabase } [33m=[39m [36mawait[39m [36mimport[39m([32m'@/model/businessDatabase'[39m)
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 630 |[39m
     [90m 631 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m businessDatabase[33m.[39mgetBusinessById([32m'1'[39m)
     [90m 632 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:629:42
      at Object.<anonymous> (src/tests/integration/comprehensive/databaseOperations.comprehensive.test.ts:629:36)

FAIL src/tests/integration/enhancedDataValidation.test.ts (112.387 s)
  Enhanced Data Validation Pipeline - Integration Tests
    Complete Business Record Validation and Enrichment
      × should validate and enrich a complete business record (11368 ms)
      √ should handle partial business records gracefully (10976 ms)
      √ should handle invalid data appropriately (10952 ms)
    Email Validation Integration
      √ should perform comprehensive email validation (11238 ms)
    Phone Validation Integration
      √ should perform comprehensive phone validation (11046 ms)
    Business Intelligence Integration
      × should perform comprehensive business intelligence enrichment (11213 ms)
    Data Quality Scoring
      × should calculate accurate data quality scores (11595 ms)
    Performance and Caching
      √ should cache validation results for performance (22560 ms)
    Error Recovery
      √ should continue enrichment even when some services fail (11195 ms)

  ● Enhanced Data Validation Pipeline - Integration Tests › Complete Business Record Validation and Enrichment › should validate and enrich a complete business record

    expect(received).toBeGreaterThan(expected)

    Matcher error: received value must be a number or bigint

    Received has value: undefined

    [0m [90m 121 |[39m       expect(
     [90m 122 |[39m         businessRecord[33m.[39mbusinessIntelligence[33m?[39m[33m.[39mtechnologyStack[33m?[39m[33m.[39mplatforms[33m?[39m[33m.[39mlength
    [31m[1m>[22m[39m[90m 123 |[39m       )[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 124 |[39m
     [90m 125 |[39m       [90m// Check geocoding[39m
     [90m 126 |[39m       expect(businessRecord[33m.[39mcoordinates)[33m.[39mtoBeDefined()[0m

      at Object.toBeGreaterThan (src/tests/integration/enhancedDataValidation.test.ts:123:9)

  ● Enhanced Data Validation Pipeline - Integration Tests › Business Intelligence Integration › should perform comprehensive business intelligence enrichment

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 361 |[39m       [90m// Technology[39m
     [90m 362 |[39m       [36mconst[39m techPlatforms [33m=[39m businessRecord[33m.[39mbusinessIntelligence[33m?[39m[33m.[39mtechnologyStack[33m?[39m[33m.[39mplatforms
    [31m[1m>[22m[39m[90m 363 |[39m       expect(techPlatforms[33m?[39m[33m.[39msome(p [33m=>[39m p[33m.[39mname [33m===[39m [32m'WordPress'[39m))[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                                                                [31m[1m^[22m[39m
     [90m 364 |[39m       expect(techPlatforms[33m?[39m[33m.[39msome(p [33m=>[39m p[33m.[39mname [33m===[39m [32m'Google Analytics'[39m))[33m.[39mtoBe([36mtrue[39m)
     [90m 365 |[39m
     [90m 366 |[39m       [90m// Social media[39m[0m

      at Object.toBe (src/tests/integration/enhancedDataValidation.test.ts:363:64)

  ● Enhanced Data Validation Pipeline - Integration Tests › Data Quality Scoring › should calculate accurate data quality scores

    expect(received).toBeGreaterThan(expected)

    Expected: > 70
    Received:   NaN

    [0m [90m 396 |[39m       highQualityRecord[33m.[39mdataQualityScore [33m=[39m qualityScore[33m.[39moverall [33m*[39m [35m100[39m
     [90m 397 |[39m
    [31m[1m>[22m[39m[90m 398 |[39m       expect(highQualityRecord[33m.[39mdataQualityScore)[33m.[39mtoBeGreaterThan([35m70[39m)
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 399 |[39m
     [90m 400 |[39m       [36mconst[39m lowQualityRecord[33m:[39m [33mBusinessRecord[39m [33m=[39m {
     [90m 401 |[39m         id[33m:[39m [32m'low-quality'[39m[33m,[39m[0m

      at Object.toBeGreaterThan (src/tests/integration/enhancedDataValidation.test.ts:398:50)

FAIL src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts
  API Endpoints Comprehensive Integration Tests
    /api/search endpoint
      × should handle valid search request (7 ms)
      √ should handle missing required fields (8 ms)
      √ should handle invalid JSON body (1 ms)
      √ should handle empty request body (1 ms)
      × should handle invalid ZIP code format (2 ms)
      √ should handle negative maxResults (3 ms)
      √ should handle extremely large maxResults (1 ms)
      √ should handle special characters in query (1 ms)
      √ should handle very long query strings (3 ms)
    /api/scrape endpoint
      × should handle valid scrape request (43 ms)
      × should handle invalid URL (26 ms)
      × should handle malicious URLs (12 ms)
      √ should handle cleanup action (5 ms)
      √ should handle unknown action (3 ms)
    /api/config endpoint
      × should return configuration (4 ms)
      √ should handle configuration errors (2 ms)
    /api/health endpoint
      × should return health status
      × should include service health checks (1 ms)
    Error Handling Across Endpoints
      √ should handle CORS preflight requests (8 ms)
      √ should handle unsupported HTTP methods (3 ms)
      √ should handle request timeout scenarios (12 ms)
      √ should handle memory pressure during large requests (5 ms)

  ● API Endpoints Comprehensive Integration Tests › /api/search endpoint › should handle valid search request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 50 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 53 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'results'[39m)
     [90m 54 |[39m       expect([33mArray[39m[33m.[39misArray(data[33m.[39mresults))[33m.[39mtoBe([36mtrue[39m)
     [90m 55 |[39m     })[0m

      at Object.toBe (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:52:31)

  ● API Endpoints Comprehensive Integration Tests › /api/search endpoint › should handle invalid ZIP code format

    expect(received).toContain(expected) // indexOf

    Expected substring: "ZIP code"
    Received string:    "Query and location are required"

    [0m [90m 128 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m 129 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'error'[39m)
    [31m[1m>[22m[39m[90m 130 |[39m       expect(data[33m.[39merror)[33m.[39mtoContain([32m'ZIP code'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 131 |[39m     })
     [90m 132 |[39m
     [90m 133 |[39m     test([32m'should handle negative maxResults'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:130:26)

  ● API Endpoints Comprehensive Integration Tests › /api/scrape endpoint › should handle valid scrape request

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 243 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 244 |[39m
    [31m[1m>[22m[39m[90m 245 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 246 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'businesses'[39m)
     [90m 247 |[39m       expect([33mArray[39m[33m.[39misArray(data[33m.[39mbusinesses))[33m.[39mtoBe([36mtrue[39m)
     [90m 248 |[39m     })[0m

      at Object.toBe (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:245:31)

  ● API Endpoints Comprehensive Integration Tests › /api/scrape endpoint › should handle invalid URL

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 267 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 268 |[39m
    [31m[1m>[22m[39m[90m 269 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 270 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'error'[39m)
     [90m 271 |[39m     })
     [90m 272 |[39m[0m

      at Object.toBe (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:269:31)

  ● API Endpoints Comprehensive Integration Tests › /api/scrape endpoint › should handle malicious URLs

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 297 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m scrapeHandler(request)
     [90m 298 |[39m
    [31m[1m>[22m[39m[90m 299 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 300 |[39m       }
     [90m 301 |[39m     })
     [90m 302 |[39m[0m

      at Object.toBe (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:299:33)

  ● API Endpoints Comprehensive Integration Tests › /api/config endpoint › should return configuration

    expect(received).toHaveProperty(path)

    Expected path: "config"
    Received path: []

    Received value: {"app": {"debug": false, "environment": "test", "name": "Business Scraper App", "version": "1.3.0"}, "cache": {"type": "redis"}, "features": {"enableAuth": true, "enableCaching": true, "enableDebugMode": false, "enableExperimentalFeatures": false, "enableMetrics": true, "enableRateLimiting": true}, "logging": {"format": "json", "level": "info"}, "scraping": {"maxRetries": 3, "maxSearchResults": 50, "timeout": 30000}}

    [0m [90m 361 |[39m
     [90m 362 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 363 |[39m       expect(data)[33m.[39mtoHaveProperty([32m'config'[39m)
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 364 |[39m     })
     [90m 365 |[39m
     [90m 366 |[39m     test([32m'should handle configuration errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toHaveProperty (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:363:20)

  ● API Endpoints Comprehensive Integration Tests › /api/health endpoint › should return health status

    Configuration error

    [0m [90m 367 |[39m       [90m// Mock configuration error[39m
     [90m 368 |[39m       jest[33m.[39mdoMock([32m'@/lib/config'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 369 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Configuration error'[39m)
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 370 |[39m       })
     [90m 371 |[39m
     [90m 372 |[39m       [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/config'[39m[33m,[39m {[0m

      at src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:369:15
      at Object.<anonymous> (src/lib/database.ts:38:17)
      at Object.<anonymous> (src/app/api/health/route.ts:14:19)
      at src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:386:34
      at Object.<anonymous> (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:386:28)

  ● API Endpoints Comprehensive Integration Tests › /api/health endpoint › should include service health checks

    Configuration error

    [0m [90m 367 |[39m       [90m// Mock configuration error[39m
     [90m 368 |[39m       jest[33m.[39mdoMock([32m'@/lib/config'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 369 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Configuration error'[39m)
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 370 |[39m       })
     [90m 371 |[39m
     [90m 372 |[39m       [36mconst[39m request [33m=[39m [36mnew[39m [33mNextRequest[39m([32m'http://localhost:3000/api/config'[39m[33m,[39m {[0m

      at src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:369:15
      at Object.<anonymous> (src/lib/database.ts:38:17)
      at Object.<anonymous> (src/app/api/health/route.ts:14:19)
      at src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:386:34
      at Object.<anonymous> (src/tests/integration/comprehensive/apiEndpoints.comprehensive.test.ts:386:28)

FAIL src/controller/__tests__/paymentIntegration.test.ts
  Payment System Integration
    User Subscription Workflow
      × should handle complete subscription creation workflow (4 ms)
      × should handle subscription cancellation workflow (3 ms)
    Feature Usage and Limits Integration
      × should track usage and enforce limits correctly (8 ms)
      × should handle enterprise unlimited access correctly (4 ms)
    Event-Driven Integration
      × should handle subscription events and cache invalidation (4 ms)
      × should handle cache invalidation on subscription changes (5 ms)
    Error Handling Integration
      × should handle payment controller errors gracefully in feature access (6 ms)
      × should handle feature access errors in payment workflows (2 ms)
    Usage Summary Integration
      × should provide comprehensive usage summary across all features (6 ms)
    Plan Upgrade/Downgrade Scenarios
      × should handle plan upgrade scenario correctly (6 ms)

  ● Payment System Integration › User Subscription Workflow › should handle complete subscription creation workflow

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 45 |[39m       [90m// Check initial free tier access[39m
     [90m 46 |[39m       [36mlet[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'scraping_request'[39m)
    [31m[1m>[22m[39m[90m 47 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mtrue[39m)
     [90m    |[39m                                      [31m[1m^[22m[39m
     [90m 48 |[39m       expect(accessResult[33m.[39musageLimit)[33m.[39mtoBe([35m10[39m) [90m// free tier limit[39m
     [90m 49 |[39m
     [90m 50 |[39m       [90m// Advanced search should be denied on free tier[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:47:38)

  ● Payment System Integration › User Subscription Workflow › should handle subscription cancellation workflow

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 104 |[39m       [90m// Verify pro access[39m
     [90m 105 |[39m       [36mlet[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'api_access'[39m)
    [31m[1m>[22m[39m[90m 106 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 107 |[39m       expect(accessResult[33m.[39musageLimit)[33m.[39mtoBe([35m50[39m) [90m// pro tier API access[39m
     [90m 108 |[39m
     [90m 109 |[39m       [90m// Cancel subscription[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:106:38)

  ● Payment System Integration › Feature Usage and Limits Integration › should track usage and enforce limits correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "usage_limit_exceeded"
    Received: "subscription_required"

    [0m [90m 146 |[39m       [36mconst[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'scraping_request'[39m)
     [90m 147 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 148 |[39m       expect(accessResult[33m.[39mreason)[33m.[39mtoBe([32m'usage_limit_exceeded'[39m)
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 149 |[39m       expect(accessResult[33m.[39mcurrentUsage)[33m.[39mtoBe([35m100[39m)
     [90m 150 |[39m       expect(accessResult[33m.[39musageLimit)[33m.[39mtoBe([35m100[39m)
     [90m 151 |[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:148:35)

  ● Payment System Integration › Feature Usage and Limits Integration › should handle enterprise unlimited access correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 176 |[39m       [90m// Should still have access due to unlimited plan[39m
     [90m 177 |[39m       [36mconst[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'scraping_request'[39m)
    [31m[1m>[22m[39m[90m 178 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 179 |[39m       expect(accessResult[33m.[39mcurrentUsage)[33m.[39mtoBeUndefined()
     [90m 180 |[39m       expect(accessResult[33m.[39musageLimit)[33m.[39mtoBeUndefined()
     [90m 181 |[39m     })[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:178:38)

  ● Payment System Integration › Event-Driven Integration › should handle subscription events and cache invalidation

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"featureType": "api_access", "reason": "plan_restriction"}

    Number of calls: 0

    [0m [90m 208 |[39m       [90m// Try to access restricted feature (should trigger access:denied)[39m
     [90m 209 |[39m       [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'api_access'[39m) [90m// not available on free tier[39m
    [31m[1m>[22m[39m[90m 210 |[39m       expect(accessDeniedSpy)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 211 |[39m         featureType[33m:[39m [32m'api_access'[39m[33m,[39m
     [90m 212 |[39m         reason[33m:[39m [32m'plan_restriction'[39m[33m,[39m
     [90m 213 |[39m       })[0m

      at Object.toHaveBeenCalledWith (src/controller/__tests__/paymentIntegration.test.ts:210:31)

  ● Payment System Integration › Event-Driven Integration › should handle cache invalidation on subscription changes

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 223 |[39m       [90m// Verify cache is populated[39m
     [90m 224 |[39m       [36mconst[39m cacheSize [33m=[39m (featureAccessController [36mas[39m any)[33m.[39musageCache[33m.[39msize
    [31m[1m>[22m[39m[90m 225 |[39m       expect(cacheSize)[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 226 |[39m
     [90m 227 |[39m       [90m// Simulate subscription change[39m
     [90m 228 |[39m       [36mconst[39m newSubscription [33m=[39m {[0m

      at Object.toBeGreaterThan (src/controller/__tests__/paymentIntegration.test.ts:225:25)

  ● Payment System Integration › Error Handling Integration › should handle payment controller errors gracefully in feature access

    expect(received).toBe(expected) // Object.is equality

    Expected: "feature_disabled"
    Received: "subscription_required"

    [0m [90m 260 |[39m       [36mconst[39m accessResult [33m=[39m [36mawait[39m featureAccessController[33m.[39mcanAccessFeature([32m'scraping_request'[39m)
     [90m 261 |[39m       expect(accessResult[33m.[39mhasAccess)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 262 |[39m       expect(accessResult[33m.[39mreason)[33m.[39mtoBe([32m'feature_disabled'[39m)
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 263 |[39m     })
     [90m 264 |[39m
     [90m 265 |[39m     it([32m'should handle feature access errors in payment workflows'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:262:35)

  ● Payment System Integration › Error Handling Integration › should handle feature access errors in payment workflows

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 273 |[39m       [90m// Payment controller should handle the error gracefully[39m
     [90m 274 |[39m       [36mconst[39m hasAccess [33m=[39m [36mawait[39m paymentController[33m.[39mcheckFeatureAccess([32m'scraping_request'[39m)
    [31m[1m>[22m[39m[90m 275 |[39m       expect(hasAccess)[33m.[39mtoBe([36mfalse[39m)
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 276 |[39m     })
     [90m 277 |[39m   })
     [90m 278 |[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:275:25)

  ● Payment System Integration › Usage Summary Integration › should provide comprehensive usage summary across all features

    expect(received).toEqual(expected) // deep equality

    - Expected  - 18
    + Received  +  1

    - Object {
    -   "advanced_search": Object {
    -     "limit": 10,
    -     "used": 8,
    -   },
    -   "api_access": Object {
    -     "limit": 0,
    -     "used": 0,
    -   },
    -   "export": Object {
    -     "limit": 50,
    -     "used": 30,
    -   },
    -   "scraping_request": Object {
    -     "limit": 100,
    -     "used": 75,
    -   },
    - }
    + Object {}

    [0m [90m 310 |[39m       [36mconst[39m summary [33m=[39m [36mawait[39m featureAccessController[33m.[39mgetUsageSummary()
     [90m 311 |[39m
    [31m[1m>[22m[39m[90m 312 |[39m       expect(summary)[33m.[39mtoEqual({
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 313 |[39m         scraping_request[33m:[39m { used[33m:[39m [35m75[39m[33m,[39m limit[33m:[39m [35m100[39m }[33m,[39m
     [90m 314 |[39m         [36mexport[39m[33m:[39m { used[33m:[39m [35m30[39m[33m,[39m limit[33m:[39m [35m50[39m }[33m,[39m
     [90m 315 |[39m         advanced_search[33m:[39m { used[33m:[39m [35m8[39m[33m,[39m limit[33m:[39m [35m10[39m }[33m,[39m[0m

      at Object.toEqual (src/controller/__tests__/paymentIntegration.test.ts:312:23)

  ● Payment System Integration › Plan Upgrade/Downgrade Scenarios › should handle plan upgrade scenario correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 50
    Received: 0

    [0m [90m 360 |[39m       [90m// Verify pro plan limits[39m
     [90m 361 |[39m       limits [33m=[39m [36mawait[39m featureAccessController[33m.[39mgetFeatureLimits()
    [31m[1m>[22m[39m[90m 362 |[39m       expect(limits[33m.[39mapi_access)[33m.[39mtoBe([35m50[39m) [90m// API access available in pro[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 363 |[39m       expect(limits[33m.[39mscraping_request)[33m.[39mtoBe([35m1000[39m) [90m// Higher scraping limit[39m
     [90m 364 |[39m
     [90m 365 |[39m       [90m// Verify API access is now available[39m[0m

      at Object.toBe (src/controller/__tests__/paymentIntegration.test.ts:362:33)

FAIL src/__tests__/integration/api-endpoints.test.ts
  API Endpoints Integration
    Templates API
      × GET /api/v1/templates should return template list (5 ms)
      × GET /api/v1/templates with platform filter (4 ms)
      × GET /api/v1/templates with details (8 ms)
    Exports API
      × POST /api/v1/exports should create export successfully (4 ms)
      × POST /api/v1/exports should validate required fields (2 ms)
      × POST /api/v1/exports should validate business data (8 ms)
    Analytics API
      × GET /api/v1/analytics?type=realtime should return real-time metrics (4 ms)
      × GET /api/v1/analytics?type=client should return client analytics (3 ms)
      × GET /api/v1/analytics?type=system should return system analytics (2 ms)
      × GET /api/v1/analytics with date range should filter data (9 ms)
    Error Handling
      × should handle invalid JSON in request body (3 ms)
      × should handle missing required parameters (3 ms)
    Response Format
      √ should include standard response metadata (2 ms)
      × should include rate limit headers (2 ms)
      √ should include CORS headers (2 ms)

  ● API Endpoints Integration › Templates API › GET /api/v1/templates should return template list

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 192 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getTemplatesList(request)
     [90m 193 |[39m
    [31m[1m>[22m[39m[90m 194 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 195 |[39m
     [90m 196 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 197 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:194:31)

  ● API Endpoints Integration › Templates API › GET /api/v1/templates with platform filter

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 205 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getTemplatesList(request)
     [90m 206 |[39m
    [31m[1m>[22m[39m[90m 207 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 208 |[39m
     [90m 209 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 210 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:207:31)

  ● API Endpoints Integration › Templates API › GET /api/v1/templates with details

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 216 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getTemplatesList(request)
     [90m 217 |[39m
    [31m[1m>[22m[39m[90m 218 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 219 |[39m
     [90m 220 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 221 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:218:31)

  ● API Endpoints Integration › Exports API › POST /api/v1/exports should create export successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 260 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createExport(request)
     [90m 261 |[39m
    [31m[1m>[22m[39m[90m 262 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 263 |[39m
     [90m 264 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 265 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:262:31)

  ● API Endpoints Integration › Exports API › POST /api/v1/exports should validate required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

    [0m [90m 285 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createExport(request)
     [90m 286 |[39m
    [31m[1m>[22m[39m[90m 287 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m) [90m// Should be handled by error handling[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 288 |[39m
     [90m 289 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 290 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:287:31)

  ● API Endpoints Integration › Exports API › POST /api/v1/exports should validate business data

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

    [0m [90m 306 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createExport(request)
     [90m 307 |[39m
    [31m[1m>[22m[39m[90m 308 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 309 |[39m
     [90m 310 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 311 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:308:31)

  ● API Endpoints Integration › Analytics API › GET /api/v1/analytics?type=realtime should return real-time metrics

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 319 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 320 |[39m
    [31m[1m>[22m[39m[90m 321 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 322 |[39m
     [90m 323 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 324 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:321:31)

  ● API Endpoints Integration › Analytics API › GET /api/v1/analytics?type=client should return client analytics

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 335 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 336 |[39m
    [31m[1m>[22m[39m[90m 337 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 338 |[39m
     [90m 339 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 340 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:337:31)

  ● API Endpoints Integration › Analytics API › GET /api/v1/analytics?type=system should return system analytics

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 349 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 350 |[39m
    [31m[1m>[22m[39m[90m 351 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 352 |[39m
     [90m 353 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 354 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:351:31)

  ● API Endpoints Integration › Analytics API › GET /api/v1/analytics with date range should filter data

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 369 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 370 |[39m
    [31m[1m>[22m[39m[90m 371 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 372 |[39m
     [90m 373 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 374 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:371:31)

  ● API Endpoints Integration › Error Handling › should handle invalid JSON in request body

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

    [0m [90m 388 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m createExport(request)
     [90m 389 |[39m
    [31m[1m>[22m[39m[90m 390 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 391 |[39m
     [90m 392 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 393 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:390:31)

  ● API Endpoints Integration › Error Handling › should handle missing required parameters

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

    [0m [90m 401 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m getAnalytics(request)
     [90m 402 |[39m
    [31m[1m>[22m[39m[90m 403 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 404 |[39m
     [90m 405 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 406 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[0m

      at Object.toBe (src/__tests__/integration/api-endpoints.test.ts:403:31)

  ● API Endpoints Integration › Response Format › should include rate limit headers

    expect(received).toBeTruthy()

    Received: undefined

    [0m [90m 427 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-Request-ID'[39m))[33m.[39mtoBeTruthy()
     [90m 428 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-API-Version'[39m))[33m.[39mtoBe([32m'v1'[39m)
    [31m[1m>[22m[39m[90m 429 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-RateLimit-Remaining'[39m))[33m.[39mtoBeTruthy()
     [90m     |[39m                                                             [31m[1m^[22m[39m
     [90m 430 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'X-RateLimit-Reset'[39m))[33m.[39mtoBeTruthy()
     [90m 431 |[39m     })
     [90m 432 |[39m[0m

      at Object.toBeTruthy (src/__tests__/integration/api-endpoints.test.ts:429:61)

FAIL src/__tests__/integration/crmSync.test.ts
  CRM Sync Integration Tests
    Business Record Sync
      × should sync single business record to CRM (13 ms)
      × should sync multiple business records in batch (2 ms)
      × should handle sync failures gracefully (3 ms)
      × should sync to multiple CRM providers (3 ms)
      × should filter by specific provider IDs (6 ms)
    Sync Status and History
      √ should retrieve sync status and history (9 ms)
      √ should filter sync history by provider (2 ms)
    Error Handling
      × should return error for invalid request body (2 ms)
      × should return error when no active CRM services found (2 ms)
      × should handle malformed JSON gracefully (2 ms)
    Performance Tests
      × should handle large batch sync efficiently (3 ms)
      × should handle concurrent sync requests (6 ms)

  ● CRM Sync Integration Tests › Business Record Sync › should sync single business record to CRM

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 63 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 64 |[39m
    [31m[1m>[22m[39m[90m 65 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 66 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 67 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalSynced)[33m.[39mtoBe([35m1[39m)
     [90m 68 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalFailed)[33m.[39mtoBe([35m0[39m)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:65:31)

  ● CRM Sync Integration Tests › Business Record Sync › should sync multiple business records in batch

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 119 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 120 |[39m
    [31m[1m>[22m[39m[90m 121 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 122 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 123 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalSynced)[33m.[39mtoBe(mockBusinessData[33m.[39mlength)
     [90m 124 |[39m       expect(mockService[33m.[39msyncBusinessRecords)[33m.[39mtoHaveBeenCalledWith(mockBusinessData)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:121:31)

  ● CRM Sync Integration Tests › Business Record Sync › should handle sync failures gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 151 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 152 |[39m
    [31m[1m>[22m[39m[90m 153 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 154 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 155 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults[[35m0[39m][33m.[39mtype)[33m.[39mtoBe([32m'error'[39m)
     [90m 156 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults[[35m0[39m][33m.[39merror)[33m.[39mtoBe([32m'Sync failed'[39m)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:153:31)

  ● CRM Sync Integration Tests › Business Record Sync › should sync to multiple CRM providers

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 201 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 202 |[39m
    [31m[1m>[22m[39m[90m 203 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 204 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 205 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalProviders)[33m.[39mtoBe([35m2[39m)
     [90m 206 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults)[33m.[39mtoHaveLength([35m2[39m)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:203:31)

  ● CRM Sync Integration Tests › Business Record Sync › should filter by specific provider IDs

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 251 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 252 |[39m
    [31m[1m>[22m[39m[90m 253 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 254 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 255 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults)[33m.[39mtoHaveLength([35m1[39m)
     [90m 256 |[39m       expect(data[33m.[39mdata[33m.[39msyncResults[[35m0[39m][33m.[39mproviderId)[33m.[39mtoBe([32m'provider-1'[39m)[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:253:31)

  ● CRM Sync Integration Tests › Error Handling › should return error for invalid request body

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

    [0m [90m 310 |[39m
     [90m 311 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
    [31m[1m>[22m[39m[90m 312 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 313 |[39m       expect(data[33m.[39merror)[33m.[39mtoContain([32m'Records array is required'[39m)
     [90m 314 |[39m     })
     [90m 315 |[39m[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:312:28)

  ● CRM Sync Integration Tests › Error Handling › should return error when no active CRM services found

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

    [0m [90m 332 |[39m
     [90m 333 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
    [31m[1m>[22m[39m[90m 334 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 335 |[39m       expect(data[33m.[39merror)[33m.[39mtoContain([32m'No active CRM services found'[39m)
     [90m 336 |[39m     })
     [90m 337 |[39m[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:334:28)

  ● CRM Sync Integration Tests › Error Handling › should handle malformed JSON gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

    [0m [90m 348 |[39m       [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 349 |[39m
    [31m[1m>[22m[39m[90m 350 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m500[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 351 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)
     [90m 352 |[39m     })
     [90m 353 |[39m   })[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:350:31)

  ● CRM Sync Integration Tests › Performance Tests › should handle large batch sync efficiently

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 401 |[39m       [36mconst[39m endTime [33m=[39m [33mDate[39m[33m.[39mnow()
     [90m 402 |[39m
    [31m[1m>[22m[39m[90m 403 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 404 |[39m       expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 405 |[39m       expect(data[33m.[39mdata[33m.[39msummary[33m.[39mtotalSynced)[33m.[39mtoBe(largeBatch[33m.[39mlength)
     [90m 406 |[39m       expect(endTime [33m-[39m startTime)[33m.[39mtoBeLessThan([35m5000[39m) [90m// Should complete within 5 seconds[39m[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:403:31)

  ● CRM Sync Integration Tests › Performance Tests › should handle concurrent sync requests

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 440 |[39m       [90m// All requests should succeed[39m
     [90m 441 |[39m       [36mfor[39m ([36mconst[39m response [36mof[39m responses) {
    [31m[1m>[22m[39m[90m 442 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 443 |[39m         [36mconst[39m data [33m=[39m [36mawait[39m response[33m.[39mjson()
     [90m 444 |[39m         expect(data[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)
     [90m 445 |[39m       }[0m

      at Object.toBe (src/__tests__/integration/crmSync.test.ts:442:33)

FAIL src/__tests__/integration/payment-flow.test.tsx
  Payment Flow Integration
    successful payment flow
      √ should complete payment flow successfully (211 ms)
      √ should handle subscription creation flow (186 ms)
    payment error handling
      × should handle payment errors gracefully (2 ms)
      × should handle network errors (2 ms)
      √ should handle insufficient funds error (63 ms)
    payment form validation
      √ should validate required fields (47 ms)
      √ should handle invalid card number (65 ms)
    payment processing states
      √ should show loading state during payment processing (167 ms)
      √ should handle payment timeout (185 ms)
    subscription management integration
      √ should handle subscription upgrade flow (190 ms)
      √ should handle subscription cancellation (13 ms)

  ● Payment Flow Integration › payment error handling › should handle payment errors gracefully

    TypeError: jest.mocked(...).mockReturnValue is not a function

    [0m [90m 145 |[39m
     [90m 146 |[39m       [90m// Mock payment failure[39m
    [31m[1m>[22m[39m[90m 147 |[39m       jest[33m.[39mmocked(require([32m'@stripe/react-stripe-js'[39m)[33m.[39museStripe)[33m.[39mmockReturnValue({
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 148 |[39m         confirmPayment[33m:[39m jest[33m.[39mfn()[33m.[39mmockResolvedValue({
     [90m 149 |[39m           error[33m:[39m { message[33m:[39m [32m'Your card was declined.'[39m }[33m,[39m
     [90m 150 |[39m         })[33m,[39m[0m

      at Object.mockReturnValue (src/__tests__/integration/payment-flow.test.tsx:147:65)

  ● Payment Flow Integration › payment error handling › should handle network errors

    TypeError: jest.mocked(...).mockReturnValue is not a function

    [0m [90m 187 |[39m
     [90m 188 |[39m       [90m// Mock network error[39m
    [31m[1m>[22m[39m[90m 189 |[39m       jest[33m.[39mmocked(require([32m'@stripe/react-stripe-js'[39m)[33m.[39museStripe)[33m.[39mmockReturnValue({
     [90m     |[39m                                                                 [31m[1m^[22m[39m
     [90m 190 |[39m         confirmPayment[33m:[39m jest[33m.[39mfn()[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Network error'[39m))[33m,[39m
     [90m 191 |[39m       })
     [90m 192 |[39m[0m

      at Object.mockReturnValue (src/__tests__/integration/payment-flow.test.tsx:189:65)

FAIL src/__tests__/integration/ai-workflow.test.ts
  AI/ML Workflow Integration
    Complete AI Pipeline
      × should process businesses through the complete AI pipeline (17 ms)
      × should handle mixed quality data appropriately (2 ms)
      × should provide industry-specific scoring (2 ms)
      × should provide geographic scoring (3 ms)
    Batch Processing Performance
      × should handle large batches efficiently (2 ms)
      × should handle errors gracefully in batch processing (2 ms)
    Data Enhancement
      × should enhance business records with AI insights (4 ms)
      × should provide actionable recommendations (9 ms)
    Export Integration
      × should export enhanced data with AI insights (3 ms)
    Filtering and Sorting
      × should filter businesses by lead score (1 ms)
      × should sort businesses by lead score (1 ms)
      × should identify businesses needing attention (2 ms)

  ● AI/ML Workflow Integration › Complete AI Pipeline › should process businesses through the complete AI pipeline

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:120:48)

  ● AI/ML Workflow Integration › Complete AI Pipeline › should handle mixed quality data appropriately

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:164:48)

  ● AI/ML Workflow Integration › Complete AI Pipeline › should provide industry-specific scoring

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:177:48)

  ● AI/ML Workflow Integration › Complete AI Pipeline › should provide geographic scoring

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:193:48)

  ● AI/ML Workflow Integration › Batch Processing Performance › should handle large batches efficiently

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:220:48)

  ● AI/ML Workflow Integration › Batch Processing Performance › should handle errors gracefully in batch processing

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:238:48)

  ● AI/ML Workflow Integration › Data Enhancement › should enhance business records with AI insights

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:249:48)

  ● AI/ML Workflow Integration › Data Enhancement › should provide actionable recommendations

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:269:48)

  ● AI/ML Workflow Integration › Export Integration › should export enhanced data with AI insights

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:294:48)

  ● AI/ML Workflow Integration › Filtering and Sorting › should filter businesses by lead score

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:321:48)

  ● AI/ML Workflow Integration › Filtering and Sorting › should sort businesses by lead score

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:337:48)

  ● AI/ML Workflow Integration › Filtering and Sorting › should identify businesses needing attention

    TypeError: Cannot read properties of undefined (reading 'compile')

    [0m [90m 102 |[39m
     [90m 103 |[39m       [90m// Compile the model[39m
    [31m[1m>[22m[39m[90m 104 |[39m       [36mthis[39m[33m.[39mmodel[33m.[39mcompile({
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 105 |[39m         optimizer[33m:[39m train[33m.[39madam([35m0.001[39m)[33m,[39m
     [90m 106 |[39m         loss[33m:[39m [32m'meanSquaredError'[39m[33m,[39m
     [90m 107 |[39m         metrics[33m:[39m [[32m'accuracy'[39m][33m,[39m[0m

      at AILeadScoringService.compile [as initialize] (src/lib/aiLeadScoring.ts:104:18)
      at EnhancedDataManager.initialize (src/lib/enhancedDataManager.ts:51:34)
      at EnhancedDataManager.initialize [as processBatch] (src/lib/enhancedDataManager.ts:69:18)
      at Object.processBatch (src/__tests__/integration/ai-workflow.test.ts:367:48)

FAIL src/tests/integration/crm/crmExportService.test.ts
  CRMExportService Integration
    exportWithCRMTemplate
      √ should export business records using Salesforce template (16 ms)
      √ should handle progress callbacks (8 ms)
      × should generate CSV export correctly (6 ms)
      × should handle HubSpot JSON export (17 ms)
      × should validate records and skip invalid ones (11 ms)
      × should handle empty record set (5 ms)
      √ should generate proper filename with timestamp (2 ms)
      √ should include export metadata (2 ms)
    getExportPreview
      √ should generate preview with limited records (5 ms)
      √ should show validation errors in preview (3 ms)
    validateRecords
      √ should validate all records against template (12 ms)
      × should identify invalid records (2 ms)
    platform and template management
      √ should get available platforms (2 ms)
      √ should get templates for specific platform (2 ms)
      √ should get template by ID (2 ms)
    error handling
      √ should handle invalid template platform (12 ms)
      √ should handle transformation errors gracefully (3 ms)
    performance
      √ should handle large datasets efficiently (10 ms)
      √ should provide accurate progress updates for large datasets (5 ms)

  ● CRMExportService Integration › exportWithCRMTemplate › should generate CSV export correctly

    TypeError: result.blob.text is not a function

    [0m [90m 111 |[39m       )
     [90m 112 |[39m
    [31m[1m>[22m[39m[90m 113 |[39m       [36mconst[39m csvText [33m=[39m [36mawait[39m result[33m.[39mblob[33m.[39mtext()
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 114 |[39m       [36mconst[39m lines [33m=[39m csvText[33m.[39msplit([32m'\n'[39m)[33m.[39mfilter(line [33m=>[39m line[33m.[39mtrim())
     [90m 115 |[39m
     [90m 116 |[39m       [90m// Should have header + 3 data rows[39m[0m

      at Object.text (src/tests/integration/crm/crmExportService.test.ts:113:41)

  ● CRMExportService Integration › exportWithCRMTemplate › should handle HubSpot JSON export

    TypeError: result.blob.text is not a function

    [0m [90m 142 |[39m         expect(result[33m.[39mblob[33m.[39mtype)[33m.[39mtoBe([32m'application/json'[39m)
     [90m 143 |[39m
    [31m[1m>[22m[39m[90m 144 |[39m         [36mconst[39m jsonText [33m=[39m [36mawait[39m result[33m.[39mblob[33m.[39mtext()
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 145 |[39m         [36mconst[39m jsonData [33m=[39m [33mJSON[39m[33m.[39mparse(jsonText)
     [90m 146 |[39m
     [90m 147 |[39m         expect(jsonData[33m.[39mmetadata)[33m.[39mtoBeDefined()[0m

      at Object.text (src/tests/integration/crm/crmExportService.test.ts:144:44)

  ● CRMExportService Integration › exportWithCRMTemplate › should validate records and skip invalid ones

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 4

    [0m [90m 177 |[39m
     [90m 178 |[39m       expect(result[33m.[39mstatistics[33m.[39mtotalRecords)[33m.[39mtoBe([35m4[39m)
    [31m[1m>[22m[39m[90m 179 |[39m       expect(result[33m.[39mstatistics[33m.[39mexportedRecords)[33m.[39mtoBe([35m3[39m) [90m// Only valid records[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 180 |[39m       expect(result[33m.[39mstatistics[33m.[39mskippedRecords)[33m.[39mtoBe([35m1[39m)
     [90m 181 |[39m       expect(result[33m.[39mstatistics[33m.[39merrors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m 182 |[39m     })[0m

      at Object.toBe (src/tests/integration/crm/crmExportService.test.ts:179:49)

  ● CRMExportService Integration › exportWithCRMTemplate › should handle empty record set

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 189 |[39m       expect(result[33m.[39mstatistics[33m.[39mtotalRecords)[33m.[39mtoBe([35m0[39m)
     [90m 190 |[39m       expect(result[33m.[39mstatistics[33m.[39mexportedRecords)[33m.[39mtoBe([35m0[39m)
    [31m[1m>[22m[39m[90m 191 |[39m       expect(result[33m.[39mblob[33m.[39msize)[33m.[39mtoBeGreaterThan([35m0[39m) [90m// Should still have headers[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 192 |[39m     })
     [90m 193 |[39m
     [90m 194 |[39m     it([32m'should generate proper filename with timestamp'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBeGreaterThan (src/tests/integration/crm/crmExportService.test.ts:191:32)

  ● CRMExportService Integration › validateRecords › should identify invalid records

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 4

    [0m [90m 273 |[39m       [36mconst[39m validation [33m=[39m [36mawait[39m exportService[33m.[39mvalidateRecords(invalidRecords[33m,[39m salesforceTemplate)
     [90m 274 |[39m
    [31m[1m>[22m[39m[90m 275 |[39m       expect(validation[33m.[39mvalidCount)[33m.[39mtoBe([35m3[39m)
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 276 |[39m       expect(validation[33m.[39minvalidCount)[33m.[39mtoBe([35m1[39m)
     [90m 277 |[39m       expect(validation[33m.[39merrors[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m 278 |[39m     })[0m

      at Object.toBe (src/tests/integration/crm/crmExportService.test.ts:275:37)

FAIL src/tests/integration/virtualizedResultsTable.test.tsx (5.889 s)
  VirtualizedResultsTable Integration Tests
    Component Rendering
      √ should render virtual scrolling table (126 ms)
      √ should show loading state (29 ms)
      √ should display performance monitoring panel in development (20 ms)
    Performance Monitoring Integration
      √ should start frame rate monitoring on mount (46 ms)
      √ should stop frame rate monitoring on unmount (22 ms)
      √ should record performance metrics on scroll (69 ms)
      × should show performance metrics when panel is open (1039 ms)
    Search and Filtering
      √ should handle search input (396 ms)
      √ should record performance metrics on search (163 ms)
    Row Selection
      √ should handle row selection (141 ms)
      √ should handle select all (203 ms)
    Export Functionality
      × should handle export with performance tracking (1035 ms)
      √ should show export button with count (56 ms)
    Sorting
      √ should handle column sorting (50 ms)
    Error Handling
      √ should handle fetch errors gracefully (15 ms)
    Accessibility
      × should have proper ARIA labels (1033 ms)
      √ should support keyboard navigation (132 ms)
    Responsive Design
      √ should handle different screen sizes (8 ms)
    Memory Management
      √ should limit performance metrics to prevent memory leaks (889 ms)

  ● VirtualizedResultsTable Integration Tests › Performance Monitoring Integration › should show performance metrics when panel is open

    Unable to find an element with the text: Performance Metrics. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm w-full"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between"[39m
            [36m>[39m
              [36m<h3[39m
                [33mclass[39m=[32m"text-2xl font-semibold leading-none tracking-tight"[39m
              [36m>[39m
                [0mBusiness Results ([0m
                [0m1,000[0m
                [0m)[0m
              [36m</h3>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"24"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<rect[39m
                      [33mheight[39m=[32m"14"[39m
                      [33mrx[39m=[32m"2"[39m
                      [33mwidth[39m=[32m"20"[39m
                      [33mx[39m=[32m"2"[39m
                      [33my[39m=[32m"3"[39m
                    [36m/>[39m
                    [36m<line[39m
                      [33mx1[39m=[32m"8"[39m
                      [33mx2[39m=[32m"16"[39m
                      [33my1[39m=[32m"21"[39m
                      [33my2[39m=[32m"21"[39m
                    [36m/>[39m
                    [36m<line[39m
                      [33mx1[39m=[32m"12"[39m
                      [33mx2[39m=[32m"12"[39m
                      [33my1[39m=[32m"17"[39m
                      [33my2[39m=[32m"21"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mPerformance[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mheight[39m=[32m"24"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mwidth[39m=[32m"24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"[39m
                    [36m/>[39m
                    [36m<polyline[39m
                      [33mpoints[39m=[32m"7 10 12 15 17 10"[39m
                    [36m/>[39m
                    [36m<line[39m
                      [33mx1[39m=[32m"12"[39m
                      [33mx2[39m=[32m"12"[39m
                      [33my1[39m=[32m"15"[39m
                      [33my2[39m=[32m"3"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mExport ([0m
                  [0m10[0m
                  [0m)[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-4"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex-1"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"space-y-2"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"relative"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"[39m
                    [36m>[39m
                      [36m<svg[39m
                        [33mclass[39m=[32m"h-4 w-4 text-muted-foreground"[39m
                        [33mfill[39m=[32m"none"[39m
                        [33mheight[39m=[32m"24"[39m
                        [33mstroke[39m=[32m"currentColor"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                        [33mviewBox[39m=[32m"0 0 24 24"[39m
                        [33mwidth[39m=[32m"24"[39m
                        [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                      [36m>[39m
                        [36m<circle[39m
                          [33mcx[39m=[32m"11"[39m
                          [33mcy[39m=[32m"11"[39m
                          [33mr[39m=[32m"8"[39m
                        [36m/>[39m
                        [36m<path[39m
                          [33md[39m=[32m"m21 21-4.3-4.3"[39m
                        [36m/>[39m
                      [36m</svg>[39m
                    [36m</div>[39m
                    [36m<input[39m
                      [33maria-invalid[39m=[32m"false"[39m
                      [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 pl-10 pr-3 border-input focus-visible:ring-ring"[39m
                      [33mid[39m=[32m":r6:"[39m
                      [33mplaceholder[39m=[32m"Search businesses..."[39m
                      [33mtype[39m=[32m"text"[39m
                      [33mvalue[39m=[32m""[39m
                    [36m/>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"abs...

    [0m [90m 225 |[39m       fireEvent[33m.[39mclick(performanceButton)
     [90m 226 |[39m
    [31m[1m>[22m[39m[90m 227 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 228 |[39m         expect(screen[33m.[39mgetByText([32m'Performance Metrics'[39m))[33m.[39mtoBeInTheDocument()
     [90m 229 |[39m         expect(screen[33m.[39mgetByText([32m'8.50ms'[39m))[33m.[39mtoBeInTheDocument() [90m// avgRenderTime[39m
     [90m 230 |[39m         expect(screen[33m.[39mgetByText([32m'58 fps'[39m))[33m.[39mtoBeInTheDocument() [90m// avgFrameRate[39m[0m

      at waitForWrapper (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (src/tests/integration/virtualizedResultsTable.test.tsx:227:20)

  ● VirtualizedResultsTable Integration Tests › Export Functionality › should handle export with performance tracking

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"operation": "export"}
    Received: {"componentName": "VirtualizedResultsTable", "memoryUsage": 52428800, "operation": "loadInitialData", "renderTime": 0, "scrollPosition": 0, "scrollVelocity": 0, "timestamp": 1758757353262, "totalItemsCount": 0, "visibleItemsCount": 0}

    Number of calls: 1

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm w-full"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"text-2xl font-semibold leading-none tracking-tight"[39m
                [36m>[39m
                  [0mBusiness Results ([0m
                  [0m1,000[0m
                  [0m)[0m
                [36m</h3>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3 bg-blue-100"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"14"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"20"[39m
                        [33mx[39m=[32m"2"[39m
                        [33my[39m=[32m"3"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"8"[39m
                        [33mx2[39m=[32m"16"[39m
                        [33my1[39m=[32m"21"[39m
                        [33my2[39m=[32m"21"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"12"[39m
                        [33mx2[39m=[32m"12"[39m
                        [33my1[39m=[32m"17"[39m
                        [33my2[39m=[32m"21"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [0mPerformance[0m
                  [36m</button>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"[39m
                      [36m/>[39m
                      [36m<polyline[39m
                        [33mpoints[39m=[32m"7 10 12 15 17 10"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"12"[39m
                        [33mx2[39m=[32m"12"[39m
                        [33my1[39m=[32m"15"[39m
                        [33my2[39m=[32m"3"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [0mExport ([0m
                    [0m10[0m
                    [0m)[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-4"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"[39m
                      [36m>[39m
                        [36m<svg[39m
                          [33mclass[39m=[32m"h-4 w-4 text-muted-foreground"[39m
                          [33mfill[39m=[32m"none"[39m
                          [33mheight[39m=[32m"24"[39m
                          [33mstroke[39m=[32m"currentColor"[39m
                          [33mstroke-linecap[39m=[32m"round"[39m
                          [33mstroke-linejoin[39m=[32m"round"[39m
                          [33mstroke-width[39m=[32m"2"[39m
                          [33mviewBox[39m=[32m"0 0 24 24"[39m
                          [33mwidth[39m=[32m"24"[39m
                          [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                        [36m>[39m
                          [36m<circle[39m
                            [33mcx[39m=[32m"11"[39m
                            [33mcy[39m=[32m"11"[39m
                            [33mr[39m=[32m"8"[39m
                          [36m/>[39m
                          [36m<path[39m
                            [33md[39m=[32m"m21 21-4.3-4.3"[39m
                          [36m/>[39m
                        [36m</svg>[39m
                      [36m</div>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 pl-10 pr-3 border-input focus-visible:ring-ring"[39m
           ...

    [0m [90m 301 |[39m
     [90m 302 |[39m       [36mawait[39m waitFor(() [33m=>[39m {
    [31m[1m>[22m[39m[90m 303 |[39m         expect(performanceMonitoringService[33m.[39mrecordMetric)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                           [31m[1m^[22m[39m
     [90m 304 |[39m           expect[33m.[39mobjectContaining({
     [90m 305 |[39m             operation[33m:[39m [32m'export'[39m[33m,[39m
     [90m 306 |[39m           })[0m

      at toHaveBeenCalledWith (src/tests/integration/virtualizedResultsTable.test.tsx:303:59)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

  ● VirtualizedResultsTable Integration Tests › Accessibility › should have proper ARIA labels

    expect(element).toHaveAttribute("title", "Select all businesses") // element.getAttribute("title") === "Select all businesses"

    Expected the element to have attribute:
      title="Select all businesses"
    Received:
      null

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"rounded-lg border bg-card text-card-foreground shadow-sm w-full"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col space-y-1.5 p-6"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center justify-between"[39m
              [36m>[39m
                [36m<h3[39m
                  [33mclass[39m=[32m"text-2xl font-semibold leading-none tracking-tight"[39m
                [36m>[39m
                  [0mBusiness Results ([0m
                  [0m1,000[0m
                  [0m)[0m
                [36m</h3>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex items-center gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3 bg-blue-100"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<rect[39m
                        [33mheight[39m=[32m"14"[39m
                        [33mrx[39m=[32m"2"[39m
                        [33mwidth[39m=[32m"20"[39m
                        [33mx[39m=[32m"2"[39m
                        [33my[39m=[32m"3"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"8"[39m
                        [33mx2[39m=[32m"16"[39m
                        [33my1[39m=[32m"21"[39m
                        [33my2[39m=[32m"21"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"12"[39m
                        [33mx2[39m=[32m"12"[39m
                        [33my1[39m=[32m"17"[39m
                        [33my2[39m=[32m"21"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [0mPerformance[0m
                  [36m</button>[39m
                  [36m<button[39m
                    [33mclass[39m=[32m"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"mr-2 h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mheight[39m=[32m"24"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                      [33mwidth[39m=[32m"24"[39m
                      [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"[39m
                      [36m/>[39m
                      [36m<polyline[39m
                        [33mpoints[39m=[32m"7 10 12 15 17 10"[39m
                      [36m/>[39m
                      [36m<line[39m
                        [33mx1[39m=[32m"12"[39m
                        [33mx2[39m=[32m"12"[39m
                        [33my1[39m=[32m"15"[39m
                        [33my2[39m=[32m"3"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                    [0mExport ([0m
                    [0m10[0m
                    [0m)[0m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-4"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"space-y-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"relative"[39m
                    [36m>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"[39m
                      [36m>[39m
                        [36m<svg[39m
                          [33mclass[39m=[32m"h-4 w-4 text-muted-foreground"[39m
                          [33mfill[39m=[32m"none"[39m
                          [33mheight[39m=[32m"24"[39m
                          [33mstroke[39m=[32m"currentColor"[39m
                          [33mstroke-linecap[39m=[32m"round"[39m
                          [33mstroke-linejoin[39m=[32m"round"[39m
                          [33mstroke-width[39m=[32m"2"[39m
                          [33mviewBox[39m=[32m"0 0 24 24"[39m
                          [33mwidth[39m=[32m"24"[39m
                          [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                        [36m>[39m
                          [36m<circle[39m
                            [33mcx[39m=[32m"11"[39m
                            [33mcy[39m=[32m"11"[39m
                            [33mr[39m=[32m"8"[39m
                          [36m/>[39m
                          [36m<path[39m
                            [33md[39m=[32m"m21 21-4.3-4.3"[39m
                          [36m/>[39m
                        [36m</svg>[39m
                      [36m</div>[39m
                      [36m<input[39m
                        [33maria-invalid[39m=[32m"false"[39m
                        [33mclass[39m=[32m"flex h-10 w-full rounded-md border bg-background py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-200 pl-10 pr-3 border-input focus-visible:ring-ring"[39m
           ...

    [0m [90m 354 |[39m
     [90m 355 |[39m         [36mconst[39m checkboxes [33m=[39m screen[33m.[39mgetAllByRole([32m'checkbox'[39m)
    [31m[1m>[22m[39m[90m 356 |[39m         expect(checkboxes[[35m0[39m])[33m.[39mtoHaveAttribute([32m'title'[39m[33m,[39m [32m'Select all businesses'[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 357 |[39m       })
     [90m 358 |[39m     })
     [90m 359 |[39m[0m

      at toHaveAttribute (src/tests/integration/virtualizedResultsTable.test.tsx:356:31)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:520:19)

FAIL src/__tests__/integration/healthCheck.integration.test.ts
  Health Check Integration Tests
    Basic Health Check Endpoint
      √ should return healthy status when all systems are operational (12 ms)
      √ should return unhealthy status when database is down (6 ms)
      × should return warning status when configuration has issues (3 ms)
      √ should handle memory usage monitoring (3 ms)
    Detailed Health Check Endpoint
      √ should return detailed health information with metrics (10 ms)
      √ should return detailed health information with alerts (6 ms)
      × should handle custom health check parameters via POST (6 ms)
    Metrics Endpoint Integration
      × should return Prometheus format by default (8 ms)
      × should return JSON format when requested (4 ms)
      √ should exclude monitoring data when requested (4 ms)
    Error Handling
      × should handle monitoring service failures gracefully (19 ms)
      √ should handle metrics service failures (3 ms)

  ● Health Check Integration Tests › Basic Health Check Endpoint › should return warning status when configuration has issues

    expect(received).toBe(expected) // Object.is equality

    Expected: "warning"
    Received: "degraded"

    [0m [90m 146 |[39m
     [90m 147 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 148 |[39m       expect(data[33m.[39mstatus)[33m.[39mtoBe([32m'warning'[39m)
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 149 |[39m       expect(data[33m.[39mchecks[33m.[39mconfiguration)[33m.[39mtoBe([32m'warning'[39m)
     [90m 150 |[39m     })
     [90m 151 |[39m[0m

      at Object.toBe (src/__tests__/integration/healthCheck.integration.test.ts:148:27)

  ● Health Check Integration Tests › Detailed Health Check Endpoint › should handle custom health check parameters via POST

    expect(received).toMatchObject(expected)

    Matcher error: received value must be a non-null object

    Received has value: undefined

    [0m [90m 319 |[39m
     [90m 320 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 321 |[39m       expect(data[33m.[39mrequestedParameters)[33m.[39mtoMatchObject(requestBody)
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 322 |[39m       expect(data[33m.[39mservices)[33m.[39mtoHaveLength([35m1[39m)
     [90m 323 |[39m       expect(data[33m.[39mservices[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'database'[39m)
     [90m 324 |[39m     })[0m

      at Object.toMatchObject (src/__tests__/integration/healthCheck.integration.test.ts:321:40)

  ● Health Check Integration Tests › Metrics Endpoint Integration › should return Prometheus format by default

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 332 |[39m       [36mconst[39m text [33m=[39m [36mawait[39m response[33m.[39mtext()
     [90m 333 |[39m
    [31m[1m>[22m[39m[90m 334 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 335 |[39m       expect(response[33m.[39mheaders[33m.[39m[36mget[39m([32m'Content-Type'[39m))[33m.[39mtoContain([32m'text/plain'[39m)
     [90m 336 |[39m       expect(text)[33m.[39mtoContain([32m'# Prometheus metrics'[39m)
     [90m 337 |[39m     })[0m

      at Object.toBe (src/__tests__/integration/healthCheck.integration.test.ts:334:31)

  ● Health Check Integration Tests › Metrics Endpoint Integration › should return JSON format when requested

    expect(received).toMatchObject(expected)

    - Expected  - 1
    + Received  + 0

    @@ -1,7 +1,6 @@
      Object {
    -   "alerts": Any<Array>,
        "metrics": Any<Array>,
        "prometheus": Any<String>,
        "system": Object {
          "activeAlerts": Any<Number>,
          "services": Any<Array>,

    [0m [90m 354 |[39m
     [90m 355 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
    [31m[1m>[22m[39m[90m 356 |[39m       expect(data)[33m.[39mtoMatchObject({
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 357 |[39m         timestamp[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m
     [90m 358 |[39m         system[33m:[39m {
     [90m 359 |[39m           status[33m:[39m [32m'healthy'[39m[33m,[39m[0m

      at Object.toMatchObject (src/__tests__/integration/healthCheck.integration.test.ts:356:20)

  ● Health Check Integration Tests › Error Handling › should handle monitoring service failures gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 503
    Received: 500

    [0m [90m 388 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m healthCheckHandler(request)
     [90m 389 |[39m
    [31m[1m>[22m[39m[90m 390 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m503[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 391 |[39m     })
     [90m 392 |[39m
     [90m 393 |[39m     it([32m'should handle metrics service failures'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toBe (src/__tests__/integration/healthCheck.integration.test.ts:390:31)

FAIL src/__tests__/integration/userManagement.integration.test.ts
  User Management Integration
    Complete User Onboarding Flow
      × should complete full onboarding flow with payment setup (7 ms)
      × should handle subscription upgrade flow (2 ms)
      × should handle multiple user registrations (2 ms)
    Usage Quota Management
      × should properly initialize and track usage quotas (4 ms)
      × should handle different plan quota limits (2 ms)
    Payment Integration
      × should handle payment profile creation and updates (1 ms)
      × should gracefully handle payment service failures (4 ms)
    Data Persistence and Retrieval
      × should persist user data correctly across service calls (8 ms)
      × should handle concurrent user operations (3 ms)
    Error Scenarios
      × should handle duplicate email registration attempts (2 ms)
      × should handle invalid verification tokens (1 ms)

  ● User Management Integration › Complete User Onboarding Flow › should complete full onboarding flow with payment setup

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:53:51)

  ● User Management Integration › Complete User Onboarding Flow › should handle subscription upgrade flow

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:93:64)

  ● User Management Integration › Complete User Onboarding Flow › should handle multiple user registrations

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:121:50)

  ● User Management Integration › Usage Quota Management › should properly initialize and track usage quotas

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:146:48)

  ● User Management Integration › Usage Quota Management › should handle different plan quota limits

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:172:50)

  ● User Management Integration › Payment Integration › should handle payment profile creation and updates

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:189:48)

  ● User Management Integration › Payment Integration › should gracefully handle payment service failures

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:214:48)

  ● User Management Integration › Data Persistence and Retrieval › should persist user data correctly across service calls

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:239:56)

  ● User Management Integration › Data Persistence and Retrieval › should handle concurrent user operations

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:262:75)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/integration/userManagement.integration.test.ts:262:42)

  ● User Management Integration › Error Scenarios › should handle duplicate email registration attempts

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:292:53)

  ● User Management Integration › Error Scenarios › should handle invalid verification tokens

    TypeError: Cannot destructure property 'hash' of '(0 , _security.hashPassword)(...)' as it is undefined.

    [0m [90m 69 |[39m     [36mtry[39m {
     [90m 70 |[39m       [90m// Hash password securely[39m
    [31m[1m>[22m[39m[90m 71 |[39m       [36mconst[39m { hash[33m,[39m salt } [33m=[39m hashPassword(userData[33m.[39mpassword)
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 72 |[39m
     [90m 73 |[39m       [36mconst[39m user[33m:[39m [33mUser[39m [33m=[39m {
     [90m 74 |[39m         id[33m:[39m userId[33m,[39m[0m

      at UserOnboardingService.hash [as createUserProfile] (src/model/userOnboardingService.ts:71:15)
      at UserOnboardingService.createUserProfile [as completeOnboarding] (src/model/userOnboardingService.ts:38:31)
      at Object.completeOnboarding (src/__tests__/integration/userManagement.integration.test.ts:310:48)

PASS src/tests/integration/simple-api.test.ts
  Simple Integration Tests
    API Client
      √ should make GET requests correctly (4 ms)
      √ should make POST requests correctly (2 ms)
    Business Data Validation
      √ should validate business data structure (3 ms)
      √ should have valid email format (2 ms)
      √ should have valid phone format (3 ms)
      √ should have valid website URL (2 ms)
      √ should have valid confidence score (2 ms)
    Data Processing Pipeline
      √ should process business data through validation pipeline (2 ms)
      √ should handle batch validation (1 ms)
    Error Handling
      √ should handle network errors (16 ms)
      √ should handle invalid JSON responses (2 ms)
      √ should validate required fields (1 ms)
    Data Transformation
      √ should transform business data for export (1 ms)
      √ should handle missing optional fields in transformation (3 ms)
    Search and Filtering
      √ should filter businesses by industry (4 ms)
      √ should search businesses by name (1 ms)
      √ should sort businesses by confidence (1 ms)
    Performance Tests
      √ should handle large datasets efficiently (2 ms)
      √ should handle concurrent API requests (1 ms)

FAIL src/__tests__/integration/mobile-responsiveness.test.tsx
  Mobile Responsiveness Integration
    Mobile Layout
      × should render mobile-optimized header (58 ms)
      × should open mobile navigation drawer (17 ms)
      × should have touch-friendly targets (16 ms)
      × should handle mobile navigation between tabs (8 ms)
    Tablet Layout
      × should render tablet-optimized layout (11 ms)
    Desktop Layout
      × should render desktop layout (10 ms)
    Responsive Breakpoint Changes
      × should adapt when switching from mobile to desktop (6 ms)
    Touch Interactions
      × should handle touch events properly (9 ms)
      × should prevent body scroll when modal is open (21 ms)
    Accessibility on Mobile
      × should have proper ARIA attributes for mobile navigation (6 ms)
      × should support keyboard navigation (9 ms)
      × should have minimum touch target sizes (14 ms)

  ● Mobile Responsiveness Integration › Mobile Layout › should render mobile-optimized header

    TestingLibraryElementError: Unable to find an element with the text: Scraper. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 79 |[39m
     [90m 80 |[39m       [90m// Should show mobile title[39m
    [31m[1m>[22m[39m[90m 81 |[39m       expect(screen[33m.[39mgetByText([32m'Scraper'[39m))[33m.[39mtoBeInTheDocument()
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 82 |[39m       expect(screen[33m.[39mqueryByText([32m'Business Scraper'[39m))[33m.[39mnot[33m.[39mtoBeInTheDocument()
     [90m 83 |[39m
     [90m 84 |[39m       [90m// Should show mobile menu button[39m[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/integration/mobile-responsiveness.test.tsx:81:21)

  ● Mobile Responsiveness Integration › Mobile Layout › should open mobile navigation drawer

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m  95 |[39m       )
     [90m  96 |[39m
    [31m[1m>[22m[39m[90m  97 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m  98 |[39m
     [90m  99 |[39m       expect(screen[33m.[39mgetByRole([32m'dialog'[39m))[33m.[39mtoBeInTheDocument()
     [90m 100 |[39m       expect(screen[33m.[39mgetByText([32m'Navigation'[39m))[33m.[39mtoBeInTheDocument()[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:97:31)

  ● Mobile Responsiveness Integration › Mobile Layout › should have touch-friendly targets

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 110 |[39m       )
     [90m 111 |[39m
    [31m[1m>[22m[39m[90m 112 |[39m       [36mconst[39m menuButton [33m=[39m screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 113 |[39m       expect(menuButton)[33m.[39mtoHaveClass([32m'min-h-touch'[39m[33m,[39m [32m'min-w-touch'[39m)
     [90m 114 |[39m
     [90m 115 |[39m       [36mawait[39m user[33m.[39mclick(menuButton)[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:112:33)

  ● Mobile Responsiveness Integration › Mobile Layout › should handle mobile navigation between tabs

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 129 |[39m
     [90m 130 |[39m       [90m// Open mobile menu[39m
    [31m[1m>[22m[39m[90m 131 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 132 |[39m
     [90m 133 |[39m       [90m// Navigate to scraping tab[39m
     [90m 134 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByText([32m'Scraping'[39m))[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:131:31)

  ● Mobile Responsiveness Integration › Tablet Layout › should render tablet-optimized layout

    TestingLibraryElementError: Unable to find an element with the text: Business Scraper. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 170 |[39m
     [90m 171 |[39m       [90m// Should show full title on tablet[39m
    [31m[1m>[22m[39m[90m 172 |[39m       expect(screen[33m.[39mgetByText([32m'Business Scraper'[39m))[33m.[39mtoBeInTheDocument()
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 173 |[39m
     [90m 174 |[39m       [90m// Should show desktop navigation on tablet[39m
     [90m 175 |[39m       expect(screen[33m.[39mgetByText([32m'Configuration'[39m))[33m.[39mtoBeInTheDocument()[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/integration/mobile-responsiveness.test.tsx:172:21)

  ● Mobile Responsiveness Integration › Desktop Layout › should render desktop layout

    TestingLibraryElementError: Unable to find an element with the text: Business Scraper. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 204 |[39m
     [90m 205 |[39m       [90m// Should show full title[39m
    [31m[1m>[22m[39m[90m 206 |[39m       expect(screen[33m.[39mgetByText([32m'Business Scraper'[39m))[33m.[39mtoBeInTheDocument()
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 207 |[39m
     [90m 208 |[39m       [90m// Should show desktop navigation[39m
     [90m 209 |[39m       expect(screen[33m.[39mgetByText([32m'Configuration'[39m))[33m.[39mtoBeInTheDocument()[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (src/__tests__/integration/mobile-responsiveness.test.tsx:206:21)

  ● Mobile Responsiveness Integration › Responsive Breakpoint Changes › should adapt when switching from mobile to desktop

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 236 |[39m
     [90m 237 |[39m       [90m// Should be in mobile mode[39m
    [31m[1m>[22m[39m[90m 238 |[39m       expect(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))[33m.[39mtoBeInTheDocument()
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 239 |[39m
     [90m 240 |[39m       [90m// Open mobile drawer[39m
     [90m 241 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:238:21)

  ● Mobile Responsiveness Integration › Touch Interactions › should handle touch events properly

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 286 |[39m       )
     [90m 287 |[39m
    [31m[1m>[22m[39m[90m 288 |[39m       [36mconst[39m menuButton [33m=[39m screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 289 |[39m
     [90m 290 |[39m       [90m// Simulate touch events[39m
     [90m 291 |[39m       fireEvent[33m.[39mtouchStart(menuButton)[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:288:33)

  ● Mobile Responsiveness Integration › Touch Interactions › should prevent body scroll when modal is open

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 308 |[39m       expect(document[33m.[39mbody[33m.[39mstyle[33m.[39moverflow)[33m.[39mtoBe([32m''[39m)
     [90m 309 |[39m
    [31m[1m>[22m[39m[90m 310 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 311 |[39m
     [90m 312 |[39m       expect(document[33m.[39mbody[33m.[39mstyle[33m.[39moverflow)[33m.[39mtoBe([32m'hidden'[39m)
     [90m 313 |[39m[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:310:31)

  ● Mobile Responsiveness Integration › Accessibility on Mobile › should have proper ARIA attributes for mobile navigation

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 341 |[39m       )
     [90m 342 |[39m
    [31m[1m>[22m[39m[90m 343 |[39m       [36mconst[39m menuButton [33m=[39m screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 344 |[39m       expect(menuButton)[33m.[39mtoHaveAttribute([32m'aria-expanded'[39m[33m,[39m [32m'false'[39m)
     [90m 345 |[39m
     [90m 346 |[39m       [36mawait[39m user[33m.[39mclick(menuButton)[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:343:33)

  ● Mobile Responsiveness Integration › Accessibility on Mobile › should support keyboard navigation

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 362 |[39m       )
     [90m 363 |[39m
    [31m[1m>[22m[39m[90m 364 |[39m       [36mawait[39m user[33m.[39mclick(screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m))
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 365 |[39m
     [90m 366 |[39m       [90m// Should be able to close with Escape[39m
     [90m 367 |[39m       fireEvent[33m.[39mkeyDown(document[33m,[39m { key[33m:[39m [32m'Escape'[39m[33m,[39m code[33m:[39m [32m'Escape'[39m })[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:364:31)

  ● Mobile Responsiveness Integration › Accessibility on Mobile › should have minimum touch target sizes

    TestingLibraryElementError: Unable to find a label with the text of: Open navigation menu

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"min-h-screen flex items-center justify-center"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"text-center space-y-4"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto"[39m
            [36m/>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-muted-foreground"[39m
            [36m>[39m
              [0mInitializing application...[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

    [0m [90m 381 |[39m       )
     [90m 382 |[39m
    [31m[1m>[22m[39m[90m 383 |[39m       [36mconst[39m menuButton [33m=[39m screen[33m.[39mgetByLabelText([32m'Open navigation menu'[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 384 |[39m       expect(menuButton)[33m.[39mtoHaveClass([32m'min-h-touch'[39m[33m,[39m [32m'min-w-touch'[39m)
     [90m 385 |[39m
     [90m 386 |[39m       [36mawait[39m user[33m.[39mclick(menuButton)[0m

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getAllByLabelText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/queries/label-text.js:111:38)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/__tests__/integration/mobile-responsiveness.test.tsx:383:33)


```

### End-to-End Tests

**Error:** Command failed: npm run test:e2e
[1A[2K[chromium] › src\tests\e2e\admin-login-flow.test.ts:64:7 › Admin Login Flow - Core Functionality › Admin Login - Complete Flow Test
❌ Admin login flow failed: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m()[22m failed

Locator:  locator('text=Sign in to access the application')
Expected: visible
Received: <element(s) not found>
Timeout:  10000ms

Call log:
[2m  - Expect "toBeVisible" with timeout 10000ms[22m
[2m  - waiting for locator('text=Sign in to access the application')[22m
[2m    - waiting for navigation to finish...[22m
[2m    - navigated to "http://localhost:3000/"[22m

[1A[2K⚠️  Success rate 0.0% is below 90% threshold
[1A[2K[chromium] › src\tests\e2e\admin-login-flow.test.ts:246:7 › Admin Login Flow - Core Functionality › Admin Login - Form Validation
Page load timeout: page.waitForLoadState: Timeout 10000ms exceeded.
=========================== logs ===========================
  "commit" event fired
  "domcontentloaded" event fired
  "load" event fired
============================================================
    at waitForPageLoad [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:42:16[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\admin-login-flow.test.ts:253:7 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts'[39m,
      line: [33m42[39m,
      column: [33m16[39m,
      function: [32m'waitForPageLoad'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for load state "networkidle"'[39m,
    apiName: [32m'page.waitForLoadState'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@31'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@31'[39m,
      _title: [32m'Wait for load state "networkidle"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757423276[39m,
    error: {
      message: [32m'TimeoutError: page.waitForLoadState: Timeout 10000ms exceeded.\n'[39m +
        [32m'=========================== logs ===========================\n'[39m +
        [32m'  "commit" event fired\n'[39m +
        [32m'  "domcontentloaded" event fired\n'[39m +
        [32m'  "load" event fired\n'[39m +
        [32m'============================================================'[39m,
      stack: [32m'TimeoutError: page.waitForLoadState: Timeout 10000ms exceeded.\n'[39m +
        [32m'=========================== logs ===========================\n'[39m +
        [32m'  "commit" event fired\n'[39m +
        [32m'  "domcontentloaded" event fired\n'[39m +
        [32m'  "load" event fired\n'[39m +
        [32m'============================================================\n'[39m +
        [32m'    at waitForPageLoad (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:42:16)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\admin-login-flow.test.ts:253:7'[39m,
      cause: [90mundefined[39m
    }
  }
}
[1A[2K⚠️  Success rate 50.0% is below 90% threshold
[1A[2K⚠️  Success rate 0.0% is below 90% threshold
[1A[2K[chromium] › src\tests\e2e\admin-login-flow.test.ts:191:7 › Admin Login Flow - Core Functionality › Admin Login - Invalid Credentials Handling
Login error: page.waitForFunction: Timeout 15000ms exceeded.
    at performLogin [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:105:16[90m)[39m
    at testInvalidCredentials [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:354:18[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\admin-login-flow.test.ts:197:17 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts'[39m,
      line: [33m105[39m,
      column: [33m16[39m,
      function: [32m'performLogin'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for function'[39m,
    apiName: [32m'page.waitForFunction'[39m,
    params: {
      pollingInterval: [90mundefined[39m,
      expression: [32m'() => {\n'[39m +
        [32m"      const debugElement = document.querySelector('.text-blue-700');\n"[39m +
        [32m'      if (debugElement) {\n'[39m +
        [32m"        const text = debugElement.textContent || '';\n"[39m +
        [32m"        return text.includes('CSRF Token: Present') && !text.includes('CSRF Loading: Yes');\n"[39m +
        [32m'      }\n'[39m +
        [32m'      return false;\n'[39m +
        [32m'    }'[39m,
      isFunction: [33mtrue[39m,
      arg: [36m[Object][39m,
      timeout: [33m15000[39m
    },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@30'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@30'[39m,
      _title: [32m'Wait for function'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757428335[39m,
    error: {
      message: [32m'TimeoutError: page.waitForFunction: Timeout 15000ms exceeded.'[39m,
      stack: [32m'TimeoutError: page.waitForFunction: Timeout 15000ms exceeded.\n'[39m +
        [32m'    at performLogin (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:105:16)\n'[39m +
        [32m'    at testInvalidCredentials (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:354:18)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\admin-login-flow.test.ts:197:17'[39m,
      cause: [90mundefined[39m
    }
  }
}
[1A[2K[chromium] › src\tests\e2e\admin-login-flow.test.ts:125:7 › Admin Login Flow - Core Functionality › Admin Login - Performance Test
Page load timeout: page.waitForLoadState: Timeout 10000ms exceeded.
=========================== logs ===========================
  "commit" event fired
  "domcontentloaded" event fired
  "load" event fired
============================================================
    at waitForPageLoad [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:42:16[90m)[39m
    at measureLoginPerformance [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:288:3[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\admin-login-flow.test.ts:132:27 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts'[39m,
      line: [33m42[39m,
      column: [33m16[39m,
      function: [32m'waitForPageLoad'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for load state "networkidle"'[39m,
    apiName: [32m'page.waitForLoadState'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@40'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@40'[39m,
      _title: [32m'Wait for load state "networkidle"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757432023[39m,
    error: {
      message: [32m'TimeoutError: page.waitForLoadState: Timeout 10000ms exceeded.\n'[39m +
        [32m'=========================== logs ===========================\n'[39m +
        [32m'  "commit" event fired\n'[39m +
        [32m'  "domcontentloaded" event fired\n'[39m +
        [32m'  "load" event fired\n'[39m +
        [32m'============================================================'[39m,
      stack: [32m'TimeoutError: page.waitForLoadState: Timeout 10000ms exceeded.\n'[39m +
        [32m'=========================== logs ===========================\n'[39m +
        [32m'  "commit" event fired\n'[39m +
        [32m'  "domcontentloaded" event fired\n'[39m +
        [32m'  "load" event fired\n'[39m +
        [32m'============================================================\n'[39m +
        [32m'    at waitForPageLoad (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:42:16)\n'[39m +
        [32m'    at measureLoginPerformance (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:288:3)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\admin-login-flow.test.ts:132:27'[39m,
      cause: [90mundefined[39m
    }
  }
}
[1A[2K⚠️  Success rate 0.0% is below 90% threshold
[1A[2K[chromium] › src\tests\e2e\comprehensiveUserWorkflows.test.ts:75:9 › Comprehensive User Workflow Tests › Complete Business Search Workflow › should complete full business search and export workflow
❌ Step 2 failed: TimeoutError: page.click: Timeout 15000ms exceeded.
Call log:
[2m  - waiting for locator('a[href*="/search"], button:has-text("Start Search"), [data-testid="search-nav"]')[22m

[1A[2K[chromium] › src\tests\e2e\comprehensiveUserWorkflows.test.ts:268:9 › Comprehensive User Workflow Tests › Complete Business Search Workflow › should handle search with no results gracefully
❌ Step 1 failed: Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m()[22m failed

Locator:  locator('form, [data-testid="search-form"]')
Expected: visible
Received: <element(s) not found>
Timeout:  10000ms

Call log:
[2m  - Expect "toBeVisible" with timeout 10000ms[22m
[2m  - waiting for locator('form, [data-testid="search-form"]')[22m

[1A[2K[chromium] › src\tests\e2e\comprehensiveUserWorkflows.test.ts:345:9 › Comprehensive User Workflow Tests › Error Handling Workflows › should handle invalid input gracefully
❌ Step 1 failed: Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m()[22m failed

Locator:  locator('form')
Expected: visible
Received: <element(s) not found>
Timeout:  10000ms

Call log:
[2m  - Expect "toBeVisible" with timeout 10000ms[22m
[2m  - waiting for locator('form')[22m

[1A[2K[chromium] › src\tests\e2e\comprehensiveUserWorkflows.test.ts:307:9 › Comprehensive User Workflow Tests › Error Handling Workflows › should handle network errors gracefully
❌ Step 2 failed: TimeoutError: page.fill: Timeout 15000ms exceeded.
Call log:
[2m  - waiting for locator('input[name="industry"], [data-testid="industry-input"]')[22m

[1A[2KInternal error: step id not found: fixture@36[1A[2K[chromium] › src\tests\e2e\end2end_download_authentication_1.spec.ts:87:7 › End-to-End Download Test Suite - Part 1: Login Authentication › should successfully login with admin credentials
Error checking auth status: page.waitForLoadState: Timeout 15000ms exceeded.
    at waitForPageLoad [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:32:14[90m)[39m
    at isAuthEnabled [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:40:11[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:96:27 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts'[39m,
      line: [33m32[39m,
      column: [33m14[39m,
      function: [32m'waitForPageLoad'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for load state "networkidle"'[39m,
    apiName: [32m'page.waitForLoadState'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@32'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@32'[39m,
      _title: [32m'Wait for load state "networkidle"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757542874[39m,
    error: {
      message: [32m'TimeoutError: page.waitForLoadState: Timeout 15000ms exceeded.'[39m,
      stack: [32m'TimeoutError: page.waitForLoadState: Timeout 15000ms exceeded.\n'[39m +
        [32m'    at waitForPageLoad (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:32:14)\n'[39m +
        [32m'    at isAuthEnabled (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:40:11)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:96:27'[39m,
      cause: [90mundefined[39m
    }
  }
}
[1A[2K[chromium] › src\tests\e2e\end2end_download_authentication_1.spec.ts:87:7 › End-to-End Download Test Suite - Part 1: Login Authentication › should successfully login with admin credentials
Login test failed: page.waitForLoadState: Timeout 15000ms exceeded.
    at waitForPageLoad [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:32:14[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:103:15 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts'[39m,
      line: [33m32[39m,
      column: [33m14[39m,
      function: [32m'waitForPageLoad'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for load state "networkidle"'[39m,
    apiName: [32m'page.waitForLoadState'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@35'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@35'[39m,
      _title: [32m'Wait for load state "networkidle"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757558409[39m,
    error: {
      message: [32m'TimeoutError: page.waitForLoadState: Timeout 15000ms exceeded.'[39m,
      stack: [32m'TimeoutError: page.waitForLoadState: Timeout 15000ms exceeded.\n'[39m +
        [32m'    at waitForPageLoad (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:32:14)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:103:15'[39m,
      cause: [90mundefined[39m
    }
  }
}


**stderr:**
```
[1A[2K[chromium] › src\tests\e2e\admin-login-flow.test.ts:64:7 › Admin Login Flow - Core Functionality › Admin Login - Complete Flow Test
❌ Admin login flow failed: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m()[22m failed

Locator:  locator('text=Sign in to access the application')
Expected: visible
Received: <element(s) not found>
Timeout:  10000ms

Call log:
[2m  - Expect "toBeVisible" with timeout 10000ms[22m
[2m  - waiting for locator('text=Sign in to access the application')[22m
[2m    - waiting for navigation to finish...[22m
[2m    - navigated to "http://localhost:3000/"[22m

[1A[2K⚠️  Success rate 0.0% is below 90% threshold
[1A[2K[chromium] › src\tests\e2e\admin-login-flow.test.ts:246:7 › Admin Login Flow - Core Functionality › Admin Login - Form Validation
Page load timeout: page.waitForLoadState: Timeout 10000ms exceeded.
=========================== logs ===========================
  "commit" event fired
  "domcontentloaded" event fired
  "load" event fired
============================================================
    at waitForPageLoad [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:42:16[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\admin-login-flow.test.ts:253:7 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts'[39m,
      line: [33m42[39m,
      column: [33m16[39m,
      function: [32m'waitForPageLoad'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for load state "networkidle"'[39m,
    apiName: [32m'page.waitForLoadState'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@31'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@31'[39m,
      _title: [32m'Wait for load state "networkidle"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757423276[39m,
    error: {
      message: [32m'TimeoutError: page.waitForLoadState: Timeout 10000ms exceeded.\n'[39m +
        [32m'=========================== logs ===========================\n'[39m +
        [32m'  "commit" event fired\n'[39m +
        [32m'  "domcontentloaded" event fired\n'[39m +
        [32m'  "load" event fired\n'[39m +
        [32m'============================================================'[39m,
      stack: [32m'TimeoutError: page.waitForLoadState: Timeout 10000ms exceeded.\n'[39m +
        [32m'=========================== logs ===========================\n'[39m +
        [32m'  "commit" event fired\n'[39m +
        [32m'  "domcontentloaded" event fired\n'[39m +
        [32m'  "load" event fired\n'[39m +
        [32m'============================================================\n'[39m +
        [32m'    at waitForPageLoad (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:42:16)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\admin-login-flow.test.ts:253:7'[39m,
      cause: [90mundefined[39m
    }
  }
}
[1A[2K⚠️  Success rate 50.0% is below 90% threshold
[1A[2K⚠️  Success rate 0.0% is below 90% threshold
[1A[2K[chromium] › src\tests\e2e\admin-login-flow.test.ts:191:7 › Admin Login Flow - Core Functionality › Admin Login - Invalid Credentials Handling
Login error: page.waitForFunction: Timeout 15000ms exceeded.
    at performLogin [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:105:16[90m)[39m
    at testInvalidCredentials [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:354:18[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\admin-login-flow.test.ts:197:17 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts'[39m,
      line: [33m105[39m,
      column: [33m16[39m,
      function: [32m'performLogin'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for function'[39m,
    apiName: [32m'page.waitForFunction'[39m,
    params: {
      pollingInterval: [90mundefined[39m,
      expression: [32m'() => {\n'[39m +
        [32m"      const debugElement = document.querySelector('.text-blue-700');\n"[39m +
        [32m'      if (debugElement) {\n'[39m +
        [32m"        const text = debugElement.textContent || '';\n"[39m +
        [32m"        return text.includes('CSRF Token: Present') && !text.includes('CSRF Loading: Yes');\n"[39m +
        [32m'      }\n'[39m +
        [32m'      return false;\n'[39m +
        [32m'    }'[39m,
      isFunction: [33mtrue[39m,
      arg: [36m[Object][39m,
      timeout: [33m15000[39m
    },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@30'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@30'[39m,
      _title: [32m'Wait for function'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757428335[39m,
    error: {
      message: [32m'TimeoutError: page.waitForFunction: Timeout 15000ms exceeded.'[39m,
      stack: [32m'TimeoutError: page.waitForFunction: Timeout 15000ms exceeded.\n'[39m +
        [32m'    at performLogin (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:105:16)\n'[39m +
        [32m'    at testInvalidCredentials (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:354:18)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\admin-login-flow.test.ts:197:17'[39m,
      cause: [90mundefined[39m
    }
  }
}
[1A[2K[chromium] › src\tests\e2e\admin-login-flow.test.ts:125:7 › Admin Login Flow - Core Functionality › Admin Login - Performance Test
Page load timeout: page.waitForLoadState: Timeout 10000ms exceeded.
=========================== logs ===========================
  "commit" event fired
  "domcontentloaded" event fired
  "load" event fired
============================================================
    at waitForPageLoad [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:42:16[90m)[39m
    at measureLoginPerformance [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\helpers\auth-test-helpers.ts:288:3[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\admin-login-flow.test.ts:132:27 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts'[39m,
      line: [33m42[39m,
      column: [33m16[39m,
      function: [32m'waitForPageLoad'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for load state "networkidle"'[39m,
    apiName: [32m'page.waitForLoadState'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@40'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@40'[39m,
      _title: [32m'Wait for load state "networkidle"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757432023[39m,
    error: {
      message: [32m'TimeoutError: page.waitForLoadState: Timeout 10000ms exceeded.\n'[39m +
        [32m'=========================== logs ===========================\n'[39m +
        [32m'  "commit" event fired\n'[39m +
        [32m'  "domcontentloaded" event fired\n'[39m +
        [32m'  "load" event fired\n'[39m +
        [32m'============================================================'[39m,
      stack: [32m'TimeoutError: page.waitForLoadState: Timeout 10000ms exceeded.\n'[39m +
        [32m'=========================== logs ===========================\n'[39m +
        [32m'  "commit" event fired\n'[39m +
        [32m'  "domcontentloaded" event fired\n'[39m +
        [32m'  "load" event fired\n'[39m +
        [32m'============================================================\n'[39m +
        [32m'    at waitForPageLoad (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:42:16)\n'[39m +
        [32m'    at measureLoginPerformance (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\helpers\\auth-test-helpers.ts:288:3)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\admin-login-flow.test.ts:132:27'[39m,
      cause: [90mundefined[39m
    }
  }
}
[1A[2K⚠️  Success rate 0.0% is below 90% threshold
[1A[2K[chromium] › src\tests\e2e\comprehensiveUserWorkflows.test.ts:75:9 › Comprehensive User Workflow Tests › Complete Business Search Workflow › should complete full business search and export workflow
❌ Step 2 failed: TimeoutError: page.click: Timeout 15000ms exceeded.
Call log:
[2m  - waiting for locator('a[href*="/search"], button:has-text("Start Search"), [data-testid="search-nav"]')[22m

[1A[2K[chromium] › src\tests\e2e\comprehensiveUserWorkflows.test.ts:268:9 › Comprehensive User Workflow Tests › Complete Business Search Workflow › should handle search with no results gracefully
❌ Step 1 failed: Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m()[22m failed

Locator:  locator('form, [data-testid="search-form"]')
Expected: visible
Received: <element(s) not found>
Timeout:  10000ms

Call log:
[2m  - Expect "toBeVisible" with timeout 10000ms[22m
[2m  - waiting for locator('form, [data-testid="search-form"]')[22m

[1A[2K[chromium] › src\tests\e2e\comprehensiveUserWorkflows.test.ts:345:9 › Comprehensive User Workflow Tests › Error Handling Workflows › should handle invalid input gracefully
❌ Step 1 failed: Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m()[22m failed

Locator:  locator('form')
Expected: visible
Received: <element(s) not found>
Timeout:  10000ms

Call log:
[2m  - Expect "toBeVisible" with timeout 10000ms[22m
[2m  - waiting for locator('form')[22m

[1A[2K[chromium] › src\tests\e2e\comprehensiveUserWorkflows.test.ts:307:9 › Comprehensive User Workflow Tests › Error Handling Workflows › should handle network errors gracefully
❌ Step 2 failed: TimeoutError: page.fill: Timeout 15000ms exceeded.
Call log:
[2m  - waiting for locator('input[name="industry"], [data-testid="industry-input"]')[22m

[1A[2KInternal error: step id not found: fixture@36[1A[2K[chromium] › src\tests\e2e\end2end_download_authentication_1.spec.ts:87:7 › End-to-End Download Test Suite - Part 1: Login Authentication › should successfully login with admin credentials
Error checking auth status: page.waitForLoadState: Timeout 15000ms exceeded.
    at waitForPageLoad [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:32:14[90m)[39m
    at isAuthEnabled [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:40:11[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:96:27 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts'[39m,
      line: [33m32[39m,
      column: [33m14[39m,
      function: [32m'waitForPageLoad'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for load state "networkidle"'[39m,
    apiName: [32m'page.waitForLoadState'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@32'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@32'[39m,
      _title: [32m'Wait for load state "networkidle"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757542874[39m,
    error: {
      message: [32m'TimeoutError: page.waitForLoadState: Timeout 15000ms exceeded.'[39m,
      stack: [32m'TimeoutError: page.waitForLoadState: Timeout 15000ms exceeded.\n'[39m +
        [32m'    at waitForPageLoad (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:32:14)\n'[39m +
        [32m'    at isAuthEnabled (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:40:11)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:96:27'[39m,
      cause: [90mundefined[39m
    }
  }
}
[1A[2K[chromium] › src\tests\e2e\end2end_download_authentication_1.spec.ts:87:7 › End-to-End Download Test Suite - Part 1: Login Authentication › should successfully login with admin credentials
Login test failed: page.waitForLoadState: Timeout 15000ms exceeded.
    at waitForPageLoad [90m(Q:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:32:14[90m)[39m
    at [90mQ:\_kyle\temp_documents\GitHub\business_scraper\[39msrc\tests\e2e\end2end_download_authentication_1.spec.ts:103:15 {
  name: [32m'TimeoutError'[39m,
  [[32mSymbol(step)[39m]: {
    location: {
      file: [32m'Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts'[39m,
      line: [33m32[39m,
      column: [33m14[39m,
      function: [32m'waitForPageLoad'[39m
    },
    category: [32m'pw:api'[39m,
    title: [32m'Wait for load state "networkidle"'[39m,
    apiName: [32m'page.waitForLoadState'[39m,
    params: { info: [36m[Object][39m },
    group: [90mundefined[39m,
    stepId: [32m'pw:api@35'[39m,
    boxedStack: [90mundefined[39m,
    steps: [],
    attachmentIndices: [],
    info: TestStepInfoImpl {
      annotations: [],
      _testInfo: [36m[TestInfoImpl][39m,
      _stepId: [32m'pw:api@35'[39m,
      _title: [32m'Wait for load state "networkidle"'[39m,
      _parentStep: [90mundefined[39m,
      skip: [36m[Function (anonymous)][39m
    },
    recoverFromStepError: [36m[AsyncFunction: recoverFromStepError][39m,
    complete: [36m[Function: complete][39m,
    endWallTime: [33m1758757558409[39m,
    error: {
      message: [32m'TimeoutError: page.waitForLoadState: Timeout 15000ms exceeded.'[39m,
      stack: [32m'TimeoutError: page.waitForLoadState: Timeout 15000ms exceeded.\n'[39m +
        [32m'    at waitForPageLoad (Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:32:14)\n'[39m +
        [32m'    at Q:\\_kyle\\temp_documents\\GitHub\\business_scraper\\src\\tests\\e2e\\end2end_download_authentication_1.spec.ts:103:15'[39m,
      cause: [90mundefined[39m
    }
  }
}

```

### System Tests

**Error:** Command failed: npm run test:comprehensive


### Regression Tests

**Error:** Command failed: npm run test:regression:comprehensive
FAIL src/tests/regression/comprehensive/featureRegression.test.ts
  Feature Regression Comprehensive Tests
    Core Business Search Functionality
      × should maintain search functionality across versions (8 ms)
    Web Scraping Functionality
      × should maintain scraping functionality across versions (3 ms)
    Data Processing and Validation
      × should maintain data processing consistency (7 ms)
    API Endpoint Consistency
      √ should maintain API contract consistency (6 ms)
    Performance Regression
      × should maintain performance benchmarks (2 ms)
    Backward Compatibility
      √ should maintain backward compatibility (2 ms)
    Regression Test Summary
      × should provide comprehensive regression test coverage (1 ms)

  ● Feature Regression Comprehensive Tests › Core Business Search Functionality › should maintain search functionality across versions

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

    [0m [90m 203 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m regressionSuite[33m.[39mrunAllTests()
     [90m 204 |[39m
    [31m[1m>[22m[39m[90m 205 |[39m       expect(results[33m.[39mcritical)[33m.[39mtoBe([35m0[39m) [90m// No critical failures allowed[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 206 |[39m       expect(results[33m.[39mpassed)[33m.[39mtoBeGreaterThan(results[33m.[39mfailed)
     [90m 207 |[39m     })
     [90m 208 |[39m   })[0m

      at Object.toBe (src/tests/regression/comprehensive/featureRegression.test.ts:205:32)

  ● Feature Regression Comprehensive Tests › Web Scraping Functionality › should maintain scraping functionality across versions

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

    [0m [90m 291 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m regressionSuite[33m.[39mrunAllTests()
     [90m 292 |[39m
    [31m[1m>[22m[39m[90m 293 |[39m       expect(results[33m.[39mcritical)[33m.[39mtoBe([35m0[39m)
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 294 |[39m       expect(results[33m.[39mpassed)[33m.[39mtoBeGreaterThan(results[33m.[39mfailed)
     [90m 295 |[39m     })
     [90m 296 |[39m   })[0m

      at Object.toBe (src/tests/regression/comprehensive/featureRegression.test.ts:293:32)

  ● Feature Regression Comprehensive Tests › Data Processing and Validation › should maintain data processing consistency

    expect(received).toBeGreaterThan(expected)

    Expected: > 1
    Received:   1

    [0m [90m 367 |[39m
     [90m 368 |[39m       expect(results[33m.[39mcritical)[33m.[39mtoBe([35m0[39m)
    [31m[1m>[22m[39m[90m 369 |[39m       expect(results[33m.[39mpassed)[33m.[39mtoBeGreaterThan(results[33m.[39mfailed)
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 370 |[39m     })
     [90m 371 |[39m   })
     [90m 372 |[39m[0m

      at Object.toBeGreaterThan (src/tests/regression/comprehensive/featureRegression.test.ts:369:30)

  ● Feature Regression Comprehensive Tests › Performance Regression › should maintain performance benchmarks

    expect(received).toBeGreaterThan(expected)

    Expected: > 2
    Received:   0

    [0m [90m 494 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m regressionSuite[33m.[39mrunAllTests()
     [90m 495 |[39m
    [31m[1m>[22m[39m[90m 496 |[39m       expect(results[33m.[39mpassed)[33m.[39mtoBeGreaterThan(results[33m.[39mfailed)
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 497 |[39m     })
     [90m 498 |[39m   })
     [90m 499 |[39m[0m

      at Object.toBeGreaterThan (src/tests/regression/comprehensive/featureRegression.test.ts:496:30)

  ● Feature Regression Comprehensive Tests › Regression Test Summary › should provide comprehensive regression test coverage

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 0.9
    Received:    NaN

    [0m [90m 567 |[39m       [90m// At least 90% of tests should pass[39m
     [90m 568 |[39m       [36mconst[39m successRate [33m=[39m allResults[33m.[39mpassed [33m/[39m (allResults[33m.[39mpassed [33m+[39m allResults[33m.[39mfailed)
    [31m[1m>[22m[39m[90m 569 |[39m       expect(successRate)[33m.[39mtoBeGreaterThanOrEqual([35m0.9[39m)
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 570 |[39m
     [90m 571 |[39m       [90m// Should have comprehensive test coverage[39m
     [90m 572 |[39m       expect(allResults[33m.[39mpassed [33m+[39m allResults[33m.[39mfailed)[33m.[39mtoBeGreaterThan([35m10[39m)[0m

      at Object.toBeGreaterThanOrEqual (src/tests/regression/comprehensive/featureRegression.test.ts:569:27)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 2 passed, 7 total
Snapshots:   0 total
Time:        1.961 s, estimated 2 s
Ran all test suites matching /regression\\comprehensive/i.


**stderr:**
```
FAIL src/tests/regression/comprehensive/featureRegression.test.ts
  Feature Regression Comprehensive Tests
    Core Business Search Functionality
      × should maintain search functionality across versions (8 ms)
    Web Scraping Functionality
      × should maintain scraping functionality across versions (3 ms)
    Data Processing and Validation
      × should maintain data processing consistency (7 ms)
    API Endpoint Consistency
      √ should maintain API contract consistency (6 ms)
    Performance Regression
      × should maintain performance benchmarks (2 ms)
    Backward Compatibility
      √ should maintain backward compatibility (2 ms)
    Regression Test Summary
      × should provide comprehensive regression test coverage (1 ms)

  ● Feature Regression Comprehensive Tests › Core Business Search Functionality › should maintain search functionality across versions

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

    [0m [90m 203 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m regressionSuite[33m.[39mrunAllTests()
     [90m 204 |[39m
    [31m[1m>[22m[39m[90m 205 |[39m       expect(results[33m.[39mcritical)[33m.[39mtoBe([35m0[39m) [90m// No critical failures allowed[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 206 |[39m       expect(results[33m.[39mpassed)[33m.[39mtoBeGreaterThan(results[33m.[39mfailed)
     [90m 207 |[39m     })
     [90m 208 |[39m   })[0m

      at Object.toBe (src/tests/regression/comprehensive/featureRegression.test.ts:205:32)

  ● Feature Regression Comprehensive Tests › Web Scraping Functionality › should maintain scraping functionality across versions

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

    [0m [90m 291 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m regressionSuite[33m.[39mrunAllTests()
     [90m 292 |[39m
    [31m[1m>[22m[39m[90m 293 |[39m       expect(results[33m.[39mcritical)[33m.[39mtoBe([35m0[39m)
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 294 |[39m       expect(results[33m.[39mpassed)[33m.[39mtoBeGreaterThan(results[33m.[39mfailed)
     [90m 295 |[39m     })
     [90m 296 |[39m   })[0m

      at Object.toBe (src/tests/regression/comprehensive/featureRegression.test.ts:293:32)

  ● Feature Regression Comprehensive Tests › Data Processing and Validation › should maintain data processing consistency

    expect(received).toBeGreaterThan(expected)

    Expected: > 1
    Received:   1

    [0m [90m 367 |[39m
     [90m 368 |[39m       expect(results[33m.[39mcritical)[33m.[39mtoBe([35m0[39m)
    [31m[1m>[22m[39m[90m 369 |[39m       expect(results[33m.[39mpassed)[33m.[39mtoBeGreaterThan(results[33m.[39mfailed)
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 370 |[39m     })
     [90m 371 |[39m   })
     [90m 372 |[39m[0m

      at Object.toBeGreaterThan (src/tests/regression/comprehensive/featureRegression.test.ts:369:30)

  ● Feature Regression Comprehensive Tests › Performance Regression › should maintain performance benchmarks

    expect(received).toBeGreaterThan(expected)

    Expected: > 2
    Received:   0

    [0m [90m 494 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m regressionSuite[33m.[39mrunAllTests()
     [90m 495 |[39m
    [31m[1m>[22m[39m[90m 496 |[39m       expect(results[33m.[39mpassed)[33m.[39mtoBeGreaterThan(results[33m.[39mfailed)
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 497 |[39m     })
     [90m 498 |[39m   })
     [90m 499 |[39m[0m

      at Object.toBeGreaterThan (src/tests/regression/comprehensive/featureRegression.test.ts:496:30)

  ● Feature Regression Comprehensive Tests › Regression Test Summary › should provide comprehensive regression test coverage

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 0.9
    Received:    NaN

    [0m [90m 567 |[39m       [90m// At least 90% of tests should pass[39m
     [90m 568 |[39m       [36mconst[39m successRate [33m=[39m allResults[33m.[39mpassed [33m/[39m (allResults[33m.[39mpassed [33m+[39m allResults[33m.[39mfailed)
    [31m[1m>[22m[39m[90m 569 |[39m       expect(successRate)[33m.[39mtoBeGreaterThanOrEqual([35m0.9[39m)
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 570 |[39m
     [90m 571 |[39m       [90m// Should have comprehensive test coverage[39m
     [90m 572 |[39m       expect(allResults[33m.[39mpassed [33m+[39m allResults[33m.[39mfailed)[33m.[39mtoBeGreaterThan([35m10[39m)[0m

      at Object.toBeGreaterThanOrEqual (src/tests/regression/comprehensive/featureRegression.test.ts:569:27)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 2 passed, 7 total
Snapshots:   0 total
Time:        1.961 s, estimated 2 s
Ran all test suites matching /regression\\comprehensive/i.

```

### Acceptance Tests

**Error:** Command failed: npm run test:acceptance:comprehensive


### Performance Tests

**Error:** Command failed: npm run test:performance
FAIL src/tests/performance/performanceRegression.test.ts (49.55 s)
  Performance Regression Testing
    Scraper Service Performance
      × single website scraping performance (580 ms)
      × multiple website scraping performance (381 ms)
      √ enhanced scraping engine performance (42 ms)
    Client Scraper Service Performance
      × website search performance (30318 ms)
      √ client website scraping performance (10 ms)
    Memory Leak Detection
      √ should not leak memory during repeated operations (13471 ms)
      √ should clean up resources properly (21 ms)
    Baseline Comparison
      × should compare against historical baselines (1803 ms)

  ● Performance Regression Testing › Scraper Service Performance › single website scraping performance

    ws does not work in the browser. Browser clients must use the native WebSocket object

    [0m [90m 110 |[39m
     [90m 111 |[39m     [36mtry[39m {
    [31m[1m>[22m[39m[90m 112 |[39m       [36mthis[39m[33m.[39mbrowser [33m=[39m [36mawait[39m puppeteer[33m.[39mlaunch({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 113 |[39m         headless[33m:[39m [36mthis[39m[33m.[39mconfig[33m.[39mheadless[33m,[39m
     [90m 114 |[39m         args[33m:[39m [
     [90m 115 |[39m           [32m'--no-sandbox'[39m[33m,[39m[0m

      at new Object.<anonymous>.module.exports (node_modules/ws/browser.js:4:9)
      at node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:20:18
      at Function.create (node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:19:12)
      at ChromeLauncher.createCdpSocketConnection (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:306:48)
      at ChromeLauncher.launch (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:172:27)
      at ScraperService.initialize (src/model/scraperService.ts:112:22)
      at ScraperService.scrapeWebsite (src/model/scraperService.ts:204:7)
      at PerformanceMonitor.measurePerformance (src/tests/performance/performanceRegression.test.ts:72:16)
      at Object.<anonymous> (src/tests/performance/performanceRegression.test.ts:199:35)

  ● Performance Regression Testing › Scraper Service Performance › multiple website scraping performance

    ws does not work in the browser. Browser clients must use the native WebSocket object

    [0m [90m 110 |[39m
     [90m 111 |[39m     [36mtry[39m {
    [31m[1m>[22m[39m[90m 112 |[39m       [36mthis[39m[33m.[39mbrowser [33m=[39m [36mawait[39m puppeteer[33m.[39mlaunch({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 113 |[39m         headless[33m:[39m [36mthis[39m[33m.[39mconfig[33m.[39mheadless[33m,[39m
     [90m 114 |[39m         args[33m:[39m [
     [90m 115 |[39m           [32m'--no-sandbox'[39m[33m,[39m[0m

      at new Object.<anonymous>.module.exports (node_modules/ws/browser.js:4:9)
      at node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:20:18
      at Function.create (node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:19:12)
      at ChromeLauncher.createCdpSocketConnection (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:306:48)
      at ChromeLauncher.launch (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:172:27)
      at ScraperService.initialize (src/model/scraperService.ts:112:22)
      at ScraperService.scrapeWebsite (src/model/scraperService.ts:204:7)
      at src/tests/performance/performanceRegression.test.ts:218:32
      at PerformanceMonitor.measurePerformance (src/tests/performance/performanceRegression.test.ts:72:16)
      at Object.<anonymous> (src/tests/performance/performanceRegression.test.ts:213:35)

  ● Performance Regression Testing › Client Scraper Service Performance › website search performance

    EBUSY: resource busy or locked, unlink 'C:\Users\kyle\AppData\Local\Temp\puppeteer_dev_chrome_profile-hfoXoQ\first_party_sets.db'



  ● Performance Regression Testing › Client Scraper Service Performance › website search performance

    EBUSY: resource busy or locked, unlink 'C:\Users\kyle\AppData\Local\Temp\puppeteer_dev_chrome_profile-9TMaLP\first_party_sets.db'



  ● Performance Regression Testing › Client Scraper Service Performance › website search performance

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 246 |[39m
     [90m 247 |[39m   describe([32m'Client Scraper Service Performance'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 248 |[39m     test([32m'website search performance'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 249 |[39m       [36mconst[39m { result[33m,[39m metrics } [33m=[39m [36mawait[39m performanceMonitor[33m.[39mmeasurePerformance(
     [90m 250 |[39m         [32m'website-search'[39m[33m,[39m
     [90m 251 |[39m         () [33m=>[39m clientScraperService[33m.[39msearchForWebsites([32m'restaurants'[39m[33m,[39m [32m'12345'[39m[33m,[39m [35m10[39m)[0m

      at test (src/tests/performance/performanceRegression.test.ts:248:5)
      at describe (src/tests/performance/performanceRegression.test.ts:247:3)
      at Object.describe (src/tests/performance/performanceRegression.test.ts:180:1)

  ● Performance Regression Testing › Baseline Comparison › should compare against historical baselines

    ws does not work in the browser. Browser clients must use the native WebSocket object

    [0m [90m 110 |[39m
     [90m 111 |[39m     [36mtry[39m {
    [31m[1m>[22m[39m[90m 112 |[39m       [36mthis[39m[33m.[39mbrowser [33m=[39m [36mawait[39m puppeteer[33m.[39mlaunch({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 113 |[39m         headless[33m:[39m [36mthis[39m[33m.[39mconfig[33m.[39mheadless[33m,[39m
     [90m 114 |[39m         args[33m:[39m [
     [90m 115 |[39m           [32m'--no-sandbox'[39m[33m,[39m[0m

      at new Object.<anonymous>.module.exports (node_modules/ws/browser.js:4:9)
      at node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:20:18
      at Function.create (node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:19:12)
      at ChromeLauncher.createCdpSocketConnection (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:306:48)
      at ChromeLauncher.launch (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:172:27)
      at ScraperService.initialize (src/model/scraperService.ts:112:22)
      at ScraperService.scrapeWebsite (src/model/scraperService.ts:204:7)
      at PerformanceMonitor.measurePerformance (src/tests/performance/performanceRegression.test.ts:72:16)
      at Object.<anonymous> (src/tests/performance/performanceRegression.test.ts:319:27)



**stderr:**
```
FAIL src/tests/performance/performanceRegression.test.ts (49.55 s)
  Performance Regression Testing
    Scraper Service Performance
      × single website scraping performance (580 ms)
      × multiple website scraping performance (381 ms)
      √ enhanced scraping engine performance (42 ms)
    Client Scraper Service Performance
      × website search performance (30318 ms)
      √ client website scraping performance (10 ms)
    Memory Leak Detection
      √ should not leak memory during repeated operations (13471 ms)
      √ should clean up resources properly (21 ms)
    Baseline Comparison
      × should compare against historical baselines (1803 ms)

  ● Performance Regression Testing › Scraper Service Performance › single website scraping performance

    ws does not work in the browser. Browser clients must use the native WebSocket object

    [0m [90m 110 |[39m
     [90m 111 |[39m     [36mtry[39m {
    [31m[1m>[22m[39m[90m 112 |[39m       [36mthis[39m[33m.[39mbrowser [33m=[39m [36mawait[39m puppeteer[33m.[39mlaunch({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 113 |[39m         headless[33m:[39m [36mthis[39m[33m.[39mconfig[33m.[39mheadless[33m,[39m
     [90m 114 |[39m         args[33m:[39m [
     [90m 115 |[39m           [32m'--no-sandbox'[39m[33m,[39m[0m

      at new Object.<anonymous>.module.exports (node_modules/ws/browser.js:4:9)
      at node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:20:18
      at Function.create (node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:19:12)
      at ChromeLauncher.createCdpSocketConnection (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:306:48)
      at ChromeLauncher.launch (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:172:27)
      at ScraperService.initialize (src/model/scraperService.ts:112:22)
      at ScraperService.scrapeWebsite (src/model/scraperService.ts:204:7)
      at PerformanceMonitor.measurePerformance (src/tests/performance/performanceRegression.test.ts:72:16)
      at Object.<anonymous> (src/tests/performance/performanceRegression.test.ts:199:35)

  ● Performance Regression Testing › Scraper Service Performance › multiple website scraping performance

    ws does not work in the browser. Browser clients must use the native WebSocket object

    [0m [90m 110 |[39m
     [90m 111 |[39m     [36mtry[39m {
    [31m[1m>[22m[39m[90m 112 |[39m       [36mthis[39m[33m.[39mbrowser [33m=[39m [36mawait[39m puppeteer[33m.[39mlaunch({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 113 |[39m         headless[33m:[39m [36mthis[39m[33m.[39mconfig[33m.[39mheadless[33m,[39m
     [90m 114 |[39m         args[33m:[39m [
     [90m 115 |[39m           [32m'--no-sandbox'[39m[33m,[39m[0m

      at new Object.<anonymous>.module.exports (node_modules/ws/browser.js:4:9)
      at node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:20:18
      at Function.create (node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:19:12)
      at ChromeLauncher.createCdpSocketConnection (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:306:48)
      at ChromeLauncher.launch (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:172:27)
      at ScraperService.initialize (src/model/scraperService.ts:112:22)
      at ScraperService.scrapeWebsite (src/model/scraperService.ts:204:7)
      at src/tests/performance/performanceRegression.test.ts:218:32
      at PerformanceMonitor.measurePerformance (src/tests/performance/performanceRegression.test.ts:72:16)
      at Object.<anonymous> (src/tests/performance/performanceRegression.test.ts:213:35)

  ● Performance Regression Testing › Client Scraper Service Performance › website search performance

    EBUSY: resource busy or locked, unlink 'C:\Users\kyle\AppData\Local\Temp\puppeteer_dev_chrome_profile-hfoXoQ\first_party_sets.db'



  ● Performance Regression Testing › Client Scraper Service Performance › website search performance

    EBUSY: resource busy or locked, unlink 'C:\Users\kyle\AppData\Local\Temp\puppeteer_dev_chrome_profile-9TMaLP\first_party_sets.db'



  ● Performance Regression Testing › Client Scraper Service Performance › website search performance

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 246 |[39m
     [90m 247 |[39m   describe([32m'Client Scraper Service Performance'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 248 |[39m     test([32m'website search performance'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 249 |[39m       [36mconst[39m { result[33m,[39m metrics } [33m=[39m [36mawait[39m performanceMonitor[33m.[39mmeasurePerformance(
     [90m 250 |[39m         [32m'website-search'[39m[33m,[39m
     [90m 251 |[39m         () [33m=>[39m clientScraperService[33m.[39msearchForWebsites([32m'restaurants'[39m[33m,[39m [32m'12345'[39m[33m,[39m [35m10[39m)[0m

      at test (src/tests/performance/performanceRegression.test.ts:248:5)
      at describe (src/tests/performance/performanceRegression.test.ts:247:3)
      at Object.describe (src/tests/performance/performanceRegression.test.ts:180:1)

  ● Performance Regression Testing › Baseline Comparison › should compare against historical baselines

    ws does not work in the browser. Browser clients must use the native WebSocket object

    [0m [90m 110 |[39m
     [90m 111 |[39m     [36mtry[39m {
    [31m[1m>[22m[39m[90m 112 |[39m       [36mthis[39m[33m.[39mbrowser [33m=[39m [36mawait[39m puppeteer[33m.[39mlaunch({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 113 |[39m         headless[33m:[39m [36mthis[39m[33m.[39mconfig[33m.[39mheadless[33m,[39m
     [90m 114 |[39m         args[33m:[39m [
     [90m 115 |[39m           [32m'--no-sandbox'[39m[33m,[39m[0m

      at new Object.<anonymous>.module.exports (node_modules/ws/browser.js:4:9)
      at node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:20:18
      at Function.create (node_modules/puppeteer/node_modules/puppeteer-core/src/node/NodeWebSocketTransport.ts:19:12)
      at ChromeLauncher.createCdpSocketConnection (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:306:48)
      at ChromeLauncher.launch (node_modules/puppeteer/node_modules/puppeteer-core/src/node/ProductLauncher.ts:172:27)
      at ScraperService.initialize (src/model/scraperService.ts:112:22)
      at ScraperService.scrapeWebsite (src/model/scraperService.ts:204:7)
      at PerformanceMonitor.measurePerformance (src/tests/performance/performanceRegression.test.ts:72:16)
      at Object.<anonymous> (src/tests/performance/performanceRegression.test.ts:319:27)


```

### Security Tests

**Error:** Command failed: npm run test:security
FAIL src/__tests__/fileUploadSecurity.test.ts (6.314 s)
  File Upload Security
    File Validation
      √ should validate file size limits (1119 ms)
      √ should validate file types (7 ms)
      √ should validate file extensions (10 ms)
      √ should detect path traversal attempts (11 ms)
      √ should detect null bytes in filename (11 ms)
      √ should validate empty files (8 ms)
      √ should accept valid files (14 ms)
    Magic Number Validation
      √ should validate JPEG magic numbers (18 ms)
      × should detect mismatched file types (31 ms)
      √ should detect embedded executables (16 ms)
    Content Analysis
      √ should detect script injection patterns (13 ms)
      √ should detect command execution patterns (18 ms)
      × should detect high entropy content (11 ms)
      × should detect multiple base64 strings (9 ms)
    Quarantine Functionality
      √ should quarantine malicious files (156 ms)
      √ should not quarantine safe files (9 ms)
    Hash Checking
      × should detect known malware hashes (11 ms)
    Filename Security
      × should generate secure filenames (14 ms)
      × should preserve file extensions (13 ms)
      √ should handle long filenames (6 ms)
      √ should remove invalid characters (7 ms)
    Performance and Limits
      √ should handle scan timeout (165 ms)
      √ should limit content analysis to reasonable size (182 ms)
    Integration with Validation Service
      √ should integrate with existing validation service (9 ms)
      √ should handle malware scanning integration (309 ms)

  ● File Upload Security › Magic Number Validation › should detect mismatched file types

    expect(received).toContain(expected) // indexOf

    Expected value: "File content doesn't match expected type for .jpg"
    Received array: []

    [0m [90m 129 |[39m       })
     [90m 130 |[39m
    [31m[1m>[22m[39m[90m 131 |[39m       expect(result[33m.[39mwarnings)[33m.[39mtoContain([32m"File content doesn't match expected type for .jpg"[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 132 |[39m     })
     [90m 133 |[39m
     [90m 134 |[39m     test([32m'should detect embedded executables'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/__tests__/fileUploadSecurity.test.ts:131:31)

  ● File Upload Security › Content Analysis › should detect high entropy content

    expect(received).toContain(expected) // indexOf

    Expected value: "File has high entropy - possible obfuscation or encryption"
    Received array: []

    [0m [90m 175 |[39m       })
     [90m 176 |[39m
    [31m[1m>[22m[39m[90m 177 |[39m       expect(result[33m.[39mwarnings)[33m.[39mtoContain(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 178 |[39m         [32m'File has high entropy - possible obfuscation or encryption'[39m
     [90m 179 |[39m       )
     [90m 180 |[39m     })[0m

      at Object.toContain (src/__tests__/fileUploadSecurity.test.ts:177:31)

  ● File Upload Security › Content Analysis › should detect multiple base64 strings

    expect(received).toContain(expected) // indexOf

    Expected value: "File contains multiple base64 encoded strings"
    Received array: []

    [0m [90m 187 |[39m       })
     [90m 188 |[39m
    [31m[1m>[22m[39m[90m 189 |[39m       expect(result[33m.[39mwarnings)[33m.[39mtoContain([32m'File contains multiple base64 encoded strings'[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 190 |[39m     })
     [90m 191 |[39m   })
     [90m 192 |[39m[0m

      at Object.toContain (src/__tests__/fileUploadSecurity.test.ts:189:31)

  ● File Upload Security › Hash Checking › should detect known malware hashes

    expect(received).toContain(expected) // indexOf

    Expected value: "File matches known malware signature"
    Received array: ["File extension '.exe' is not allowed", "File type 'application/octet-stream' is not allowed", "Executable files are not allowed"]

    [0m [90m 230 |[39m
     [90m 231 |[39m       expect(result[33m.[39misSecure)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 232 |[39m       expect(result[33m.[39mthreats)[33m.[39mtoContain([32m'File matches known malware signature'[39m)
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 233 |[39m     })
     [90m 234 |[39m   })
     [90m 235 |[39m[0m

      at Object.toContain (src/__tests__/fileUploadSecurity.test.ts:232:30)

  ● File Upload Security › Filename Security › should generate secure filenames

    expect(received).toMatch(expected)

    Expected pattern: /^[a-zA-Z0-9._-]+_\d+$/
    Received string:  "_1758758076161passwd"

    [0m [90m 241 |[39m       expect(secureName)[33m.[39mnot[33m.[39mtoContain([32m'../'[39m)
     [90m 242 |[39m       expect(secureName)[33m.[39mnot[33m.[39mtoContain([32m'/'[39m)
    [31m[1m>[22m[39m[90m 243 |[39m       expect(secureName)[33m.[39mtoMatch([35m/^[a-zA-Z0-9._-]+_\d+$/[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 244 |[39m     })
     [90m 245 |[39m
     [90m 246 |[39m     test([32m'should preserve file extensions'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toMatch (src/__tests__/fileUploadSecurity.test.ts:243:26)

  ● File Upload Security › Filename Security › should preserve file extensions

    TypeError: expect(...).toEndWith is not a function

    [0m [90m 248 |[39m       [36mconst[39m secureName [33m=[39m generateSecureFilename(filename[33m,[39m [36mtrue[39m)
     [90m 249 |[39m
    [31m[1m>[22m[39m[90m 250 |[39m       expect(secureName)[33m.[39mtoEndWith([32m'.pdf'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 251 |[39m     })
     [90m 252 |[39m
     [90m 253 |[39m     test([32m'should handle long filenames'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toEndWith (src/__tests__/fileUploadSecurity.test.ts:250:26)

FAIL src/__tests__/security/paymentSecurity.test.ts
  Payment Security Middleware
    paymentRateLimit
      √ should allow requests within rate limit (14 ms)
      √ should block requests exceeding rate limit (9 ms)
      √ should handle rate limit service errors gracefully (15 ms)
      √ should use different limits for different types (20 ms)
    validateWebhookSignature
      √ should validate correct webhook signature (9 ms)
      √ should reject invalid webhook signature (5 ms)
      √ should handle Stripe signature format with v1= prefix (3 ms)
      √ should handle missing parameters (3 ms)
      × should handle signature validation errors (6 ms)
    sanitizePaymentData
      √ should remove sensitive payment fields (14 ms)
      √ should handle nested objects (13 ms)
      √ should handle arrays (5 ms)
      √ should handle non-object inputs (6 ms)
    validatePaymentCSRFToken
      × should validate CSRF token successfully (9 ms)
      √ should reject invalid CSRF token (5 ms)
      × should handle missing session ID (6 ms)
      √ should handle CSRF validation errors (7 ms)
    validateWebhookIP
      √ should allow requests from Stripe IPs (8 ms)
      √ should block requests from unauthorized IPs (4 ms)
      √ should handle missing client IP (4 ms)
      √ should handle IP validation errors (5 ms)
    withPaymentSecurity
      × should apply all security checks for POST requests (7 ms)
      √ should block requests that fail rate limiting (10 ms)
      √ should block requests that fail CSRF validation (4 ms)
      √ should skip CSRF for GET requests (5 ms)
      √ should handle middleware errors gracefully (7 ms)
    withStripeWebhookSecurity
      × should validate webhook signature and allow valid requests (17 ms)
      √ should reject requests with invalid signatures (4 ms)
      √ should reject requests without signature header (3 ms)

  ● Payment Security Middleware › validateWebhookSignature › should handle signature validation errors

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "PaymentSecurity", "Webhook signature validation failed", Any<Error>
    Received: "PaymentSecurity", "Webhook signature validation failed", [RangeError: Input buffers must have the same byte length]

    Number of calls: 1

    [0m [90m 146 |[39m       [36mconst[39m result [33m=[39m validateWebhookSignature(testPayload[33m,[39m [32m'malformed_hex'[39m[33m,[39m testSecret)
     [90m 147 |[39m       expect(result)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 148 |[39m       expect(mockLogger[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 149 |[39m         [32m'PaymentSecurity'[39m[33m,[39m
     [90m 150 |[39m         [32m'Webhook signature validation failed'[39m[33m,[39m
     [90m 151 |[39m         expect[33m.[39many([33mError[39m)[0m

      at Object.toHaveBeenCalledWith (src/__tests__/security/paymentSecurity.test.ts:148:32)

  ● Payment Security Middleware › validatePaymentCSRFToken › should validate CSRF token successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_bodyUsed": false, "body": undefined, "cookies": {"delete": [Function mockConstructor], "get": [Function mockConstructor], "getAll": [Function mockConstructor], "has": [Function mockConstructor], "set": [Function mockConstructor]}, "headers": {}, "method": "POST", "nextUrl": "https://example.com/api/payment", "url": "https://example.com/api/payment", Symbol(internal request): {"cookies": {"_headers": {}, "_parsed": Map {"session-id" => {"name": "session-id", "value": "test-session"}}}, "geo": {}, "ip": undefined, "nextUrl": "https://example.com/api/payment", "url": "https://example.com/api/payment"}},
    - "test-session",
    + "mock-session-id",

    Number of calls: 1

    [0m [90m 240 |[39m
     [90m 241 |[39m       expect(result)[33m.[39mtoBe([36mtrue[39m)
    [31m[1m>[22m[39m[90m 242 |[39m       expect(mockCsrfProtectionService[33m.[39mvalidateFormSubmission)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                                [31m[1m^[22m[39m
     [90m 243 |[39m         request[33m,[39m
     [90m 244 |[39m         [32m'test-session'[39m
     [90m 245 |[39m       )[0m

      at Object.toHaveBeenCalledWith (src/__tests__/security/paymentSecurity.test.ts:242:64)

  ● Payment Security Middleware › validatePaymentCSRFToken › should handle missing session ID

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "PaymentSecurity", "No session ID found for CSRF validation"

    Number of calls: 0

    [0m [90m 274 |[39m
     [90m 275 |[39m       expect(result)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 276 |[39m       expect(mockLogger[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 277 |[39m         [32m'PaymentSecurity'[39m[33m,[39m
     [90m 278 |[39m         [32m'No session ID found for CSRF validation'[39m
     [90m 279 |[39m       )[0m

      at Object.toHaveBeenCalledWith (src/__tests__/security/paymentSecurity.test.ts:276:31)

  ● Payment Security Middleware › withPaymentSecurity › should apply all security checks for POST requests

    TypeError: Cannot read properties of undefined (reading 'status')

    [0m [90m 381 |[39m       expect(mockCsrfProtectionService[33m.[39mvalidateFormSubmission)[33m.[39mtoHaveBeenCalled()
     [90m 382 |[39m       expect(mockHandler)[33m.[39mtoHaveBeenCalled()
    [31m[1m>[22m[39m[90m 383 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 384 |[39m     })
     [90m 385 |[39m
     [90m 386 |[39m     it([32m'should block requests that fail rate limiting'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.status (src/__tests__/security/paymentSecurity.test.ts:383:23)

  ● Payment Security Middleware › withStripeWebhookSecurity › should validate webhook signature and allow valid requests

    TypeError: Cannot read properties of undefined (reading 'status')

    [0m [90m 478 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m securedHandler(request)
     [90m 479 |[39m
    [31m[1m>[22m[39m[90m 480 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 481 |[39m       expect(mockHandler)[33m.[39mtoHaveBeenCalled()
     [90m 482 |[39m     })
     [90m 483 |[39m[0m

      at Object.status (src/__tests__/security/paymentSecurity.test.ts:480:23)

FAIL src/__tests__/databaseSecurity.test.ts
  Database Security Service
    SQL Injection Detection
      √ should detect basic SQL injection patterns (20 ms)
      √ should allow safe parameterized queries (6 ms)
      √ should detect dangerous keywords (28 ms)
      √ should validate query length limits (4 ms)
    Parameter Validation
      √ should validate safe parameters (3 ms)
      √ should detect malicious parameters (5 ms)
      √ should handle null and undefined parameters (3 ms)
      × should warn about long parameters (4 ms)
    Query Sanitization
      √ should sanitize queries by removing comments (5 ms)
      √ should normalize whitespace (2 ms)
    Security Statistics
      √ should track suspicious query attempts (3 ms)
      √ should reset security counters (9 ms)
    Utility Functions
      √ should escape SQL identifiers (3 ms)
      √ should reject invalid identifiers (13 ms)
      √ should generate secure IDs (6 ms)
      √ should hash and verify sensitive data (472 ms)
  Secure Database Wrapper
    Query Execution
      × should execute safe queries successfully (6 ms)
      × should reject malicious queries (1 ms)
      × should handle query timeouts (2 ms)
      × should retry on retryable errors (1 ms)
    Transaction Support
      × should execute transactions successfully (1 ms)
      × should rollback on transaction errors (1 ms)
    Prepared Statements
      × should execute prepared statements (1 ms)
    Connection Pool Management
      × should provide pool statistics (2 ms)
      × should close connections properly (1 ms)
    Query Caching
      × should cache SELECT query results (1 ms)
      × should clear cache when requested (2 ms)

  ● Database Security Service › Parameter Validation › should warn about long parameters

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 145 |[39m       ])
     [90m 146 |[39m
    [31m[1m>[22m[39m[90m 147 |[39m       expect(result[33m.[39mwarnings[33m.[39msome(w [33m=>[39m w[33m.[39mincludes([32m'unusually long'[39m)))[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                                                                       [31m[1m^[22m[39m
     [90m 148 |[39m     })
     [90m 149 |[39m   })
     [90m 150 |[39m[0m

      at Object.toBe (src/__tests__/databaseSecurity.test.ts:147:71)

  ● Secure Database Wrapper › Query Execution › should execute safe queries successfully

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Execution › should reject malicious queries

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Execution › should handle query timeouts

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Execution › should retry on retryable errors

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Transaction Support › should execute transactions successfully

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Transaction Support › should rollback on transaction errors

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Prepared Statements › should execute prepared statements

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Connection Pool Management › should provide pool statistics

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Connection Pool Management › should close connections properly

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Caching › should cache SELECT query results

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Caching › should clear cache when requested

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

FAIL src/__tests__/lib/security.test.ts
  Security System
    generateSecureToken
      √ should generate a token of specified length (2 ms)
      √ should generate different tokens each time (2 ms)
      √ should use default length when not specified (2 ms)
    Password hashing
      × should hash a password with salt (2 ms)
      × should use provided salt (4 ms)
      × should generate different hashes for different passwords (3 ms)
      × should generate same hash for same password and salt (2 ms)
    Password verification
      × should verify correct password (1 ms)
      × should reject incorrect password (1 ms)
      × should be timing-safe (2 ms)
    Data encryption
      × should encrypt and decrypt data (2 ms)
      × should produce different encrypted output each time (1 ms)
      × should fail with wrong key (1 ms)
    Session management
      √ should create a session (5 ms)
      √ should retrieve a session (3 ms)
      √ should return null for non-existent session (3 ms)
      √ should invalidate a session (4 ms)
      √ should update last accessed time (8 ms)
    Rate limiting
      √ should allow requests within limit (2 ms)
      √ should block requests exceeding limit (5 ms)
      √ should reset after time window (1 ms)
    Login attempt tracking
      √ should track successful login (2 ms)
      √ should track failed login attempts (2 ms)
      √ should lock account after max attempts (5 ms)
      √ should clear attempts on successful login (4 ms)
    Input sanitization
      √ should remove script tags (5 ms)
      √ should escape HTML entities (7 ms)
      √ should remove javascript: URLs (2 ms)
      √ should remove event handlers (1 ms)
      √ should trim whitespace (2 ms)
    Input validation
      √ should pass safe input (3 ms)
      √ should detect SQL injection (4 ms)
      √ should detect XSS attempts (3 ms)
      √ should detect path traversal (2 ms)
    Client IP extraction
      √ should extract IP from x-forwarded-for header (4 ms)
      √ should extract IP from x-real-ip header (6 ms)
      √ should fallback to request.ip (5 ms)
      √ should return unknown when no IP available (3 ms)

  ● Security System › Password hashing › should hash a password with salt

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:52:40)

  ● Security System › Password hashing › should use provided salt

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:62:40)

  ● Security System › Password hashing › should generate different hashes for different passwords

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:68:41)

  ● Security System › Password hashing › should generate same hash for same password and salt

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:76:41)

  ● Security System › Password verification › should verify correct password

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:87:48)

  ● Security System › Password verification › should reject incorrect password

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:94:48)

  ● Security System › Password verification › should be timing-safe

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:101:48)

  ● Security System › Data encryption › should encrypt and decrypt data

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 230 |[39m   [90m// Derive key from password[39m
     [90m 231 |[39m   [36mconst[39m keyBuffer [33m=[39m encoder[33m.[39mencode(key)
    [31m[1m>[22m[39m[90m 232 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 233 |[39m     [32m'raw'[39m[33m,[39m
     [90m 234 |[39m     keyBuffer[33m,[39m
     [90m 235 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:232:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:123:42)

  ● Security System › Data encryption › should produce different encrypted output each time

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 230 |[39m   [90m// Derive key from password[39m
     [90m 231 |[39m   [36mconst[39m keyBuffer [33m=[39m encoder[33m.[39mencode(key)
    [31m[1m>[22m[39m[90m 232 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 233 |[39m     [32m'raw'[39m[33m,[39m
     [90m 234 |[39m     keyBuffer[33m,[39m
     [90m 235 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:232:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:130:43)

  ● Security System › Data encryption › should fail with wrong key

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 230 |[39m   [90m// Derive key from password[39m
     [90m 231 |[39m   [36mconst[39m keyBuffer [33m=[39m encoder[33m.[39mencode(key)
    [31m[1m>[22m[39m[90m 232 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 233 |[39m     [32m'raw'[39m[33m,[39m
     [90m 234 |[39m     keyBuffer[33m,[39m
     [90m 235 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:232:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:138:42)

FAIL src/__tests__/security/basic-security.test.ts
  Basic Security Tests
    √ should have secure environment configuration (3 ms)
    √ should handle input sanitization (2 ms)
    √ should validate data types properly (6 ms)
    × should handle SQL injection prevention patterns (3 ms)
    × should validate URL patterns (3 ms)
    √ should handle password security patterns (10 ms)
    √ should handle CSRF token patterns (3 ms)
    √ should validate file upload security (5 ms)
    √ should handle rate limiting patterns (4 ms)
    √ should validate session security (3 ms)

  ● Basic Security Tests › should handle SQL injection prevention patterns

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "DROP"
    Received string:        " DROP TABLE users --"

    [0m [90m 46 |[39m     expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'"'[39m)[33m;[39m
     [90m 47 |[39m     expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m';'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 48 |[39m     expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'DROP'[39m)[33m;[39m
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 49 |[39m   })[33m;[39m
     [90m 50 |[39m
     [90m 51 |[39m   it([32m'should validate URL patterns'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toContain (src/__tests__/security/basic-security.test.ts:48:27)

  ● Basic Security Tests › should validate URL patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 63 |[39m     expect(validateURL([32m'http://localhost:3000'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 64 |[39m     expect(validateURL([32m'invalid-url'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 65 |[39m     expect(validateURL([32m'javascript:alert(1)'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                [31m[1m^[22m[39m
     [90m 66 |[39m   })[33m;[39m
     [90m 67 |[39m
     [90m 68 |[39m   it([32m'should handle password security patterns'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBe (src/__tests__/security/basic-security.test.ts:65:48)

FAIL src/__tests__/securityMonitoring.test.ts
  Security Logger
    Security Event Logging
      √ should log security events with all required fields (10 ms)
      √ should calculate appropriate risk scores (4 ms)
      √ should track suspicious IPs (3 ms)
      √ should track blocked IPs (3 ms)
    Authentication Event Logging
      √ should log successful authentication (3 ms)
      √ should log failed authentication with escalating severity (8 ms)
    Security Metrics
      √ should generate comprehensive security metrics (4 ms)
      √ should calculate average risk score correctly (3 ms)
    Data Export
      √ should export events as JSON (3 ms)
  Log Data Sanitization
    sanitizeLogData
      √ should redact sensitive field names (10 ms)
      √ should sanitize nested objects (3 ms)
      √ should sanitize arrays (3 ms)
      √ should mask sensitive patterns in strings (7 ms)
      × should truncate very long strings (4 ms)
    validateLogData
      √ should detect sensitive data in logs (4 ms)
      √ should pass validation for clean data (4 ms)
  Authentication Monitor
    Authentication Attempt Recording
      × should record successful authentication (4 ms)
      × should record failed authentication (3 ms)
      × should block IP after multiple failed attempts (5 ms)
    Authentication Statistics
      × should generate authentication statistics (4 ms)
  Security Alert Manager
    Alert Processing
      × should trigger alerts for critical events (4 ms)
      × should respect cooldown periods (4 ms)
    Alert Management
      × should acknowledge alerts (2 ms)
      × should resolve alerts (2 ms)
    Alert Statistics
      × should generate alert statistics (8 ms)

  ● Log Data Sanitization › sanitizeLogData › should truncate very long strings

    expect(received).toHaveLength(expected)

    Expected length: 1015
    Received length: 1014
    Received string: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa...[TRUNCATED]"

    [0m [90m 260 |[39m       [36mconst[39m sanitized [33m=[39m sanitizeLogData(data)
     [90m 261 |[39m
    [31m[1m>[22m[39m[90m 262 |[39m       expect(sanitized[33m.[39mlongField)[33m.[39mtoHaveLength([35m1015[39m) [90m// 1000 + '[TRUNCATED]'[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 263 |[39m       expect(sanitized[33m.[39mlongField)[33m.[39mtoEndWith([32m'[TRUNCATED]'[39m)
     [90m 264 |[39m     })
     [90m 265 |[39m   })[0m

      at Object.toHaveLength (src/__tests__/securityMonitoring.test.ts:262:35)

  ● Authentication Monitor › Authentication Attempt Recording › should record successful authentication

    TypeError: crypto.randomUUID is not a function

    [0m [90m 112 |[39m
     [90m 113 |[39m     [36mconst[39m attempt[33m:[39m [33mAuthAttempt[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 114 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 115 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m
     [90m 116 |[39m       ip[33m,[39m
     [90m 117 |[39m       userAgent[33m,[39m[0m

      at AuthenticationMonitor.randomUUID [as recordAuthAttempt] (src/lib/authenticationMonitor.ts:114:18)
      at Object.recordAuthAttempt (src/__tests__/securityMonitoring.test.ts:312:35)

  ● Authentication Monitor › Authentication Attempt Recording › should record failed authentication

    TypeError: crypto.randomUUID is not a function

    [0m [90m 112 |[39m
     [90m 113 |[39m     [36mconst[39m attempt[33m:[39m [33mAuthAttempt[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 114 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 115 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m
     [90m 116 |[39m       ip[33m,[39m
     [90m 117 |[39m       userAgent[33m,[39m[0m

      at AuthenticationMonitor.randomUUID [as recordAuthAttempt] (src/lib/authenticationMonitor.ts:114:18)
      at Object.recordAuthAttempt (src/__tests__/securityMonitoring.test.ts:331:35)

  ● Authentication Monitor › Authentication Attempt Recording › should block IP after multiple failed attempts

    TypeError: crypto.randomUUID is not a function

    [0m [90m 112 |[39m
     [90m 113 |[39m     [36mconst[39m attempt[33m:[39m [33mAuthAttempt[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 114 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 115 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m
     [90m 116 |[39m       ip[33m,[39m
     [90m 117 |[39m       userAgent[33m,[39m[0m

      at AuthenticationMonitor.randomUUID [as recordAuthAttempt] (src/lib/authenticationMonitor.ts:114:18)
      at Object.recordAuthAttempt (src/__tests__/securityMonitoring.test.ts:350:21)

  ● Authentication Monitor › Authentication Statistics › should generate authentication statistics

    TypeError: crypto.randomUUID is not a function

    [0m [90m 112 |[39m
     [90m 113 |[39m     [36mconst[39m attempt[33m:[39m [33mAuthAttempt[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 114 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 115 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m
     [90m 116 |[39m       ip[33m,[39m
     [90m 117 |[39m       userAgent[33m,[39m[0m

      at AuthenticationMonitor.randomUUID [as recordAuthAttempt] (src/lib/authenticationMonitor.ts:114:18)
      at Object.recordAuthAttempt (src/__tests__/securityMonitoring.test.ts:366:19)

  ● Security Alert Manager › Alert Processing › should trigger alerts for critical events

    TypeError: crypto.randomUUID is not a function

    [0m [90m 417 |[39m   )[33m:[39m [33mSecurityAlert[39m {
     [90m 418 |[39m     [36mconst[39m alert[33m:[39m [33mSecurityAlert[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 419 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 420 |[39m       ruleId[33m:[39m rule[33m.[39mid[33m,[39m
     [90m 421 |[39m       ruleName[33m:[39m rule[33m.[39mname[33m,[39m
     [90m 422 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m[0m

      at SecurityAlertManager.randomUUID [as createAlert] (src/lib/securityAlerts.ts:419:18)
      at SecurityAlertManager.createAlert [as processSecurityEvent] (src/lib/securityAlerts.ts:221:26)
      at Object.processSecurityEvent (src/__tests__/securityMonitoring.test.ts:390:35)

  ● Security Alert Manager › Alert Processing › should respect cooldown periods

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 414 |[39m       )
     [90m 415 |[39m
    [31m[1m>[22m[39m[90m 416 |[39m       expect(firstAlerts[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 417 |[39m       expect(secondAlerts[33m.[39mlength)[33m.[39mtoBe([35m0[39m)
     [90m 418 |[39m     })
     [90m 419 |[39m   })[0m

      at Object.toBeGreaterThan (src/__tests__/securityMonitoring.test.ts:416:34)

  ● Security Alert Manager › Alert Management › should acknowledge alerts

    TypeError: crypto.randomUUID is not a function

    [0m [90m 417 |[39m   )[33m:[39m [33mSecurityAlert[39m {
     [90m 418 |[39m     [36mconst[39m alert[33m:[39m [33mSecurityAlert[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 419 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 420 |[39m       ruleId[33m:[39m rule[33m.[39mid[33m,[39m
     [90m 421 |[39m       ruleName[33m:[39m rule[33m.[39mname[33m,[39m
     [90m 422 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m[0m

      at SecurityAlertManager.randomUUID [as createAlert] (src/lib/securityAlerts.ts:419:18)
      at SecurityAlertManager.createAlert [as processSecurityEvent] (src/lib/securityAlerts.ts:221:26)
      at Object.processSecurityEvent (src/__tests__/securityMonitoring.test.ts:423:35)

  ● Security Alert Manager › Alert Management › should resolve alerts

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 445 |[39m       )
     [90m 446 |[39m
    [31m[1m>[22m[39m[90m 447 |[39m       [36mconst[39m alertId [33m=[39m alerts[[35m0[39m][33m.[39mid
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 448 |[39m       [36mconst[39m result [33m=[39m alertManager[33m.[39mresolveAlert(alertId[33m,[39m [32m'admin'[39m)
     [90m 449 |[39m
     [90m 450 |[39m       expect(result)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.id (src/__tests__/securityMonitoring.test.ts:447:33)

  ● Security Alert Manager › Alert Statistics › should generate alert statistics

    TypeError: crypto.randomUUID is not a function

    [0m [90m 417 |[39m   )[33m:[39m [33mSecurityAlert[39m {
     [90m 418 |[39m     [36mconst[39m alert[33m:[39m [33mSecurityAlert[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 419 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 420 |[39m       ruleId[33m:[39m rule[33m.[39mid[33m,[39m
     [90m 421 |[39m       ruleName[33m:[39m rule[33m.[39mname[33m,[39m
     [90m 422 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m[0m

      at SecurityAlertManager.randomUUID [as createAlert] (src/lib/securityAlerts.ts:419:18)
      at SecurityAlertManager.createAlert [as processSecurityEvent] (src/lib/securityAlerts.ts:221:26)
      at Object.processSecurityEvent (src/__tests__/securityMonitoring.test.ts:467:20)

FAIL src/tests/security/penetrationTesting.test.ts
  Penetration Testing Suite
    Input Validation Attacks
      × should prevent SQL injection attacks (16 ms)
      √ should prevent XSS attacks (23 ms)
      √ should prevent command injection attacks (8 ms)
    Authentication and Authorization
      √ should enforce rate limiting (97 ms)
      √ should validate CORS headers (12 ms)
    Data Protection
      √ should not expose sensitive information in error messages (4 ms)
      × should sanitize file paths (12 ms)
    Security Report Generation
      √ should generate comprehensive security report (4 ms)

  ● Penetration Testing Suite › Input Validation Attacks › should prevent SQL injection attacks

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 177 |[39m [32m      )[39m
     [90m 178 |[39m [32m[39m
    [31m[1m>[22m[39m[90m 179 |[39m [32m      expect(result.passed).toBe(true)[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 180 |[39m [32m    })[39m
     [90m 181 |[39m [32m[39m
     [90m 182 |[39m [32m    test('should prevent XSS attacks', async () => {[39m[0m

      at Object.toBe (src/tests/security/penetrationTesting.test.ts:179:29)

  ● Penetration Testing Suite › Data Protection › should sanitize file paths

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 447 |[39m       )
     [90m 448 |[39m
    [31m[1m>[22m[39m[90m 449 |[39m       expect(result[33m.[39mpassed)[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 450 |[39m     })
     [90m 451 |[39m   })
     [90m 452 |[39m[0m

      at Object.toBe (src/tests/security/penetrationTesting.test.ts:449:29)

FAIL src/tests/security/vulnerabilityScanning.test.ts
  Security Vulnerability Scanning
    Dependency Vulnerability Scanning
      × should run npm audit and detect vulnerabilities (28 ms)
      × should have acceptable vulnerability levels (30 ms)
      × should detect security regressions (15 ms)
    Security Configuration Tests
      √ should have secure package.json configuration (29 ms)
      √ should have secure environment configuration (87 ms)
      √ should not expose sensitive information in logs (4 ms)
    Input Validation Security
      × should validate and sanitize URL inputs (10 ms)
      × should prevent injection attacks in search queries (15 ms)

  ● Security Vulnerability Scanning › Dependency Vulnerability Scanning › should run npm audit and detect vulnerabilities

    Failed to run npm audit: spawn npm ENOENT

    [0m [90m 66 |[39m
     [90m 67 |[39m       auditProcess[33m.[39mon([32m'error'[39m[33m,[39m error [33m=>[39m {
    [31m[1m>[22m[39m[90m 68 |[39m         reject([36mnew[39m [33mError[39m([32m`Failed to run npm audit: ${error.message}`[39m))
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 69 |[39m       })
     [90m 70 |[39m     })
     [90m 71 |[39m   }[0m

      at ChildProcess.<anonymous> (src/tests/security/vulnerabilityScanning.test.ts:68:16)

  ● Security Vulnerability Scanning › Dependency Vulnerability Scanning › should have acceptable vulnerability levels

    Failed to run npm audit: spawn npm ENOENT

    [0m [90m 66 |[39m
     [90m 67 |[39m       auditProcess[33m.[39mon([32m'error'[39m[33m,[39m error [33m=>[39m {
    [31m[1m>[22m[39m[90m 68 |[39m         reject([36mnew[39m [33mError[39m([32m`Failed to run npm audit: ${error.message}`[39m))
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 69 |[39m       })
     [90m 70 |[39m     })
     [90m 71 |[39m   }[0m

      at ChildProcess.<anonymous> (src/tests/security/vulnerabilityScanning.test.ts:68:16)

  ● Security Vulnerability Scanning › Dependency Vulnerability Scanning › should detect security regressions

    Failed to run npm audit: spawn npm ENOENT

    [0m [90m 66 |[39m
     [90m 67 |[39m       auditProcess[33m.[39mon([32m'error'[39m[33m,[39m error [33m=>[39m {
    [31m[1m>[22m[39m[90m 68 |[39m         reject([36mnew[39m [33mError[39m([32m`Failed to run npm audit: ${error.message}`[39m))
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 69 |[39m       })
     [90m 70 |[39m     })
     [90m 71 |[39m   }[0m

      at ChildProcess.<anonymous> (src/tests/security/vulnerabilityScanning.test.ts:68:16)

  ● Security Vulnerability Scanning › Input Validation Security › should validate and sanitize URL inputs

    expect(received).toThrow()

    Received function did not throw

    [0m [90m 362 |[39m             [36mthrow[39m [36mnew[39m [33mError[39m([32m'Invalid protocol'[39m)
     [90m 363 |[39m           }
    [31m[1m>[22m[39m[90m 364 |[39m         })[33m.[39mtoThrow()
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 365 |[39m       })
     [90m 366 |[39m     })
     [90m 367 |[39m[0m

      at toThrow (src/tests/security/vulnerabilityScanning.test.ts:364:12)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/tests/security/vulnerabilityScanning.test.ts:357:21)

  ● Security Vulnerability Scanning › Input Validation Security › should prevent injection attacks in search queries

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "DROP TABLE"
    Received string:        " DROP TABLE businesses --"

    [0m [90m 385 |[39m
     [90m 386 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'<script>'[39m)
    [31m[1m>[22m[39m[90m 387 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'DROP TABLE'[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 388 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'${'[39m)
     [90m 389 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'..'[39m)
     [90m 390 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'{{'[39m)[0m

      at toContain (src/tests/security/vulnerabilityScanning.test.ts:387:31)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/tests/security/vulnerabilityScanning.test.ts:377:24)

Test Suites: 8 failed, 8 total
Tests:       52 failed, 118 passed, 170 total
Snapshots:   0 total
Time:        22.025 s
Ran all test suites matching /security/i.


**stderr:**
```
FAIL src/__tests__/fileUploadSecurity.test.ts (6.314 s)
  File Upload Security
    File Validation
      √ should validate file size limits (1119 ms)
      √ should validate file types (7 ms)
      √ should validate file extensions (10 ms)
      √ should detect path traversal attempts (11 ms)
      √ should detect null bytes in filename (11 ms)
      √ should validate empty files (8 ms)
      √ should accept valid files (14 ms)
    Magic Number Validation
      √ should validate JPEG magic numbers (18 ms)
      × should detect mismatched file types (31 ms)
      √ should detect embedded executables (16 ms)
    Content Analysis
      √ should detect script injection patterns (13 ms)
      √ should detect command execution patterns (18 ms)
      × should detect high entropy content (11 ms)
      × should detect multiple base64 strings (9 ms)
    Quarantine Functionality
      √ should quarantine malicious files (156 ms)
      √ should not quarantine safe files (9 ms)
    Hash Checking
      × should detect known malware hashes (11 ms)
    Filename Security
      × should generate secure filenames (14 ms)
      × should preserve file extensions (13 ms)
      √ should handle long filenames (6 ms)
      √ should remove invalid characters (7 ms)
    Performance and Limits
      √ should handle scan timeout (165 ms)
      √ should limit content analysis to reasonable size (182 ms)
    Integration with Validation Service
      √ should integrate with existing validation service (9 ms)
      √ should handle malware scanning integration (309 ms)

  ● File Upload Security › Magic Number Validation › should detect mismatched file types

    expect(received).toContain(expected) // indexOf

    Expected value: "File content doesn't match expected type for .jpg"
    Received array: []

    [0m [90m 129 |[39m       })
     [90m 130 |[39m
    [31m[1m>[22m[39m[90m 131 |[39m       expect(result[33m.[39mwarnings)[33m.[39mtoContain([32m"File content doesn't match expected type for .jpg"[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 132 |[39m     })
     [90m 133 |[39m
     [90m 134 |[39m     test([32m'should detect embedded executables'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.toContain (src/__tests__/fileUploadSecurity.test.ts:131:31)

  ● File Upload Security › Content Analysis › should detect high entropy content

    expect(received).toContain(expected) // indexOf

    Expected value: "File has high entropy - possible obfuscation or encryption"
    Received array: []

    [0m [90m 175 |[39m       })
     [90m 176 |[39m
    [31m[1m>[22m[39m[90m 177 |[39m       expect(result[33m.[39mwarnings)[33m.[39mtoContain(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 178 |[39m         [32m'File has high entropy - possible obfuscation or encryption'[39m
     [90m 179 |[39m       )
     [90m 180 |[39m     })[0m

      at Object.toContain (src/__tests__/fileUploadSecurity.test.ts:177:31)

  ● File Upload Security › Content Analysis › should detect multiple base64 strings

    expect(received).toContain(expected) // indexOf

    Expected value: "File contains multiple base64 encoded strings"
    Received array: []

    [0m [90m 187 |[39m       })
     [90m 188 |[39m
    [31m[1m>[22m[39m[90m 189 |[39m       expect(result[33m.[39mwarnings)[33m.[39mtoContain([32m'File contains multiple base64 encoded strings'[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 190 |[39m     })
     [90m 191 |[39m   })
     [90m 192 |[39m[0m

      at Object.toContain (src/__tests__/fileUploadSecurity.test.ts:189:31)

  ● File Upload Security › Hash Checking › should detect known malware hashes

    expect(received).toContain(expected) // indexOf

    Expected value: "File matches known malware signature"
    Received array: ["File extension '.exe' is not allowed", "File type 'application/octet-stream' is not allowed", "Executable files are not allowed"]

    [0m [90m 230 |[39m
     [90m 231 |[39m       expect(result[33m.[39misSecure)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 232 |[39m       expect(result[33m.[39mthreats)[33m.[39mtoContain([32m'File matches known malware signature'[39m)
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 233 |[39m     })
     [90m 234 |[39m   })
     [90m 235 |[39m[0m

      at Object.toContain (src/__tests__/fileUploadSecurity.test.ts:232:30)

  ● File Upload Security › Filename Security › should generate secure filenames

    expect(received).toMatch(expected)

    Expected pattern: /^[a-zA-Z0-9._-]+_\d+$/
    Received string:  "_1758758076161passwd"

    [0m [90m 241 |[39m       expect(secureName)[33m.[39mnot[33m.[39mtoContain([32m'../'[39m)
     [90m 242 |[39m       expect(secureName)[33m.[39mnot[33m.[39mtoContain([32m'/'[39m)
    [31m[1m>[22m[39m[90m 243 |[39m       expect(secureName)[33m.[39mtoMatch([35m/^[a-zA-Z0-9._-]+_\d+$/[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 244 |[39m     })
     [90m 245 |[39m
     [90m 246 |[39m     test([32m'should preserve file extensions'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toMatch (src/__tests__/fileUploadSecurity.test.ts:243:26)

  ● File Upload Security › Filename Security › should preserve file extensions

    TypeError: expect(...).toEndWith is not a function

    [0m [90m 248 |[39m       [36mconst[39m secureName [33m=[39m generateSecureFilename(filename[33m,[39m [36mtrue[39m)
     [90m 249 |[39m
    [31m[1m>[22m[39m[90m 250 |[39m       expect(secureName)[33m.[39mtoEndWith([32m'.pdf'[39m)
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 251 |[39m     })
     [90m 252 |[39m
     [90m 253 |[39m     test([32m'should handle long filenames'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toEndWith (src/__tests__/fileUploadSecurity.test.ts:250:26)

FAIL src/__tests__/security/paymentSecurity.test.ts
  Payment Security Middleware
    paymentRateLimit
      √ should allow requests within rate limit (14 ms)
      √ should block requests exceeding rate limit (9 ms)
      √ should handle rate limit service errors gracefully (15 ms)
      √ should use different limits for different types (20 ms)
    validateWebhookSignature
      √ should validate correct webhook signature (9 ms)
      √ should reject invalid webhook signature (5 ms)
      √ should handle Stripe signature format with v1= prefix (3 ms)
      √ should handle missing parameters (3 ms)
      × should handle signature validation errors (6 ms)
    sanitizePaymentData
      √ should remove sensitive payment fields (14 ms)
      √ should handle nested objects (13 ms)
      √ should handle arrays (5 ms)
      √ should handle non-object inputs (6 ms)
    validatePaymentCSRFToken
      × should validate CSRF token successfully (9 ms)
      √ should reject invalid CSRF token (5 ms)
      × should handle missing session ID (6 ms)
      √ should handle CSRF validation errors (7 ms)
    validateWebhookIP
      √ should allow requests from Stripe IPs (8 ms)
      √ should block requests from unauthorized IPs (4 ms)
      √ should handle missing client IP (4 ms)
      √ should handle IP validation errors (5 ms)
    withPaymentSecurity
      × should apply all security checks for POST requests (7 ms)
      √ should block requests that fail rate limiting (10 ms)
      √ should block requests that fail CSRF validation (4 ms)
      √ should skip CSRF for GET requests (5 ms)
      √ should handle middleware errors gracefully (7 ms)
    withStripeWebhookSecurity
      × should validate webhook signature and allow valid requests (17 ms)
      √ should reject requests with invalid signatures (4 ms)
      √ should reject requests without signature header (3 ms)

  ● Payment Security Middleware › validateWebhookSignature › should handle signature validation errors

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "PaymentSecurity", "Webhook signature validation failed", Any<Error>
    Received: "PaymentSecurity", "Webhook signature validation failed", [RangeError: Input buffers must have the same byte length]

    Number of calls: 1

    [0m [90m 146 |[39m       [36mconst[39m result [33m=[39m validateWebhookSignature(testPayload[33m,[39m [32m'malformed_hex'[39m[33m,[39m testSecret)
     [90m 147 |[39m       expect(result)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 148 |[39m       expect(mockLogger[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 149 |[39m         [32m'PaymentSecurity'[39m[33m,[39m
     [90m 150 |[39m         [32m'Webhook signature validation failed'[39m[33m,[39m
     [90m 151 |[39m         expect[33m.[39many([33mError[39m)[0m

      at Object.toHaveBeenCalledWith (src/__tests__/security/paymentSecurity.test.ts:148:32)

  ● Payment Security Middleware › validatePaymentCSRFToken › should validate CSRF token successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_bodyUsed": false, "body": undefined, "cookies": {"delete": [Function mockConstructor], "get": [Function mockConstructor], "getAll": [Function mockConstructor], "has": [Function mockConstructor], "set": [Function mockConstructor]}, "headers": {}, "method": "POST", "nextUrl": "https://example.com/api/payment", "url": "https://example.com/api/payment", Symbol(internal request): {"cookies": {"_headers": {}, "_parsed": Map {"session-id" => {"name": "session-id", "value": "test-session"}}}, "geo": {}, "ip": undefined, "nextUrl": "https://example.com/api/payment", "url": "https://example.com/api/payment"}},
    - "test-session",
    + "mock-session-id",

    Number of calls: 1

    [0m [90m 240 |[39m
     [90m 241 |[39m       expect(result)[33m.[39mtoBe([36mtrue[39m)
    [31m[1m>[22m[39m[90m 242 |[39m       expect(mockCsrfProtectionService[33m.[39mvalidateFormSubmission)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                                [31m[1m^[22m[39m
     [90m 243 |[39m         request[33m,[39m
     [90m 244 |[39m         [32m'test-session'[39m
     [90m 245 |[39m       )[0m

      at Object.toHaveBeenCalledWith (src/__tests__/security/paymentSecurity.test.ts:242:64)

  ● Payment Security Middleware › validatePaymentCSRFToken › should handle missing session ID

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "PaymentSecurity", "No session ID found for CSRF validation"

    Number of calls: 0

    [0m [90m 274 |[39m
     [90m 275 |[39m       expect(result)[33m.[39mtoBe([36mfalse[39m)
    [31m[1m>[22m[39m[90m 276 |[39m       expect(mockLogger[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 277 |[39m         [32m'PaymentSecurity'[39m[33m,[39m
     [90m 278 |[39m         [32m'No session ID found for CSRF validation'[39m
     [90m 279 |[39m       )[0m

      at Object.toHaveBeenCalledWith (src/__tests__/security/paymentSecurity.test.ts:276:31)

  ● Payment Security Middleware › withPaymentSecurity › should apply all security checks for POST requests

    TypeError: Cannot read properties of undefined (reading 'status')

    [0m [90m 381 |[39m       expect(mockCsrfProtectionService[33m.[39mvalidateFormSubmission)[33m.[39mtoHaveBeenCalled()
     [90m 382 |[39m       expect(mockHandler)[33m.[39mtoHaveBeenCalled()
    [31m[1m>[22m[39m[90m 383 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 384 |[39m     })
     [90m 385 |[39m
     [90m 386 |[39m     it([32m'should block requests that fail rate limiting'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.status (src/__tests__/security/paymentSecurity.test.ts:383:23)

  ● Payment Security Middleware › withStripeWebhookSecurity › should validate webhook signature and allow valid requests

    TypeError: Cannot read properties of undefined (reading 'status')

    [0m [90m 478 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m securedHandler(request)
     [90m 479 |[39m
    [31m[1m>[22m[39m[90m 480 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 481 |[39m       expect(mockHandler)[33m.[39mtoHaveBeenCalled()
     [90m 482 |[39m     })
     [90m 483 |[39m[0m

      at Object.status (src/__tests__/security/paymentSecurity.test.ts:480:23)

FAIL src/__tests__/databaseSecurity.test.ts
  Database Security Service
    SQL Injection Detection
      √ should detect basic SQL injection patterns (20 ms)
      √ should allow safe parameterized queries (6 ms)
      √ should detect dangerous keywords (28 ms)
      √ should validate query length limits (4 ms)
    Parameter Validation
      √ should validate safe parameters (3 ms)
      √ should detect malicious parameters (5 ms)
      √ should handle null and undefined parameters (3 ms)
      × should warn about long parameters (4 ms)
    Query Sanitization
      √ should sanitize queries by removing comments (5 ms)
      √ should normalize whitespace (2 ms)
    Security Statistics
      √ should track suspicious query attempts (3 ms)
      √ should reset security counters (9 ms)
    Utility Functions
      √ should escape SQL identifiers (3 ms)
      √ should reject invalid identifiers (13 ms)
      √ should generate secure IDs (6 ms)
      √ should hash and verify sensitive data (472 ms)
  Secure Database Wrapper
    Query Execution
      × should execute safe queries successfully (6 ms)
      × should reject malicious queries (1 ms)
      × should handle query timeouts (2 ms)
      × should retry on retryable errors (1 ms)
    Transaction Support
      × should execute transactions successfully (1 ms)
      × should rollback on transaction errors (1 ms)
    Prepared Statements
      × should execute prepared statements (1 ms)
    Connection Pool Management
      × should provide pool statistics (2 ms)
      × should close connections properly (1 ms)
    Query Caching
      × should cache SELECT query results (1 ms)
      × should clear cache when requested (2 ms)

  ● Database Security Service › Parameter Validation › should warn about long parameters

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 145 |[39m       ])
     [90m 146 |[39m
    [31m[1m>[22m[39m[90m 147 |[39m       expect(result[33m.[39mwarnings[33m.[39msome(w [33m=>[39m w[33m.[39mincludes([32m'unusually long'[39m)))[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                                                                       [31m[1m^[22m[39m
     [90m 148 |[39m     })
     [90m 149 |[39m   })
     [90m 150 |[39m[0m

      at Object.toBe (src/__tests__/databaseSecurity.test.ts:147:71)

  ● Secure Database Wrapper › Query Execution › should execute safe queries successfully

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Execution › should reject malicious queries

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Execution › should handle query timeouts

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Execution › should retry on retryable errors

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Transaction Support › should execute transactions successfully

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Transaction Support › should rollback on transaction errors

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Prepared Statements › should execute prepared statements

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Connection Pool Management › should provide pool statistics

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Connection Pool Management › should close connections properly

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Caching › should cache SELECT query results

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

  ● Secure Database Wrapper › Query Caching › should clear cache when requested

    ReferenceError: Pool is not defined

    [0m [90m 247 |[39m
     [90m 248 |[39m     [90m// Get the mocked pool instance[39m
    [31m[1m>[22m[39m[90m 249 |[39m     mockPool [33m=[39m [36mnew[39m [33mPool[39m()
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 250 |[39m   })
     [90m 251 |[39m
     [90m 252 |[39m   describe([32m'Query Execution'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.mockPool (src/__tests__/databaseSecurity.test.ts:249:5)

FAIL src/__tests__/lib/security.test.ts
  Security System
    generateSecureToken
      √ should generate a token of specified length (2 ms)
      √ should generate different tokens each time (2 ms)
      √ should use default length when not specified (2 ms)
    Password hashing
      × should hash a password with salt (2 ms)
      × should use provided salt (4 ms)
      × should generate different hashes for different passwords (3 ms)
      × should generate same hash for same password and salt (2 ms)
    Password verification
      × should verify correct password (1 ms)
      × should reject incorrect password (1 ms)
      × should be timing-safe (2 ms)
    Data encryption
      × should encrypt and decrypt data (2 ms)
      × should produce different encrypted output each time (1 ms)
      × should fail with wrong key (1 ms)
    Session management
      √ should create a session (5 ms)
      √ should retrieve a session (3 ms)
      √ should return null for non-existent session (3 ms)
      √ should invalidate a session (4 ms)
      √ should update last accessed time (8 ms)
    Rate limiting
      √ should allow requests within limit (2 ms)
      √ should block requests exceeding limit (5 ms)
      √ should reset after time window (1 ms)
    Login attempt tracking
      √ should track successful login (2 ms)
      √ should track failed login attempts (2 ms)
      √ should lock account after max attempts (5 ms)
      √ should clear attempts on successful login (4 ms)
    Input sanitization
      √ should remove script tags (5 ms)
      √ should escape HTML entities (7 ms)
      √ should remove javascript: URLs (2 ms)
      √ should remove event handlers (1 ms)
      √ should trim whitespace (2 ms)
    Input validation
      √ should pass safe input (3 ms)
      √ should detect SQL injection (4 ms)
      √ should detect XSS attempts (3 ms)
      √ should detect path traversal (2 ms)
    Client IP extraction
      √ should extract IP from x-forwarded-for header (4 ms)
      √ should extract IP from x-real-ip header (6 ms)
      √ should fallback to request.ip (5 ms)
      √ should return unknown when no IP available (3 ms)

  ● Security System › Password hashing › should hash a password with salt

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:52:40)

  ● Security System › Password hashing › should use provided salt

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:62:40)

  ● Security System › Password hashing › should generate different hashes for different passwords

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:68:41)

  ● Security System › Password hashing › should generate same hash for same password and salt

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:76:41)

  ● Security System › Password verification › should verify correct password

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:87:48)

  ● Security System › Password verification › should reject incorrect password

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:94:48)

  ● Security System › Password verification › should be timing-safe

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 153 |[39m
     [90m 154 |[39m   [90m// Import password as key material[39m
    [31m[1m>[22m[39m[90m 155 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 156 |[39m     [32m'raw'[39m[33m,[39m
     [90m 157 |[39m     passwordBuffer[33m,[39m
     [90m 158 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:155:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:101:48)

  ● Security System › Data encryption › should encrypt and decrypt data

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 230 |[39m   [90m// Derive key from password[39m
     [90m 231 |[39m   [36mconst[39m keyBuffer [33m=[39m encoder[33m.[39mencode(key)
    [31m[1m>[22m[39m[90m 232 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 233 |[39m     [32m'raw'[39m[33m,[39m
     [90m 234 |[39m     keyBuffer[33m,[39m
     [90m 235 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:232:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:123:42)

  ● Security System › Data encryption › should produce different encrypted output each time

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 230 |[39m   [90m// Derive key from password[39m
     [90m 231 |[39m   [36mconst[39m keyBuffer [33m=[39m encoder[33m.[39mencode(key)
    [31m[1m>[22m[39m[90m 232 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 233 |[39m     [32m'raw'[39m[33m,[39m
     [90m 234 |[39m     keyBuffer[33m,[39m
     [90m 235 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:232:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:130:43)

  ● Security System › Data encryption › should fail with wrong key

    TypeError: Cannot read properties of undefined (reading 'importKey')

    [0m [90m 230 |[39m   [90m// Derive key from password[39m
     [90m 231 |[39m   [36mconst[39m keyBuffer [33m=[39m encoder[33m.[39mencode(key)
    [31m[1m>[22m[39m[90m 232 |[39m   [36mconst[39m keyMaterial [33m=[39m [36mawait[39m webCrypto[33m.[39msubtle[33m.[39mimportKey(
     [90m     |[39m                                              [31m[1m^[22m[39m
     [90m 233 |[39m     [32m'raw'[39m[33m,[39m
     [90m 234 |[39m     keyBuffer[33m,[39m
     [90m 235 |[39m     { name[33m:[39m [32m'PBKDF2'[39m }[33m,[39m[0m

      at importKey (src/lib/security.ts:232:46)
      at Object.<anonymous> (src/__tests__/lib/security.test.ts:138:42)

FAIL src/__tests__/security/basic-security.test.ts
  Basic Security Tests
    √ should have secure environment configuration (3 ms)
    √ should handle input sanitization (2 ms)
    √ should validate data types properly (6 ms)
    × should handle SQL injection prevention patterns (3 ms)
    × should validate URL patterns (3 ms)
    √ should handle password security patterns (10 ms)
    √ should handle CSRF token patterns (3 ms)
    √ should validate file upload security (5 ms)
    √ should handle rate limiting patterns (4 ms)
    √ should validate session security (3 ms)

  ● Basic Security Tests › should handle SQL injection prevention patterns

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "DROP"
    Received string:        " DROP TABLE users --"

    [0m [90m 46 |[39m     expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'"'[39m)[33m;[39m
     [90m 47 |[39m     expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m';'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 48 |[39m     expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'DROP'[39m)[33m;[39m
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 49 |[39m   })[33m;[39m
     [90m 50 |[39m
     [90m 51 |[39m   it([32m'should validate URL patterns'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toContain (src/__tests__/security/basic-security.test.ts:48:27)

  ● Basic Security Tests › should validate URL patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 63 |[39m     expect(validateURL([32m'http://localhost:3000'[39m))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 64 |[39m     expect(validateURL([32m'invalid-url'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 65 |[39m     expect(validateURL([32m'javascript:alert(1)'[39m))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m    |[39m                                                [31m[1m^[22m[39m
     [90m 66 |[39m   })[33m;[39m
     [90m 67 |[39m
     [90m 68 |[39m   it([32m'should handle password security patterns'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.toBe (src/__tests__/security/basic-security.test.ts:65:48)

FAIL src/__tests__/securityMonitoring.test.ts
  Security Logger
    Security Event Logging
      √ should log security events with all required fields (10 ms)
      √ should calculate appropriate risk scores (4 ms)
      √ should track suspicious IPs (3 ms)
      √ should track blocked IPs (3 ms)
    Authentication Event Logging
      √ should log successful authentication (3 ms)
      √ should log failed authentication with escalating severity (8 ms)
    Security Metrics
      √ should generate comprehensive security metrics (4 ms)
      √ should calculate average risk score correctly (3 ms)
    Data Export
      √ should export events as JSON (3 ms)
  Log Data Sanitization
    sanitizeLogData
      √ should redact sensitive field names (10 ms)
      √ should sanitize nested objects (3 ms)
      √ should sanitize arrays (3 ms)
      √ should mask sensitive patterns in strings (7 ms)
      × should truncate very long strings (4 ms)
    validateLogData
      √ should detect sensitive data in logs (4 ms)
      √ should pass validation for clean data (4 ms)
  Authentication Monitor
    Authentication Attempt Recording
      × should record successful authentication (4 ms)
      × should record failed authentication (3 ms)
      × should block IP after multiple failed attempts (5 ms)
    Authentication Statistics
      × should generate authentication statistics (4 ms)
  Security Alert Manager
    Alert Processing
      × should trigger alerts for critical events (4 ms)
      × should respect cooldown periods (4 ms)
    Alert Management
      × should acknowledge alerts (2 ms)
      × should resolve alerts (2 ms)
    Alert Statistics
      × should generate alert statistics (8 ms)

  ● Log Data Sanitization › sanitizeLogData › should truncate very long strings

    expect(received).toHaveLength(expected)

    Expected length: 1015
    Received length: 1014
    Received string: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa...[TRUNCATED]"

    [0m [90m 260 |[39m       [36mconst[39m sanitized [33m=[39m sanitizeLogData(data)
     [90m 261 |[39m
    [31m[1m>[22m[39m[90m 262 |[39m       expect(sanitized[33m.[39mlongField)[33m.[39mtoHaveLength([35m1015[39m) [90m// 1000 + '[TRUNCATED]'[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 263 |[39m       expect(sanitized[33m.[39mlongField)[33m.[39mtoEndWith([32m'[TRUNCATED]'[39m)
     [90m 264 |[39m     })
     [90m 265 |[39m   })[0m

      at Object.toHaveLength (src/__tests__/securityMonitoring.test.ts:262:35)

  ● Authentication Monitor › Authentication Attempt Recording › should record successful authentication

    TypeError: crypto.randomUUID is not a function

    [0m [90m 112 |[39m
     [90m 113 |[39m     [36mconst[39m attempt[33m:[39m [33mAuthAttempt[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 114 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 115 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m
     [90m 116 |[39m       ip[33m,[39m
     [90m 117 |[39m       userAgent[33m,[39m[0m

      at AuthenticationMonitor.randomUUID [as recordAuthAttempt] (src/lib/authenticationMonitor.ts:114:18)
      at Object.recordAuthAttempt (src/__tests__/securityMonitoring.test.ts:312:35)

  ● Authentication Monitor › Authentication Attempt Recording › should record failed authentication

    TypeError: crypto.randomUUID is not a function

    [0m [90m 112 |[39m
     [90m 113 |[39m     [36mconst[39m attempt[33m:[39m [33mAuthAttempt[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 114 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 115 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m
     [90m 116 |[39m       ip[33m,[39m
     [90m 117 |[39m       userAgent[33m,[39m[0m

      at AuthenticationMonitor.randomUUID [as recordAuthAttempt] (src/lib/authenticationMonitor.ts:114:18)
      at Object.recordAuthAttempt (src/__tests__/securityMonitoring.test.ts:331:35)

  ● Authentication Monitor › Authentication Attempt Recording › should block IP after multiple failed attempts

    TypeError: crypto.randomUUID is not a function

    [0m [90m 112 |[39m
     [90m 113 |[39m     [36mconst[39m attempt[33m:[39m [33mAuthAttempt[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 114 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 115 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m
     [90m 116 |[39m       ip[33m,[39m
     [90m 117 |[39m       userAgent[33m,[39m[0m

      at AuthenticationMonitor.randomUUID [as recordAuthAttempt] (src/lib/authenticationMonitor.ts:114:18)
      at Object.recordAuthAttempt (src/__tests__/securityMonitoring.test.ts:350:21)

  ● Authentication Monitor › Authentication Statistics › should generate authentication statistics

    TypeError: crypto.randomUUID is not a function

    [0m [90m 112 |[39m
     [90m 113 |[39m     [36mconst[39m attempt[33m:[39m [33mAuthAttempt[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 114 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 115 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m
     [90m 116 |[39m       ip[33m,[39m
     [90m 117 |[39m       userAgent[33m,[39m[0m

      at AuthenticationMonitor.randomUUID [as recordAuthAttempt] (src/lib/authenticationMonitor.ts:114:18)
      at Object.recordAuthAttempt (src/__tests__/securityMonitoring.test.ts:366:19)

  ● Security Alert Manager › Alert Processing › should trigger alerts for critical events

    TypeError: crypto.randomUUID is not a function

    [0m [90m 417 |[39m   )[33m:[39m [33mSecurityAlert[39m {
     [90m 418 |[39m     [36mconst[39m alert[33m:[39m [33mSecurityAlert[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 419 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 420 |[39m       ruleId[33m:[39m rule[33m.[39mid[33m,[39m
     [90m 421 |[39m       ruleName[33m:[39m rule[33m.[39mname[33m,[39m
     [90m 422 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m[0m

      at SecurityAlertManager.randomUUID [as createAlert] (src/lib/securityAlerts.ts:419:18)
      at SecurityAlertManager.createAlert [as processSecurityEvent] (src/lib/securityAlerts.ts:221:26)
      at Object.processSecurityEvent (src/__tests__/securityMonitoring.test.ts:390:35)

  ● Security Alert Manager › Alert Processing › should respect cooldown periods

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 414 |[39m       )
     [90m 415 |[39m
    [31m[1m>[22m[39m[90m 416 |[39m       expect(firstAlerts[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 417 |[39m       expect(secondAlerts[33m.[39mlength)[33m.[39mtoBe([35m0[39m)
     [90m 418 |[39m     })
     [90m 419 |[39m   })[0m

      at Object.toBeGreaterThan (src/__tests__/securityMonitoring.test.ts:416:34)

  ● Security Alert Manager › Alert Management › should acknowledge alerts

    TypeError: crypto.randomUUID is not a function

    [0m [90m 417 |[39m   )[33m:[39m [33mSecurityAlert[39m {
     [90m 418 |[39m     [36mconst[39m alert[33m:[39m [33mSecurityAlert[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 419 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 420 |[39m       ruleId[33m:[39m rule[33m.[39mid[33m,[39m
     [90m 421 |[39m       ruleName[33m:[39m rule[33m.[39mname[33m,[39m
     [90m 422 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m[0m

      at SecurityAlertManager.randomUUID [as createAlert] (src/lib/securityAlerts.ts:419:18)
      at SecurityAlertManager.createAlert [as processSecurityEvent] (src/lib/securityAlerts.ts:221:26)
      at Object.processSecurityEvent (src/__tests__/securityMonitoring.test.ts:423:35)

  ● Security Alert Manager › Alert Management › should resolve alerts

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 445 |[39m       )
     [90m 446 |[39m
    [31m[1m>[22m[39m[90m 447 |[39m       [36mconst[39m alertId [33m=[39m alerts[[35m0[39m][33m.[39mid
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 448 |[39m       [36mconst[39m result [33m=[39m alertManager[33m.[39mresolveAlert(alertId[33m,[39m [32m'admin'[39m)
     [90m 449 |[39m
     [90m 450 |[39m       expect(result)[33m.[39mtoBe([36mtrue[39m)[0m

      at Object.id (src/__tests__/securityMonitoring.test.ts:447:33)

  ● Security Alert Manager › Alert Statistics › should generate alert statistics

    TypeError: crypto.randomUUID is not a function

    [0m [90m 417 |[39m   )[33m:[39m [33mSecurityAlert[39m {
     [90m 418 |[39m     [36mconst[39m alert[33m:[39m [33mSecurityAlert[39m [33m=[39m {
    [31m[1m>[22m[39m[90m 419 |[39m       id[33m:[39m crypto[33m.[39mrandomUUID()[33m,[39m
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 420 |[39m       ruleId[33m:[39m rule[33m.[39mid[33m,[39m
     [90m 421 |[39m       ruleName[33m:[39m rule[33m.[39mname[33m,[39m
     [90m 422 |[39m       timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m[0m

      at SecurityAlertManager.randomUUID [as createAlert] (src/lib/securityAlerts.ts:419:18)
      at SecurityAlertManager.createAlert [as processSecurityEvent] (src/lib/securityAlerts.ts:221:26)
      at Object.processSecurityEvent (src/__tests__/securityMonitoring.test.ts:467:20)

FAIL src/tests/security/penetrationTesting.test.ts
  Penetration Testing Suite
    Input Validation Attacks
      × should prevent SQL injection attacks (16 ms)
      √ should prevent XSS attacks (23 ms)
      √ should prevent command injection attacks (8 ms)
    Authentication and Authorization
      √ should enforce rate limiting (97 ms)
      √ should validate CORS headers (12 ms)
    Data Protection
      √ should not expose sensitive information in error messages (4 ms)
      × should sanitize file paths (12 ms)
    Security Report Generation
      √ should generate comprehensive security report (4 ms)

  ● Penetration Testing Suite › Input Validation Attacks › should prevent SQL injection attacks

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 177 |[39m [32m      )[39m
     [90m 178 |[39m [32m[39m
    [31m[1m>[22m[39m[90m 179 |[39m [32m      expect(result.passed).toBe(true)[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 180 |[39m [32m    })[39m
     [90m 181 |[39m [32m[39m
     [90m 182 |[39m [32m    test('should prevent XSS attacks', async () => {[39m[0m

      at Object.toBe (src/tests/security/penetrationTesting.test.ts:179:29)

  ● Penetration Testing Suite › Data Protection › should sanitize file paths

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 447 |[39m       )
     [90m 448 |[39m
    [31m[1m>[22m[39m[90m 449 |[39m       expect(result[33m.[39mpassed)[33m.[39mtoBe([36mtrue[39m)
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 450 |[39m     })
     [90m 451 |[39m   })
     [90m 452 |[39m[0m

      at Object.toBe (src/tests/security/penetrationTesting.test.ts:449:29)

FAIL src/tests/security/vulnerabilityScanning.test.ts
  Security Vulnerability Scanning
    Dependency Vulnerability Scanning
      × should run npm audit and detect vulnerabilities (28 ms)
      × should have acceptable vulnerability levels (30 ms)
      × should detect security regressions (15 ms)
    Security Configuration Tests
      √ should have secure package.json configuration (29 ms)
      √ should have secure environment configuration (87 ms)
      √ should not expose sensitive information in logs (4 ms)
    Input Validation Security
      × should validate and sanitize URL inputs (10 ms)
      × should prevent injection attacks in search queries (15 ms)

  ● Security Vulnerability Scanning › Dependency Vulnerability Scanning › should run npm audit and detect vulnerabilities

    Failed to run npm audit: spawn npm ENOENT

    [0m [90m 66 |[39m
     [90m 67 |[39m       auditProcess[33m.[39mon([32m'error'[39m[33m,[39m error [33m=>[39m {
    [31m[1m>[22m[39m[90m 68 |[39m         reject([36mnew[39m [33mError[39m([32m`Failed to run npm audit: ${error.message}`[39m))
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 69 |[39m       })
     [90m 70 |[39m     })
     [90m 71 |[39m   }[0m

      at ChildProcess.<anonymous> (src/tests/security/vulnerabilityScanning.test.ts:68:16)

  ● Security Vulnerability Scanning › Dependency Vulnerability Scanning › should have acceptable vulnerability levels

    Failed to run npm audit: spawn npm ENOENT

    [0m [90m 66 |[39m
     [90m 67 |[39m       auditProcess[33m.[39mon([32m'error'[39m[33m,[39m error [33m=>[39m {
    [31m[1m>[22m[39m[90m 68 |[39m         reject([36mnew[39m [33mError[39m([32m`Failed to run npm audit: ${error.message}`[39m))
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 69 |[39m       })
     [90m 70 |[39m     })
     [90m 71 |[39m   }[0m

      at ChildProcess.<anonymous> (src/tests/security/vulnerabilityScanning.test.ts:68:16)

  ● Security Vulnerability Scanning › Dependency Vulnerability Scanning › should detect security regressions

    Failed to run npm audit: spawn npm ENOENT

    [0m [90m 66 |[39m
     [90m 67 |[39m       auditProcess[33m.[39mon([32m'error'[39m[33m,[39m error [33m=>[39m {
    [31m[1m>[22m[39m[90m 68 |[39m         reject([36mnew[39m [33mError[39m([32m`Failed to run npm audit: ${error.message}`[39m))
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 69 |[39m       })
     [90m 70 |[39m     })
     [90m 71 |[39m   }[0m

      at ChildProcess.<anonymous> (src/tests/security/vulnerabilityScanning.test.ts:68:16)

  ● Security Vulnerability Scanning › Input Validation Security › should validate and sanitize URL inputs

    expect(received).toThrow()

    Received function did not throw

    [0m [90m 362 |[39m             [36mthrow[39m [36mnew[39m [33mError[39m([32m'Invalid protocol'[39m)
     [90m 363 |[39m           }
    [31m[1m>[22m[39m[90m 364 |[39m         })[33m.[39mtoThrow()
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 365 |[39m       })
     [90m 366 |[39m     })
     [90m 367 |[39m[0m

      at toThrow (src/tests/security/vulnerabilityScanning.test.ts:364:12)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/tests/security/vulnerabilityScanning.test.ts:357:21)

  ● Security Vulnerability Scanning › Input Validation Security › should prevent injection attacks in search queries

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "DROP TABLE"
    Received string:        " DROP TABLE businesses --"

    [0m [90m 385 |[39m
     [90m 386 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'<script>'[39m)
    [31m[1m>[22m[39m[90m 387 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'DROP TABLE'[39m)
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 388 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'${'[39m)
     [90m 389 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'..'[39m)
     [90m 390 |[39m         expect(sanitized)[33m.[39mnot[33m.[39mtoContain([32m'{{'[39m)[0m

      at toContain (src/tests/security/vulnerabilityScanning.test.ts:387:31)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/tests/security/vulnerabilityScanning.test.ts:377:24)

Test Suites: 8 failed, 8 total
Tests:       52 failed, 118 passed, 170 total
Snapshots:   0 total
Time:        22.025 s
Ran all test suites matching /security/i.

```

### Accessibility Tests

**Error:** Command failed: npm run test:accessibility


### Compatibility Tests

**Error:** Command failed: npm run test:compatibility:comprehensive


### Exploratory Tests

**Error:** Command failed: npm run test:exploratory:comprehensive
FAIL src/tests/exploratory/comprehensive/edgeCaseDiscovery.test.ts (7.481 s)
  Exploratory Testing - Edge Case Discovery
    Boundary Value Exploration
      √ should explore extreme input boundaries (12 ms)
    Data Format Exploration
      √ should explore unusual data formats and structures (44 ms)
    Interaction Pattern Exploration
      √ should explore unusual user interaction patterns (23 ms)
    Environment Condition Exploration
      √ should explore unusual environment conditions (302 ms)
    Security Edge Case Exploration
      √ should explore potential security edge cases (39 ms)
    Performance Edge Case Exploration
      √ should explore performance edge cases (59 ms)
    Exploratory Test Analysis
      × should analyze and report exploratory test findings (7 ms)

  ● Exploratory Testing - Edge Case Discovery › Exploratory Test Analysis › should analyze and report exploratory test findings

    expect(received).toBeGreaterThan(expected)

    Expected: > 10
    Received:   0

    [0m [90m 517 |[39m
     [90m 518 |[39m       [90m// Exploratory testing quality metrics[39m
    [31m[1m>[22m[39m[90m 519 |[39m       expect(results[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m10[39m) [90m// Should have comprehensive coverage[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 520 |[39m       expect(highRiskIssues[33m.[39mlength)[33m.[39mtoBeLessThanOrEqual([35m2[39m) [90m// Minimal high-risk issues[39m
     [90m 521 |[39m
     [90m 522 |[39m       [90m// Category coverage[39m[0m

      at Object.toBeGreaterThan (src/tests/exploratory/comprehensive/edgeCaseDiscovery.test.ts:519:30)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 6 passed, 7 total
Snapshots:   0 total
Time:        8.741 s
Ran all test suites matching /exploratory\\comprehensive/i.


**stderr:**
```
FAIL src/tests/exploratory/comprehensive/edgeCaseDiscovery.test.ts (7.481 s)
  Exploratory Testing - Edge Case Discovery
    Boundary Value Exploration
      √ should explore extreme input boundaries (12 ms)
    Data Format Exploration
      √ should explore unusual data formats and structures (44 ms)
    Interaction Pattern Exploration
      √ should explore unusual user interaction patterns (23 ms)
    Environment Condition Exploration
      √ should explore unusual environment conditions (302 ms)
    Security Edge Case Exploration
      √ should explore potential security edge cases (39 ms)
    Performance Edge Case Exploration
      √ should explore performance edge cases (59 ms)
    Exploratory Test Analysis
      × should analyze and report exploratory test findings (7 ms)

  ● Exploratory Testing - Edge Case Discovery › Exploratory Test Analysis › should analyze and report exploratory test findings

    expect(received).toBeGreaterThan(expected)

    Expected: > 10
    Received:   0

    [0m [90m 517 |[39m
     [90m 518 |[39m       [90m// Exploratory testing quality metrics[39m
    [31m[1m>[22m[39m[90m 519 |[39m       expect(results[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m10[39m) [90m// Should have comprehensive coverage[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 520 |[39m       expect(highRiskIssues[33m.[39mlength)[33m.[39mtoBeLessThanOrEqual([35m2[39m) [90m// Minimal high-risk issues[39m
     [90m 521 |[39m
     [90m 522 |[39m       [90m// Category coverage[39m[0m

      at Object.toBeGreaterThan (src/tests/exploratory/comprehensive/edgeCaseDiscovery.test.ts:519:30)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 6 passed, 7 total
Snapshots:   0 total
Time:        8.741 s
Ran all test suites matching /exploratory\\comprehensive/i.

```

### Smoke Tests

**Error:** Command failed: npm run test:bvt


### Memory Stress Tests

**Error:** Command failed: npm run test:memory


