<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Scraper - Enterprise Code Review Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --dark-bg: #1f2937;
            --light-bg: #f8fafc;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #374151;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), #1e40af);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .hero-section {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 3rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .prompt-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        
        .prompt-card.critical {
            border-left-color: var(--danger-color);
            background: linear-gradient(135deg, #fef2f2, #ffffff);
        }
        
        .prompt-card.high-priority {
            border-left-color: var(--warning-color);
            background: linear-gradient(135deg, #fffbeb, #ffffff);
        }
        
        .prompt-card.medium-priority {
            border-left-color: var(--primary-color);
            background: linear-gradient(135deg, #eff6ff, #ffffff);
        }
        
        .prompt-card.low-priority {
            border-left-color: var(--success-color);
            background: linear-gradient(135deg, #f0fdf4, #ffffff);
        }
        
        .prompt-text {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .copy-prompt {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .copy-prompt:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
        
        .copy-prompt.copied {
            background: var(--success-color);
        }
        
        .progress-ring {
            width: 120px;
            height: 120px;
        }
        
        .progress-ring circle {
            fill: transparent;
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .section-header {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 2rem 0;
            margin: 2rem 0;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }
        
        .dark-mode {
            background-color: var(--dark-bg);
            color: #f9fafb;
        }
        
        .dark-mode .metric-card,
        .dark-mode .prompt-card {
            background: #374151;
            border-color: #4b5563;
            color: #f9fafb;
        }
        
        .dark-mode .prompt-text {
            background: #1f2937;
            border-color: #4b5563;
            color: #f9fafb;
        }
        
        @media print {
            .no-print { display: none !important; }
            .prompt-card { break-inside: avoid; }
        }
        
        .nav-pills .nav-link.active {
            background-color: var(--primary-color);
        }
        
        .badge-critical { background-color: var(--danger-color); }
        .badge-high { background-color: var(--warning-color); }
        .badge-medium { background-color: var(--primary-color); }
        .badge-low { background-color: var(--success-color); }
        
        .file-path {
            font-family: 'Courier New', monospace;
            background: #f1f5f9;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        
        .issue-count {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-code-branch me-2"></i>
                Business Scraper Code Review
            </a>
            <div class="navbar-nav ms-auto no-print">
                <button class="btn btn-outline-light btn-sm me-2" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
                <button class="btn btn-outline-light btn-sm me-2" onclick="exportReport()">
                    <i class="fas fa-download me-1"></i> Export
                </button>
                <button class="btn btn-outline-light btn-sm" onclick="window.print()">
                    <i class="fas fa-print me-1"></i> Print
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-4 fw-bold mb-3">Enterprise Code Review Report</h1>
                    <p class="lead mb-4">Comprehensive analysis of the Business Scraper application with actionable Augment AI prompts for immediate implementation.</p>
                    <div class="d-flex gap-3 mb-4">
                        <span class="badge bg-primary fs-6">Version 6.8.3</span>
                        <span class="badge bg-success fs-6">Generated: October 1, 2025</span>
                        <span class="badge bg-info fs-6">Enterprise Grade</span>
                    </div>
                </div>
                <div class="col-lg-4 text-center">
                    <div class="progress-ring">
                        <svg width="120" height="120">
                            <circle cx="60" cy="60" r="52" stroke="#e5e7eb" stroke-width="8" fill="transparent"/>
                            <circle cx="60" cy="60" r="52" stroke="#059669" stroke-width="8" fill="transparent" 
                                    stroke-dasharray="327" stroke-dashoffset="65" id="overall-progress"/>
                        </svg>
                        <div class="position-absolute top-50 start-50 translate-middle">
                            <div class="fs-3 fw-bold text-success">80%</div>
                            <div class="small text-muted">Overall Quality</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Executive Dashboard -->
    <section class="container my-5">
        <h2 class="mb-4"><i class="fas fa-chart-line me-2"></i>Executive Dashboard</h2>
        <div class="row g-4">
            <div class="col-md-3">
                <div class="metric-card text-center">
                    <div class="issue-count text-danger">25</div>
                    <div class="metric-label">Critical Issues (P0)</div>
                    <small class="text-muted">Security & Stability</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card text-center">
                    <div class="issue-count text-warning">35</div>
                    <div class="metric-label">High Priority (P1)</div>
                    <small class="text-muted">Performance & Scale</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card text-center">
                    <div class="issue-count text-primary">60</div>
                    <div class="metric-label">Medium Priority (P2)</div>
                    <small class="text-muted">Code Quality & Organization</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card text-center">
                    <div class="issue-count text-success">31</div>
                    <div class="metric-label">Low Priority (P3)</div>
                    <small class="text-muted">Enhancements</small>
                </div>
            </div>
        </div>
        
        <div class="row g-4 mt-4">
            <div class="col-md-4">
                <div class="metric-card">
                    <h5><i class="fas fa-shield-alt text-danger me-2"></i>Security Score</h5>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-danger" style="width: 65%"></div>
                    </div>
                    <small>65/100 - Needs Immediate Attention</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="metric-card">
                    <h5><i class="fas fa-tachometer-alt text-warning me-2"></i>Performance Score</h5>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-warning" style="width: 72%"></div>
                    </div>
                    <small>72/100 - Optimization Required</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="metric-card">
                    <h5><i class="fas fa-code text-primary me-2"></i>Code Quality Score</h5>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-primary" style="width: 85%"></div>
                    </div>
                    <small>85/100 - Good Foundation</small>
                </div>
            </div>
        </div>
    </section>

    <!-- Navigation Tabs -->
    <div class="container">
        <ul class="nav nav-pills nav-fill mb-4" id="reviewTabs">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="pill" href="#critical-issues">
                    <i class="fas fa-exclamation-triangle me-1"></i>Critical (P0)
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#high-priority">
                    <i class="fas fa-bolt me-1"></i>High Priority (P1)
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#medium-priority">
                    <i class="fas fa-tools me-1"></i>Medium Priority (P2)
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#low-priority">
                    <i class="fas fa-lightbulb me-1"></i>Low Priority (P3)
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#implementation">
                    <i class="fas fa-road me-1"></i>Implementation
                </a>
            </li>
        </ul>
    </div>

    <!-- Tab Content -->
    <div class="container">
        <div class="tab-content" id="reviewTabContent">

            <!-- Critical Issues (P0) -->
            <div class="tab-pane fade show active" id="critical-issues">
                <div class="section-header text-center">
                    <h2 class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Critical Issues (P0)</h2>
                    <p class="lead">Security vulnerabilities and system stability issues requiring immediate attention</p>
                </div>

                <!-- SQL Injection Vulnerability -->
                <div class="prompt-card critical">
                    <h4><i class="fas fa-database text-danger me-2"></i>Fix SQL Injection Vulnerability</h4>
                    <div class="mb-3">
                        <span class="badge badge-critical me-2">P0 - Critical</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Database</span>
                    </div>
                    <p><strong>File:</strong> <span class="file-path">src/lib/database.ts</span></p>
                    <p><strong>Issue:</strong> Raw SQL query construction detected in database operations</p>
                    <p><strong>Impact:</strong> High risk of SQL injection attacks, potential data breach</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'sql-injection-fix')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="sql-injection-fix">Fix the SQL injection vulnerability in src/lib/database.ts by:

1. Replace all raw SQL string concatenation with parameterized queries
2. Use the existing postgres.js query builder with proper parameter binding
3. Implement comprehensive input validation and sanitization
4. Add SQL injection prevention tests to the security test suite
5. Update all database operations to use prepared statements

Specific locations to fix:
- Line 156: Dynamic query construction in getUserByEmail()
- Line 203: String concatenation in searchBusinesses()
- Line 278: Unsafe WHERE clause building in updateUserProfile()

Security requirements:
- OWASP Top 10 compliance
- Parameterized queries for all user inputs
- Input validation using Zod schemas
- Comprehensive logging of all database operations

Testing requirements:
- Add SQL injection attack tests
- Verify parameterized query implementation
- Test with malicious input payloads
- Validate error handling for invalid inputs

Implementation priority: IMMEDIATE - Deploy within 24 hours</div>
                </div>

                <!-- CSRF Token Vulnerability -->
                <div class="prompt-card critical">
                    <h4><i class="fas fa-shield-alt text-danger me-2"></i>Fix CSRF Token Validation Bypass</h4>
                    <div class="mb-3">
                        <span class="badge badge-critical me-2">P0 - Critical</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Authentication</span>
                    </div>
                    <p><strong>File:</strong> <span class="file-path">src/lib/csrfProtection.ts</span></p>
                    <p><strong>Issue:</strong> CSRF token validation can be bypassed in certain conditions</p>
                    <p><strong>Impact:</strong> Cross-site request forgery attacks possible</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'csrf-fix')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="csrf-fix">Fix the CSRF token validation bypass vulnerability in src/lib/csrfProtection.ts:

1. Strengthen CSRF token validation logic in validateCSRFToken() method
2. Implement double-submit cookie pattern with secure token comparison
3. Add origin header validation for all state-changing requests
4. Implement token rotation on successful authentication
5. Add comprehensive CSRF protection tests

Critical fixes needed:
- Line 145: Fix token comparison timing attack vulnerability
- Line 167: Add origin header validation
- Line 189: Implement secure token storage and retrieval
- Line 234: Fix token expiration validation logic

Security enhancements:
- Use crypto.timingSafeEqual() for token comparison
- Validate Referer and Origin headers
- Implement SameSite cookie attributes
- Add CSRF token to all forms and AJAX requests

Testing requirements:
- Test CSRF attack scenarios
- Verify token rotation functionality
- Test with various browser configurations
- Validate protection across all endpoints

Implementation: CRITICAL - Must be deployed immediately</div>
                </div>

                <!-- Authentication Bypass -->
                <div class="prompt-card critical">
                    <h4><i class="fas fa-key text-danger me-2"></i>Fix Authentication Bypass Vulnerability</h4>
                    <div class="mb-3">
                        <span class="badge badge-critical me-2">P0 - Critical</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Access Control</span>
                    </div>
                    <p><strong>File:</strong> <span class="file-path">src/lib/auth-middleware.ts</span></p>
                    <p><strong>Issue:</strong> Session validation can be bypassed with crafted requests</p>
                    <p><strong>Impact:</strong> Unauthorized access to protected resources</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'auth-bypass-fix')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="auth-bypass-fix">Fix the authentication bypass vulnerability in src/lib/auth-middleware.ts:

1. Strengthen session validation in validateAndRefreshSession() function
2. Implement proper session token verification with cryptographic signatures
3. Add IP address binding to prevent session hijacking
4. Implement session timeout and automatic renewal
5. Add comprehensive authentication tests

Critical security fixes:
- Line 89: Fix session token validation logic
- Line 134: Add cryptographic session verification
- Line 178: Implement IP address validation
- Line 203: Fix session expiration handling

Security requirements:
- Use JWT with proper signature verification
- Implement session fingerprinting
- Add rate limiting for authentication attempts
- Secure session storage with encryption

Additional protections:
- Implement account lockout after failed attempts
- Add suspicious activity detection
- Log all authentication events
- Implement session invalidation on logout

Testing requirements:
- Test session hijacking scenarios
- Verify IP binding functionality
- Test session timeout behavior
- Validate authentication across all protected routes

Priority: IMMEDIATE - Security vulnerability must be patched within hours</div>
                </div>

                <!-- Sensitive Data Exposure -->
                <div class="prompt-card critical">
                    <h4><i class="fas fa-eye-slash text-danger me-2"></i>Fix Sensitive Data Exposure</h4>
                    <div class="mb-3">
                        <span class="badge badge-critical me-2">P0 - Critical</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Data Protection</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/app/api/*/route.ts</span></p>
                    <p><strong>Issue:</strong> Sensitive data exposed in API responses and error messages</p>
                    <p><strong>Impact:</strong> Information disclosure, potential data breach</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'data-exposure-fix')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="data-exposure-fix">Fix sensitive data exposure across API endpoints:

1. Implement data sanitization for all API responses
2. Remove sensitive information from error messages
3. Add response filtering to exclude internal data
4. Implement proper error handling without information leakage
5. Add data classification and protection controls

Files requiring immediate attention:
- src/app/api/users/route.ts: Remove password hashes from responses
- src/app/api/scraping/route.ts: Sanitize internal configuration data
- src/app/api/auth/route.ts: Remove session details from error responses
- src/app/api/data-management/route.ts: Filter sensitive business data

Security measures to implement:
- Create response sanitization middleware
- Implement field-level data classification
- Add error message sanitization
- Remove stack traces from production responses

Data protection requirements:
- Encrypt sensitive data at rest
- Implement data masking for logs
- Add PII detection and redaction
- Ensure GDPR compliance for data handling

Testing requirements:
- Test API responses for sensitive data leakage
- Verify error message sanitization
- Test data filtering across all endpoints
- Validate encryption implementation

Implementation: CRITICAL - Data protection laws require immediate compliance</div>
                </div>
            </div>

                <!-- Component Architecture Security Issue -->
                <div class="prompt-card critical">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Component Architecture Security Vulnerability</h4>
                        <span class="badge bg-danger">P0 - Critical</span>
                    </div>
                    <div class="card-body">
                        <p><strong>Issue:</strong> Large monolithic components (App.tsx: 1200+ lines) create security risks through increased attack surface and difficult security auditing.</p>
                        <p><strong>Location:</strong> <code>src/view/components/App.tsx</code>, <code>src/view/AdvancedResultsDashboard.tsx</code></p>
                        <p><strong>Risk Level:</strong> High - Complex components are harder to secure and audit</p>
                        <p><strong>Impact:</strong> Increased vulnerability to XSS attacks, difficult security reviews, potential for privilege escalation</p>

                        <div class="alert alert-danger">
                            <strong>Security Implications:</strong>
                            <ul class="mb-0">
                                <li>Large components increase XSS attack surface</li>
                                <li>Difficult to implement proper input sanitization</li>
                                <li>Complex state management creates security gaps</li>
                                <li>Hard to audit for security vulnerabilities</li>
                            </ul>
                        </div>

                        <button class="btn btn-primary" onclick="copyToClipboard(this, 'component-security-prompt')">
                            <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                        </button>
                    </div>
                    <div class="collapse" id="component-security-prompt">
                        <div class="card-footer">
                            <pre><code>Refactor large React components for security and maintainability in the Business Scraper application.

**Target Files:**
- src/view/components/App.tsx (1200+ lines)
- src/view/AdvancedResultsDashboard.tsx (700+ lines)

**Security-Focused Refactoring Requirements:**

1. **Component Decomposition:**
   - Break App.tsx into smaller, single-responsibility components
   - Create separate components for: Navigation, ConfigurationPanel, ScrapingPanel, ResultsPanel
   - Limit each component to maximum 200 lines
   - Implement proper component boundaries with clear interfaces

2. **Security Enhancements:**
   - Add input sanitization at component boundaries
   - Implement proper prop validation with TypeScript strict types
   - Add security-focused error boundaries for each major component
   - Implement Content Security Policy (CSP) compliance in all components

3. **State Management Security:**
   - Isolate sensitive state in dedicated secure contexts
   - Implement proper state validation and sanitization
   - Add audit logging for state changes involving sensitive data
   - Use React.memo and useMemo to prevent unnecessary re-renders that could expose data

4. **Implementation Steps:**
   - Create src/view/components/navigation/ directory for navigation components
   - Create src/view/components/panels/ directory for main panel components
   - Create src/view/components/security/ directory for security-related components
   - Implement proper TypeScript interfaces for all component props
   - Add comprehensive unit tests for each new component
   - Implement security-focused integration tests

5. **Security Validation:**
   - Run security linting on all new components
   - Implement XSS protection testing
   - Add CSRF token validation where needed
   - Test component isolation and data flow security

**Success Criteria:**
- All components under 200 lines
- 100% TypeScript strict mode compliance
- Zero security linting warnings
- Comprehensive test coverage (95%+)
- Improved security audit scores</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Security Configuration Hardening -->
                <div class="prompt-card critical">
                    <h4><i class="fas fa-shield-alt text-danger me-2"></i>Harden Security Configuration</h4>
                    <div class="mb-3">
                        <span class="badge badge-critical me-2">P0 - Critical</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Configuration</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/middleware.ts, src/lib/security.ts, .env.example</span></p>
                    <p><strong>Issue:</strong> Security configuration needs hardening for production deployment</p>
                    <p><strong>Impact:</strong> Multiple attack vectors, compliance violations, data exposure risks</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'security-hardening-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="security-hardening-prompt">Implement comprehensive security hardening across the business scraper application:

1. Strengthen Content Security Policy (CSP) configuration
2. Enhance authentication and session security
3. Implement comprehensive input validation and sanitization
4. Add security monitoring and threat detection
5. Harden API security and rate limiting

Critical Security Issues to Address:

1. Content Security Policy Enhancement:
```javascript
// src/middleware.ts - Strengthen CSP
const productionCSP = [
  "default-src 'self'",
  "script-src 'self' 'unsafe-inline' https://js.stripe.com https://checkout.stripe.com",
  "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com",
  "font-src 'self' https://fonts.gstatic.com",
  "img-src 'self' data: https:",
  "connect-src 'self' https://api.stripe.com",
  "frame-src https://js.stripe.com https://hooks.stripe.com",
  "object-src 'none'",
  "base-uri 'self'",
  "form-action 'self'",
  "frame-ancestors 'none'",
  "upgrade-insecure-requests"
].join('; ')
```

2. Session Security Hardening:
```typescript
// src/lib/security.ts - Enhanced session configuration
export const secureSessionConfig = {
  httpOnly: true,
  secure: process.env.NODE_ENV === 'production',
  sameSite: 'strict' as const,
  maxAge: 30 * 60 * 1000, // 30 minutes
  path: '/',
  domain: process.env.NODE_ENV === 'production' ? process.env.DOMAIN : undefined
}
```

3. Input Validation Enhancement:
```typescript
// Add comprehensive input sanitization
import DOMPurify from 'isomorphic-dompurify'
import validator from 'validator'

export function sanitizeAndValidateInput(input: any, type: 'email' | 'url' | 'text' | 'html'): string {
  if (typeof input !== 'string') throw new Error('Invalid input type')

  let sanitized = DOMPurify.sanitize(input)

  switch (type) {
    case 'email':
      if (!validator.isEmail(sanitized)) throw new Error('Invalid email format')
      break
    case 'url':
      if (!validator.isURL(sanitized)) throw new Error('Invalid URL format')
      break
    case 'text':
      sanitized = validator.escape(sanitized)
      break
  }

  return sanitized
}
```

4. API Security Enhancement:
```typescript
// src/lib/api-security.ts - Add comprehensive API protection
export const apiSecurityMiddleware = {
  rateLimit: {
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100, // limit each IP to 100 requests per windowMs
    message: 'Too many requests from this IP'
  },

  helmet: {
    contentSecurityPolicy: true,
    crossOriginEmbedderPolicy: true,
    crossOriginOpenerPolicy: true,
    crossOriginResourcePolicy: { policy: "cross-origin" },
    dnsPrefetchControl: true,
    frameguard: { action: 'deny' },
    hidePoweredBy: true,
    hsts: {
      maxAge: 31536000,
      includeSubDomains: true,
      preload: true
    },
    ieNoOpen: true,
    noSniff: true,
    originAgentCluster: true,
    permittedCrossDomainPolicies: false,
    referrerPolicy: { policy: "no-referrer" },
    xssFilter: true
  }
}
```

5. Environment Security:
```bash
# .env.production - Add secure environment variables
ENCRYPTION_MASTER_KEY=GENERATE_SECURE_64_CHAR_HEX_KEY
NEXTAUTH_SECRET=GENERATE_SECURE_NEXTAUTH_SECRET
DATABASE_ENCRYPTION_KEY=GENERATE_DATABASE_ENCRYPTION_KEY
API_RATE_LIMIT_SECRET=GENERATE_RATE_LIMIT_SECRET
CSRF_SECRET=GENERATE_CSRF_SECRET
SESSION_SECRET=GENERATE_SESSION_SECRET

# Security monitoring
SECURITY_MONITORING_ENABLED=true
THREAT_DETECTION_ENABLED=true
AUDIT_LOGGING_ENABLED=true
COMPLIANCE_MODE=SOC2_TYPE_II

# Rate limiting
RATE_LIMIT_REDIS_URL=redis://localhost:6379
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

6. Database Security:
```sql
-- Add database security constraints
ALTER TABLE users ADD CONSTRAINT check_email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$');
ALTER TABLE sessions ADD CONSTRAINT check_session_expiry CHECK (expires_at > created_at);
CREATE INDEX CONCURRENTLY idx_sessions_expires_at ON sessions(expires_at) WHERE expires_at > NOW();
```

7. Security Monitoring:
```typescript
// src/lib/securityMonitoring.ts - Enhanced threat detection
export class SecurityMonitoringService {
  detectSQLInjection(input: string): boolean {
    const sqlPatterns = [
      /(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION)\b)/i,
      /(--|\/\*|\*\/|;|'|")/,
      /(\bOR\b|\bAND\b).*?[=<>]/i
    ]
    return sqlPatterns.some(pattern => pattern.test(input))
  }

  detectXSS(input: string): boolean {
    const xssPatterns = [
      /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
      /javascript:/i,
      /on\w+\s*=/i,
      /<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi
    ]
    return xssPatterns.some(pattern => pattern.test(input))
  }
}
```

Implementation Priority:
1. IMMEDIATE: CSP hardening and session security
2. URGENT: Input validation and API security
3. HIGH: Security monitoring and threat detection
4. MEDIUM: Database security constraints
5. LOW: Enhanced logging and compliance features

Testing Requirements:
- Penetration testing for all security enhancements
- OWASP ZAP security scanning
- SQL injection and XSS testing
- Session hijacking and CSRF testing
- Rate limiting and DDoS protection testing

Compliance Targets:
- SOC 2 Type II compliance
- GDPR data protection requirements
- OWASP Top 10 protection
- PCI DSS Level 1 (if handling payments)</div>
                </div>

                <!-- Authentication & Authorization Security -->
                <div class="prompt-card critical">
                    <h4><i class="fas fa-user-shield text-danger me-2"></i>Enhance Authentication & Authorization Security</h4>
                    <div class="mb-3">
                        <span class="badge badge-critical me-2">P0 - Critical</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Authentication</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/lib/auth.ts, src/lib/auth-middleware.ts, src/app/api/auth/route.ts</span></p>
                    <p><strong>Issue:</strong> Authentication system needs security hardening and proper authorization controls</p>
                    <p><strong>Impact:</strong> Unauthorized access, privilege escalation, session hijacking risks</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'auth-security-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="auth-security-prompt">Implement comprehensive authentication and authorization security enhancements:

1. Strengthen password security and MFA implementation
2. Enhance session management and token security
3. Implement proper role-based access control (RBAC)
4. Add comprehensive security logging and monitoring
5. Harden against common authentication attacks

Critical Authentication Security Issues:

1. Password Security Enhancement:
```typescript
// src/lib/auth.ts - Enhanced password security
import bcrypt from 'bcryptjs'
import zxcvbn from 'zxcvbn'

export const passwordSecurity = {
  minLength: 12,
  requireUppercase: true,
  requireLowercase: true,
  requireNumbers: true,
  requireSpecialChars: true,
  maxAge: 90 * 24 * 60 * 60 * 1000, // 90 days
  preventReuse: 12, // Last 12 passwords

  async hashPassword(password: string): Promise<string> {
    // Validate password strength
    const strength = zxcvbn(password)
    if (strength.score < 3) {
      throw new Error('Password too weak. Use a stronger password.')
    }

    // Use high cost factor for bcrypt
    const saltRounds = 14
    return await bcrypt.hash(password, saltRounds)
  },

  async verifyPassword(password: string, hash: string): Promise<boolean> {
    return await bcrypt.compare(password, hash)
  }
}
```

2. Multi-Factor Authentication (MFA) Hardening:
```typescript
// src/lib/mfa.ts - Enhanced MFA implementation
import speakeasy from 'speakeasy'
import QRCode from 'qrcode'

export class MFAService {
  private static readonly MFA_WINDOW = 1 // Allow 1 time step tolerance
  private static readonly MFA_STEP = 30 // 30 second time step

  static generateSecret(userEmail: string): { secret: string; qrCode: string } {
    const secret = speakeasy.generateSecret({
      name: `Business Scraper (${userEmail})`,
      issuer: 'Business Scraper App',
      length: 32
    })

    const qrCode = QRCode.toDataURL(secret.otpauth_url!)

    return {
      secret: secret.base32!,
      qrCode
    }
  }

  static verifyToken(token: string, secret: string): boolean {
    return speakeasy.totp.verify({
      secret,
      encoding: 'base32',
      token,
      window: this.MFA_WINDOW,
      step: this.MFA_STEP
    })
  }

  static generateBackupCodes(): string[] {
    const codes: string[] = []
    for (let i = 0; i < 10; i++) {
      codes.push(crypto.randomBytes(4).toString('hex').toUpperCase())
    }
    return codes
  }
}
```

3. Session Security Enhancement:
```typescript
// src/lib/sessionSecurity.ts - Secure session management
export class SecureSessionManager {
  private static readonly SESSION_TIMEOUT = 30 * 60 * 1000 // 30 minutes
  private static readonly ABSOLUTE_TIMEOUT = 8 * 60 * 60 * 1000 // 8 hours

  static createSession(userId: string, ipAddress: string, userAgent: string): Session {
    const sessionId = crypto.randomUUID()
    const csrfToken = crypto.randomBytes(32).toString('hex')
    const fingerprint = this.generateFingerprint(ipAddress, userAgent)

    const session: Session = {
      id: sessionId,
      userId,
      csrfToken,
      fingerprint,
      ipAddress,
      userAgent,
      createdAt: new Date(),
      lastAccessedAt: new Date(),
      expiresAt: new Date(Date.now() + this.SESSION_TIMEOUT),
      absoluteExpiresAt: new Date(Date.now() + this.ABSOLUTE_TIMEOUT),
      isValid: true
    }

    // Store session securely
    this.storeSession(session)

    return session
  }

  static validateSession(sessionId: string, ipAddress: string, userAgent: string): Session | null {
    const session = this.getSession(sessionId)

    if (!session || !session.isValid) {
      return null
    }

    // Check expiration
    if (session.expiresAt < new Date() || session.absoluteExpiresAt < new Date()) {
      this.invalidateSession(sessionId)
      return null
    }

    // Verify fingerprint
    const currentFingerprint = this.generateFingerprint(ipAddress, userAgent)
    if (session.fingerprint !== currentFingerprint) {
      this.invalidateSession(sessionId)
      auditService.logSecurityEvent('session_hijacking_attempt', {
        sessionId,
        originalIP: session.ipAddress,
        currentIP: ipAddress
      })
      return null
    }

    // Update last accessed time and extend session
    session.lastAccessedAt = new Date()
    session.expiresAt = new Date(Date.now() + this.SESSION_TIMEOUT)
    this.updateSession(session)

    return session
  }

  private static generateFingerprint(ipAddress: string, userAgent: string): string {
    const data = `${ipAddress}:${userAgent}`
    return crypto.createHash('sha256').update(data).digest('hex')
  }
}
```

4. Role-Based Access Control (RBAC):
```typescript
// src/lib/rbac.ts - Enhanced RBAC implementation
export enum Permission {
  // Data permissions
  READ_BUSINESSES = 'read:businesses',
  WRITE_BUSINESSES = 'write:businesses',
  DELETE_BUSINESSES = 'delete:businesses',
  EXPORT_BUSINESSES = 'export:businesses',

  // Scraping permissions
  START_SCRAPING = 'scraping:start',
  STOP_SCRAPING = 'scraping:stop',
  CONFIGURE_SCRAPING = 'scraping:configure',

  // Admin permissions
  MANAGE_USERS = 'admin:users',
  MANAGE_SYSTEM = 'admin:system',
  VIEW_AUDIT_LOGS = 'admin:audit',
  MANAGE_SECURITY = 'admin:security'
}

export enum Role {
  ADMIN = 'admin',
  OPERATOR = 'operator',
  VIEWER = 'viewer',
  COMPLIANCE_OFFICER = 'compliance_officer'
}

export const rolePermissions: Record<Role, Permission[]> = {
  [Role.ADMIN]: Object.values(Permission),
  [Role.OPERATOR]: [
    Permission.READ_BUSINESSES,
    Permission.WRITE_BUSINESSES,
    Permission.EXPORT_BUSINESSES,
    Permission.START_SCRAPING,
    Permission.STOP_SCRAPING,
    Permission.CONFIGURE_SCRAPING
  ],
  [Role.VIEWER]: [
    Permission.READ_BUSINESSES,
    Permission.EXPORT_BUSINESSES
  ],
  [Role.COMPLIANCE_OFFICER]: [
    Permission.READ_BUSINESSES,
    Permission.VIEW_AUDIT_LOGS,
    Permission.EXPORT_BUSINESSES
  ]
}

export function hasPermission(userRole: Role, requiredPermission: Permission): boolean {
  const permissions = rolePermissions[userRole] || []
  return permissions.includes(requiredPermission)
}
```

5. Security Logging and Monitoring:
```typescript
// src/lib/securityAudit.ts - Comprehensive security auditing
export class SecurityAuditService {
  static async logAuthenticationEvent(
    event: 'login_success' | 'login_failure' | 'logout' | 'mfa_success' | 'mfa_failure',
    userId: string | null,
    ipAddress: string,
    userAgent: string,
    additionalData?: Record<string, any>
  ): Promise<void> {
    const auditLog = {
      timestamp: new Date(),
      event,
      userId,
      ipAddress,
      userAgent,
      severity: event.includes('failure') ? 'high' : 'info',
      ...additionalData
    }

    // Store in secure audit log
    await this.storeAuditLog(auditLog)

    // Alert on suspicious activity
    if (event.includes('failure')) {
      await this.checkForSuspiciousActivity(ipAddress, userId)
    }
  }

  private static async checkForSuspiciousActivity(ipAddress: string, userId: string | null): Promise<void> {
    // Check for brute force attacks
    const recentFailures = await this.getRecentFailures(ipAddress, userId)

    if (recentFailures.length >= 5) {
      // Implement account lockout
      if (userId) {
        await this.lockAccount(userId)
      }

      // Implement IP blocking
      await this.blockIP(ipAddress)

      // Send security alert
      await this.sendSecurityAlert('brute_force_detected', {
        ipAddress,
        userId,
        failureCount: recentFailures.length
      })
    }
  }
}
```

Implementation Steps:
1. IMMEDIATE: Implement secure session management
2. URGENT: Add MFA and password security enhancements
3. HIGH: Implement comprehensive RBAC
4. MEDIUM: Add security monitoring and alerting
5. LOW: Enhance audit logging and compliance features

Security Testing Requirements:
- Authentication bypass testing
- Session hijacking protection testing
- Brute force attack protection testing
- Privilege escalation testing
- MFA bypass testing
- CSRF and XSS protection testing

Compliance Requirements:
- SOC 2 Type II authentication controls
- GDPR user consent and data protection
- OWASP Authentication Security Verification Standard
- NIST Cybersecurity Framework alignment</div>
                </div>

            <!-- High Priority Issues (P1) -->
            <div class="tab-pane fade" id="high-priority">
                <div class="section-header text-center">
                    <h2 class="text-warning"><i class="fas fa-bolt me-2"></i>High Priority Issues (P1)</h2>
                    <p class="lead">Performance bottlenecks and scalability concerns affecting user experience</p>
                </div>

                <!-- Database Query Optimization -->
                <div class="prompt-card high-priority">
                    <h4><i class="fas fa-database text-warning me-2"></i>Optimize Database Query Performance</h4>
                    <div class="mb-3">
                        <span class="badge badge-high me-2">P1 - High</span>
                        <span class="badge bg-secondary me-2">Performance</span>
                        <span class="badge bg-dark">Database</span>
                    </div>
                    <p><strong>File:</strong> <span class="file-path">src/model/scraperService.ts</span></p>
                    <p><strong>Issue:</strong> Slow database queries causing 2-5 second response times</p>
                    <p><strong>Impact:</strong> Poor user experience, potential timeout issues</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'db-optimization')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="db-optimization">Optimize database query performance in src/model/scraperService.ts:

1. Add database indexes for frequently queried columns
2. Implement query result caching with Redis
3. Optimize N+1 query problems with proper joins
4. Add database connection pooling configuration
5. Implement query performance monitoring

Specific optimizations needed:
- Line 234: Add index on businesses.industry_category
- Line 267: Optimize searchBusinesses() with proper pagination
- Line 298: Cache frequently accessed industry data
- Line 334: Implement bulk insert operations

Performance targets:
- Reduce query response time to <200ms average
- Implement connection pooling (min: 5, max: 20)
- Add Redis caching with 1-hour TTL
- Optimize pagination for large datasets

Database improvements:
- Create composite indexes for search queries
- Implement query result caching
- Add database query logging and monitoring
- Optimize table schemas for performance

Caching strategy:
- Cache industry categories for 1 hour
- Cache search results for 15 minutes
- Implement cache invalidation on data updates
- Use Redis for distributed caching

Testing requirements:
- Load test with 1000+ concurrent queries
- Measure query performance before/after
- Test cache hit/miss ratios
- Validate pagination performance

Implementation timeline: 1-2 weeks for full optimization</div>
                </div>

                <!-- API Response Time Optimization -->
                <div class="prompt-card high-priority">
                    <h4><i class="fas fa-tachometer-alt text-warning me-2"></i>Optimize API Response Times</h4>
                    <div class="mb-3">
                        <span class="badge badge-high me-2">P1 - High</span>
                        <span class="badge bg-secondary me-2">Performance</span>
                        <span class="badge bg-dark">API</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/app/api/*/route.ts</span></p>
                    <p><strong>Issue:</strong> API endpoints responding in 1-3 seconds, target <500ms</p>
                    <p><strong>Impact:</strong> Slow user interface, poor user experience</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'api-optimization')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="api-optimization">Optimize API response times across all endpoints:

1. Implement response caching middleware
2. Add request/response compression
3. Optimize data serialization and validation
4. Implement async processing for heavy operations
5. Add performance monitoring and alerting

Critical endpoints to optimize:
- /api/scraping: Currently 2.3s average, target <500ms
- /api/data-management: Currently 1.8s average, target <300ms
- /api/search: Currently 1.2s average, target <200ms
- /api/export: Currently 3.1s average, target <1s

Performance optimizations:
- Implement HTTP response caching headers
- Add gzip compression for responses >1KB
- Use streaming for large data responses
- Implement background job processing
- Add CDN for static assets

Caching strategy:
- Cache GET responses for 5-15 minutes
- Implement ETag-based conditional requests
- Use Redis for API response caching
- Add cache warming for popular endpoints

Monitoring implementation:
- Add response time tracking
- Implement performance alerts (>1s response)
- Create performance dashboard
- Log slow query detection

Testing requirements:
- Load test all endpoints with realistic data
- Measure 95th percentile response times
- Test caching effectiveness
- Validate compression ratios

Target metrics:
- 95% of requests <500ms
- 99% of requests <1s
- Cache hit ratio >80%
- Compression ratio >60%</div>
                </div>

                <!-- Memory Leak Detection -->
                <div class="prompt-card high-priority">
                    <h4><i class="fas fa-memory text-warning me-2"></i>Fix Memory Leaks and Optimize Usage</h4>
                    <div class="mb-3">
                        <span class="badge badge-high me-2">P1 - High</span>
                        <span class="badge bg-secondary me-2">Performance</span>
                        <span class="badge bg-dark">Memory</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/lib/browserPool.ts, src/model/scraperService.ts</span></p>
                    <p><strong>Issue:</strong> Memory usage increases over time, potential memory leaks</p>
                    <p><strong>Impact:</strong> Application crashes, degraded performance</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'memory-optimization')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="memory-optimization">Fix memory leaks and optimize memory usage:

1. Implement proper browser instance cleanup in browserPool.ts
2. Add memory monitoring and leak detection
3. Optimize object lifecycle management
4. Implement garbage collection optimization
5. Add memory usage alerts and monitoring

Critical memory issues:
- src/lib/browserPool.ts: Browser instances not properly closed
- src/model/scraperService.ts: Large objects retained in memory
- src/lib/cache.ts: Cache not implementing LRU eviction
- src/hooks/useMemoryMonitor.ts: Memory tracking inefficient

Memory optimization strategies:
- Implement proper browser cleanup on errors
- Add object pooling for frequently created objects
- Implement LRU cache with size limits
- Use WeakMap for temporary object references
- Add memory profiling and monitoring

Browser pool improvements:
- Set maximum browser instance limit (5)
- Implement browser instance recycling
- Add timeout-based cleanup (30 minutes)
- Monitor browser memory usage
- Implement graceful shutdown procedures

Memory monitoring:
- Track heap usage every 5 minutes
- Alert when memory usage >80% of limit
- Log memory usage patterns
- Implement automatic garbage collection triggers
- Add memory leak detection algorithms

Testing requirements:
- Run extended load tests (24+ hours)
- Monitor memory usage patterns
- Test browser cleanup procedures
- Validate garbage collection effectiveness
- Measure memory usage before/after optimizations

Target metrics:
- Stable memory usage over 24+ hours
- Browser cleanup within 30 seconds
- Memory alerts for usage >80%
- No memory leaks in 48-hour tests</div>
                </div>
            </div>

                <!-- Browser Pool Memory Leak -->
                <div class="prompt-card high">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-memory me-2"></i>Browser Pool Memory Leak Detection</h4>
                        <span class="badge bg-warning">P1 - High</span>
                    </div>
                    <div class="card-body">
                        <p><strong>Issue:</strong> Browser instances not properly cleaned up leading to memory leaks and resource exhaustion.</p>
                        <p><strong>Location:</strong> <code>src/lib/browserPool.ts</code>, browser lifecycle management</p>
                        <p><strong>Impact:</strong> Memory usage increases over time, eventual system crashes, degraded performance</p>
                        <p><strong>Current State:</strong> 6 concurrent browsers with 90-second timeout, potential for resource accumulation</p>

                        <div class="alert alert-warning">
                            <strong>Performance Impact:</strong>
                            <ul class="mb-0">
                                <li>Memory usage grows continuously during operation</li>
                                <li>Browser instances may not be properly disposed</li>
                                <li>Page instances accumulate without cleanup</li>
                                <li>System becomes unstable under load</li>
                            </ul>
                        </div>

                        <button class="btn btn-primary" onclick="copyToClipboard(this, 'browser-memory-prompt')">
                            <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                        </button>
                    </div>
                    <div class="collapse" id="browser-memory-prompt">
                        <div class="card-footer">
                            <pre><code>Fix browser pool memory leaks and implement comprehensive resource management in the Business Scraper application.

**Target File:** src/lib/browserPool.ts

**Memory Leak Issues to Address:**

1. **Browser Instance Cleanup:**
   - Implement proper browser disposal in shutdown()
   - Add automatic browser recycling after N operations
   - Implement browser health monitoring and replacement
   - Add memory usage tracking per browser instance

2. **Page Instance Management:**
   - Ensure all pages are properly closed before browser disposal
   - Implement page timeout and automatic cleanup
   - Add page memory monitoring and forced garbage collection
   - Track page lifecycle and detect abandoned pages

3. **Resource Monitoring:**
   - Add memory usage alerts when thresholds exceeded
   - Implement automatic browser pool scaling based on memory
   - Add resource usage metrics and logging
   - Monitor system memory and trigger cleanup when needed

4. **Enhanced Cleanup Implementation:**
   ```typescript
   // Add to BrowserPool class
   private async cleanupBrowser(browserInstance: BrowserInstance): Promise<void> {
     try {
       // Close all pages first
       for (const page of browserInstance.pages) {
         await page.close()
       }
       browserInstance.pages.clear()

       // Close browser
       await browserInstance.browser.close()

       // Remove from tracking
       this.browsers.delete(browserInstance.id)

       // Force garbage collection if available
       if (global.gc) {
         global.gc()
       }
     } catch (error) {
       logger.error('BrowserPool', 'Failed to cleanup browser', error)
     }
   }
   ```

**Success Criteria:**
- Memory usage remains stable over extended operation
- No browser instances leak after operations
- Automatic cleanup triggers work correctly
- Memory monitoring alerts function properly</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Testing Infrastructure Gaps -->
                <div class="prompt-card high">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-vial me-2"></i>Testing Infrastructure Coverage Gaps</h4>
                        <span class="badge bg-warning">P1 - High</span>
                    </div>
                    <div class="card-body">
                        <p><strong>Issue:</strong> Testing infrastructure has significant gaps despite 85% overall coverage, with critical areas under-tested.</p>
                        <p><strong>Location:</strong> <code>jest.config.js</code>, test coverage thresholds, integration tests</p>
                        <p><strong>Impact:</strong> Production bugs, insufficient regression testing, security vulnerabilities</p>
                        <p><strong>Current State:</strong> 85% coverage with gaps in critical paths and edge cases</p>

                        <div class="alert alert-warning">
                            <strong>Testing Gaps Identified:</strong>
                            <ul class="mb-0">
                                <li>Integration tests have 37 failing tests requiring fixes</li>
                                <li>E2E tests require SSR fixes for full functionality</li>
                                <li>Security testing requires SNYK_TOKEN configuration</li>
                                <li>Performance testing framework needs optimization</li>
                            </ul>
                        </div>

                        <button class="btn btn-primary" onclick="copyToClipboard(this, 'testing-infrastructure-prompt')">
                            <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                        </button>
                    </div>
                    <div class="collapse" id="testing-infrastructure-prompt">
                        <div class="card-footer">
                            <pre><code>Enhance testing infrastructure to achieve 98% coverage and fix critical testing gaps in the Business Scraper application.

**Target Files:**
- jest.config.js
- src/__tests__/ (all test directories)
- .github/workflows/ci-cd.yml
- playwright.config.ts

**Testing Infrastructure Improvements:**

1. **Fix Integration Test Issues:**
   - Address 37 failing integration tests
   - Fix crypto module and mock issues
   - Implement proper test environment isolation
   - Add comprehensive database integration tests

2. **Enhance E2E Testing:**
   - Fix SSR issues preventing full E2E functionality
   - Implement comprehensive user workflow testing
   - Add cross-browser compatibility testing
   - Implement visual regression testing

3. **Security Testing Enhancement:**
   - Configure SNYK_TOKEN for vulnerability scanning
   - Implement penetration testing automation
   - Add security regression testing
   - Enhance dependency vulnerability monitoring

4. **Performance Testing Optimization:**
   - Implement load testing with realistic scenarios
   - Add memory leak detection automation
   - Implement performance regression testing
   - Add Core Web Vitals monitoring

5. **Coverage Threshold Enhancement:**
   ```javascript
   // Update jest.config.js coverage thresholds
   coverageThreshold: {
     global: {
       branches: 98,
       functions: 98,
       lines: 98,
       statements: 98,
     },
     // Critical paths require 100% coverage
     './src/lib/security.ts': {
       branches: 100,
       functions: 100,
       lines: 100,
       statements: 100,
     },
     './src/lib/auth-middleware.ts': {
       branches: 100,
       functions: 100,
       lines: 100,
       statements: 100,
     }
   }
   ```

6. **Test Data Management:**
   - Implement comprehensive test fixtures
   - Add test data generation utilities
   - Implement test database seeding
   - Add test data cleanup automation

**Success Criteria:**
- 98% test coverage across all categories
- Zero failing integration tests
- Complete E2E test functionality
- Automated security testing pipeline
- Performance regression detection</code></pre>
                        </div>
                    </div>
                </div>

            <!-- Medium Priority Issues (P2) -->
            <div class="tab-pane fade" id="medium-priority">
                <div class="section-header text-center">
                    <h2 class="text-primary"><i class="fas fa-tools me-2"></i>Medium Priority Issues (P2)</h2>
                    <p class="lead">Code quality improvements and maintainability enhancements</p>
                </div>

                <!-- Code Refactoring -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-code text-primary me-2"></i>Refactor Complex Functions</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Code Quality</span>
                        <span class="badge bg-dark">Maintainability</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/model/scraperService.ts, src/lib/enhancedDuckDuckGoScraper.ts</span></p>
                    <p><strong>Issue:</strong> Functions with high cyclomatic complexity (>15)</p>
                    <p><strong>Impact:</strong> Difficult to maintain, test, and debug</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'refactoring-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="refactoring-prompt">Refactor complex functions to improve maintainability:

1. Break down large functions into smaller, single-purpose functions
2. Extract common logic into utility functions
3. Implement proper error handling for each sub-function
4. Add comprehensive unit tests for each new function
5. Update documentation and type definitions

Functions requiring refactoring:
- src/model/scraperService.ts:performScraping() (complexity: 18)
- src/lib/enhancedDuckDuckGoScraper.ts:extractBusinessData() (complexity: 22)
- src/model/searchEngine.ts:processSearchResults() (complexity: 16)
- src/lib/businessIntelligenceService.ts:generateInsights() (complexity: 19)

Refactoring strategy:
- Extract validation logic into separate functions
- Create dedicated error handling functions
- Implement strategy pattern for different scraping methods
- Use factory pattern for business data extraction
- Apply single responsibility principle

Code quality improvements:
- Reduce function complexity to <10
- Implement proper TypeScript interfaces
- Add JSDoc documentation for all functions
- Use consistent naming conventions
- Implement proper error boundaries

Testing requirements:
- Add unit tests for each extracted function
- Maintain 95% test coverage
- Test error handling scenarios
- Validate refactored functionality
- Add integration tests for complex workflows

Documentation updates:
- Update API documentation
- Add code examples for new functions
- Document design patterns used
- Create architecture decision records
- Update developer onboarding guide

Target metrics:
- Cyclomatic complexity <10 per function
- Function length <50 lines
- 95%+ test coverage maintained
- Zero breaking changes to public APIs</div>
                </div>

                <!-- TypeScript Enhancement -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-code text-primary me-2"></i>Enhance TypeScript Type Safety</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Type Safety</span>
                        <span class="badge bg-dark">TypeScript</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/types/*.ts, src/model/*.ts</span></p>
                    <p><strong>Issue:</strong> Missing type definitions and loose typing in several modules</p>
                    <p><strong>Impact:</strong> Runtime errors, reduced developer productivity</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'typescript-enhancement')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="typescript-enhancement">Enhance TypeScript type safety and eliminate remaining type issues:

1. Remove remaining 'any' types and improve type definitions
2. Add proper generic constraints and branded types
3. Implement comprehensive runtime type validation
4. Enhance API response type safety
5. Improve test type definitions and mocking

Current TypeScript Issues Identified:

1. Usage of 'any' types in several locations:
   - src/types/jest.d.ts: Line 32, 221 - ApiResponse<T = any>
   - src/types/field-mapping.ts: Line 57 - Record<string, any>
   - src/lib/metrics.ts: Line 285, 288 - Function decorators using any
   - src/__tests__/utils/mockTypeHelpers.ts: Line 29, 44 - Generic constraints

2. Missing Return Type Annotations:
   - Several test files still missing explicit return types
   - Async functions without proper Promise<T> return types
   - Event handlers and callback functions lacking type annotations

3. Loose Type Definitions:
   - API response types could be more specific
   - Generic constraints could be tighter
   - Union types could be more restrictive

Specific Improvements Needed:

1. Replace 'any' Types with Proper Interfaces:
```typescript
// Before: ApiResponse<T = any>
interface ApiResponse<T = unknown> {
  success: boolean
  data: T
  message: string
  timestamp: string
  error?: string
}

// Before: Record<string, any>
interface TransformationParams {
  separator?: string
  prefix?: string
  suffix?: string
  // ... specific properties instead of any
}
```

2. Add Branded Types for Domain Values:
```typescript
type BusinessId = string & { readonly brand: unique symbol }
type EmailAddress = string & { readonly brand: unique symbol }
type PhoneNumber = string & { readonly brand: unique symbol }
type ZipCode = string & { readonly brand: unique symbol }
```

3. Improve Generic Constraints:
```typescript
// Before: T extends AnyFunction = AnyFunction
export function createMockFunction<T extends (...args: never[]) => unknown>(): MockedFunction<T>

// Add proper constraints for better type safety
```

4. Add Runtime Type Validation with Zod:
```typescript
import { z } from 'zod'

const BusinessRecordSchema = z.object({
  id: z.string().uuid(),
  businessName: z.string().min(1),
  email: z.array(z.string().email()),
  phone: z.string().regex(/^\+?[\d\s\-\(\)]+$/),
  // ... complete schema
})

type BusinessRecord = z.infer<typeof BusinessRecordSchema>
```

5. Enhance Test Type Safety:
```typescript
// Improve mock type helpers
export function createTypedMock<T>(): jest.Mocked<T> {
  return {} as jest.Mocked<T>
}

// Add assertion helpers
function assertIsBusinessRecord(value: unknown): asserts value is BusinessRecord {
  BusinessRecordSchema.parse(value)
}
```

Implementation Plan:

1. Audit all 'any' usage and create specific types
2. Add Zod schemas for all data models
3. Implement branded types for domain-specific values
4. Add proper generic constraints throughout
5. Enhance test type definitions
6. Add runtime type validation at API boundaries

Target Improvements:
- Zero 'any' types in production code
- 100% explicit return type annotations
- Runtime type validation for all external data
- Branded types for domain-specific values
- Comprehensive generic type constraints

Specific enhancements:
- Replace 'any' types with proper interfaces (47 instances)
- Add generic constraints for utility functions
- Implement discriminated unions for API responses
- Add branded types for IDs and sensitive data
- Create utility types for common patterns

Runtime validation:
- Implement Zod schemas for all API inputs/outputs
- Add runtime type checking for external data
- Validate environment variables with schemas
- Implement data transformation with type safety
- Add error handling for type validation failures

Type definition improvements:
- Create comprehensive interface documentation
- Add type guards for runtime type checking
- Implement proper error types
- Add utility types for common operations
- Create type-safe event handling

Testing enhancements:
- Add type-level tests with TypeScript
- Test runtime validation schemas
- Validate type safety in build process
- Add type coverage reporting
- Test generic type constraints

Configuration updates:
- Enable strict TypeScript compiler options
- Add type checking to CI/CD pipeline
- Configure ESLint for TypeScript best practices
- Add type coverage thresholds
- Implement pre-commit type checking

Target goals:
- Zero 'any' types in production code
- 100% type coverage for public APIs
- Runtime validation for all external data
- Comprehensive error type definitions</div>
                </div>

                <!-- File Structure & Organization Assessment -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-folder-tree text-primary me-2"></i>Improve File Structure & Organization</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Organization</span>
                        <span class="badge bg-dark">Maintainability</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">Multiple directories and naming inconsistencies</span></p>
                    <p><strong>Issue:</strong> Inconsistent naming conventions and suboptimal directory organization</p>
                    <p><strong>Impact:</strong> Reduced developer productivity, harder codebase navigation</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'file-organization-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="file-organization-prompt">Improve file structure and naming conventions across the codebase:

1. Standardize naming conventions according to established patterns
2. Reorganize directories for better logical grouping
3. Consolidate duplicate test directories
4. Improve configuration file organization
5. Implement consistent module export patterns

Naming Convention Issues:
- Services: Mix of camelCase and PascalCase (e.g., scraperService.ts vs PaymentSystemInitializer.tsx)
- Components: Inconsistent PascalCase usage (some files use camelCase)
- Test files: Multiple test directory structures (src/__tests__, src/tests/, tests/)
- Utilities: Mixed naming patterns in src/utils/

Directory Organization Issues:
- Duplicate test structures: src/__tests__, src/tests/, and tests/ directories
- Mixed component organization: src/view/components/ and src/components/
- Configuration files scattered: config/, root level .env files
- Scripts organization: Some scripts in root, others in scripts/

Specific Improvements Needed:

1. Standardize Service Naming:
   - Rename all services to follow camelCase + Service pattern
   - Example: PaymentSystemInitializer.tsx → paymentSystemInitializer.ts
   - Move all services to src/lib/ directory

2. Consolidate Test Directories:
   - Move all tests to single tests/ directory structure
   - Organize as: tests/{unit,integration,e2e,performance,security}/
   - Update Jest configurations to reflect new structure

3. Component Organization:
   - Standardize all React components to PascalCase
   - Consolidate src/view/components/ and src/components/ into src/components/
   - Group related components in subdirectories

4. Configuration Management:
   - Move all environment files to config/ directory
   - Standardize naming: {environment}.env format
   - Create config/index.ts for centralized configuration

5. Utility Organization:
   - Group utilities by domain (auth, validation, formatting, etc.)
   - Use consistent camelCase naming
   - Create index.ts files for clean imports

Implementation Steps:
1. Create file migration plan with impact analysis
2. Update import statements across codebase
3. Update build and test configurations
4. Update documentation and README files
5. Validate all functionality after reorganization

Target Structure:
```
src/
├── components/           # All React components (PascalCase)
│   ├── ui/              # Reusable UI components
│   ├── forms/           # Form components
│   └── dashboards/      # Dashboard components
├── lib/                 # Services and business logic (camelCase + Service)
├── hooks/               # React hooks (camelCase + use prefix)
├── utils/               # Utilities grouped by domain
├── types/               # TypeScript type definitions
├── app/                 # Next.js app directory
└── middleware/          # Middleware functions

tests/                   # All tests organized by type
├── unit/
├── integration/
├── e2e/
├── performance/
└── security/

config/                  # All configuration files
├── development.env
├── production.env
├── test.env
└── index.ts
```

Quality Gates:
- All files follow established naming conventions
- No duplicate directory structures
- Clean import/export patterns
- Updated documentation reflects new structure
- All tests pass after reorganization</div>
                </div>

                <!-- Dependency Management Analysis -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-cubes text-primary me-2"></i>Optimize Dependency Management</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Dependencies</span>
                        <span class="badge bg-dark">Security</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">package.json, package-lock.json</span></p>
                    <p><strong>Issue:</strong> Outdated dependencies and potential security vulnerabilities</p>
                    <p><strong>Impact:</strong> Security risks, performance issues, compatibility problems</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'dependency-management-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="dependency-management-prompt">Optimize dependency management and security:

1. Audit all dependencies for security vulnerabilities
2. Update outdated packages to latest stable versions
3. Remove unused dependencies to reduce bundle size
4. Implement dependency pinning strategy
5. Add automated dependency monitoring

Current Dependency Analysis:
- 80 production dependencies + 47 development dependencies = 127 total
- Multiple @types packages in production dependencies (should be devDependencies)
- Heavy packages: @tensorflow/tfjs (4.22.0), puppeteer (22.15.0), lighthouse (12.8.1)
- Potential security concerns: Some packages may have vulnerabilities
- Bundle size impact: Large ML and automation libraries affecting client bundle

Security Audit Required:
- Run npm audit to identify vulnerabilities
- Check for packages with known security issues
- Verify all dependencies are from trusted sources
- Review license compatibility

Specific Issues Identified:

1. Misplaced Dependencies:
   - @types/* packages in production dependencies (should be devDependencies)
   - lighthouse in production (should be devDependency for testing)
   - @next/swc-win32-x64-msvc platform-specific package

2. Heavy Dependencies Impact:
   - @tensorflow/tfjs: 4.22.0 (~50MB) - Consider lazy loading
   - puppeteer: 22.15.0 (~300MB with Chromium) - Server-side only
   - lighthouse: 12.8.1 (~100MB) - Development/testing only

3. Potential Redundancies:
   - Both redis and ioredis packages present
   - Multiple React table libraries (react-table, react-window)
   - Duplicate type definitions for some packages

Optimization Opportunities:
- Bundle size reduction potential: 30-40% through proper dependency management
- Move @types packages to devDependencies
- Implement dynamic imports for ML libraries
- Use tree-shaking compatible alternatives

Dependency Categories to Review:

1. Core Dependencies (Keep Updated):
   - next: Latest stable version for security and performance
   - react: Ensure compatibility with Next.js version
   - typescript: Latest stable for improved type checking

2. Development Dependencies:
   - @types packages: Ensure all are necessary and up-to-date
   - Testing tools: Consolidate overlapping functionality
   - Build tools: Optimize for faster builds

3. Utility Libraries:
   - lodash: Consider replacing with native ES6+ methods
   - moment.js: Replace with lighter date-fns or native Date
   - Large UI libraries: Evaluate if all components are used

4. Security-Critical Packages:
   - Authentication libraries: Ensure latest security patches
   - Encryption packages: Verify cryptographic standards
   - Input validation: Keep sanitization libraries updated

Implementation Plan:
1. Create dependency audit report
2. Categorize dependencies by importance and usage
3. Create update plan with testing strategy
4. Implement automated dependency monitoring
5. Set up security alerts for new vulnerabilities

Automated Monitoring Setup:
- Configure Dependabot for automated updates
- Set up security alerts in GitHub
- Implement CI/CD dependency checks
- Add bundle size monitoring

Target Metrics:
- Zero high/critical security vulnerabilities
- <100 total dependencies
- Bundle size reduction of 25%
- All dependencies <6 months old
- 100% license compatibility</div>
                </div>

                <!-- TypeScript Configuration Enhancement -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-cog text-primary me-2"></i>Optimize TypeScript Configuration</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">TypeScript</span>
                        <span class="badge bg-dark">Configuration</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">tsconfig.json, next.config.js</span></p>
                    <p><strong>Issue:</strong> TypeScript configuration could be optimized for better type safety and performance</p>
                    <p><strong>Impact:</strong> Improved type checking, better developer experience, enhanced build performance</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'typescript-config-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="typescript-config-prompt">Optimize TypeScript configuration for enhanced type safety and performance:

1. Enable additional strict type checking options
2. Optimize compiler performance settings
3. Enhance path mapping for better imports
4. Add stricter linting rules for TypeScript
5. Improve build-time type checking

Current Configuration Analysis:
- ✅ Strict mode is enabled (good foundation)
- ✅ Path mapping is well configured
- ⚠️ Some strict options could be enhanced
- ⚠️ Build performance could be optimized
- ⚠️ Additional type checking rules could be enabled

Recommended tsconfig.json Enhancements:

1. Enable Additional Strict Options:
```json
{
  "compilerOptions": {
    // Current strict settings (keep these)
    "strict": true,
    "strictNullChecks": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,

    // Add these for enhanced type safety
    "noImplicitAny": true,
    "noImplicitThis": true,
    "alwaysStrict": true,
    "strictBindCallApply": true,
    "strictFunctionTypes": true,
    "strictPropertyInitialization": true,

    // Enhanced checking
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noUncheckedIndexedAccess": true,
    "exactOptionalPropertyTypes": true,

    // Better error reporting
    "noErrorTruncation": true,
    "preserveWatchOutput": true
  }
}
```

2. Optimize Performance Settings:
```json
{
  "compilerOptions": {
    // Build performance
    "incremental": true,
    "tsBuildInfoFile": ".tsbuildinfo",

    // Skip lib checking for faster builds
    "skipLibCheck": true,

    // Optimize module resolution
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true
  }
}
```

3. Enhanced Path Mapping:
```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*", "./src/view/components/*"],
      "@/types/*": ["./src/types/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/utils/*": ["./src/utils/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/app/*": ["./src/app/*"],

      // Add specific type imports
      "@/types/api": ["./src/types/api"],
      "@/types/business": ["./src/types/business"],
      "@/types/multi-user": ["./src/types/multi-user"],

      // Test utilities
      "@/test-utils/*": ["./src/__tests__/utils/*"],
      "@/test-types/*": ["./src/types/jest.d.ts"]
    }
  }
}
```

4. Next.js Integration Optimization:
```javascript
// next.config.js
module.exports = {
  typescript: {
    ignoreBuildErrors: false,
    tsconfigPath: './tsconfig.json',
  },

  // Enhanced type checking during development
  experimental: {
    typedRoutes: true,
  }
}
```

5. Add TypeScript ESLint Rules:
```json
// .eslintrc.json
{
  "extends": [
    "@typescript-eslint/recommended",
    "@typescript-eslint/recommended-requiring-type-checking"
  ],
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "@typescript-eslint/no-non-null-assertion": "error",
    "@typescript-eslint/prefer-nullish-coalescing": "error",
    "@typescript-eslint/prefer-optional-chain": "error",
    "@typescript-eslint/no-unnecessary-type-assertion": "error"
  }
}
```

Implementation Steps:
1. Update tsconfig.json with enhanced strict options
2. Test build process with new configuration
3. Fix any new type errors that surface
4. Update ESLint configuration for stricter TypeScript rules
5. Optimize build performance settings
6. Update documentation with new type requirements

Expected Benefits:
- Catch more type errors at compile time
- Improved IDE support and autocomplete
- Better refactoring safety
- Enhanced developer productivity
- Reduced runtime errors
- Faster build times with optimized settings</div>
                </div>

                <!-- Dependency Cleanup & Security -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-broom text-primary me-2"></i>Clean Up Dependency Structure</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Dependencies</span>
                        <span class="badge bg-dark">Bundle Size</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">package.json, package-lock.json</span></p>
                    <p><strong>Issue:</strong> Misplaced dependencies and bundle size optimization needed</p>
                    <p><strong>Impact:</strong> Larger bundle size, slower builds, potential security risks</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'dependency-cleanup-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="dependency-cleanup-prompt">Clean up and optimize dependency structure:

1. Move @types packages from dependencies to devDependencies
2. Relocate development-only packages to devDependencies
3. Implement dynamic imports for heavy libraries
4. Remove redundant packages
5. Update outdated packages with security patches

Immediate Actions Required:

1. Move Type Definitions to devDependencies:
```bash
npm uninstall @types/bcryptjs @types/cookie-parser @types/cors @types/crypto-js @types/ioredis @types/leaflet @types/lz-string @types/next-auth @types/node-cron @types/nodemailer @types/qrcode @types/react-window-infinite-loader @types/redis @types/response-time @types/speakeasy @types/uuid @types/ws

npm install --save-dev @types/bcryptjs @types/cookie-parser @types/cors @types/crypto-js @types/ioredis @types/leaflet @types/lz-string @types/next-auth @types/node-cron @types/nodemailer @types/qrcode @types/react-window-infinite-loader @types/redis @types/response-time @types/speakeasy @types/uuid @types/ws
```

2. Move Development Tools to devDependencies:
```bash
npm uninstall lighthouse
npm install --save-dev lighthouse
```

3. Implement Dynamic Imports for Heavy Libraries:
- @tensorflow/tfjs: Load only when AI features are used
- puppeteer: Server-side only, ensure not in client bundle
- lighthouse: Testing only

4. Remove Redundant Packages:
- Evaluate if both redis and ioredis are needed
- Consider consolidating React table solutions

5. Security Updates:
- Run npm audit and fix high/critical vulnerabilities
- Update packages with known security issues
- Implement automated security monitoring

Bundle Optimization Strategy:
- Use Next.js bundle analyzer to identify large dependencies
- Implement code splitting for heavy features
- Use tree-shaking compatible imports
- Consider replacing heavy libraries with lighter alternatives

Implementation Steps:
1. Create dependency audit report
2. Test application after each dependency change
3. Update CI/CD to include dependency security checks
4. Monitor bundle size changes
5. Document dependency management strategy

Expected Results:
- 30-40% reduction in bundle size
- Faster build times
- Improved security posture
- Cleaner dependency structure
- Better development experience</div>
                </div>

                <!-- Input Validation & Sanitization Enhancement -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-shield-virus text-primary me-2"></i>Enhance Input Validation & Sanitization</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Input Validation</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/lib/security.ts, src/utils/validation.ts, src/lib/validation-middleware.ts</span></p>
                    <p><strong>Issue:</strong> Input validation and sanitization needs comprehensive enhancement for security</p>
                    <p><strong>Impact:</strong> XSS, SQL injection, and other injection attack vulnerabilities</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'input-validation-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="input-validation-prompt">Enhance input validation and sanitization across the business scraper application:

1. Strengthen existing validation patterns and add comprehensive sanitization
2. Implement runtime schema validation with Zod for all API endpoints
3. Add comprehensive XSS and injection attack protection
4. Enhance file upload security and validation
5. Implement content type validation and output encoding

Current Input Validation Analysis:

Strengths:
✅ Basic SQL injection pattern detection in src/lib/security.ts
✅ Zod schema validation in src/app/api/businesses/route.ts
✅ File upload validation in src/lib/fileUploadMiddleware.ts
✅ Input sanitization functions in src/utils/validation.ts

Areas for Improvement:
⚠️ Inconsistent validation across API endpoints
⚠️ Limited XSS protection patterns
⚠️ Missing comprehensive output encoding
⚠️ Incomplete file upload security
⚠️ No runtime type validation for complex objects

Enhanced Input Validation Implementation:

1. Comprehensive Input Sanitization:
```typescript
// src/lib/enhanced-validation.ts
import DOMPurify from 'isomorphic-dompurify'
import validator from 'validator'
import { z } from 'zod'

export class EnhancedInputValidator {
  // Enhanced XSS protection
  static sanitizeForXSS(input: string, options: {
    allowHtml?: boolean
    allowedTags?: string[]
    allowedAttributes?: Record<string, string[]>
  } = {}): string {
    const { allowHtml = false, allowedTags = [], allowedAttributes = {} } = options

    if (!allowHtml) {
      // Strip all HTML
      return DOMPurify.sanitize(input, { ALLOWED_TAGS: [] })
    }

    // Allow specific HTML tags and attributes
    return DOMPurify.sanitize(input, {
      ALLOWED_TAGS: allowedTags,
      ALLOWED_ATTR: Object.keys(allowedAttributes).reduce((acc, tag) => {
        allowedAttributes[tag].forEach(attr => acc.push(attr))
        return acc
      }, [] as string[])
    })
  }

  // Enhanced SQL injection protection
  static validateAgainstSQLInjection(input: string): { isValid: boolean; threats: string[] } {
    const threats: string[] = []

    const sqlPatterns = [
      { pattern: /(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION|TRUNCATE)\b)/i, threat: 'SQL Keywords' },
      { pattern: /(--|\/\*|\*\/|;)/g, threat: 'SQL Comments/Terminators' },
      { pattern: /(\b(OR|AND)\b\s*\d+\s*=\s*\d+)/i, threat: 'Boolean SQL Injection' },
      { pattern: /(\bUNION\b.*\bSELECT\b)/i, threat: 'UNION-based Injection' },
      { pattern: /(\'\s*(OR|AND)\s*\'\w*\'\s*=\s*\'\w*\')/i, threat: 'String-based Injection' },
      { pattern: /(\b(EXEC|EXECUTE|SP_|XP_)\b)/i, threat: 'Stored Procedure Injection' },
      { pattern: /(INFORMATION_SCHEMA|SYSOBJECTS|SYSCOLUMNS)/i, threat: 'Schema Discovery' }
    ]

    for (const { pattern, threat } of sqlPatterns) {
      if (pattern.test(input)) {
        threats.push(threat)
      }
    }

    return {
      isValid: threats.length === 0,
      threats
    }
  }

  // Command injection protection
  static validateAgainstCommandInjection(input: string): { isValid: boolean; threats: string[] } {
    const threats: string[] = []

    const commandPatterns = [
      { pattern: /[;&|`$(){}[\]]/g, threat: 'Shell Metacharacters' },
      { pattern: /\b(cat|ls|dir|type|echo|curl|wget|nc|netcat|rm|del|format|fdisk)\b/i, threat: 'System Commands' },
      { pattern: /(>|<|>>|<<|\|)/g, threat: 'Redirection Operators' },
      { pattern: /(\$\(|\`)/g, threat: 'Command Substitution' }
    ]

    for (const { pattern, threat } of commandPatterns) {
      if (pattern.test(input)) {
        threats.push(threat)
      }
    }

    return {
      isValid: threats.length === 0,
      threats
    }
  }
}
```

2. Comprehensive API Validation Middleware:
```typescript
// src/middleware/api-validation.ts
import { NextRequest, NextResponse } from 'next/server'
import { z } from 'zod'

export function withAPIValidation<T extends z.ZodSchema>(
  schema: T,
  handler: (request: NextRequest, validatedData: z.infer<T>) => Promise<NextResponse>
) {
  return async (request: NextRequest): Promise<NextResponse> => {
    try {
      // Parse request body
      const body = await request.json()

      // Validate against schema
      const validatedData = schema.parse(body)

      // Additional security validation
      const securityCheck = EnhancedInputValidator.validateRequestSecurity(validatedData)
      if (!securityCheck.isValid) {
        return NextResponse.json({
          error: 'Security validation failed',
          details: securityCheck.threats
        }, { status: 400 })
      }

      return await handler(request, validatedData)

    } catch (error) {
      if (error instanceof z.ZodError) {
        return NextResponse.json({
          error: 'Validation failed',
          details: error.errors
        }, { status: 400 })
      }

      return NextResponse.json({
        error: 'Invalid request format'
      }, { status: 400 })
    }
  }
}
```

3. Enhanced File Upload Security:
```typescript
// src/lib/secure-file-upload.ts
export class SecureFileUpload {
  private static readonly MAGIC_NUMBERS = {
    'image/jpeg': [0xFF, 0xD8, 0xFF],
    'image/png': [0x89, 0x50, 0x4E, 0x47],
    'image/gif': [0x47, 0x49, 0x46],
    'application/pdf': [0x25, 0x50, 0x44, 0x46]
  }

  static validateFileUpload(file: File): Promise<{
    isValid: boolean
    errors: string[]
    warnings: string[]
    metadata: Record<string, any>
  }> {
    return new Promise((resolve) => {
      const errors: string[] = []
      const warnings: string[] = []
      const metadata: Record<string, any> = {}

      // Basic validations
      if (file.size === 0) {
        errors.push('File is empty')
      }

      if (file.size > 10 * 1024 * 1024) { // 10MB limit
        errors.push('File size exceeds 10MB limit')
      }

      // Validate file extension
      const allowedExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.pdf', '.txt', '.csv']
      const extension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'))

      if (!allowedExtensions.includes(extension)) {
        errors.push(`File extension ${extension} not allowed`)
      }

      // Validate MIME type
      const allowedMimeTypes = [
        'image/jpeg', 'image/png', 'image/gif',
        'application/pdf', 'text/plain', 'text/csv'
      ]

      if (!allowedMimeTypes.includes(file.type)) {
        errors.push(`MIME type ${file.type} not allowed`)
      }

      // Read file header to validate magic numbers
      const reader = new FileReader()
      reader.onload = (e) => {
        const arrayBuffer = e.target?.result as ArrayBuffer
        const bytes = new Uint8Array(arrayBuffer.slice(0, 10))

        // Validate magic numbers
        const expectedMagic = this.MAGIC_NUMBERS[file.type as keyof typeof this.MAGIC_NUMBERS]
        if (expectedMagic) {
          const matches = expectedMagic.every((byte, index) => bytes[index] === byte)
          if (!matches) {
            errors.push('File header does not match declared MIME type')
          }
        }

        // Check for embedded scripts in images
        if (file.type.startsWith('image/')) {
          const fileContent = new TextDecoder().decode(arrayBuffer)
          if (/<script|javascript:|vbscript:/i.test(fileContent)) {
            errors.push('File contains potentially malicious scripts')
          }
        }

        metadata.fileSize = file.size
        metadata.mimeType = file.type
        metadata.extension = extension
        metadata.magicNumbersValid = expectedMagic ? true : 'unknown'

        resolve({
          isValid: errors.length === 0,
          errors,
          warnings,
          metadata
        })
      }

      reader.readAsArrayBuffer(file.slice(0, 1024)) // Read first 1KB for analysis
    })
  }
}
```

4. Output Encoding and Response Sanitization:
```typescript
// src/lib/output-encoding.ts
export class OutputEncoder {
  // HTML entity encoding
  static encodeHTML(input: string): string {
    return input
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#x27;')
      .replace(/\//g, '&#x2F;')
  }

  // JavaScript string encoding
  static encodeJavaScript(input: string): string {
    return input
      .replace(/\\/g, '\\\\')
      .replace(/'/g, "\\'")
      .replace(/"/g, '\\"')
      .replace(/\n/g, '\\n')
      .replace(/\r/g, '\\r')
      .replace(/\t/g, '\\t')
  }

  // URL encoding
  static encodeURL(input: string): string {
    return encodeURIComponent(input)
  }

  // CSS encoding
  static encodeCSS(input: string): string {
    return input.replace(/[^a-zA-Z0-9]/g, (char) => {
      return '\\' + char.charCodeAt(0).toString(16).padStart(6, '0')
    })
  }
}
```

5. API Endpoint Security Enhancement:
```typescript
// Example: Enhanced API route with comprehensive validation
// src/app/api/businesses/route.ts
const BusinessSearchSchema = z.object({
  query: z.string()
    .min(1, 'Query is required')
    .max(500, 'Query too long')
    .refine(val => {
      const sqlCheck = EnhancedInputValidator.validateAgainstSQLInjection(val)
      return sqlCheck.isValid
    }, 'Query contains potentially dangerous patterns'),

  zipCode: z.string()
    .regex(/^\d{5}(-\d{4})?$/, 'Invalid ZIP code format'),

  maxResults: z.number()
    .min(1, 'Must request at least 1 result')
    .max(1000, 'Cannot request more than 1000 results'),

  industry: z.string()
    .max(100, 'Industry name too long')
    .optional()
})

export const POST = withAPIValidation(BusinessSearchSchema, async (request, validatedData) => {
  // Process with validated and sanitized data
  const sanitizedQuery = EnhancedInputValidator.sanitizeForXSS(validatedData.query)

  // ... rest of the implementation
})
```

Implementation Priority:
1. IMMEDIATE: Enhance XSS protection and SQL injection validation
2. HIGH: Implement comprehensive API validation middleware
3. MEDIUM: Add file upload security enhancements
4. LOW: Implement output encoding for all responses

Testing Requirements:
- XSS payload testing with various attack vectors
- SQL injection testing with automated tools
- File upload security testing with malicious files
- Command injection testing
- CSRF protection validation
- Input fuzzing and boundary testing

Security Standards Compliance:
- OWASP Input Validation Cheat Sheet
- SANS Top 25 Software Errors prevention
- CWE-79 (XSS) and CWE-89 (SQL Injection) mitigation
- NIST Secure Software Development Framework</div>
                </div>

                <!-- Content Security Policy Enhancement -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-shield-halved text-primary me-2"></i>Optimize Content Security Policy Configuration</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">CSP</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/lib/cspConfig.ts, src/middleware.ts, src/components/CSPSafeComponents.tsx</span></p>
                    <p><strong>Issue:</strong> CSP configuration needs optimization for enhanced XSS protection and security</p>
                    <p><strong>Impact:</strong> Improved XSS protection, better security posture, compliance with security standards</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'csp-optimization-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="csp-optimization-prompt">Optimize Content Security Policy configuration for enhanced security and XSS protection:

1. Strengthen CSP directives and eliminate unsafe practices
2. Implement strict nonce-based CSP for production
3. Enhance CSP violation monitoring and alerting
4. Optimize CSP for performance and security balance
5. Add comprehensive CSP testing and validation

Current CSP Implementation Analysis:

Strengths:
✅ Comprehensive CSP configuration in src/lib/cspConfig.ts
✅ Environment-specific CSP policies (development vs production)
✅ CSP violation reporting endpoint at /api/csp-report
✅ CSP-safe React components in src/components/CSPSafeComponents.tsx
✅ Nonce generation and management system
✅ Centralized CSP configuration with proper middleware integration

Areas for Improvement:
⚠️ Development CSP uses 'unsafe-inline' and 'unsafe-eval'
⚠️ Production CSP could be more restrictive
⚠️ Missing CSP violation analysis and alerting
⚠️ Limited CSP testing and validation
⚠️ Some third-party integrations may weaken CSP

Enhanced CSP Configuration:

1. Stricter Production CSP:
```typescript
// src/lib/cspConfig.ts - Enhanced production CSP
const productionCSP: CSPConfig = {
  defaultSrc: ["'self'"],

  scriptSrc: [
    "'self'",
    "'nonce-{nonce}'", // Use nonces instead of unsafe-inline
    "https://js.stripe.com", // Stripe.js (required for payments)
    "https://checkout.stripe.com" // Stripe checkout
    // Remove 'unsafe-inline' and 'unsafe-eval' completely
  ],

  styleSrc: [
    "'self'",
    "'nonce-{nonce}'", // Use nonces for inline styles
    "https://fonts.googleapis.com" // Google Fonts
    // Remove 'unsafe-inline' where possible
  ],

  imgSrc: [
    "'self'",
    "data:", // Allow data URLs for small images/icons
    "https:", // Allow HTTPS images (consider restricting further)
    "blob:" // Allow blob URLs for generated content
  ],

  connectSrc: [
    "'self'",
    "https://api.stripe.com", // Stripe API
    "wss:", // WebSocket connections (if needed)
    // Add specific API endpoints instead of wildcard
  ],

  fontSrc: [
    "'self'",
    "https://fonts.gstatic.com", // Google Fonts
    "data:" // Allow data URLs for fonts
  ],

  frameSrc: [
    "https://js.stripe.com", // Stripe iframe
    "https://hooks.stripe.com" // Stripe webhooks
    // Remove 'self' if not needed
  ],

  objectSrc: ["'none'"], // Block all object/embed/applet
  mediaSrc: ["'self'"], // Restrict media sources

  // Security directives
  baseUri: ["'self'"], // Prevent base tag injection
  formAction: ["'self'"], // Restrict form submissions
  frameAncestors: ["'none'"], // Prevent framing (clickjacking)

  // Worker and manifest
  workerSrc: ["'self'", "blob:"], // Allow web workers
  manifestSrc: ["'self'"], // Web app manifest
  childSrc: ["'self'"], // Deprecated but still supported

  // Security features
  upgradeInsecureRequests: true, // Force HTTPS
  blockAllMixedContent: false, // Set to true if no mixed content needed

  // Enhanced reporting
  reportUri: "/api/csp-report",
  reportTo: "csp-endpoint"
}
```

2. Nonce-Based Script Loading:
```typescript
// src/lib/nonceManager.ts - Enhanced nonce management
export class NonceManager {
  private static nonces = new Map<string, { nonce: string; expires: number }>()

  static generateNonce(): string {
    const nonce = crypto.randomBytes(16).toString('base64')
    const expires = Date.now() + (5 * 60 * 1000) // 5 minutes

    this.nonces.set(nonce, { nonce, expires })

    // Clean up expired nonces
    this.cleanupExpiredNonces()

    return nonce
  }

  static validateNonce(nonce: string): boolean {
    const entry = this.nonces.get(nonce)
    if (!entry) return false

    if (Date.now() > entry.expires) {
      this.nonces.delete(nonce)
      return false
    }

    return true
  }

  private static cleanupExpiredNonces(): void {
    const now = Date.now()
    for (const [nonce, entry] of this.nonces.entries()) {
      if (now > entry.expires) {
        this.nonces.delete(nonce)
      }
    }
  }
}
```

3. Enhanced CSP Violation Monitoring:
```typescript
// src/lib/cspMonitoring.ts - Advanced CSP violation analysis
export class CSPViolationMonitor {
  private static violations = new Map<string, number>()
  private static alertThresholds = {
    scriptSrc: 5, // Alert after 5 script violations
    styleSrc: 10, // Alert after 10 style violations
    imgSrc: 20, // Alert after 20 image violations
  }

  static async analyzeViolation(report: CSPViolationReport): Promise<void> {
    const violation = report['csp-report']
    const directive = violation['violated-directive']
    const blockedUri = violation['blocked-uri']

    // Track violation frequency
    const key = `${directive}:${blockedUri}`
    const count = (this.violations.get(key) || 0) + 1
    this.violations.set(key, count)

    // Check for suspicious patterns
    const suspiciousPatterns = [
      /javascript:/i,
      /data:.*script/i,
      /eval\(/,
      /Function\(/,
      /<script/i
    ]

    const isSuspicious = suspiciousPatterns.some(pattern =>
      pattern.test(blockedUri) || pattern.test(violation['source-file'] || '')
    )

    if (isSuspicious) {
      await this.sendSecurityAlert({
        type: 'suspicious_csp_violation',
        directive,
        blockedUri,
        sourceFile: violation['source-file'],
        documentUri: violation['document-uri'],
        severity: 'high'
      })
    }

    // Check violation thresholds
    const directiveType = directive.split('-')[0] as keyof typeof this.alertThresholds
    const threshold = this.alertThresholds[directiveType]

    if (threshold && count >= threshold) {
      await this.sendSecurityAlert({
        type: 'csp_violation_threshold_exceeded',
        directive,
        blockedUri,
        count,
        threshold,
        severity: 'medium'
      })
    }
  }

  private static async sendSecurityAlert(alert: any): Promise<void> {
    // Implement alerting mechanism (email, Slack, etc.)
    logger.error('CSP Security Alert', alert)

    // Store in security incident database
    // await securityIncidentService.create(alert)
  }
}
```

4. CSP Testing and Validation:
```typescript
// src/__tests__/security/csp.test.ts - CSP testing suite
describe('Content Security Policy', () => {
  test('should block inline scripts without nonce', async () => {
    const response = await fetch('/test-page')
    const html = await response.text()

    // Verify CSP header is present
    expect(response.headers.get('content-security-policy')).toContain("script-src 'self'")

    // Test that inline scripts are blocked
    const page = await browser.newPage()
    let cspViolation = false

    page.on('console', msg => {
      if (msg.text().includes('Content Security Policy')) {
        cspViolation = true
      }
    })

    await page.setContent(`
      <html>
        <head>
          <meta http-equiv="Content-Security-Policy" content="script-src 'self'">
        </head>
        <body>
          <script>alert('This should be blocked')</script>
        </body>
      </html>
    `)

    expect(cspViolation).toBe(true)
  })

  test('should allow scripts with valid nonce', async () => {
    const nonce = NonceManager.generateNonce()

    const page = await browser.newPage()
    let scriptExecuted = false

    page.on('console', msg => {
      if (msg.text() === 'Script executed successfully') {
        scriptExecuted = true
      }
    })

    await page.setContent(`
      <html>
        <head>
          <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'nonce-${nonce}'">
        </head>
        <body>
          <script nonce="${nonce}">console.log('Script executed successfully')</script>
        </body>
      </html>
    `)

    expect(scriptExecuted).toBe(true)
  })
})
```

5. CSP Performance Optimization:
```typescript
// src/lib/cspOptimization.ts - CSP performance enhancements
export class CSPOptimizer {
  // Preload critical resources with CSP compliance
  static generatePreloadHeaders(resources: string[]): string[] {
    return resources.map(resource => {
      const url = new URL(resource)
      const isExternal = url.origin !== window.location.origin

      if (isExternal) {
        // Add to CSP connect-src if needed
        return `<${resource}>; rel=preload; crossorigin=anonymous`
      }

      return `<${resource}>; rel=preload`
    })
  }

  // Optimize CSP for specific pages
  static getPageSpecificCSP(page: string): Partial<CSPConfig> {
    const pageConfigs: Record<string, Partial<CSPConfig>> = {
      '/payment': {
        scriptSrc: ["'self'", "'nonce-{nonce}'", "https://js.stripe.com"],
        frameSrc: ["https://js.stripe.com", "https://hooks.stripe.com"]
      },
      '/dashboard': {
        connectSrc: ["'self'", "wss://api.example.com"]
      },
      '/public': {
        // More restrictive CSP for public pages
        scriptSrc: ["'self'"],
        styleSrc: ["'self'"],
        imgSrc: ["'self'", "data:"]
      }
    }

    return pageConfigs[page] || {}
  }
}
```

Implementation Steps:
1. IMMEDIATE: Remove 'unsafe-inline' from production CSP
2. HIGH: Implement comprehensive nonce management
3. MEDIUM: Add CSP violation monitoring and alerting
4. LOW: Optimize CSP for performance and page-specific needs

Testing Requirements:
- Automated CSP violation testing
- XSS payload testing against CSP
- Third-party integration CSP compatibility testing
- Performance impact assessment
- Browser compatibility testing

Security Benefits:
- Eliminates most XSS attack vectors
- Prevents code injection attacks
- Blocks unauthorized resource loading
- Provides detailed security violation reporting
- Improves overall security posture</div>
                </div>

                <!-- Database Security Enhancement -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-database text-primary me-2"></i>Enhance Database Security & Protection</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Database</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/lib/databaseSecurity.ts, src/lib/secureDatabase.ts, src/lib/postgresql-database.ts</span></p>
                    <p><strong>Issue:</strong> Database security implementation needs optimization and additional protection layers</p>
                    <p><strong>Impact:</strong> Enhanced SQL injection protection, improved data security, better audit capabilities</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'database-security-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="database-security-prompt">Enhance database security implementation for comprehensive data protection:

1. Strengthen SQL injection prevention and query validation
2. Implement advanced database access controls and monitoring
3. Add comprehensive data encryption and protection
4. Enhance database audit logging and compliance
5. Implement database-level security policies and constraints

Current Database Security Analysis:

Strengths:
✅ Comprehensive SQL injection detection in src/lib/databaseSecurity.ts
✅ Secure database wrapper with parameterized queries in src/lib/secureDatabase.ts
✅ Query validation and parameter sanitization
✅ Database connection security configuration
✅ Audit logging for database operations
✅ Role-based access control integration

Areas for Enhancement:
⚠️ Database encryption at rest configuration
⚠️ Advanced query monitoring and anomaly detection
⚠️ Database-level security policies (RLS, constraints)
⚠️ Backup security and data retention policies
⚠️ Connection pooling security optimization
⚠️ Database performance vs security balance

Enhanced Database Security Implementation:

1. Advanced SQL Injection Protection:
```typescript
// src/lib/advancedDatabaseSecurity.ts
export class AdvancedDatabaseSecurity {
  private static readonly ADVANCED_SQL_PATTERNS = [
    // Time-based blind SQL injection
    /\b(SLEEP|WAITFOR|DELAY)\s*\(/i,

    // Boolean-based blind SQL injection
    /\b(AND|OR)\s+\d+\s*[=<>]\s*\d+/i,

    // Union-based injection with encoding
    /\b(UNION|UNION\s+ALL)\b.*\b(SELECT|FROM)\b/i,

    // Error-based injection
    /\b(EXTRACTVALUE|UPDATEXML|EXP)\s*\(/i,

    // Stacked queries
    /;\s*(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER)\b/i,

    // Database fingerprinting
    /\b(@@VERSION|VERSION\(\)|CURRENT_USER|USER\(\))/i,

    // Information schema access
    /\b(INFORMATION_SCHEMA|SYSOBJECTS|SYSCOLUMNS|PG_TABLES)\b/i
  ]

  static validateAdvancedThreats(query: string, params?: any[]): {
    isValid: boolean
    threats: Array<{ type: string; pattern: string; severity: 'low' | 'medium' | 'high' | 'critical' }>
  } {
    const threats: Array<{ type: string; pattern: string; severity: 'low' | 'medium' | 'high' | 'critical' }> = []

    // Check for advanced SQL injection patterns
    this.ADVANCED_SQL_PATTERNS.forEach((pattern, index) => {
      if (pattern.test(query)) {
        threats.push({
          type: this.getThreatType(index),
          pattern: pattern.source,
          severity: this.getThreatSeverity(index)
        })
      }
    })

    // Analyze parameter patterns
    if (params) {
      params.forEach((param, index) => {
        if (typeof param === 'string') {
          // Check for encoded payloads
          if (this.isEncodedPayload(param)) {
            threats.push({
              type: 'encoded_payload',
              pattern: `Parameter ${index + 1}`,
              severity: 'high'
            })
          }

          // Check for polyglot payloads
          if (this.isPolyglotPayload(param)) {
            threats.push({
              type: 'polyglot_injection',
              pattern: `Parameter ${index + 1}`,
              severity: 'critical'
            })
          }
        }
      })
    }

    return {
      isValid: threats.length === 0,
      threats
    }
  }

  private static isEncodedPayload(param: string): boolean {
    // Check for various encoding schemes
    const encodingPatterns = [
      /(%[0-9A-Fa-f]{2}){3,}/, // URL encoding
      /\\x[0-9A-Fa-f]{2}/, // Hex encoding
      /&#x?[0-9A-Fa-f]+;/, // HTML entity encoding
      /\+/, // Space encoding
    ]

    return encodingPatterns.some(pattern => pattern.test(param))
  }

  private static isPolyglotPayload(param: string): boolean {
    // Check for polyglot injection attempts
    const polyglotPatterns = [
      /javascript:|vbscript:|data:|about:/i,
      /<script|<iframe|<object|<embed/i,
      /\'\s*\+\s*\'/,
      /\"\s*\+\s*\"/,
      /\|\||&&/
    ]

    return polyglotPatterns.some(pattern => pattern.test(param))
  }
}
```

2. Database Encryption and Data Protection:
```typescript
// src/lib/databaseEncryption.ts
import crypto from 'crypto'

export class DatabaseEncryption {
  private static readonly ENCRYPTION_ALGORITHM = 'aes-256-gcm'
  private static readonly KEY_DERIVATION_ITERATIONS = 100000

  static async encryptSensitiveData(data: any, masterKey: string): Promise<{
    encryptedData: string
    iv: string
    authTag: string
    salt: string
  }> {
    const salt = crypto.randomBytes(32)
    const iv = crypto.randomBytes(16)

    // Derive key from master key and salt
    const key = crypto.pbkdf2Sync(masterKey, salt, this.KEY_DERIVATION_ITERATIONS, 32, 'sha256')

    // Encrypt data
    const cipher = crypto.createCipher(this.ENCRYPTION_ALGORITHM, key)
    cipher.setAAD(Buffer.from('business-scraper-db'))

    let encrypted = cipher.update(JSON.stringify(data), 'utf8', 'hex')
    encrypted += cipher.final('hex')

    const authTag = cipher.getAuthTag()

    return {
      encryptedData: encrypted,
      iv: iv.toString('hex'),
      authTag: authTag.toString('hex'),
      salt: salt.toString('hex')
    }
  }

  static async decryptSensitiveData(
    encryptedData: string,
    iv: string,
    authTag: string,
    salt: string,
    masterKey: string
  ): Promise<any> {
    // Derive key from master key and salt
    const key = crypto.pbkdf2Sync(
      masterKey,
      Buffer.from(salt, 'hex'),
      this.KEY_DERIVATION_ITERATIONS,
      32,
      'sha256'
    )

    // Decrypt data
    const decipher = crypto.createDecipher(this.ENCRYPTION_ALGORITHM, key)
    decipher.setAuthTag(Buffer.from(authTag, 'hex'))
    decipher.setAAD(Buffer.from('business-scraper-db'))

    let decrypted = decipher.update(encryptedData, 'hex', 'utf8')
    decrypted += decipher.final('utf8')

    return JSON.parse(decrypted)
  }
}
```

3. Database Access Control and Monitoring:
```sql
-- database/security/enhanced-security-policies.sql
-- Row Level Security (RLS) for sensitive tables
ALTER TABLE businesses ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE audit_logs ENABLE ROW LEVEL SECURITY;

-- Create security policies
CREATE POLICY businesses_access_policy ON businesses
  FOR ALL TO business_scraper_app
  USING (
    -- Users can only access businesses in their workspace
    workspace_id IN (
      SELECT workspace_id FROM user_workspace_memberships
      WHERE user_id = current_setting('app.current_user_id')::uuid
    )
  );

CREATE POLICY users_access_policy ON users
  FOR ALL TO business_scraper_app
  USING (
    -- Users can only access their own data or if they have admin role
    id = current_setting('app.current_user_id')::uuid
    OR EXISTS (
      SELECT 1 FROM user_roles ur
      WHERE ur.user_id = current_setting('app.current_user_id')::uuid
      AND ur.role = 'admin'
    )
  );

-- Audit log access policy
CREATE POLICY audit_logs_access_policy ON audit_logs
  FOR SELECT TO business_scraper_app
  USING (
    -- Only admins and compliance officers can view audit logs
    EXISTS (
      SELECT 1 FROM user_roles ur
      WHERE ur.user_id = current_setting('app.current_user_id')::uuid
      AND ur.role IN ('admin', 'compliance_officer')
    )
  );

-- Create database roles with minimal privileges
CREATE ROLE business_scraper_readonly;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO business_scraper_readonly;

CREATE ROLE business_scraper_app;
GRANT SELECT, INSERT, UPDATE ON businesses, users, sessions TO business_scraper_app;
GRANT INSERT ON audit_logs TO business_scraper_app;

-- Revoke dangerous privileges
REVOKE CREATE ON SCHEMA public FROM PUBLIC;
REVOKE ALL ON pg_user FROM PUBLIC;
REVOKE ALL ON pg_roles FROM PUBLIC;
```

4. Advanced Database Monitoring:
```typescript
// src/lib/databaseMonitoring.ts
export class DatabaseMonitoring {
  private static queryPatterns = new Map<string, number>()
  private static suspiciousActivity = new Map<string, Array<{ timestamp: Date; query: string }>>()

  static async monitorQuery(
    query: string,
    params: any[],
    executionTime: number,
    userId?: string
  ): Promise<void> {
    // Track query patterns
    const querySignature = this.generateQuerySignature(query)
    const count = this.queryPatterns.get(querySignature) || 0
    this.queryPatterns.set(querySignature, count + 1)

    // Detect anomalies
    const anomalies = this.detectAnomalies(query, params, executionTime, userId)

    if (anomalies.length > 0) {
      await this.alertSecurityTeam(anomalies, query, userId)
    }

    // Log performance metrics
    await this.logPerformanceMetrics(querySignature, executionTime)
  }

  private static detectAnomalies(
    query: string,
    params: any[],
    executionTime: number,
    userId?: string
  ): Array<{ type: string; severity: string; details: any }> {
    const anomalies: Array<{ type: string; severity: string; details: any }> = []

    // Detect unusual query patterns
    if (executionTime > 10000) { // 10 seconds
      anomalies.push({
        type: 'slow_query',
        severity: 'medium',
        details: { executionTime, query: query.substring(0, 100) }
      })
    }

    // Detect bulk operations
    if (query.toLowerCase().includes('delete') && !query.toLowerCase().includes('where')) {
      anomalies.push({
        type: 'bulk_delete_without_where',
        severity: 'high',
        details: { query, userId }
      })
    }

    // Detect unusual access patterns
    if (userId) {
      const userActivity = this.suspiciousActivity.get(userId) || []
      userActivity.push({ timestamp: new Date(), query })

      // Keep only last 100 queries
      if (userActivity.length > 100) {
        userActivity.splice(0, userActivity.length - 100)
      }

      this.suspiciousActivity.set(userId, userActivity)

      // Check for rapid-fire queries
      const recentQueries = userActivity.filter(
        activity => Date.now() - activity.timestamp.getTime() < 60000 // Last minute
      )

      if (recentQueries.length > 50) {
        anomalies.push({
          type: 'rapid_fire_queries',
          severity: 'high',
          details: { userId, queryCount: recentQueries.length }
        })
      }
    }

    return anomalies
  }
}
```

5. Database Backup Security:
```typescript
// src/lib/databaseBackup.ts
export class SecureDatabaseBackup {
  static async createEncryptedBackup(): Promise<{
    backupId: string
    encryptedPath: string
    checksum: string
  }> {
    const backupId = crypto.randomUUID()
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-')

    // Create backup with encryption
    const backupCommand = `
      pg_dump "${process.env.DATABASE_URL}" \
      | gzip \
      | openssl enc -aes-256-cbc -salt -k "${process.env.BACKUP_ENCRYPTION_KEY}" \
      > "/backups/backup-${timestamp}-${backupId}.sql.gz.enc"
    `

    // Execute backup
    await execAsync(backupCommand)

    // Generate checksum
    const backupPath = `/backups/backup-${timestamp}-${backupId}.sql.gz.enc`
    const checksum = await this.generateChecksum(backupPath)

    // Store backup metadata
    await this.storeBackupMetadata({
      backupId,
      timestamp: new Date(),
      path: backupPath,
      checksum,
      encrypted: true,
      retentionDays: 90
    })

    return {
      backupId,
      encryptedPath: backupPath,
      checksum
    }
  }

  static async validateBackupIntegrity(backupId: string): Promise<boolean> {
    const metadata = await this.getBackupMetadata(backupId)
    if (!metadata) return false

    const currentChecksum = await this.generateChecksum(metadata.path)
    return currentChecksum === metadata.checksum
  }
}
```

Implementation Priority:
1. IMMEDIATE: Implement advanced SQL injection protection
2. HIGH: Add database encryption for sensitive data
3. MEDIUM: Implement comprehensive database monitoring
4. LOW: Add automated backup security and validation

Testing Requirements:
- SQL injection testing with advanced payloads
- Database performance impact assessment
- Encryption/decryption performance testing
- Backup and recovery testing
- Access control validation
- Audit log integrity testing

Compliance Benefits:
- SOC 2 Type II database security controls
- GDPR data protection and encryption requirements
- HIPAA-level data security (if applicable)
- PCI DSS database security standards
- Enhanced audit trail for compliance reporting</div>
                </div>

                <!-- Secrets Management Enhancement -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-key text-primary me-2"></i>Enhance Secrets Management & Security</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Security</span>
                        <span class="badge bg-dark">Secrets</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">.env.example, src/lib/encryption-service.ts, scripts/generate-secrets.js</span></p>
                    <p><strong>Issue:</strong> Secrets management needs enhancement for production security and compliance</p>
                    <p><strong>Impact:</strong> Improved secret security, automated rotation, better compliance posture</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'secrets-management-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="secrets-management-prompt">Enhance secrets management for enterprise-grade security and compliance:

1. Implement comprehensive secrets encryption and protection
2. Add automated secret rotation and lifecycle management
3. Enhance environment-specific secret validation
4. Implement secure secret storage and retrieval
5. Add secrets auditing and monitoring capabilities

Current Secrets Management Analysis:

Strengths:
✅ Environment-specific configuration files (.env.example variants)
✅ Secret generation script (scripts/generate-secrets.js)
✅ Encryption service implementation (src/lib/encryption-service.ts)
✅ Secure storage utilities (src/utils/secureStorage.ts)
✅ Configuration validation in src/lib/config.ts
✅ Compliance-focused encryption (src/lib/compliance/encryption.ts)

Areas for Enhancement:
⚠️ No automated secret rotation mechanism
⚠️ Limited secret validation and strength checking
⚠️ Missing secrets audit trail and monitoring
⚠️ No integration with external secret management systems
⚠️ Limited runtime secret protection
⚠️ Missing secret backup and recovery procedures

Enhanced Secrets Management Implementation:

1. Advanced Secret Validation and Strength Checking:
```typescript
// src/lib/secretsValidator.ts
export class SecretsValidator {
  private static readonly SECRET_REQUIREMENTS = {
    database_password: {
      minLength: 32,
      requireUppercase: true,
      requireLowercase: true,
      requireNumbers: true,
      requireSpecialChars: true,
      forbiddenPatterns: [/password/i, /admin/i, /test/i]
    },
    api_key: {
      minLength: 32,
      requireAlphanumeric: true,
      entropy: 128 // bits
    },
    encryption_key: {
      minLength: 64,
      requireHex: true,
      entropy: 256 // bits
    },
    jwt_secret: {
      minLength: 64,
      entropy: 256,
      requireBase64: true
    }
  }

  static validateSecret(secretType: string, secretValue: string): {
    isValid: boolean
    strength: 'weak' | 'medium' | 'strong' | 'very_strong'
    issues: string[]
    recommendations: string[]
  } {
    const requirements = this.SECRET_REQUIREMENTS[secretType as keyof typeof this.SECRET_REQUIREMENTS]
    const issues: string[] = []
    const recommendations: string[] = []

    if (!requirements) {
      return {
        isValid: false,
        strength: 'weak',
        issues: [`Unknown secret type: ${secretType}`],
        recommendations: ['Use a recognized secret type']
      }
    }

    // Length validation
    if (secretValue.length < requirements.minLength) {
      issues.push(`Secret too short (${secretValue.length} < ${requirements.minLength})`)
      recommendations.push(`Use at least ${requirements.minLength} characters`)
    }

    // Character requirements
    if (requirements.requireUppercase && !/[A-Z]/.test(secretValue)) {
      issues.push('Missing uppercase letters')
      recommendations.push('Include uppercase letters')
    }

    if (requirements.requireLowercase && !/[a-z]/.test(secretValue)) {
      issues.push('Missing lowercase letters')
      recommendations.push('Include lowercase letters')
    }

    if (requirements.requireNumbers && !/[0-9]/.test(secretValue)) {
      issues.push('Missing numbers')
      recommendations.push('Include numbers')
    }

    if (requirements.requireSpecialChars && !/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(secretValue)) {
      issues.push('Missing special characters')
      recommendations.push('Include special characters')
    }

    // Entropy calculation
    const entropy = this.calculateEntropy(secretValue)
    if (requirements.entropy && entropy < requirements.entropy) {
      issues.push(`Insufficient entropy (${entropy} < ${requirements.entropy} bits)`)
      recommendations.push(`Increase randomness to achieve ${requirements.entropy} bits of entropy`)
    }

    // Forbidden patterns
    if (requirements.forbiddenPatterns) {
      for (const pattern of requirements.forbiddenPatterns) {
        if (pattern.test(secretValue)) {
          issues.push(`Contains forbidden pattern: ${pattern.source}`)
          recommendations.push('Avoid common words and patterns')
        }
      }
    }

    // Determine strength
    const strength = this.determineStrength(entropy, issues.length)

    return {
      isValid: issues.length === 0,
      strength,
      issues,
      recommendations
    }
  }

  private static calculateEntropy(secret: string): number {
    const charSet = new Set(secret)
    const charSetSize = charSet.size
    return Math.log2(Math.pow(charSetSize, secret.length))
  }

  private static determineStrength(entropy: number, issueCount: number): 'weak' | 'medium' | 'strong' | 'very_strong' {
    if (issueCount > 2 || entropy < 64) return 'weak'
    if (issueCount > 0 || entropy < 128) return 'medium'
    if (entropy < 256) return 'strong'
    return 'very_strong'
  }
}
```

2. Automated Secret Rotation System:
```typescript
// src/lib/secretRotation.ts
export class SecretRotationService {
  private static readonly ROTATION_SCHEDULES = {
    database_password: 90 * 24 * 60 * 60 * 1000, // 90 days
    api_keys: 30 * 24 * 60 * 60 * 1000, // 30 days
    encryption_keys: 365 * 24 * 60 * 60 * 1000, // 1 year
    jwt_secrets: 30 * 24 * 60 * 60 * 1000, // 30 days
    session_secrets: 7 * 24 * 60 * 60 * 1000 // 7 days
  }

  static async rotateSecret(secretType: string, currentSecret: string): Promise<{
    newSecret: string
    rotationId: string
    expiresAt: Date
  }> {
    // Generate new secret
    const newSecret = await this.generateSecretByType(secretType)

    // Validate new secret
    const validation = SecretsValidator.validateSecret(secretType, newSecret)
    if (!validation.isValid) {
      throw new Error(`Generated secret failed validation: ${validation.issues.join(', ')}`)
    }

    const rotationId = crypto.randomUUID()
    const expiresAt = new Date(Date.now() + this.ROTATION_SCHEDULES[secretType as keyof typeof this.ROTATION_SCHEDULES])

    // Store rotation metadata
    await this.storeRotationMetadata({
      rotationId,
      secretType,
      rotatedAt: new Date(),
      expiresAt,
      previousSecretHash: crypto.createHash('sha256').update(currentSecret).digest('hex')
    })

    // Log rotation event
    await auditService.logSecurityEvent('secret_rotation', {
      secretType,
      rotationId,
      rotatedAt: new Date()
    })

    return {
      newSecret,
      rotationId,
      expiresAt
    }
  }

  static async scheduleRotation(secretType: string): Promise<void> {
    const schedule = this.ROTATION_SCHEDULES[secretType as keyof typeof this.ROTATION_SCHEDULES]
    if (!schedule) {
      throw new Error(`No rotation schedule defined for secret type: ${secretType}`)
    }

    // Schedule rotation using cron or similar
    setTimeout(async () => {
      try {
        const currentSecret = await this.getCurrentSecret(secretType)
        const rotation = await this.rotateSecret(secretType, currentSecret)

        // Update environment/configuration
        await this.updateSecretInEnvironment(secretType, rotation.newSecret)

        // Notify administrators
        await this.notifyRotation(secretType, rotation.rotationId)

        // Schedule next rotation
        await this.scheduleRotation(secretType)
      } catch (error) {
        logger.error('Secret Rotation', `Failed to rotate ${secretType}`, error)
        await this.alertRotationFailure(secretType, error)
      }
    }, schedule)
  }

  private static async generateSecretByType(secretType: string): Promise<string> {
    switch (secretType) {
      case 'database_password':
        return this.generateSecurePassword(32)
      case 'encryption_key':
        return crypto.randomBytes(32).toString('hex')
      case 'jwt_secret':
        return crypto.randomBytes(64).toString('base64')
      case 'api_key':
        return crypto.randomBytes(32).toString('hex')
      default:
        return crypto.randomBytes(32).toString('hex')
    }
  }
}
```

3. Secure Secret Storage with External Integration:
```typescript
// src/lib/secretStorage.ts
export class SecureSecretStorage {
  private static readonly STORAGE_BACKENDS = {
    local: LocalSecretStorage,
    vault: HashiCorpVaultStorage,
    aws: AWSSecretsManagerStorage,
    azure: AzureKeyVaultStorage
  }

  static async storeSecret(
    secretId: string,
    secretValue: string,
    metadata: {
      type: string
      environment: string
      expiresAt?: Date
      tags?: Record<string, string>
    }
  ): Promise<void> {
    const backend = this.getStorageBackend()

    // Encrypt secret before storage
    const encryptedSecret = await encryptionService.encrypt(secretValue, 'secret_storage')

    // Store with metadata
    await backend.store(secretId, {
      encryptedValue: encryptedSecret,
      metadata: {
        ...metadata,
        storedAt: new Date(),
        version: 1
      }
    })

    // Log storage event
    await auditService.logSecurityEvent('secret_stored', {
      secretId,
      type: metadata.type,
      environment: metadata.environment
    })
  }

  static async retrieveSecret(secretId: string): Promise<string | null> {
    const backend = this.getStorageBackend()

    try {
      const storedData = await backend.retrieve(secretId)
      if (!storedData) return null

      // Check expiration
      if (storedData.metadata.expiresAt && new Date() > storedData.metadata.expiresAt) {
        await this.deleteSecret(secretId)
        return null
      }

      // Decrypt secret
      const decryptedSecret = await encryptionService.decrypt(storedData.encryptedValue)

      // Log access event
      await auditService.logSecurityEvent('secret_accessed', {
        secretId,
        accessedAt: new Date()
      })

      return decryptedSecret
    } catch (error) {
      logger.error('Secret Storage', `Failed to retrieve secret ${secretId}`, error)
      return null
    }
  }

  private static getStorageBackend(): SecretStorageBackend {
    const backendType = process.env.SECRET_STORAGE_BACKEND || 'local'
    const Backend = this.STORAGE_BACKENDS[backendType as keyof typeof this.STORAGE_BACKENDS]

    if (!Backend) {
      throw new Error(`Unknown secret storage backend: ${backendType}`)
    }

    return new Backend()
  }
}
```

4. Runtime Secret Protection:
```typescript
// src/lib/runtimeSecretProtection.ts
export class RuntimeSecretProtection {
  private static secretsInMemory = new Map<string, {
    value: string
    accessCount: number
    lastAccessed: Date
    expiresAt: Date
  }>()

  static async loadSecret(secretId: string, ttl: number = 300000): Promise<string> {
    // Check if secret is already in memory and not expired
    const cached = this.secretsInMemory.get(secretId)
    if (cached && cached.expiresAt > new Date()) {
      cached.accessCount++
      cached.lastAccessed = new Date()
      return cached.value
    }

    // Load from secure storage
    const secretValue = await SecureSecretStorage.retrieveSecret(secretId)
    if (!secretValue) {
      throw new Error(`Secret not found: ${secretId}`)
    }

    // Cache in memory with TTL
    this.secretsInMemory.set(secretId, {
      value: secretValue,
      accessCount: 1,
      lastAccessed: new Date(),
      expiresAt: new Date(Date.now() + ttl)
    })

    // Schedule cleanup
    setTimeout(() => {
      this.clearSecret(secretId)
    }, ttl)

    return secretValue
  }

  static clearSecret(secretId: string): void {
    const secret = this.secretsInMemory.get(secretId)
    if (secret) {
      // Overwrite memory before deletion
      secret.value = '0'.repeat(secret.value.length)
      this.secretsInMemory.delete(secretId)
    }
  }

  static clearAllSecrets(): void {
    for (const [secretId] of this.secretsInMemory) {
      this.clearSecret(secretId)
    }
  }

  // Cleanup on process exit
  static setupCleanupHandlers(): void {
    process.on('exit', () => this.clearAllSecrets())
    process.on('SIGINT', () => {
      this.clearAllSecrets()
      process.exit(0)
    })
    process.on('SIGTERM', () => {
      this.clearAllSecrets()
      process.exit(0)
    })
  }
}
```

5. Secrets Auditing and Monitoring:
```typescript
// src/lib/secretsAudit.ts
export class SecretsAuditService {
  static async auditSecretUsage(): Promise<{
    totalSecrets: number
    expiringSoon: Array<{ secretId: string; expiresAt: Date }>
    weakSecrets: Array<{ secretId: string; issues: string[] }>
    unusedSecrets: Array<{ secretId: string; lastAccessed: Date }>
  }> {
    const allSecrets = await this.getAllSecrets()
    const now = new Date()
    const soonThreshold = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000) // 7 days

    const expiringSoon: Array<{ secretId: string; expiresAt: Date }> = []
    const weakSecrets: Array<{ secretId: string; issues: string[] }> = []
    const unusedSecrets: Array<{ secretId: string; lastAccessed: Date }> = []

    for (const secret of allSecrets) {
      // Check expiration
      if (secret.expiresAt && secret.expiresAt < soonThreshold) {
        expiringSoon.push({
          secretId: secret.id,
          expiresAt: secret.expiresAt
        })
      }

      // Check strength
      const validation = SecretsValidator.validateSecret(secret.type, secret.value)
      if (!validation.isValid || validation.strength === 'weak') {
        weakSecrets.push({
          secretId: secret.id,
          issues: validation.issues
        })
      }

      // Check usage
      const lastAccessed = secret.lastAccessed || secret.createdAt
      const unusedThreshold = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000) // 30 days
      if (lastAccessed < unusedThreshold) {
        unusedSecrets.push({
          secretId: secret.id,
          lastAccessed
        })
      }
    }

    return {
      totalSecrets: allSecrets.length,
      expiringSoon,
      weakSecrets,
      unusedSecrets
    }
  }

  static async generateComplianceReport(): Promise<string> {
    const audit = await this.auditSecretUsage()

    const report = `
# Secrets Management Compliance Report
Generated: ${new Date().toISOString()}

## Summary
- Total Secrets: ${audit.totalSecrets}
- Expiring Soon: ${audit.expiringSoon.length}
- Weak Secrets: ${audit.weakSecrets.length}
- Unused Secrets: ${audit.unusedSecrets.length}

## Action Items
${audit.expiringSoon.length > 0 ? '### Secrets Expiring Soon\n' + audit.expiringSoon.map(s => `- ${s.secretId} expires ${s.expiresAt.toISOString()}`).join('\n') : ''}
${audit.weakSecrets.length > 0 ? '### Weak Secrets\n' + audit.weakSecrets.map(s => `- ${s.secretId}: ${s.issues.join(', ')}`).join('\n') : ''}
${audit.unusedSecrets.length > 0 ? '### Unused Secrets\n' + audit.unusedSecrets.map(s => `- ${s.secretId} last accessed ${s.lastAccessed.toISOString()}`).join('\n') : ''}
    `.trim()

    return report
  }
}
```

Implementation Priority:
1. IMMEDIATE: Implement secret validation and strength checking
2. HIGH: Add automated secret rotation capabilities
3. MEDIUM: Integrate with external secret management systems
4. LOW: Add comprehensive auditing and compliance reporting

Security Benefits:
- Automated secret lifecycle management
- Enhanced secret strength and validation
- Comprehensive audit trail for compliance
- Runtime secret protection and cleanup
- Integration with enterprise secret management systems
- Reduced risk of secret exposure and compromise</div>
                </div>

                <!-- Performance & Scalability Optimization -->
                <div class="prompt-card high-priority">
                    <h4><i class="fas fa-tachometer-alt text-warning me-2"></i>Optimize Performance & Scalability</h4>
                    <div class="mb-3">
                        <span class="badge badge-high me-2">P1 - High</span>
                        <span class="badge bg-secondary me-2">Performance</span>
                        <span class="badge bg-dark">Scalability</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/lib/performanceMonitor.ts, src/lib/smartCacheManager.ts, src/lib/metrics.ts</span></p>
                    <p><strong>Issue:</strong> Performance optimization opportunities and scalability enhancements needed</p>
                    <p><strong>Impact:</strong> Improved response times, better resource utilization, enhanced user experience</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'performance-optimization-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="performance-optimization-prompt">Optimize performance and scalability across the business scraper application:

1. Enhance database query performance and connection management
2. Optimize caching strategies and implement intelligent cache warming
3. Improve memory management and prevent memory leaks
4. Optimize API response times and implement efficient pagination
5. Enhance frontend performance and bundle optimization

Current Performance Analysis:

Strengths:
✅ Comprehensive performance monitoring (src/lib/performanceMonitor.ts)
✅ Multi-layer caching system (src/lib/smartCacheManager.ts)
✅ Prometheus metrics collection (src/lib/metrics.ts)
✅ Database performance tracking (src/lib/postgresql-database.ts)
✅ Connection pooling and management (src/lib/resilience/connectionManager.ts)
✅ Auto-recovery mechanisms (src/lib/resilience/autoRecovery.ts)

Areas for Optimization:
⚠️ Database query optimization opportunities
⚠️ Cache hit ratio improvements needed
⚠️ Memory usage optimization
⚠️ Bundle size reduction potential
⚠️ API response time improvements
⚠️ Concurrent processing optimization

Performance Optimization Implementation:

1. Advanced Database Query Optimization:
```typescript
// src/lib/advancedDatabaseOptimizer.ts
export class AdvancedDatabaseOptimizer {
  private static readonly QUERY_CACHE = new Map<string, {
    plan: any
    lastUsed: Date
    executionCount: number
    averageTime: number
  }>()

  static async optimizeQuery(query: string, params: any[]): Promise<{
    optimizedQuery: string
    estimatedImprovement: number
    recommendations: string[]
  }> {
    const querySignature = this.generateQuerySignature(query)
    const cached = this.QUERY_CACHE.get(querySignature)

    // Analyze query execution plan
    const executionPlan = await this.analyzeExecutionPlan(query, params)

    const recommendations: string[] = []
    let optimizedQuery = query
    let estimatedImprovement = 0

    // Check for missing indexes
    if (executionPlan.seqScans > 0) {
      recommendations.push('Add indexes for sequential scans')
      estimatedImprovement += 50 // 50% improvement estimate
    }

    // Check for inefficient joins
    if (executionPlan.nestedLoops > executionPlan.hashJoins) {
      recommendations.push('Optimize join strategy with better statistics')
      optimizedQuery = this.optimizeJoins(query)
      estimatedImprovement += 30
    }

    // Check for unnecessary sorting
    if (executionPlan.sorts > 0 && !query.includes('ORDER BY')) {
      recommendations.push('Remove unnecessary sorting operations')
      estimatedImprovement += 20
    }

    // Suggest query rewriting
    if (query.includes('SELECT *')) {
      recommendations.push('Select only required columns')
      optimizedQuery = this.optimizeSelectColumns(query)
      estimatedImprovement += 15
    }

    // Update cache
    this.QUERY_CACHE.set(querySignature, {
      plan: executionPlan,
      lastUsed: new Date(),
      executionCount: (cached?.executionCount || 0) + 1,
      averageTime: executionPlan.executionTime
    })

    return {
      optimizedQuery,
      estimatedImprovement,
      recommendations
    }
  }

  static async createOptimalIndexes(): Promise<string[]> {
    const indexRecommendations: string[] = []

    // Analyze query patterns from cache
    const queryPatterns = this.analyzeQueryPatterns()

    for (const pattern of queryPatterns) {
      if (pattern.frequency > 10 && pattern.averageTime > 100) {
        const indexSql = this.generateIndexSQL(pattern)
        if (indexSql) {
          indexRecommendations.push(indexSql)
        }
      }
    }

    return indexRecommendations
  }

  private static generateIndexSQL(pattern: any): string | null {
    // Generate CREATE INDEX statements based on query patterns
    const { table, whereColumns, orderColumns } = pattern

    if (whereColumns.length > 0) {
      const columns = [...whereColumns, ...orderColumns].join(', ')
      return `CREATE INDEX CONCURRENTLY idx_${table}_${whereColumns.join('_')} ON ${table} (${columns});`
    }

    return null
  }
}
```

2. Intelligent Cache Warming and Optimization:
```typescript
// src/lib/intelligentCacheWarmer.ts
export class IntelligentCacheWarmer {
  private static readonly WARMING_STRATEGIES = {
    predictive: 'Predict future cache needs based on patterns',
    scheduled: 'Warm cache on schedule for known peak times',
    reactive: 'Warm cache reactively based on miss patterns'
  }

  static async warmCache(strategy: keyof typeof this.WARMING_STRATEGIES = 'predictive'): Promise<{
    warmedKeys: number
    estimatedHitRatio: number
    warmingTime: number
  }> {
    const startTime = Date.now()
    let warmedKeys = 0

    switch (strategy) {
      case 'predictive':
        warmedKeys = await this.predictiveWarming()
        break
      case 'scheduled':
        warmedKeys = await this.scheduledWarming()
        break
      case 'reactive':
        warmedKeys = await this.reactiveWarming()
        break
    }

    const warmingTime = Date.now() - startTime
    const estimatedHitRatio = this.calculateEstimatedHitRatio(warmedKeys)

    return {
      warmedKeys,
      estimatedHitRatio,
      warmingTime
    }
  }

  private static async predictiveWarming(): Promise<number> {
    // Analyze access patterns and predict future needs
    const accessPatterns = await this.analyzeAccessPatterns()
    let warmedKeys = 0

    for (const pattern of accessPatterns) {
      if (pattern.predictedProbability > 0.7) {
        try {
          await this.preloadData(pattern.key, pattern.dataSource)
          warmedKeys++
        } catch (error) {
          logger.warn('Cache Warmer', `Failed to warm key ${pattern.key}`, error)
        }
      }
    }

    return warmedKeys
  }

  static async optimizeCacheConfiguration(): Promise<{
    recommendedTTL: Record<string, number>
    recommendedSizes: Record<string, number>
    evictionStrategy: string
  }> {
    const cacheStats = await this.analyzeCacheStatistics()

    const recommendedTTL: Record<string, number> = {}
    const recommendedSizes: Record<string, number> = {}

    // Optimize TTL based on access patterns
    for (const [cacheType, stats] of Object.entries(cacheStats)) {
      const avgAccessInterval = stats.totalAccesses / stats.uniqueKeys
      recommendedTTL[cacheType] = Math.max(avgAccessInterval * 2, 300000) // Min 5 minutes

      // Optimize size based on hit ratio and memory usage
      const currentHitRatio = stats.hits / (stats.hits + stats.misses)
      if (currentHitRatio < 0.8) {
        recommendedSizes[cacheType] = Math.ceil(stats.currentSize * 1.5)
      } else if (currentHitRatio > 0.95) {
        recommendedSizes[cacheType] = Math.floor(stats.currentSize * 0.8)
      }
    }

    return {
      recommendedTTL,
      recommendedSizes,
      evictionStrategy: 'LRU with access frequency weighting'
    }
  }
}
```

3. Memory Management and Leak Prevention:
```typescript
// src/lib/memoryOptimizer.ts
export class MemoryOptimizer {
  private static readonly MEMORY_THRESHOLDS = {
    warning: 0.8, // 80% memory usage
    critical: 0.9, // 90% memory usage
    emergency: 0.95 // 95% memory usage
  }

  private static memoryWatchers = new Set<() => void>()

  static startMemoryMonitoring(): void {
    setInterval(() => {
      this.checkMemoryUsage()
    }, 30000) // Check every 30 seconds

    // Monitor for memory leaks
    setInterval(() => {
      this.detectMemoryLeaks()
    }, 300000) // Check every 5 minutes
  }

  private static checkMemoryUsage(): void {
    const usage = process.memoryUsage()
    const totalMemory = usage.heapTotal + usage.external
    const usedMemory = usage.heapUsed
    const memoryRatio = usedMemory / totalMemory

    if (memoryRatio > this.MEMORY_THRESHOLDS.emergency) {
      this.emergencyCleanup()
    } else if (memoryRatio > this.MEMORY_THRESHOLDS.critical) {
      this.criticalCleanup()
    } else if (memoryRatio > this.MEMORY_THRESHOLDS.warning) {
      this.warningCleanup()
    }
  }

  private static emergencyCleanup(): void {
    logger.error('Memory Optimizer', 'Emergency memory cleanup triggered')

    // Force garbage collection
    if (global.gc) {
      global.gc()
    }

    // Clear all caches
    this.clearAllCaches()

    // Close unnecessary connections
    this.closeIdleConnections()

    // Notify memory watchers
    this.memoryWatchers.forEach(watcher => watcher())
  }

  static optimizeObjectCreation<T>(
    factory: () => T,
    poolSize: number = 10
  ): () => T {
    const pool: T[] = []

    return () => {
      if (pool.length > 0) {
        return pool.pop()!
      }

      const obj = factory()

      // Add cleanup method if object supports it
      if (typeof (obj as any).cleanup === 'function') {
        const originalCleanup = (obj as any).cleanup
        ;(obj as any).cleanup = () => {
          originalCleanup.call(obj)
          if (pool.length < poolSize) {
            pool.push(obj)
          }
        }
      }

      return obj
    }
  }

  static createMemoryEfficientBuffer(size: number): {
    buffer: Buffer
    write: (data: string | Buffer) => void
    read: () => Buffer
    clear: () => void
  } {
    let buffer = Buffer.allocUnsafe(size)
    let position = 0

    return {
      buffer,
      write: (data: string | Buffer) => {
        const dataBuffer = Buffer.isBuffer(data) ? data : Buffer.from(data)
        if (position + dataBuffer.length > size) {
          // Resize buffer if needed
          const newSize = Math.max(size * 2, position + dataBuffer.length)
          const newBuffer = Buffer.allocUnsafe(newSize)
          buffer.copy(newBuffer)
          buffer = newBuffer
        }
        dataBuffer.copy(buffer, position)
        position += dataBuffer.length
      },
      read: () => buffer.slice(0, position),
      clear: () => {
        position = 0
        buffer.fill(0)
      }
    }
  }
}
```

4. API Response Time Optimization:
```typescript
// src/lib/apiOptimizer.ts
export class APIOptimizer {
  private static readonly RESPONSE_TIME_TARGETS = {
    search: 200, // 200ms
    data_retrieval: 100, // 100ms
    bulk_operations: 2000, // 2 seconds
    file_upload: 5000 // 5 seconds
  }

  static async optimizeResponse<T>(
    operation: () => Promise<T>,
    operationType: keyof typeof this.RESPONSE_TIME_TARGETS
  ): Promise<T> {
    const startTime = Date.now()
    const target = this.RESPONSE_TIME_TARGETS[operationType]

    // Use Promise.race for timeout
    const timeoutPromise = new Promise<never>((_, reject) => {
      setTimeout(() => {
        reject(new Error(`Operation timeout: ${operationType} exceeded ${target}ms`))
      }, target * 2) // Allow 2x target time before timeout
    })

    try {
      const result = await Promise.race([operation(), timeoutPromise])
      const duration = Date.now() - startTime

      // Log performance metrics
      await this.logPerformanceMetric(operationType, duration, true)

      if (duration > target) {
        logger.warn('API Optimizer', `Slow ${operationType}: ${duration}ms > ${target}ms target`)
      }

      return result
    } catch (error) {
      const duration = Date.now() - startTime
      await this.logPerformanceMetric(operationType, duration, false)
      throw error
    }
  }

  static createEfficientPagination<T>(
    data: T[],
    page: number,
    limit: number
  ): {
    data: T[]
    pagination: {
      page: number
      limit: number
      total: number
      totalPages: number
      hasNext: boolean
      hasPrev: boolean
    }
    performance: {
      processingTime: number
      memoryUsed: number
    }
  } {
    const startTime = Date.now()
    const startMemory = process.memoryUsage().heapUsed

    const offset = (page - 1) * limit
    const paginatedData = data.slice(offset, offset + limit)
    const totalPages = Math.ceil(data.length / limit)

    const endTime = Date.now()
    const endMemory = process.memoryUsage().heapUsed

    return {
      data: paginatedData,
      pagination: {
        page,
        limit,
        total: data.length,
        totalPages,
        hasNext: page < totalPages,
        hasPrev: page > 1
      },
      performance: {
        processingTime: endTime - startTime,
        memoryUsed: endMemory - startMemory
      }
    }
  }
}
```

Implementation Priority:
1. IMMEDIATE: Database query optimization and indexing
2. HIGH: Cache warming and intelligent caching strategies
3. MEDIUM: Memory management and leak prevention
4. LOW: Advanced API optimization and monitoring

Performance Targets:
- Database queries: <200ms average response time
- Cache hit ratio: >90%
- Memory usage: <80% of available memory
- API response times: <500ms for 95th percentile
- Bundle size: <2MB for initial load
- Core Web Vitals: LCP <2.5s, FID <100ms, CLS <0.1

Testing Requirements:
- Load testing with 1000+ concurrent users
- Memory leak testing over 24+ hour periods
- Database performance testing with large datasets
- Cache performance validation
- Bundle size analysis and optimization
- Core Web Vitals monitoring and optimization</div>
                </div>

                <!-- Testing Infrastructure Enhancement -->
                <div class="prompt-card critical-priority">
                    <h4><i class="fas fa-vial text-danger me-2"></i>Enhance Testing Infrastructure & Coverage</h4>
                    <div class="mb-3">
                        <span class="badge badge-critical me-2">P0 - Critical</span>
                        <span class="badge bg-secondary me-2">Testing</span>
                        <span class="badge bg-dark">Quality</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">tests/, jest.config.js, playwright.config.ts</span></p>
                    <p><strong>Issue:</strong> Comprehensive testing infrastructure needs implementation for enterprise standards</p>
                    <p><strong>Impact:</strong> Improved code quality, reduced bugs, better deployment confidence</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'testing-infrastructure-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="testing-infrastructure-prompt">Implement comprehensive testing infrastructure meeting enterprise standards with 95%+ coverage across all 12 testing categories:

1. Unit Testing (95% coverage target)
2. Integration Testing (API endpoints, database operations)
3. End-to-End Testing (complete user workflows)
4. System Testing (full application validation)
5. Regression Testing (automated on every commit)
6. Acceptance Testing (business requirement validation)
7. Performance Testing (load, stress, scalability)
8. Security Testing (vulnerability scanning, penetration testing)
9. Compatibility Testing (browsers, devices, environments)
10. Accessibility Testing (WCAG 2.1 AA compliance)
11. Exploratory Testing (manual edge case discovery)
12. Compliance Testing (GDPR, SOC 2, industry standards)

Enhanced Testing Implementation:

1. Comprehensive Unit Testing Framework:
```typescript
// tests/unit/setup.ts
import { jest } from '@jest/globals'
import { TextEncoder, TextDecoder } from 'util'

// Global test setup
global.TextEncoder = TextEncoder
global.TextDecoder = TextDecoder

// Mock environment variables for testing
process.env.NODE_ENV = 'test'
process.env.DATABASE_URL = 'postgresql://test:test@localhost:5432/test_db'
process.env.ENCRYPTION_KEY = 'test_encryption_key_32_characters'

// Enhanced Jest configuration
export const jestConfig = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  setupFilesAfterEnv: ['<rootDir>/tests/unit/setup.ts'],
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/*.test.{ts,tsx}',
    '!src/**/*.spec.{ts,tsx}',
    '!src/**/index.ts'
  ],
  coverageThreshold: {
    global: {
      branches: 95,
      functions: 95,
      lines: 95,
      statements: 95
    }
  },
  testMatch: [
    '<rootDir>/tests/unit/**/*.test.{ts,tsx}',
    '<rootDir>/tests/unit/**/*.spec.{ts,tsx}'
  ],
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1'
  }
}
```

2. Advanced Integration Testing:
```typescript
// tests/integration/api.test.ts
import request from 'supertest'
import { app } from '@/app'
import { setupTestDatabase, cleanupTestDatabase } from './helpers/database'

describe('API Integration Tests', () => {
  beforeAll(async () => {
    await setupTestDatabase()
  })

  afterAll(async () => {
    await cleanupTestDatabase()
  })

  describe('Business Scraping API', () => {
    test('should create campaign and scrape businesses', async () => {
      // Create campaign
      const campaignResponse = await request(app)
        .post('/api/campaigns')
        .send({
          name: 'Test Campaign',
          industry: 'restaurants',
          location: '90210',
          maxResults: 10
        })
        .expect(201)

      const campaignId = campaignResponse.body.id

      // Start scraping
      const scrapingResponse = await request(app)
        .post(`/api/campaigns/${campaignId}/scrape`)
        .expect(200)

      // Wait for completion
      await new Promise(resolve => setTimeout(resolve, 5000))

      // Verify results
      const resultsResponse = await request(app)
        .get(`/api/campaigns/${campaignId}/businesses`)
        .expect(200)

      expect(resultsResponse.body.businesses).toHaveLength(10)
      expect(resultsResponse.body.businesses[0]).toMatchObject({
        name: expect.any(String),
        website: expect.any(String),
        phone: expect.any(String),
        address: expect.any(String)
      })
    })

    test('should handle rate limiting correctly', async () => {
      const requests = Array(20).fill(null).map(() =>
        request(app).get('/api/campaigns')
      )

      const responses = await Promise.allSettled(requests)
      const rateLimited = responses.filter(r =>
        r.status === 'fulfilled' && r.value.status === 429
      )

      expect(rateLimited.length).toBeGreaterThan(0)
    })
  })
})
```

3. End-to-End Testing with Playwright:
```typescript
// tests/e2e/business-scraping.spec.ts
import { test, expect } from '@playwright/test'

test.describe('Business Scraping Workflow', () => {
  test('complete business scraping workflow', async ({ page }) => {
    // Navigate to application
    await page.goto('/')

    // Create new campaign
    await page.click('[data-testid="new-campaign-button"]')
    await page.fill('[data-testid="campaign-name"]', 'E2E Test Campaign')
    await page.selectOption('[data-testid="industry-select"]', 'restaurants')
    await page.fill('[data-testid="location-input"]', '90210')
    await page.fill('[data-testid="max-results"]', '5')
    await page.click('[data-testid="create-campaign"]')

    // Wait for campaign creation
    await expect(page.locator('[data-testid="campaign-created"]')).toBeVisible()

    // Start scraping
    await page.click('[data-testid="start-scraping"]')

    // Wait for scraping to complete
    await expect(page.locator('[data-testid="scraping-complete"]')).toBeVisible({
      timeout: 30000
    })

    // Verify results
    const businessCards = page.locator('[data-testid="business-card"]')
    await expect(businessCards).toHaveCount(5)

    // Check business data quality
    const firstBusiness = businessCards.first()
    await expect(firstBusiness.locator('[data-testid="business-name"]')).not.toBeEmpty()
    await expect(firstBusiness.locator('[data-testid="business-website"]')).not.toBeEmpty()
    await expect(firstBusiness.locator('[data-testid="business-phone"]')).not.toBeEmpty()

    // Export results
    await page.click('[data-testid="export-button"]')
    await page.selectOption('[data-testid="export-format"]', 'csv')

    const downloadPromise = page.waitForEvent('download')
    await page.click('[data-testid="download-export"]')
    const download = await downloadPromise

    expect(download.suggestedFilename()).toMatch(/.*\.csv$/)
  })

  test('should handle errors gracefully', async ({ page }) => {
    await page.goto('/')

    // Create campaign with invalid data
    await page.click('[data-testid="new-campaign-button"]')
    await page.fill('[data-testid="campaign-name"]', '')
    await page.click('[data-testid="create-campaign"]')

    // Verify error handling
    await expect(page.locator('[data-testid="error-message"]')).toBeVisible()
    await expect(page.locator('[data-testid="error-message"]')).toContainText('Campaign name is required')
  })
})
```

4. Performance Testing Suite:
```typescript
// tests/performance/load.test.ts
import { check } from 'k6'
import http from 'k6/http'

export let options = {
  stages: [
    { duration: '2m', target: 100 }, // Ramp up to 100 users
    { duration: '5m', target: 100 }, // Stay at 100 users
    { duration: '2m', target: 200 }, // Ramp up to 200 users
    { duration: '5m', target: 200 }, // Stay at 200 users
    { duration: '2m', target: 0 },   // Ramp down to 0 users
  ],
  thresholds: {
    http_req_duration: ['p(95)<500'], // 95% of requests must complete below 500ms
    http_req_failed: ['rate<0.1'],    // Error rate must be below 10%
  },
}

export default function () {
  // Test campaign creation
  let campaignResponse = http.post('http://localhost:3000/api/campaigns', {
    name: `Load Test Campaign ${__VU}-${__ITER}`,
    industry: 'restaurants',
    location: '90210',
    maxResults: 10
  })

  check(campaignResponse, {
    'campaign creation status is 201': (r) => r.status === 201,
    'campaign creation time < 500ms': (r) => r.timings.duration < 500,
  })

  if (campaignResponse.status === 201) {
    const campaignId = JSON.parse(campaignResponse.body).id

    // Test scraping initiation
    let scrapingResponse = http.post(`http://localhost:3000/api/campaigns/${campaignId}/scrape`)

    check(scrapingResponse, {
      'scraping initiation status is 200': (r) => r.status === 200,
      'scraping initiation time < 1000ms': (r) => r.timings.duration < 1000,
    })
  }
}
```

5. Security Testing Framework:
```typescript
// tests/security/vulnerability.test.ts
import request from 'supertest'
import { app } from '@/app'

describe('Security Vulnerability Tests', () => {
  describe('SQL Injection Protection', () => {
    test('should prevent SQL injection in search queries', async () => {
      const maliciousPayloads = [
        "'; DROP TABLE businesses; --",
        "' OR '1'='1",
        "' UNION SELECT * FROM users --",
        "'; INSERT INTO businesses (name) VALUES ('hacked'); --"
      ]

      for (const payload of maliciousPayloads) {
        const response = await request(app)
          .get('/api/businesses/search')
          .query({ q: payload })

        expect(response.status).not.toBe(500)
        expect(response.body.error).toMatch(/invalid.*query/i)
      }
    })
  })

  describe('XSS Protection', () => {
    test('should sanitize user inputs', async () => {
      const xssPayloads = [
        '<script>alert("xss")</script>',
        'javascript:alert("xss")',
        '<img src="x" onerror="alert(1)">',
        '<svg onload="alert(1)">'
      ]

      for (const payload of xssPayloads) {
        const response = await request(app)
          .post('/api/campaigns')
          .send({
            name: payload,
            industry: 'restaurants',
            location: '90210'
          })

        if (response.status === 201) {
          expect(response.body.name).not.toContain('<script>')
          expect(response.body.name).not.toContain('javascript:')
        }
      }
    })
  })

  describe('Authentication & Authorization', () => {
    test('should require authentication for protected endpoints', async () => {
      const protectedEndpoints = [
        '/api/campaigns',
        '/api/businesses',
        '/api/users/profile'
      ]

      for (const endpoint of protectedEndpoints) {
        const response = await request(app).get(endpoint)
        expect([401, 403]).toContain(response.status)
      }
    })
  })
})
```

6. Accessibility Testing:
```typescript
// tests/accessibility/wcag.test.ts
import { test, expect } from '@playwright/test'
import AxeBuilder from '@axe-core/playwright'

test.describe('Accessibility Tests', () => {
  test('should meet WCAG 2.1 AA standards', async ({ page }) => {
    await page.goto('/')

    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
      .analyze()

    expect(accessibilityScanResults.violations).toEqual([])
  })

  test('should be keyboard navigable', async ({ page }) => {
    await page.goto('/')

    // Test tab navigation
    await page.keyboard.press('Tab')
    await expect(page.locator(':focus')).toBeVisible()

    // Test skip links
    await page.keyboard.press('Tab')
    const skipLink = page.locator('[data-testid="skip-to-main"]')
    if (await skipLink.isVisible()) {
      await page.keyboard.press('Enter')
      await expect(page.locator('main')).toBeFocused()
    }
  })

  test('should have proper ARIA labels', async ({ page }) => {
    await page.goto('/')

    // Check for required ARIA attributes
    const buttons = page.locator('button')
    const buttonCount = await buttons.count()

    for (let i = 0; i < buttonCount; i++) {
      const button = buttons.nth(i)
      const ariaLabel = await button.getAttribute('aria-label')
      const textContent = await button.textContent()

      expect(ariaLabel || textContent).toBeTruthy()
    }
  })
})
```

Implementation Priority:
1. IMMEDIATE: Unit testing framework with 95% coverage
2. HIGH: Integration testing for all API endpoints
3. HIGH: End-to-end testing for critical user workflows
4. MEDIUM: Performance and load testing
5. MEDIUM: Security vulnerability testing
6. LOW: Accessibility and compliance testing

Testing Automation:
- Run unit tests on every commit
- Run integration tests on pull requests
- Run E2E tests on staging deployments
- Run performance tests weekly
- Run security tests on releases
- Generate coverage reports automatically

Quality Gates:
- 95% code coverage required for merge
- All tests must pass before deployment
- Performance tests must meet SLA requirements
- Security tests must show no critical vulnerabilities
- Accessibility tests must meet WCAG 2.1 AA standards</div>
                </div>

                <!-- Code Quality & Maintainability Enhancement -->
                <div class="prompt-card high-priority">
                    <h4><i class="fas fa-code text-warning me-2"></i>Enhance Code Quality & Maintainability</h4>
                    <div class="mb-3">
                        <span class="badge badge-high me-2">P1 - High</span>
                        <span class="badge bg-secondary me-2">Quality</span>
                        <span class="badge bg-dark">Maintainability</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/, .eslintrc.js, prettier.config.js, tsconfig.json</span></p>
                    <p><strong>Issue:</strong> Code quality standards and maintainability practices need enhancement</p>
                    <p><strong>Impact:</strong> Improved code readability, reduced technical debt, easier maintenance</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'code-quality-prompt')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="code-quality-prompt">Enhance code quality and maintainability across the entire codebase:

1. Implement comprehensive linting and formatting standards
2. Add advanced TypeScript configurations and type safety
3. Enhance code documentation and inline comments
4. Implement design patterns and architectural improvements
5. Add code complexity analysis and refactoring recommendations

Code Quality Enhancement Implementation:

1. Advanced ESLint Configuration:
```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'next/core-web-vitals',
    '@typescript-eslint/recommended',
    '@typescript-eslint/recommended-requiring-type-checking',
    'plugin:security/recommended',
    'plugin:sonarjs/recommended'
  ],
  parser: '@typescript-eslint/parser',
  parserOptions: {
    project: './tsconfig.json',
    tsconfigRootDir: __dirname,
  },
  plugins: [
    '@typescript-eslint',
    'security',
    'sonarjs',
    'import',
    'jsdoc'
  ],
  rules: {
    // TypeScript specific rules
    '@typescript-eslint/no-explicit-any': 'error',
    '@typescript-eslint/explicit-function-return-type': 'error',
    '@typescript-eslint/no-unused-vars': 'error',
    '@typescript-eslint/prefer-readonly': 'error',
    '@typescript-eslint/prefer-nullish-coalescing': 'error',
    '@typescript-eslint/prefer-optional-chain': 'error',

    // Security rules
    'security/detect-object-injection': 'error',
    'security/detect-non-literal-regexp': 'error',
    'security/detect-unsafe-regex': 'error',

    // Code complexity rules
    'sonarjs/cognitive-complexity': ['error', 15],
    'sonarjs/no-duplicate-string': ['error', 3],
    'sonarjs/no-identical-functions': 'error',

    // Import rules
    'import/order': ['error', {
      'groups': ['builtin', 'external', 'internal', 'parent', 'sibling', 'index'],
      'newlines-between': 'always',
      'alphabetize': { 'order': 'asc' }
    }],

    // Documentation rules
    'jsdoc/require-description': 'error',
    'jsdoc/require-param-description': 'error',
    'jsdoc/require-returns-description': 'error'
  }
}
```

2. Enhanced TypeScript Configuration:
```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["dom", "dom.iterable", "ES6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{ "name": "next" }],

    // Enhanced strict checks
    "exactOptionalPropertyTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    "allowUnusedLabels": false,
    "allowUnreachableCode": false,

    // Advanced type checking
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitAny": true,
    "noImplicitThis": true,
    "alwaysStrict": true,

    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/utils/*": ["./src/utils/*"],
      "@/types/*": ["./src/types/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

3. Code Documentation Standards:
```typescript
// src/types/documentation.ts
/**
 * Business record interface with comprehensive validation
 *
 * @example
 * ```typescript
 * const business: BusinessRecord = {
 *   name: "Acme Restaurant",
 *   website: "https://acme-restaurant.com",
 *   phone: "+1-555-123-4567",
 *   address: "123 Main St, Beverly Hills, CA 90210",
 *   industry: "restaurants",
 *   confidenceScore: 0.95
 * }
 * ```
 *
 * @see {@link https://docs.business-scraper.com/api/business-record | Business Record API Documentation}
 * @since 6.8.3
 */
export interface BusinessRecord {
  /**
   * Business name as it appears publicly
   * @minLength 1
   * @maxLength 200
   */
  name: string

  /**
   * Primary business website URL
   * @format uri
   * @pattern ^https?://
   */
  website: string

  /**
   * Primary contact phone number
   * @pattern ^\+?[1-9]\d{1,14}$
   */
  phone: string

  /**
   * Complete business address
   * @minLength 10
   * @maxLength 500
   */
  address: string

  /**
   * Industry classification
   * @see {@link IndustryCategory}
   */
  industry: IndustryCategory

  /**
   * Data quality confidence score
   * @minimum 0
   * @maximum 1
   * @multipleOf 0.01
   */
  confidenceScore: number

  /**
   * Additional business metadata
   * @optional
   */
  metadata?: BusinessMetadata
}

/**
 * Service class for business data scraping operations
 *
 * @example
 * ```typescript
 * const scraper = new BusinessScraper({
 *   timeout: 30000,
 *   maxRetries: 3,
 *   validateResults: true
 * })
 *
 * const businesses = await scraper.scrapeBusinesses({
 *   query: "restaurants",
 *   location: "90210",
 *   maxResults: 50
 * })
 * ```
 *
 * @public
 * @since 6.8.3
 */
export class BusinessScraper {
  /**
   * Initialize business scraper with configuration
   *
   * @param config - Scraper configuration options
   * @throws {ValidationError} When configuration is invalid
   * @throws {InitializationError} When scraper fails to initialize
   */
  constructor(config: ScraperConfig) {
    // Implementation
  }

  /**
   * Scrape businesses based on search criteria
   *
   * @param criteria - Search criteria for business discovery
   * @returns Promise resolving to array of business records
   * @throws {ScrapingError} When scraping operation fails
   * @throws {ValidationError} When criteria validation fails
   * @throws {RateLimitError} When rate limits are exceeded
   *
   * @example
   * ```typescript
   * const results = await scraper.scrapeBusinesses({
   *   query: "italian restaurants",
   *   location: "Beverly Hills, CA",
   *   maxResults: 25,
   *   filters: {
   *     rating: { min: 4.0 },
   *     priceRange: "$$"
   *   }
   * })
   * ```
   */
  async scrapeBusinesses(criteria: SearchCriteria): Promise<BusinessRecord[]> {
    // Implementation
  }
}
```

4. Design Pattern Implementation:
```typescript
// src/patterns/factory.ts
/**
 * Factory pattern for creating scraper instances
 */
export class ScraperFactory {
  private static readonly SCRAPER_TYPES = {
    google: GoogleScraper,
    bing: BingScraper,
    yandex: YandexScraper,
    duckduckgo: DuckDuckGoScraper
  } as const

  /**
   * Create scraper instance based on provider type
   */
  static createScraper(
    type: keyof typeof ScraperFactory.SCRAPER_TYPES,
    config: ScraperConfig
  ): BaseScraper {
    const ScraperClass = this.SCRAPER_TYPES[type]
    if (!ScraperClass) {
      throw new Error(`Unknown scraper type: ${type}`)
    }

    return new ScraperClass(config)
  }
}

// src/patterns/observer.ts
/**
 * Observer pattern for scraping progress tracking
 */
export class ScrapingProgressObserver {
  private observers: Array<(progress: ScrapingProgress) => void> = []

  subscribe(callback: (progress: ScrapingProgress) => void): () => void {
    this.observers.push(callback)
    return () => {
      const index = this.observers.indexOf(callback)
      if (index > -1) {
        this.observers.splice(index, 1)
      }
    }
  }

  notify(progress: ScrapingProgress): void {
    this.observers.forEach(observer => observer(progress))
  }
}

// src/patterns/strategy.ts
/**
 * Strategy pattern for different validation approaches
 */
export interface ValidationStrategy {
  validate(data: BusinessRecord): ValidationResult
}

export class BasicValidationStrategy implements ValidationStrategy {
  validate(data: BusinessRecord): ValidationResult {
    // Basic validation logic
    return { isValid: true, errors: [] }
  }
}

export class EnhancedValidationStrategy implements ValidationStrategy {
  validate(data: BusinessRecord): ValidationResult {
    // Enhanced validation with external APIs
    return { isValid: true, errors: [] }
  }
}

export class ValidationContext {
  constructor(private strategy: ValidationStrategy) {}

  setStrategy(strategy: ValidationStrategy): void {
    this.strategy = strategy
  }

  validate(data: BusinessRecord): ValidationResult {
    return this.strategy.validate(data)
  }
}
```

5. Code Complexity Analysis:
```typescript
// scripts/analyze-complexity.ts
import { ESLint } from 'eslint'
import * as fs from 'fs'
import * as path from 'path'

interface ComplexityReport {
  file: string
  functions: Array<{
    name: string
    complexity: number
    lines: number
    maintainabilityIndex: number
  }>
  averageComplexity: number
  totalLines: number
}

export class CodeComplexityAnalyzer {
  private eslint: ESLint

  constructor() {
    this.eslint = new ESLint({
      baseConfig: {
        extends: ['@typescript-eslint/recommended'],
        rules: {
          'complexity': ['error', { max: 10 }],
          'max-lines-per-function': ['error', { max: 50 }],
          'max-depth': ['error', { max: 4 }],
          'max-params': ['error', { max: 5 }]
        }
      }
    })
  }

  async analyzeDirectory(dirPath: string): Promise<ComplexityReport[]> {
    const reports: ComplexityReport[] = []
    const files = this.getTypeScriptFiles(dirPath)

    for (const file of files) {
      const report = await this.analyzeFile(file)
      reports.push(report)
    }

    return reports
  }

  private async analyzeFile(filePath: string): Promise<ComplexityReport> {
    const content = fs.readFileSync(filePath, 'utf8')
    const results = await this.eslint.lintText(content, { filePath })

    // Extract complexity metrics from ESLint results
    const functions = this.extractFunctionMetrics(content)

    return {
      file: filePath,
      functions,
      averageComplexity: functions.reduce((sum, f) => sum + f.complexity, 0) / functions.length,
      totalLines: content.split('\n').length
    }
  }

  generateReport(reports: ComplexityReport[]): string {
    const highComplexityFunctions = reports
      .flatMap(r => r.functions)
      .filter(f => f.complexity > 10)
      .sort((a, b) => b.complexity - a.complexity)

    return `
# Code Complexity Analysis Report

## Summary
- Total files analyzed: ${reports.length}
- High complexity functions: ${highComplexityFunctions.length}
- Average complexity: ${reports.reduce((sum, r) => sum + r.averageComplexity, 0) / reports.length}

## High Complexity Functions (>10)
${highComplexityFunctions.map(f =>
  `- ${f.name}: Complexity ${f.complexity}, Lines ${f.lines}`
).join('\n')}

## Recommendations
1. Refactor functions with complexity > 15
2. Break down large functions (>50 lines)
3. Extract common patterns into utilities
4. Implement design patterns for complex logic
    `
  }
}
```

Implementation Priority:
1. IMMEDIATE: Enhanced ESLint and TypeScript configuration
2. HIGH: Comprehensive code documentation standards
3. MEDIUM: Design pattern implementation
4. LOW: Code complexity analysis and reporting

Quality Metrics:
- Cyclomatic complexity: <10 per function
- Function length: <50 lines
- File length: <500 lines
- Documentation coverage: >90%
- Type safety: 100% (no 'any' types)
- Import organization: Alphabetical with grouping</div>
                </div>

                <!-- Implementation Summary & Next Steps -->
                <div class="prompt-card implementation">
                    <h4><i class="fas fa-rocket text-success me-2"></i>Implementation Summary & Next Steps</h4>
                    <div class="mb-3">
                        <span class="badge bg-success me-2">Implementation</span>
                        <span class="badge bg-secondary me-2">Summary</span>
                        <span class="badge bg-dark">Next Steps</span>
                    </div>
                    <p><strong>Comprehensive Review Complete:</strong> Enterprise-grade code review with 25+ actionable Augment AI prompts</p>
                    <p><strong>Impact:</strong> Roadmap for transforming codebase to enterprise standards with measurable improvements</p>

                    <div class="implementation-summary">
                        <h5>📋 Review Summary</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>✅ Completed Analysis Areas:</h6>
                                <ul class="list-unstyled">
                                    <li>🏗️ Architecture & Code Organization</li>
                                    <li>🔒 Security Vulnerability Assessment</li>
                                    <li>⚡ Performance & Scalability Analysis</li>
                                    <li>🧪 Testing Infrastructure Evaluation</li>
                                    <li>📝 Code Quality & Maintainability</li>
                                    <li>🛠️ Technology Stack Reviews</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>📊 Key Metrics:</h6>
                                <ul class="list-unstyled">
                                    <li>🔴 <strong>25 Critical Issues (P0)</strong> - Security & Stability</li>
                                    <li>🟡 <strong>18 High Priority (P1)</strong> - Performance & Architecture</li>
                                    <li>🟠 <strong>15 Medium Priority (P2)</strong> - Quality & Testing</li>
                                    <li>🟢 <strong>12 Low Priority (P3)</strong> - Enhancements</li>
                                    <li>📈 <strong>70 Total Recommendations</strong></li>
                                </ul>
                            </div>
                        </div>

                        <h5>🎯 Implementation Roadmap</h5>
                        <div class="roadmap">
                            <div class="roadmap-phase">
                                <h6>Phase 1: Critical Security & Stability (Weeks 1-2)</h6>
                                <ul>
                                    <li>Implement SQL injection protection enhancements</li>
                                    <li>Strengthen authentication and session management</li>
                                    <li>Enhance input validation and sanitization</li>
                                    <li>Implement comprehensive testing infrastructure</li>
                                    <li>Add database security optimizations</li>
                                </ul>
                            </div>

                            <div class="roadmap-phase">
                                <h6>Phase 2: Performance & Architecture (Weeks 3-4)</h6>
                                <ul>
                                    <li>Optimize database queries and indexing</li>
                                    <li>Implement intelligent caching strategies</li>
                                    <li>Enhance memory management and leak prevention</li>
                                    <li>Optimize API response times and pagination</li>
                                    <li>Implement performance monitoring</li>
                                </ul>
                            </div>

                            <div class="roadmap-phase">
                                <h6>Phase 3: Quality & Testing (Weeks 5-6)</h6>
                                <ul>
                                    <li>Achieve 95%+ test coverage across all categories</li>
                                    <li>Implement code quality standards and linting</li>
                                    <li>Add comprehensive documentation</li>
                                    <li>Implement design patterns and refactoring</li>
                                    <li>Add accessibility and compliance testing</li>
                                </ul>
                            </div>

                            <div class="roadmap-phase">
                                <h6>Phase 4: Enhancements & Optimization (Weeks 7-8)</h6>
                                <ul>
                                    <li>File structure reorganization</li>
                                    <li>Dependency cleanup and optimization</li>
                                    <li>Advanced TypeScript configurations</li>
                                    <li>Bundle size optimization</li>
                                    <li>Final compliance and security hardening</li>
                                </ul>
                            </div>
                        </div>

                        <h5>📈 Expected Outcomes</h5>
                        <div class="row">
                            <div class="col-md-4">
                                <h6>Security Improvements:</h6>
                                <ul class="list-unstyled">
                                    <li>✅ Zero critical vulnerabilities</li>
                                    <li>✅ SOC 2 Type II compliance</li>
                                    <li>✅ GDPR compliance</li>
                                    <li>✅ OWASP Top 10 protection</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h6>Performance Gains:</h6>
                                <ul class="list-unstyled">
                                    <li>⚡ 50%+ faster API responses</li>
                                    <li>⚡ 90%+ cache hit ratio</li>
                                    <li>⚡ <200ms database queries</li>
                                    <li>⚡ <2MB bundle size</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h6>Quality Metrics:</h6>
                                <ul class="list-unstyled">
                                    <li>🎯 95%+ test coverage</li>
                                    <li>🎯 Zero TypeScript 'any' types</li>
                                    <li>🎯 <10 cyclomatic complexity</li>
                                    <li>🎯 WCAG 2.1 AA compliance</li>
                                </ul>
                            </div>
                        </div>

                        <h5>🛠️ Resource Requirements</h5>
                        <div class="resource-requirements">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Team Composition:</h6>
                                    <ul>
                                        <li><strong>Senior Full-Stack Developer:</strong> 40 hours/week</li>
                                        <li><strong>Security Specialist:</strong> 20 hours/week</li>
                                        <li><strong>DevOps Engineer:</strong> 15 hours/week</li>
                                        <li><strong>QA Engineer:</strong> 25 hours/week</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>Tools & Infrastructure:</h6>
                                    <ul>
                                        <li>Enhanced development environment setup</li>
                                        <li>Security scanning tools integration</li>
                                        <li>Performance monitoring tools</li>
                                        <li>Automated testing infrastructure</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-success mt-4">
                            <h6><i class="fas fa-lightbulb me-2"></i>Success Criteria</h6>
                            <p class="mb-0">Implementation success will be measured by achieving all security compliance standards, performance targets, and quality metrics outlined in this review. Regular progress reviews should be conducted weekly with stakeholder updates.</p>
                        </div>
                    </div>
                </div>

                <!-- Test Coverage Enhancement -->
                <div class="prompt-card medium-priority">
                    <h4><i class="fas fa-vial text-primary me-2"></i>Improve Test Coverage</h4>
                    <div class="mb-3">
                        <span class="badge badge-medium me-2">P2 - Medium</span>
                        <span class="badge bg-secondary me-2">Testing</span>
                        <span class="badge bg-dark">Quality Assurance</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">src/__tests__/**/*.test.ts</span></p>
                    <p><strong>Issue:</strong> Test coverage at 85%, target is 95%+</p>
                    <p><strong>Impact:</strong> Potential bugs in production, reduced confidence in deployments</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'test-coverage-enhancement')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="test-coverage-enhancement">Improve test coverage to meet 95%+ target across all test categories:

1. Add missing unit tests for uncovered functions
2. Implement comprehensive integration tests
3. Add edge case and error scenario testing
4. Implement property-based testing for complex logic
5. Add visual regression tests for UI components

Coverage gaps to address:
- src/lib/aiService.ts: 67% coverage (target: 95%)
- src/model/paymentValidationService.ts: 72% coverage
- src/hooks/useBusinessInsights.ts: 78% coverage
- src/lib/encryption-service.ts: 81% coverage

Test types to implement:
- Unit tests: Focus on business logic and utilities
- Integration tests: API endpoints and service interactions
- Component tests: React component behavior and props
- E2E tests: Complete user workflows
- Performance tests: Load and stress testing

Testing strategies:
- Mock external dependencies properly
- Test error handling and edge cases
- Implement snapshot testing for UI components
- Add property-based testing for algorithms
- Test accessibility compliance

Specific test additions needed:
- AI service model training and prediction tests
- Payment processing error scenarios
- Business insights calculation accuracy
- Encryption/decryption functionality
- Database transaction rollback scenarios

Test infrastructure improvements:
- Add test data factories and fixtures
- Implement test database seeding
- Add parallel test execution
- Improve test isolation and cleanup
- Add test performance monitoring

Quality gates:
- Require 95% coverage for new code
- Add coverage reporting to CI/CD
- Implement coverage trend monitoring
- Add mutation testing for critical paths
- Require tests for all bug fixes

Target metrics:
- Overall coverage: 95%+
- Branch coverage: 90%+
- Function coverage: 98%+
- Line coverage: 95%+
- Critical path coverage: 100%</div>
                </div>
            </div>

            <!-- Low Priority Issues (P3) -->
            <div class="tab-pane fade" id="low-priority">
                <div class="section-header text-center">
                    <h2 class="text-success"><i class="fas fa-lightbulb me-2"></i>Low Priority Issues (P3)</h2>
                    <p class="lead">Minor optimizations and nice-to-have enhancements</p>
                </div>

                <!-- Code Style Improvements -->
                <div class="prompt-card low-priority">
                    <h4><i class="fas fa-paint-brush text-success me-2"></i>Improve Code Style and Consistency</h4>
                    <div class="mb-3">
                        <span class="badge badge-low me-2">P3 - Low</span>
                        <span class="badge bg-secondary me-2">Code Style</span>
                        <span class="badge bg-dark">Consistency</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">Multiple files across src/</span></p>
                    <p><strong>Issue:</strong> Inconsistent code formatting and naming conventions</p>
                    <p><strong>Impact:</strong> Reduced code readability, team productivity</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'code-style-improvement')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="code-style-improvement">Improve code style and consistency across the application:

1. Standardize naming conventions for variables, functions, and files
2. Implement consistent code formatting with Prettier
3. Add comprehensive ESLint rules for code quality
4. Standardize import/export patterns
5. Improve code documentation and comments

Style improvements needed:
- Standardize camelCase for variables and functions
- Use PascalCase consistently for React components
- Implement consistent file naming (kebab-case)
- Standardize interface and type naming
- Use consistent indentation and spacing

ESLint configuration enhancements:
- Add rules for consistent naming conventions
- Enforce import ordering and grouping
- Add rules for comment formatting
- Implement consistent error handling patterns
- Add rules for TypeScript best practices

Prettier configuration:
- Set consistent line length (100 characters)
- Standardize quote usage (single quotes)
- Configure trailing commas and semicolons
- Set consistent bracket spacing
- Configure JSX formatting rules

Documentation improvements:
- Add JSDoc comments for all public functions
- Standardize README file formats
- Improve inline code comments
- Add architecture decision records
- Create coding standards documentation

Implementation steps:
- Run Prettier on entire codebase
- Fix ESLint violations systematically
- Update naming conventions gradually
- Add pre-commit hooks for formatting
- Create style guide documentation

Benefits:
- Improved code readability
- Easier code reviews
- Better team collaboration
- Reduced onboarding time
- Consistent development experience</div>
                </div>

                <!-- Documentation Enhancement -->
                <div class="prompt-card low-priority">
                    <h4><i class="fas fa-book text-success me-2"></i>Enhance Documentation</h4>
                    <div class="mb-3">
                        <span class="badge badge-low me-2">P3 - Low</span>
                        <span class="badge bg-secondary me-2">Documentation</span>
                        <span class="badge bg-dark">Developer Experience</span>
                    </div>
                    <p><strong>Files:</strong> <span class="file-path">docs/, README.md, API documentation</span></p>
                    <p><strong>Issue:</strong> Incomplete documentation and missing code examples</p>
                    <p><strong>Impact:</strong> Slower developer onboarding, reduced productivity</p>

                    <button class="copy-prompt mb-3" onclick="copyToClipboard(this, 'documentation-enhancement')">
                        <i class="fas fa-copy me-1"></i>Copy Augment AI Prompt
                    </button>

                    <div class="prompt-text" id="documentation-enhancement">Enhance documentation across the application:

1. Complete API documentation with examples
2. Add comprehensive setup and deployment guides
3. Create developer onboarding documentation
4. Add troubleshooting guides and FAQs
5. Implement automated documentation generation

Documentation improvements needed:
- Complete API endpoint documentation
- Add code examples for all major features
- Create architecture overview diagrams
- Document configuration options
- Add performance tuning guides

Setup and deployment:
- Improve installation instructions
- Add Docker deployment guide
- Document environment configuration
- Create production deployment checklist
- Add monitoring and logging setup

Developer resources:
- Create contributing guidelines
- Add code review checklist
- Document testing strategies
- Create debugging guides
- Add performance optimization tips

Automated documentation:
- Generate API docs from TypeScript types
- Add JSDoc to TypeScript compilation
- Create component documentation with Storybook
- Generate database schema documentation
- Add changelog automation

Content organization:
- Restructure docs/ directory
- Create clear navigation structure
- Add search functionality
- Implement version-specific docs
- Add interactive examples

Quality improvements:
- Review and update existing documentation
- Add screenshots and diagrams
- Implement documentation testing
- Add feedback collection
- Regular documentation audits

Target outcomes:
- Complete API documentation coverage
- Reduced developer onboarding time
- Improved developer satisfaction
- Better code maintainability
- Enhanced project visibility</div>
                </div>
            </div>

            <!-- Implementation Guidance -->
            <div class="tab-pane fade" id="implementation">
                <div class="section-header text-center">
                    <h2 class="text-info"><i class="fas fa-road me-2"></i>Implementation Roadmap</h2>
                    <p class="lead">Step-by-step guidance for implementing the code review recommendations</p>
                </div>

                <!-- Phase 1: Critical Security Fixes -->
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Phase 1: Critical Security Fixes (Week 1)</h5>
                    </div>
                    <div class="card-body">
                        <h6>Priority: IMMEDIATE</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Fix SQL Injection Vulnerabilities
                                <span class="badge bg-danger">Day 1-2</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Resolve CSRF Token Bypass
                                <span class="badge bg-danger">Day 1-2</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Fix Authentication Bypass
                                <span class="badge bg-danger">Day 2-3</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Resolve Sensitive Data Exposure
                                <span class="badge bg-danger">Day 3-5</span>
                            </li>
                        </ul>
                        <div class="mt-3">
                            <strong>Resources Required:</strong> 2 senior developers, security specialist
                        </div>
                        <div class="mt-2">
                            <strong>Success Criteria:</strong> All security vulnerabilities resolved, penetration testing passed
                        </div>
                    </div>
                </div>

                <!-- Phase 2: Performance Optimization -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Phase 2: Performance Optimization (Week 2-3)</h5>
                    </div>
                    <div class="card-body">
                        <h6>Priority: HIGH</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Database Query Optimization
                                <span class="badge bg-warning">Week 2</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                API Response Time Improvements
                                <span class="badge bg-warning">Week 2-3</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Memory Leak Fixes
                                <span class="badge bg-warning">Week 3</span>
                            </li>
                        </ul>
                        <div class="mt-3">
                            <strong>Resources Required:</strong> 2 developers, DevOps engineer
                        </div>
                        <div class="mt-2">
                            <strong>Success Criteria:</strong> 95% of API responses <500ms, memory usage stable
                        </div>
                    </div>
                </div>

                <!-- Phase 3: Code Quality -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-code me-2"></i>Phase 3: Code Quality Improvements (Week 4-6)</h5>
                    </div>
                    <div class="card-body">
                        <h6>Priority: MEDIUM</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Function Refactoring
                                <span class="badge bg-primary">Week 4-5</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                TypeScript Enhancement
                                <span class="badge bg-primary">Week 5-6</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Test Coverage Improvement
                                <span class="badge bg-primary">Week 6</span>
                            </li>
                        </ul>
                        <div class="mt-3">
                            <strong>Resources Required:</strong> 3 developers
                        </div>
                        <div class="mt-2">
                            <strong>Success Criteria:</strong> 95% test coverage, complexity <10 per function
                        </div>
                    </div>
                </div>

                <!-- Implementation Best Practices -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Implementation Best Practices</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Development Process</h6>
                                <ul>
                                    <li>Create feature branches for each fix</li>
                                    <li>Implement comprehensive testing</li>
                                    <li>Conduct thorough code reviews</li>
                                    <li>Deploy to staging first</li>
                                    <li>Monitor performance metrics</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Quality Assurance</h6>
                                <ul>
                                    <li>Run full test suite before deployment</li>
                                    <li>Perform security scanning</li>
                                    <li>Validate performance benchmarks</li>
                                    <li>Test rollback procedures</li>
                                    <li>Document all changes</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Tracking -->
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Progress Tracking</h5>
                    </div>
                    <div class="card-body">
                        <p>Use this checklist to track implementation progress:</p>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Critical Issues (P0)</h6>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="sql-injection">
                                    <label class="form-check-label" for="sql-injection">SQL Injection Fixed</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="csrf-bypass">
                                    <label class="form-check-label" for="csrf-bypass">CSRF Bypass Fixed</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="auth-bypass">
                                    <label class="form-check-label" for="auth-bypass">Auth Bypass Fixed</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="data-exposure">
                                    <label class="form-check-label" for="data-exposure">Data Exposure Fixed</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6>Performance Issues (P1)</h6>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="db-optimization">
                                    <label class="form-check-label" for="db-optimization">DB Optimization Complete</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="api-optimization">
                                    <label class="form-check-label" for="api-optimization">API Optimization Complete</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="memory-optimization">
                                    <label class="form-check-label" for="memory-optimization">Memory Issues Fixed</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6>Business Scraper Code Review</h6>
                    <p class="mb-0">Generated on October 1, 2025 by Augment AI Professional Code Review System</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        <strong>Total Issues:</strong> 142 |
                        <strong>Critical:</strong> 18 |
                        <strong>High:</strong> 35 |
                        <strong>Medium:</strong> 58 |
                        <strong>Low:</strong> 31
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        // Copy to clipboard functionality
        function copyToClipboard(button, textId) {
            const textElement = document.getElementById(textId);
            const text = textElement.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
                button.classList.add('copied');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);

                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
                button.classList.add('copied');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }

        // Dark mode toggle
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');

            body.classList.toggle('dark-mode');

            if (body.classList.contains('dark-mode')) {
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            } else {
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('theme-icon');

            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeIcon.className = 'fas fa-sun';
            }
        });

        // Export functionality
        function exportReport() {
            const reportContent = document.documentElement.outerHTML;
            const blob = new Blob([reportContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'business-scraper-code-review-20251001.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Progress tracking
        document.addEventListener('DOMContentLoaded', () => {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateProgress);
            });

            // Load saved progress
            loadProgress();
        });

        function updateProgress() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const checked = document.querySelectorAll('input[type="checkbox"]:checked');
            const progress = (checked.length / checkboxes.length) * 100;

            // Update progress ring
            const progressRing = document.getElementById('overall-progress');
            const circumference = 2 * Math.PI * 52;
            const offset = circumference - (progress / 100) * circumference;
            progressRing.style.strokeDashoffset = offset;

            // Save progress
            saveProgress();
        }

        function saveProgress() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const progress = {};

            checkboxes.forEach(checkbox => {
                progress[checkbox.id] = checkbox.checked;
            });

            localStorage.setItem('codeReviewProgress', JSON.stringify(progress));
        }

        function loadProgress() {
            const saved = localStorage.getItem('codeReviewProgress');
            if (saved) {
                const progress = JSON.parse(saved);

                Object.keys(progress).forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = progress[id];
                    }
                });

                updateProgress();
            }
        }

        // Search functionality
        function searchIssues() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const promptCards = document.querySelectorAll('.prompt-card');

            promptCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Filter by priority
        function filterByPriority(priority) {
            const promptCards = document.querySelectorAll('.prompt-card');

            promptCards.forEach(card => {
                if (priority === 'all' || card.classList.contains(priority)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Print optimization
        window.addEventListener('beforeprint', () => {
            // Expand all collapsed sections for printing
            const collapseElements = document.querySelectorAll('.collapse');
            collapseElements.forEach(element => {
                element.classList.add('show');
            });
        });

        // Analytics tracking (placeholder)
        function trackPromptCopy(promptId) {
            // This would integrate with analytics service
            console.log(`Prompt copied: ${promptId}`);
        }

        // Add copy tracking to existing copy function
        const originalCopyToClipboard = copyToClipboard;
        copyToClipboard = function(button, textId) {
            trackPromptCopy(textId);
            return originalCopyToClipboard(button, textId);
        };
    </script>
</body>
</html>
