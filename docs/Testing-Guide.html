<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Guide - Business Scraper Documentation</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <style>
        .header-link {
            text-decoration: none;
            color: inherit;
        }
        .header-link:hover {
            text-decoration: underline;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 1rem 0;
        }
        .table-responsive {
            margin: 1rem 0;
        }
        .nav-breadcrumb {
            background-color: #f8f9fa;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }
        .back-to-docs {
            margin-bottom: 2rem;
        }
        .content-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .alert {
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 1rem 0;
        }
        .alert-info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffecb5;
            color: #664d03;
        }
        .alert-success {
            background-color: #d1e7dd;
            border-color: #badbcc;
            color: #0f5132;
        }
        .alert-danger {
            background-color: #f8d7da;
            border-color: #f5c2c7;
            color: #842029;
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <div class="back-to-docs">
            <a href="readme.html" class="btn btn-outline-primary">
                ← Back to Documentation Hub
            </a>
        </div>
        
        <div class="nav-breadcrumb">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item">
                        <a href="readme.html">Documentation</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Testing Guide</li>
                </ol>
            </nav>
        </div>

        <main class="documentation-content">
            <h1>Testing Guide</h1>
<h2>Overview</h2>
<p>This guide covers the comprehensive testing strategy for the Business Scraper application, including unit tests, integration tests, end-to-end tests, and performance testing.</p>
<h2>Testing Stack</h2>
<ul>
<li><strong>Unit Tests</strong>: Jest with TypeScript support</li>
<li><strong>Integration Tests</strong>: Jest with mocked dependencies</li>
<li><strong>End-to-End Tests</strong>: Playwright</li>
<li><strong>Performance Tests</strong>: Custom performance utilities</li>
<li><strong>API Testing</strong>: Supertest with Jest</li>
<li><strong>Coverage</strong>: Jest coverage reports</li>
</ul>
<h2>Test Structure</h2>
<pre><code>src/
├── __tests__/
│   ├── lib/
│   │   ├── field-mapping/
│   │   │   ├── mapping-engine.test.ts
│   │   │   ├── transformations.test.ts
│   │   │   └── validators.test.ts
│   │   ├── export-templates/
│   │   │   ├── salesforce.test.ts
│   │   │   ├── hubspot.test.ts
│   │   │   ├── pipedrive.test.ts
│   │   │   ├── mailchimp.test.ts
│   │   │   └── constant-contact.test.ts
│   │   ├── integrations/
│   │   │   ├── api-framework.test.ts
│   │   │   ├── oauth2-service.test.ts
│   │   │   ├── webhook-service.test.ts
│   │   │   └── scheduling-service.test.ts
│   │   └── analytics/
│   │       ├── usage-analytics.test.ts
│   │       └── api-metrics.test.ts
│   ├── integration/
│   │   ├── api-endpoints.test.ts
│   │   ├── export-workflows.test.ts
│   │   └── webhook-delivery.test.ts
│   └── e2e/
│       ├── export-flow.spec.ts
│       ├── api-authentication.spec.ts
│       └── scheduling.spec.ts
</code></pre>
<h2>Running Tests</h2>
<h3>All Tests</h3>
<pre><code class="language-bash">npm test
</code></pre>
<h3>Unit Tests Only</h3>
<pre><code class="language-bash">npm run test:unit
</code></pre>
<h3>Integration Tests Only</h3>
<pre><code class="language-bash">npm run test:integration
</code></pre>
<h3>End-to-End Tests</h3>
<pre><code class="language-bash">npm run test:e2e
</code></pre>
<h3>Coverage Report</h3>
<pre><code class="language-bash">npm run test:coverage
</code></pre>
<h3>Watch Mode</h3>
<pre><code class="language-bash">npm run test:watch
</code></pre>
<h2>Test Categories</h2>
<h3>1. Unit Tests</h3>
<h4>Field Mapping Engine Tests</h4>
<ul>
<li><strong>File</strong>: <code>src/__tests__/lib/field-mapping/mapping-engine.test.ts</code></li>
<li><strong>Coverage</strong>: Schema management, transformation execution, validation</li>
<li><strong>Key Test Cases</strong>:<ul>
<li>Schema registration and retrieval</li>
<li>Field mapping execution with various data types</li>
<li>Transformation application and error handling</li>
<li>Performance with large datasets</li>
</ul>
</li>
</ul>
<h4>Export Template Tests</h4>
<ul>
<li><strong>Files</strong>: <code>src/__tests__/lib/export-templates/*.test.ts</code></li>
<li><strong>Coverage</strong>: Template configuration, data transformation, platform-specific features</li>
<li><strong>Key Test Cases</strong>:<ul>
<li>Template validation and configuration</li>
<li>Business data preprocessing and filtering</li>
<li>Field mapping accuracy</li>
<li>Platform-specific formatting (phone, email, address)</li>
<li>Lead scoring and data enrichment</li>
<li>Error handling and data quality control</li>
</ul>
</li>
</ul>
<h4>API Framework Tests</h4>
<ul>
<li><strong>File</strong>: <code>src/__tests__/lib/integrations/api-framework.test.ts</code></li>
<li><strong>Coverage</strong>: Request handling, authentication, rate limiting, CORS</li>
<li><strong>Key Test Cases</strong>:<ul>
<li>Request processing and response formatting</li>
<li>Authentication (OAuth 2.0, API Key)</li>
<li>Authorization and permission checking</li>
<li>Rate limiting enforcement</li>
<li>Error handling and metrics recording</li>
</ul>
</li>
</ul>
<h3>2. Integration Tests</h3>
<h4>API Endpoints Tests</h4>
<ul>
<li><strong>File</strong>: <code>src/__tests__/integration/api-endpoints.test.ts</code></li>
<li><strong>Coverage</strong>: End-to-end API functionality with mocked services</li>
<li><strong>Key Test Cases</strong>:<ul>
<li>Template listing and filtering</li>
<li>Export creation with various options</li>
<li>Analytics data retrieval</li>
<li>Error handling and validation</li>
<li>Response format consistency</li>
</ul>
</li>
</ul>
<h4>Export Workflows Tests</h4>
<ul>
<li><strong>Coverage</strong>: Complete export workflows from data input to output</li>
<li><strong>Key Test Cases</strong>:<ul>
<li>Multi-platform export execution</li>
<li>Export scheduling and delivery</li>
<li>Webhook notification delivery</li>
<li>Data quality validation across templates</li>
</ul>
</li>
</ul>
<h3>3. End-to-End Tests</h3>
<h4>Export Flow Tests</h4>
<ul>
<li><strong>Coverage</strong>: Complete user workflows through the application</li>
<li><strong>Key Test Cases</strong>:<ul>
<li>Business data import and validation</li>
<li>Template selection and configuration</li>
<li>Export execution and download</li>
<li>Scheduled export setup and monitoring</li>
</ul>
</li>
</ul>
<h4>API Authentication Tests</h4>
<ul>
<li><strong>Coverage</strong>: OAuth 2.0 and API key authentication flows</li>
<li><strong>Key Test Cases</strong>:<ul>
<li>OAuth authorization code flow</li>
<li>Token refresh and validation</li>
<li>API key authentication</li>
<li>Permission-based access control</li>
</ul>
</li>
</ul>
<h2>Test Data</h2>
<h3>Sample Business Records</h3>
<pre><code class="language-typescript">const testBusinessData: BusinessRecord[] = [
  {
    businessName: &#39;Acme Corporation&#39;,
    email: [&#39;contact@acme.com&#39;, &#39;sales@acme.com&#39;],
    phone: [&#39;5551234567&#39;, &#39;5559876543&#39;],
    website: &#39;https://acme.com&#39;,
    address: {
      street: &#39;123 Main Street&#39;,
      city: &#39;Anytown&#39;,
      state: &#39;CA&#39;,
      zipCode: &#39;12345&#39;,
      country: &#39;United States&#39;
    },
    industry: &#39;Technology&#39;,
    description: &#39;Leading technology company&#39;
  }
  // Additional test records...
]
</code></pre>
<h3>Mock Services</h3>
<pre><code class="language-typescript">// Mock export service
jest.mock(&#39;@/lib/enhanced-export-service&#39;, () =&gt; ({
  enhancedExportService: {
    listTemplates: jest.fn(() =&gt; mockTemplates),
    exportWithTemplate: jest.fn(() =&gt; mockExportResult),
    getTemplate: jest.fn(() =&gt; mockTemplate)
  }
}))

// Mock analytics service
jest.mock(&#39;@/lib/analytics/usage-analytics&#39;, () =&gt; ({
  usageAnalyticsService: {
    recordUsage: jest.fn(),
    getClientAnalytics: jest.fn(() =&gt; mockAnalytics),
    getRealTimeMetrics: jest.fn(() =&gt; mockMetrics)
  }
}))
</code></pre>
<h2>Performance Testing</h2>
<h3>Load Testing</h3>
<pre><code class="language-typescript">describe(&#39;Performance Tests&#39;, () =&gt; {
  test(&#39;should handle large dataset export efficiently&#39;, async () =&gt; {
    const largeDataset = Array(1000).fill(null).map((_, index) =&gt; ({
      businessName: `Company ${index}`,
      email: [`contact${index}@company${index}.com`],
      industry: &#39;Technology&#39;
    }))

    const startTime = Date.now()
    const result = await template.execute(largeDataset)
    const duration = Date.now() - startTime

    expect(result.success).toBe(true)
    expect(result.recordsExported).toBe(1000)
    expect(duration).toBeLessThan(10000) // Should complete within 10 seconds
    expect(result.metadata.averageProcessingTime).toBeLessThan(10) // &lt; 10ms per record
  })
})
</code></pre>
<h3>Memory Usage Testing</h3>
<pre><code class="language-typescript">test(&#39;should not leak memory during large exports&#39;, async () =&gt; {
  const initialMemory = process.memoryUsage().heapUsed
  
  for (let i = 0; i &lt; 10; i++) {
    await template.execute(largeDataset)
  }
  
  // Force garbage collection if available
  if (global.gc) {
    global.gc()
  }
  
  const finalMemory = process.memoryUsage().heapUsed
  const memoryIncrease = finalMemory - initialMemory
  
  expect(memoryIncrease).toBeLessThan(50 * 1024 * 1024) // Less than 50MB increase
})
</code></pre>
<h2>Security Testing</h2>
<h3>Input Validation Tests</h3>
<pre><code class="language-typescript">describe(&#39;Security Tests&#39;, () =&gt; {
  test(&#39;should sanitize malicious input&#39;, async () =&gt; {
    const maliciousData = [{
      businessName: &#39;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&#39;,
      email: [&#39;test@evil.com&#39;],
      description: &#39;DROP TABLE users; --&#39;
    }]

    const result = await template.execute(maliciousData)
    
    expect(result.exportData[0].Company).not.toContain(&#39;&lt;script&gt;&#39;)
    expect(result.exportData[0].Description).not.toContain(&#39;DROP TABLE&#39;)
  })

  test(&#39;should handle SQL injection attempts&#39;, async () =&gt; {
    const sqlInjectionData = [{
      businessName: &quot;&#39;; DROP TABLE businesses; --&quot;,
      email: [&#39;test@test.com&#39;]
    }]

    const result = await template.execute(sqlInjectionData)
    
    expect(result.success).toBe(true)
    expect(result.exportData[0].Company).not.toContain(&#39;DROP TABLE&#39;)
  })
})
</code></pre>
<h3>Authentication Tests</h3>
<pre><code class="language-typescript">describe(&#39;Authentication Security&#39;, () =&gt; {
  test(&#39;should reject invalid tokens&#39;, async () =&gt; {
    const request = new NextRequest(&#39;https://example.com/api/v1/exports&#39;, {
      headers: { &#39;Authorization&#39;: &#39;Bearer invalid-token&#39; }
    })

    const response = await handler(request)
    expect(response.status).toBe(401)
  })

  test(&#39;should enforce rate limits&#39;, async () =&gt; {
    // Simulate rapid requests
    const requests = Array(200).fill(null).map(() =&gt; 
      handler(new NextRequest(&#39;https://example.com/api/v1/exports&#39;))
    )

    const responses = await Promise.all(requests)
    const rateLimitedResponses = responses.filter(r =&gt; r.status === 429)
    
    expect(rateLimitedResponses.length).toBeGreaterThan(0)
  })
})
</code></pre>
<h2>Test Configuration</h2>
<h3>Jest Configuration</h3>
<pre><code class="language-javascript">// jest.config.js
module.exports = {
  preset: &#39;ts-jest&#39;,
  testEnvironment: &#39;node&#39;,
  roots: [&#39;&lt;rootDir&gt;/src&#39;],
  testMatch: [&#39;**/__tests__/**/*.test.ts&#39;],
  collectCoverageFrom: [
    &#39;src/**/*.ts&#39;,
    &#39;!src/**/*.d.ts&#39;,
    &#39;!src/__tests__/**/*&#39;
  ],
  coverageThreshold: {
    global: {
      branches: 85,
      functions: 85,
      lines: 85,
      statements: 85
    }
  },
  setupFilesAfterEnv: [&#39;&lt;rootDir&gt;/src/__tests__/setup.ts&#39;]
}
</code></pre>
<h3>Test Setup</h3>
<pre><code class="language-typescript">// src/__tests__/setup.ts
import { jest } from &#39;@jest/globals&#39;

// Global test setup
beforeAll(() =&gt; {
  // Set test environment variables
  process.env.NODE_ENV = &#39;test&#39;
  process.env.API_BASE_URL = &#39;http://localhost:3000&#39;
})

afterAll(() =&gt; {
  // Cleanup after all tests
  jest.clearAllMocks()
})

// Mock external dependencies
jest.mock(&#39;@/lib/security&#39;, () =&gt; ({
  getClientIP: jest.fn(() =&gt; &#39;127.0.0.1&#39;)
}))
</code></pre>
<h2>Continuous Integration</h2>
<h3>GitHub Actions Workflow</h3>
<pre><code class="language-yaml">name: Test Suite
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: &#39;18&#39;
      - run: npm ci
      - run: npm run test:coverage
      - run: npm run test:e2e
      - uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
</code></pre>
<h2>Coverage Requirements</h2>
<ul>
<li><strong>Minimum Coverage</strong>: 85% for all metrics (lines, functions, branches, statements)</li>
<li><strong>Critical Paths</strong>: 95% coverage for export templates and API endpoints</li>
<li><strong>New Code</strong>: 90% coverage requirement for all new features</li>
</ul>
<h2>Best Practices</h2>
<ol>
<li><strong>Test Isolation</strong>: Each test should be independent and not rely on other tests</li>
<li><strong>Descriptive Names</strong>: Test names should clearly describe what is being tested</li>
<li><strong>Arrange-Act-Assert</strong>: Follow the AAA pattern for test structure</li>
<li><strong>Mock External Dependencies</strong>: Use mocks for external services and APIs</li>
<li><strong>Test Edge Cases</strong>: Include tests for error conditions and edge cases</li>
<li><strong>Performance Awareness</strong>: Include performance assertions for critical paths</li>
<li><strong>Security Focus</strong>: Test for common security vulnerabilities</li>
<li><strong>Documentation</strong>: Keep tests well-documented and maintainable</li>
</ol>
<h2>Debugging Tests</h2>
<h3>Running Specific Tests</h3>
<pre><code class="language-bash"># Run specific test file
npm test -- mapping-engine.test.ts

# Run tests matching pattern
npm test -- --testNamePattern=&quot;should execute mapping&quot;

# Run tests in debug mode
npm test -- --detectOpenHandles --forceExit
</code></pre>
<h3>Test Debugging</h3>
<pre><code class="language-typescript">// Add debugging output
test(&#39;should debug export process&#39;, async () =&gt; {
  console.log(&#39;Starting export test...&#39;)
  
  const result = await template.execute(testData)
  
  console.log(&#39;Export result:&#39;, JSON.stringify(result, null, 2))
  
  expect(result.success).toBe(true)
})
</code></pre>
<p>This comprehensive testing strategy ensures high-quality, reliable code with excellent coverage across all application components.</p>

        </main>

        <footer class="text-center mt-5 pt-4 border-top">
            <p class="text-muted">
                <strong>Business Scraper Application v3.0.0</strong> - Enterprise Multi-User Collaboration Platform
            </p>
            <p class="text-muted">
                <a href="readme.html">Documentation Hub</a> | 
                <a href="https://github.com/mytech-today-now/business_scraper">GitHub Repository</a>
            </p>
            <p class="text-muted small">Last updated: 8/24/2025</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>